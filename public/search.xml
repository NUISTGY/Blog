<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>JDBC åŸºç¡€</title>
      <link href="/2022/12/20/JDBC-1/"/>
      <url>/2022/12/20/JDBC-1/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="ä»€ä¹ˆæ˜¯-JDBC"><a href="#ä»€ä¹ˆæ˜¯-JDBC" class="headerlink" title="ä»€ä¹ˆæ˜¯ JDBC"></a>ä»€ä¹ˆæ˜¯ JDBC</h2><p>JDBCï¼ŒJava Database Connectivityï¼ˆJava æ•°æ®åº“è¿æ¥ï¼‰ï¼Œæ˜¯ä¸€ç»„æ‰§è¡Œ SQL è¯­å¥çš„ Java APIã€‚</p><p>JDBCï¼Œæ˜¯ Java SEï¼ˆJava Platform, Standard Editionï¼‰æ ‡å‡†çš„ä¸€éƒ¨åˆ†ã€‚</p><p>Java ç¨‹åºå¯ä»¥é€šè¿‡ JDBC è¿æ¥åˆ°å…³ç³»å‹æ•°æ®åº“ï¼Œå¹¶ä¸”ä½¿ç”¨ SQLï¼ˆStructured Query Languageï¼Œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰å®Œæˆå¯¹æ•°æ®åº“çš„æ“ä½œã€‚</p><p>æˆ‘ä»¬å¼€å‘æ—¶å¸¸ç”¨çš„ ORM æ¡†æ¶ï¼ˆObject Relational Mappingï¼‰ï¼Œä¾‹å¦‚ Hibernateï¼ŒMyBatisï¼Œå…¶æœ¬è´¨å°±æ˜¯å¯¹ JDBC çš„ä¸€ç§å°è£…ã€‚</p><h2 id="JDBC-é©±åŠ¨å’Œé¢å‘æ¥å£ç¼–ç¨‹"><a href="#JDBC-é©±åŠ¨å’Œé¢å‘æ¥å£ç¼–ç¨‹" class="headerlink" title="JDBC é©±åŠ¨å’Œé¢å‘æ¥å£ç¼–ç¨‹"></a>JDBC é©±åŠ¨å’Œé¢å‘æ¥å£ç¼–ç¨‹</h2><p>Java APIï¼Œå°±æ˜¯æ¥å£ï¼ˆinterfaceï¼‰ï¼Œæ‰€ä»¥è¯´ JDBC åªç»™å‡ºäº†æ¥å£ï¼Œæ²¡æœ‰æä¾›å®ç°ç±»ã€‚</p><p>ç”±å„ä¸ªæ•°æ®åº“çš„å‚å•†æä¾› JDBC çš„å®ç°ï¼Œè¿™äº›å®ç°ç±»å°±æ˜¯æˆ‘ä»¬å£ä¸­å¸¸è¯´çš„ï¼šé©±åŠ¨ç¨‹åºã€‚</p><p>JDBC çš„ç¼–ç¨‹å·¥ä½œï¼Œæ˜¯éœ€è¦é¢å‘æ ‡å‡†çš„ JDBC APIï¼Œä¸éœ€è¦å…³å¿ƒä½¿ç”¨çš„æ•°æ®åº“åˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p><p>ä½¿ç”¨ Oracleï¼ŒDB2ï¼Œè¿˜æ˜¯ MyBatis å¯¹äº JDBC çš„ç¼–ç¨‹éƒ½æ²¡æœ‰å½±å“ï¼Œè¿™å°±æ˜¯é¢å‘æ¥å£ç¼–ç¨‹ã€‚</p><p>ç†è®ºä¸Šè¯´ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢æ•°æ®åº“ï¼Œåªéœ€è¦æ¢ä¸€ä¸ªé©±åŠ¨ç¨‹åºå°±å¯ä»¥äº†ï¼Œæ‰€ä»¥è¯´ï¼ŒJDBC å…·æœ‰è·¨æ•°æ®åº“çš„ç‰¹æ€§ã€‚</p><p>å½“ç„¶å®é™…æ“ä½œä¸Šæ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œå› ä¸º JDBC è·¨æ•°æ®åº“çš„ç‰¹æ€§æ˜¯åŸºäºå…¨éƒ¨ä½¿ç”¨æ ‡å‡†çš„ SQL è¯­å¥ï¼Œè€ŒæŸäº›æ•°æ®åº“ä¼šæœ‰ä¸€äº›åªæœ‰è‡ªå·±æ‰èƒ½ç”¨çš„ç‰¹æ®Š SQL è¯­æ³•ã€‚</p><p>ä¾‹å¦‚ï¼ŒOracle çš„ rowidã€rownumï¼ŒMySQL çš„ limitã€‚</p><h2 id="JDBC-ç»„æˆå’ŒåŠŸèƒ½"><a href="#JDBC-ç»„æˆå’ŒåŠŸèƒ½" class="headerlink" title="JDBC ç»„æˆå’ŒåŠŸèƒ½"></a>JDBC ç»„æˆå’ŒåŠŸèƒ½</h2><p>JDBCçš„æ€»ä½“ç»“æ„æœ‰å››ä¸ªç»„ä»¶ï¼šåº”ç”¨ç¨‹åºã€é©±åŠ¨ç¨‹åºç®¡ç†å™¨ã€é©±åŠ¨ç¨‹åºå’Œæ•°æ®æºã€‚ </p><p><img src="https://i.328888.xyz/2022/12/20/Aw9AU.md.png" alt></p><p>JDBC ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li>å»ºç«‹ç¨‹åºä¸æ•°æ®åº“çš„è¿æ¥ã€‚</li><li>æ‰§è¡Œ SQL è¯­å¥ã€‚</li><li>è·å¾— SQL è¯­å¥çš„æ‰§è¡Œç»“æœã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> JDBC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> JDBC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springä¸­æ³¨å†ŒBeançš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</title>
      <link href="/2022/12/19/Spring%E4%B8%AD%E6%B3%A8%E5%86%8CBean%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/"/>
      <url>/2022/12/19/Spring%E4%B8%AD%E6%B3%A8%E5%86%8CBean%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä½¿ç”¨Springæ¡†æ¶åï¼ŒBeanç»Ÿä¸€éƒ½äº¤ç»™IOCå®¹å™¨å»ç®¡ç†å’Œåˆ›å»ºï¼Œé‚£ä¹ˆå°†ä¸€ä¸ªå¯¹è±¡åŠ å…¥åˆ°Springå®¹å™¨ä¸­æœ‰å“ªäº›æ–¹å¼å‘¢ï¼Œä»Šå¤©æˆ‘ä»¬ç»“åˆå…·ä½“çš„ä»£ç æ¥æ€»ç»“ä¸€ä¸‹ã€‚</p><h2 id="äºŒã€ç¬¬ä¸€ç§æ–¹å¼ï¼š-XMLé…ç½®æ–¹å¼"><a href="#äºŒã€ç¬¬ä¸€ç§æ–¹å¼ï¼š-XMLé…ç½®æ–¹å¼" class="headerlink" title="äºŒã€ç¬¬ä¸€ç§æ–¹å¼ï¼š XMLé…ç½®æ–¹å¼"></a>äºŒã€ç¬¬ä¸€ç§æ–¹å¼ï¼š XMLé…ç½®æ–¹å¼</h2><p>XMLé…ç½®çš„æ–¹å¼ï¼Œæ˜¯Springæœ€æ—©æ”¯æŒçš„æ–¹å¼ï¼Œä¸è¿‡ç°åœ¨XMLæ–¹å¼å·²ç»ç”¨çš„æ¯”è¾ƒå°‘äº†ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨åé¢çš„é…ç½®æ–¹å¼æ›¿ä»£äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">   xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">   xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span><br><span class="line">&lt;bean id=<span class="string">"student"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.wsh.injectbean.method_01.Student"</span>/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¬¬ä¸€ç§æ–¹å¼ï¼š XMLæ–‡ä»¶é…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">ClassPathXmlApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:spring-config.xml"</span>);</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"student"</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€ç¬¬äºŒç§æ–¹å¼ï¼š-ä½¿ç”¨-Componentæ³¨è§£-ComponentScanåŒ…æ‰«ææ–¹å¼"><a href="#ä¸‰ã€ç¬¬äºŒç§æ–¹å¼ï¼š-ä½¿ç”¨-Componentæ³¨è§£-ComponentScanåŒ…æ‰«ææ–¹å¼" class="headerlink" title="ä¸‰ã€ç¬¬äºŒç§æ–¹å¼ï¼š ä½¿ç”¨@Componentæ³¨è§£ + @ComponentScanåŒ…æ‰«ææ–¹å¼"></a>ä¸‰ã€ç¬¬äºŒç§æ–¹å¼ï¼š ä½¿ç”¨@Componentæ³¨è§£ + @ComponentScanåŒ…æ‰«ææ–¹å¼</h2><p>ä¸ºäº†è§£å†³beanå¤ªå¤šæ—¶ï¼ŒXMLæ–‡ä»¶è¿‡å¤§ï¼Œä»è€Œå¯¼è‡´è†¨èƒ€ä¸å¥½ç»´æŠ¤çš„é—®é¢˜ã€‚åœ¨Spring2.5ä¸­å¼€å§‹æ”¯æŒï¼š@Componentã€@Repositoryã€@Serviceã€@Controllerç­‰æ³¨è§£å®šä¹‰beanã€‚@Componentæ”¾åœ¨ç±»åä¸Šé¢ï¼Œç„¶åé€šè¿‡@ComponentScanæŒ‡å®šä¸€ä¸ªè·¯å¾„ï¼ŒSpringè¿›è¡Œæ‰«æå¸¦æœ‰@Componetæ³¨è§£çš„beanï¼Œç„¶ååŠ è‡³å®¹å™¨ä¸­ã€‚</p><p><strong>æ³¨æ„ï¼Œè¿™ç§æ–¹å¼ä¸å•å•æŒ‡çš„æ˜¯@Componentæ³¨è§£ï¼Œè¿˜åŒ…æ‹¬@Controlerã€@Serviceã€@Repositoryç­‰æ´¾ç”Ÿçš„æ³¨è§£ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserHandler</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.wsh.injectbean.method_02"</span>)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¬¬äºŒç§æ–¹å¼ï¼š ä½¿ç”¨<span class="doctag">@Component</span>æ³¨è§£ + <span class="doctag">@ComponentScan</span>åŒ…æ‰«ææ–¹å¼</span></span><br><span class="line"><span class="comment"> * åŒ…æ‹¬<span class="doctag">@Controler</span>ã€<span class="doctag">@Service</span>ã€<span class="doctag">@Repository</span>ç­‰æ´¾ç”Ÿçš„æ³¨è§£ã€‚</span></span><br><span class="line"><span class="comment"> * ä¸ºäº†è§£å†³beanå¤ªå¤šæ—¶ï¼Œxmlæ–‡ä»¶è¿‡å¤§ï¼Œä»è€Œå¯¼è‡´è†¨èƒ€ä¸å¥½ç»´æŠ¤çš„é—®é¢˜ã€‚åœ¨spring2.5ä¸­å¼€å§‹æ”¯æŒï¼š<span class="doctag">@Component</span>ã€<span class="doctag">@Repository</span>ã€<span class="doctag">@Service</span>ã€<span class="doctag">@Controller</span>ç­‰æ³¨è§£å®šä¹‰beanã€‚</span></span><br><span class="line"><span class="comment"> * å…¶å®æœ¬è´¨ä¸Š<span class="doctag">@Controler</span>ã€<span class="doctag">@Service</span>ã€<span class="doctag">@Repository</span>ä¹Ÿæ˜¯ä½¿ç”¨<span class="doctag">@Component</span>æ³¨è§£ä¿®é¥°çš„ã€‚</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * é€šå¸¸æƒ…å†µä¸‹ï¼š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Controller</span>ï¼šä¸€èˆ¬ç”¨åœ¨æ§åˆ¶å±‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Service</span>ï¼šä¸€èˆ¬ç”¨åœ¨ä¸šåŠ¡å±‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Repository</span>ï¼šä¸€èˆ¬ç”¨åœ¨æŒä¹…å±‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Component</span>ï¼šä¸€èˆ¬ç”¨åœ¨å…¬å…±ç»„ä»¶ä¸Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig.class);</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"userDao"</span>));</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"userService"</span>));</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"userController"</span>));</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"userHandler"</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››ã€ç¬¬ä¸‰ç§æ–¹å¼ï¼š-Configuration-Beanæ–¹å¼"><a href="#å››ã€ç¬¬ä¸‰ç§æ–¹å¼ï¼š-Configuration-Beanæ–¹å¼" class="headerlink" title="å››ã€ç¬¬ä¸‰ç§æ–¹å¼ï¼š@Configuration + @Beanæ–¹å¼"></a>å››ã€ç¬¬ä¸‰ç§æ–¹å¼ï¼š@Configuration + @Beanæ–¹å¼</h2><p>è¿™ç§æ–¹å¼å…¶å®ä¹Ÿæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ–¹å¼ä¹‹ä¸€ï¼Œ@Configurationç”¨æ¥å£°æ˜ä¸€ä¸ªé…ç½®ç±»ï¼Œç„¶åä½¿ç”¨ @Bean æ³¨è§£å£°æ˜ä¸€ä¸ªbeanï¼Œå°†å…¶åŠ å…¥åˆ°Springå®¹å™¨ä¸­ã€‚</p><p><strong>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœé¡¹ç›®ä¸­æœ‰ä½¿ç”¨åˆ°ç¬¬ä¸‰æ–¹ç±»åº“ä¸­çš„å·¥å…·ç±»çš„è¯ï¼Œæˆ‘ä»¬éƒ½æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼æ³¨å†ŒBeanã€‚</strong></p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">student</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Student();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¬¬ä¸‰ç§æ–¹å¼ï¼š<span class="doctag">@Configuration</span> + <span class="doctag">@Bean</span>æ–¹å¼</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœé¡¹ç›®ä¸­æœ‰ä½¿ç”¨åˆ°ç¬¬ä¸‰æ–¹ç±»åº“ä¸­çš„å·¥å…·ç±»çš„è¯ï¼Œæˆ‘ä»¬éƒ½æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼æ³¨å†ŒBean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig.class);</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"student"</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº”ã€ç¬¬å››ç§æ–¹å¼ï¼šFactoryBeanæ–¹å¼"><a href="#äº”ã€ç¬¬å››ç§æ–¹å¼ï¼šFactoryBeanæ–¹å¼" class="headerlink" title="äº”ã€ç¬¬å››ç§æ–¹å¼ï¼šFactoryBeanæ–¹å¼"></a>äº”ã€ç¬¬å››ç§æ–¹å¼ï¼šFactoryBeanæ–¹å¼</h2><p>FactoryBeanæ˜¯ä¸€ä¸ªBeanï¼Œå®ƒå…è®¸æˆ‘ä»¬è‡ªå®šä¹‰Beançš„åˆ›å»ºï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ol><li>getObject()ï¼šè‡ªå®šä¹‰Beanå¦‚ä½•åˆ›å»ºï¼›</li><li>getObjectType()ï¼šè¦æ³¨å†Œçš„Beançš„ç±»å‹ï¼›</li><li>isSingleton()ï¼šæ˜¯å¦å•ä¾‹ï¼›</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line"><span class="keyword">return</span> User.class;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.wsh.injectbean.method_04"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¬¬å››ç§æ–¹å¼ï¼šä½¿ç”¨FactoryBean</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * FactoryBeanåœ¨ä¸€äº›æ¡†æ¶æ•´åˆä¸Šç”¨çš„æ¯”è¾ƒå¤šï¼Œå¦‚Mybatisä¸Springçš„æ•´åˆä¸­ï¼šMapperFactoryBeanã€SqlSessionFactoryBeanç­‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig.class);</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"userFactoryBean"</span>));</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"&amp;userFactoryBean"</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…­ã€ç¬¬äº”ç§æ–¹å¼ï¼š-Importæ–¹å¼"><a href="#å…­ã€ç¬¬äº”ç§æ–¹å¼ï¼š-Importæ–¹å¼" class="headerlink" title="å…­ã€ç¬¬äº”ç§æ–¹å¼ï¼š@Importæ–¹å¼"></a>å…­ã€ç¬¬äº”ç§æ–¹å¼ï¼š@Importæ–¹å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Import</span>(&#123;Student.class&#125;)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¬¬äº”ç§æ–¹å¼ï¼š<span class="doctag">@Import</span>æ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig.class);</span><br><span class="line"><span class="keyword">for</span> (String beanDefinitionName : applicationContext.getBeanDefinitionNames()) &#123;</span><br><span class="line">System.out.println(beanDefinitionName);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"================"</span>);</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"com.wsh.injectbean.method_05.Student"</span>));</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"student"</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸ƒã€ç¬¬å…­ç§æ–¹å¼ï¼š-Import-ImportSelectoræ–¹å¼"><a href="#ä¸ƒã€ç¬¬å…­ç§æ–¹å¼ï¼š-Import-ImportSelectoræ–¹å¼" class="headerlink" title="ä¸ƒã€ç¬¬å…­ç§æ–¹å¼ï¼š@Import + ImportSelectoræ–¹å¼"></a>ä¸ƒã€ç¬¬å…­ç§æ–¹å¼ï¼š@Import + ImportSelectoræ–¹å¼</h2><p>é¦–å…ˆä»‹ç»ä¸€ä¸‹ImportSelectoræ¥å£çš„å¥½å¤„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ol><li><p>æŠŠæŸä¸ªåŠŸèƒ½çš„ç›¸å…³ç±»æ”¾åˆ°ä¸€èµ·ï¼Œæ–¹é¢ç®¡ç†å’Œç»´æŠ¤ã€‚</p></li><li><p>é‡å†™selectImportsæ–¹æ³•æ—¶ï¼Œèƒ½å¤Ÿæ ¹æ®æ¡ä»¶åˆ¤æ–­æŸäº›ç±»æ˜¯å¦éœ€è¦è¢«å®ä¾‹åŒ–ï¼Œæˆ–è€…æŸä¸ªæ¡ä»¶å®ä¾‹åŒ–è¿™äº›beanï¼Œå…¶ä»–çš„æ¡ä»¶å®ä¾‹åŒ–é‚£äº›beanç­‰ï¼Œæˆ‘ä»¬èƒ½å¤Ÿéå¸¸çµæ´»çš„å®šåˆ¶åŒ–beançš„å®ä¾‹åŒ–ã€‚</p></li></ol><p>è¿™ç§æ–¹å¼æˆ‘ä»¬éœ€è¦å®ç°ImportSelectoræ¥å£ï¼Œå¹¶é‡å†™selectImports()æ–¹æ³•ï¼Œç„¶åå°†æˆ‘ä»¬è¦å¯¼å…¥çš„ç±»çš„å…¨é™å®šåå†™åœ¨é‡Œé¢å³å¯ã€‚</p><p><strong>æŒ‡å®šéœ€è¦å®šä¹‰beançš„ç±»åï¼Œæ³¨æ„è¦åŒ…å«å®Œæ•´è·¯å¾„ï¼Œè€Œéç›¸å¯¹è·¯å¾„ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImportSelector</span> <span class="keyword">implements</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æŒ‡å®šéœ€è¦å®šä¹‰beançš„ç±»åï¼Œæ³¨æ„è¦åŒ…å«å®Œæ•´è·¯å¾„ï¼Œè€Œéç›¸å¯¹è·¯å¾„</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">"com.wsh.injectbean.method_06.Product"</span>, <span class="string">"com.wsh.injectbean.method_06.User"</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Import</span>(&#123;MyImportSelector.class&#125;)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¬¬å…­ç§æ–¹å¼ï¼š<span class="doctag">@Import</span> + ImportSelectoræ–¹å¼</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ImportSelectoræ¥å£çš„å¥½å¤„ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 1.æŠŠæŸä¸ªåŠŸèƒ½çš„ç›¸å…³ç±»æ”¾åˆ°ä¸€èµ·ï¼Œæ–¹é¢ç®¡ç†å’Œç»´æŠ¤ã€‚</span></span><br><span class="line"><span class="comment"> * 2.é‡å†™selectImportsæ–¹æ³•æ—¶ï¼Œèƒ½å¤Ÿæ ¹æ®æ¡ä»¶åˆ¤æ–­æŸäº›ç±»æ˜¯å¦éœ€è¦è¢«å®ä¾‹åŒ–ï¼Œæˆ–è€…æŸä¸ªæ¡ä»¶å®ä¾‹åŒ–è¿™äº›beanï¼Œå…¶ä»–çš„æ¡ä»¶å®ä¾‹åŒ–é‚£äº›beanç­‰,æˆ‘ä»¬èƒ½å¤Ÿéå¸¸çµæ´»çš„å®šåˆ¶åŒ–beançš„å®ä¾‹åŒ–ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig.class);</span><br><span class="line"><span class="keyword">for</span> (String beanDefinitionName : applicationContext.getBeanDefinitionNames()) &#123;</span><br><span class="line">System.out.println(beanDefinitionName);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"================"</span>);</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"com.wsh.injectbean.method_06.Product"</span>));</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"product"</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"================"</span>);</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"com.wsh.injectbean.method_06.User"</span>));</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"user"</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…«ã€ç¬¬ä¸ƒç§æ–¹å¼ï¼š-Import-ImportBeanDefinitionRegistraræ–¹å¼"><a href="#å…«ã€ç¬¬ä¸ƒç§æ–¹å¼ï¼š-Import-ImportBeanDefinitionRegistraræ–¹å¼" class="headerlink" title="å…«ã€ç¬¬ä¸ƒç§æ–¹å¼ï¼š@Import + ImportBeanDefinitionRegistraræ–¹å¼?"></a>å…«ã€ç¬¬ä¸ƒç§æ–¹å¼ï¼š@Import + ImportBeanDefinitionRegistraræ–¹å¼?</h2><p>è¿™ç§æ–¹å¼æˆ‘ä»¬éœ€è¦å®ç°ImportBeanDefinitionRegistraræ¥å£ï¼Œå¹¶é‡å†™registerBeanDefinitions()æ–¹æ³•ï¼Œç„¶åå®šä¹‰æˆ‘ä»¬éœ€è¦æ³¨å†Œçš„Beançš„å®šä¹‰ä¿¡æ¯ï¼Œç„¶åregistry.registerBeanDefinition()æ–¹æ³•æ³¨å†Œå³å¯ã€‚<strong>è¿™ç§æ–¹å¼æ¯”ImportSelectoræ›´åŠ çµæ´»ï¼Œå¯ä»¥è‡ªå®šä¹‰beançš„åç§°ã€ä½œç”¨åŸŸç­‰å¾ˆå¤šå‚æ•°ã€‚</strong> åƒæˆ‘ä»¬å¸¸è§çš„Spring Cloudä¸­çš„Feignï¼Œå°±ä½¿ç”¨äº†ImportBeanDefinitionRegistrarï¼Œå…·ä½“å¯ä»¥å‚è€ƒFeignClientsRegistrarç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line"><span class="comment">// å¯ä»¥è‡ªå®šä¹‰beançš„åç§°ã€ä½œç”¨åŸŸç­‰å¾ˆå¤šå‚æ•°</span></span><br><span class="line">registry.registerBeanDefinition(<span class="string">"user"</span>, <span class="keyword">new</span> RootBeanDefinition(User.class));</span><br><span class="line">RootBeanDefinition rootBeanDefinition = <span class="keyword">new</span> RootBeanDefinition(Product.class);</span><br><span class="line">rootBeanDefinition.setScope(BeanDefinition.SCOPE_SINGLETON);</span><br><span class="line">registry.registerBeanDefinition(<span class="string">"product"</span>, rootBeanDefinition);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Import</span>(&#123;CustomImportBeanDefinitionRegistrar.class&#125;)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¬¬ä¸ƒç§æ–¹å¼ï¼š<span class="doctag">@Import</span> + ImportBeanDefinitionRegistraræ–¹å¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å¯ä»¥è‡ªå®šä¹‰beançš„åç§°ã€ä½œç”¨åŸŸç­‰å¾ˆå¤šå‚æ•°, åƒæˆ‘ä»¬å¸¸è§çš„Spring Cloudä¸­çš„Feignï¼Œå°±ä½¿ç”¨äº†ImportBeanDefinitionRegistrar</span></span><br><span class="line"><span class="comment"> * class FeignClientsRegistrar implements ImportBeanDefinitionRegistrar, ResourceLoaderAware, EnvironmentAware &#123;</span></span><br><span class="line"><span class="comment"> * public void registerBeanDefinitions(AnnotationMetadata metadata, BeanDefinitionRegistry registry) &#123;</span></span><br><span class="line"><span class="comment"> *         this.registerDefaultConfiguration(metadata, registry);</span></span><br><span class="line"><span class="comment"> *         this.registerFeignClients(metadata, registry);</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig.class);</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"product"</span>));</span><br><span class="line">System.out.println(applicationContext.getBean(<span class="string">"user"</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springä¾èµ–æ³¨å…¥æ³¨è§£@Resourceå’Œ@Autowired</title>
      <link href="/2022/12/18/Autowired&amp;Resource/"/>
      <url>/2022/12/18/Autowired&amp;Resource/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h2><p><code>@Resource</code>å’Œ<code>@Autowired</code>æ³¨è§£éƒ½å¯ä»¥åœ¨<strong>Spring Framework</strong>åº”ç”¨ä¸­è¿›è¡Œå£°æ˜å¼çš„ä¾èµ–æ³¨å…¥ã€‚è€Œä¸”é¢è¯•ä¸­ç»å¸¸æ¶‰åŠåˆ°è¿™ä¸¤ä¸ªæ³¨è§£çš„çŸ¥è¯†ç‚¹ã€‚ä»Šå¤©æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹å®ƒä»¬ã€‚</p><h2 id="2-Resource"><a href="#2-Resource" class="headerlink" title="2. @Resource"></a>2. @Resource</h2><p>å…¨ç§°<code>javax.annotation.Resource</code>,å®ƒå±äº<strong>JSR-250</strong>è§„èŒƒçš„ä¸€ä¸ªæ³¨è§£ï¼ŒåŒ…å«<strong>Jakarta EE</strong>ï¼ˆ<strong>J2EE</strong>ï¼‰ä¸­ã€‚<strong>Spring</strong>æä¾›äº†å¯¹è¯¥æ³¨è§£çš„æ”¯æŒã€‚æˆ‘ä»¬æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹è¯¥æ³¨è§£çš„è§„åˆ™ã€‚</p><p><strong>è¯¥æ³¨è§£ä½¿ç”¨åœ¨æˆå‘˜å±æ€§å’Œsetteræ–¹æ³•ä¸Šã€‚é»˜è®¤æƒ…å†µä¸‹<code>@Resource</code>æŒ‰ç…§åç§°æ³¨å…¥ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼å£°æ˜åç§°åˆ™æŒ‰ç…§å˜é‡åç§°æˆ–è€…æ–¹æ³•ä¸­å¯¹åº”çš„å‚æ•°åç§°è¿›è¡Œæ³¨å…¥ã€‚</strong></p><p><img src="https://i.328888.xyz/2022/12/18/4vdxb.png" alt="4vdxb.png"></p><p>@Resourceæ³¨è§£ä¹Ÿå¯ä»¥å®Œæˆéç®€å•ç±»å‹æ³¨å…¥ã€‚é‚£å®ƒå’Œ@Autowiredæ³¨è§£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><ul><li>@Resourceæ³¨è§£æ˜¯JDKæ‰©å±•åŒ…ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å±äºJDKçš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥è¯¥æ³¨è§£æ˜¯æ ‡å‡†æ³¨è§£ï¼Œæ›´åŠ å…·æœ‰é€šç”¨æ€§ã€‚(JSR-250æ ‡å‡†ä¸­åˆ¶å®šçš„æ³¨è§£ç±»å‹ã€‚JSRæ˜¯Javaè§„èŒƒææ¡ˆã€‚)</li><li>@Autowiredæ³¨è§£æ˜¯Springæ¡†æ¶è‡ªå·±çš„ã€‚</li><li><strong>@Resourceæ³¨è§£é»˜è®¤æ ¹æ®åç§°è£…é…byNameï¼ŒæœªæŒ‡å®šnameæ—¶ï¼Œä½¿ç”¨å±æ€§åä½œä¸ºnameã€‚é€šè¿‡nameæ‰¾ä¸åˆ°çš„è¯ä¼šè‡ªåŠ¨å¯åŠ¨é€šè¿‡ç±»å‹byTypeè£…é…ã€‚</strong></li><li><strong>@Autowiredæ³¨è§£é»˜è®¤æ ¹æ®ç±»å‹è£…é…byTypeï¼Œå¦‚æœæƒ³æ ¹æ®åç§°è£…é…ï¼Œéœ€è¦é…åˆ@Qualifieræ³¨è§£ä¸€èµ·ç”¨ã€‚</strong></li><li>@Resourceæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€‚</li><li>@Autowiredæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•å‚æ•°ä¸Šã€‚</li></ul><p>@Resourceæ³¨è§£å±äºJDKæ‰©å±•åŒ…ï¼Œæ‰€ä»¥ä¸åœ¨JDKå½“ä¸­ï¼Œéœ€è¦é¢å¤–å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼šã€<strong>å¦‚æœæ˜¯JDK8çš„è¯ä¸éœ€è¦é¢å¤–å¼•å…¥ä¾èµ–ã€‚é«˜äºJDK11æˆ–ä½äºJDK8éœ€è¦å¼•å…¥ä»¥ä¸‹ä¾èµ–ã€‚</strong>ã€‘</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœä½ æ˜¯Spring6+ç‰ˆæœ¬è¯·ä½¿ç”¨è¿™ä¸ªä¾èµ–ğŸ‘‡</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.annotation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.annotation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœä½ æ˜¯spring5-ç‰ˆæœ¬è¯·ä½¿ç”¨è¿™ä¸ªä¾èµ–ğŸ‘‡</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.annotation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.annotation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-Autowired"><a href="#3-Autowired" class="headerlink" title="3. @Autowired"></a>3. @Autowired</h2><ul><li><p>ç¬¬ä¸€ç‚¹æ³¨æ„ï¼šè¯¥æ³¨è§£å¯ä»¥æ ‡æ³¨åœ¨å“ªé‡Œï¼Ÿ</p></li><li><ul><li>æ„é€ æ–¹æ³•ä¸Š</li><li>æ–¹æ³•ä¸Š</li><li>å½¢å‚ä¸Š</li><li>å±æ€§ä¸Š</li><li>æ³¨è§£ä¸Š</li></ul></li><li><p>ç¬¬äºŒç‚¹æ³¨æ„ï¼šè¯¥æ³¨è§£æœ‰ä¸€ä¸ªrequiredå±æ€§ï¼Œé»˜è®¤å€¼æ˜¯trueï¼Œè¡¨ç¤ºåœ¨æ³¨å…¥çš„æ—¶å€™è¦æ±‚è¢«æ³¨å…¥çš„Beanå¿…é¡»æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æŠ¥é”™ã€‚å¦‚æœrequiredå±æ€§è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºæ³¨å…¥çš„Beanå­˜åœ¨æˆ–è€…ä¸å­˜åœ¨éƒ½æ²¡å…³ç³»ï¼Œå­˜åœ¨çš„è¯å°±æ³¨å…¥ï¼Œä¸å­˜åœ¨çš„è¯ï¼Œä¹Ÿä¸æŠ¥é”™ã€‚</p></li></ul><p><img src="https://i.328888.xyz/2022/12/18/4vGld.png" alt="4vGld.png"></p><ul><li>@Autowiredæ³¨è§£å¯ä»¥å‡ºç°åœ¨ï¼šå±æ€§ä¸Šã€æ„é€ æ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•çš„å‚æ•°ä¸Šã€setteræ–¹æ³•ä¸Šã€‚</li><li>å½“å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•åªæœ‰ä¸€ä¸ªï¼Œ@Autowiredæ³¨è§£å¯ä»¥çœç•¥ã€‚</li><li>@Autowiredæ³¨è§£é»˜è®¤æ ¹æ®ç±»å‹æ³¨å…¥ã€‚å¦‚æœè¦æ ¹æ®åç§°æ³¨å…¥çš„è¯ï¼Œéœ€è¦é…åˆ@Qualifieræ³¨è§£ä¸€èµ·ä½¿ç”¨ã€‚</li></ul><h2 id="4-ä½¿ç”¨ç»†èŠ‚å’Œå…¶ä»–æ³¨æ„äº‹é¡¹"><a href="#4-ä½¿ç”¨ç»†èŠ‚å’Œå…¶ä»–æ³¨æ„äº‹é¡¹" class="headerlink" title="4. ä½¿ç”¨ç»†èŠ‚å’Œå…¶ä»–æ³¨æ„äº‹é¡¹"></a>4. ä½¿ç”¨ç»†èŠ‚å’Œå…¶ä»–æ³¨æ„äº‹é¡¹</h2><p>è´Ÿè´£å£°æ˜Beançš„æ³¨è§£ï¼Œå¸¸è§çš„åŒ…æ‹¬å››ä¸ªï¼š</p><ul><li>@Component</li><li>@Controller</li><li>@Service</li><li>@Repository</li></ul><p>æ³¨æ„å¯ä»¥åœ¨å£°æ˜Beançš„æ³¨è§£ä¸­è®¾ç½®Beançš„<strong>name</strong>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(<span class="string">"xxxBean"</span>)</span><br></pre></td></tr></table></figure><p><strong>é—®ï¼šå¦‚æœæŠŠvalueå±æ€§å½»åº•å»æ‰ï¼Œspringä¼šè¢«Beanè‡ªåŠ¨å–åå—ï¼Ÿ</strong></p><p><strong>ç­”ï¼šä¼šçš„ã€‚å¹¶ä¸”é»˜è®¤åå­—çš„è§„å¾‹æ˜¯ï¼š<u>Beanç±»åé¦–å­—æ¯å°å†™å³å¯</u>ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ssh</title>
      <link href="/2022/12/16/SSH%20related/"/>
      <url>/2022/12/16/SSH%20related/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="1-åˆè§SSH"><a href="#1-åˆè§SSH" class="headerlink" title="1. åˆè§SSH"></a>1. åˆè§SSH</h2><p>SSHæ˜¯ä¸€ç§åè®®æ ‡å‡†ï¼Œå…¶ç›®çš„æ˜¯å®ç°å®‰å…¨è¿œç¨‹ç™»å½•ä»¥åŠå…¶å®ƒå®‰å…¨ç½‘ç»œæœåŠ¡ã€‚</p><ul><li>SSHä»…ä»…æ˜¯ä¸€åè®®æ ‡å‡†ï¼Œå…¶å…·ä½“çš„å®ç°æœ‰å¾ˆå¤šï¼Œæ—¢æœ‰å¼€æºå®ç°çš„OpenSSHï¼Œä¹Ÿæœ‰å•†ä¸šå®ç°æ–¹æ¡ˆã€‚ä½¿ç”¨èŒƒå›´æœ€å¹¿æ³›çš„å½“ç„¶æ˜¯å¼€æºå®ç°OpenSSHã€‚</li></ul><h2 id="2-SSHå·¥ä½œåŸç†"><a href="#2-SSHå·¥ä½œåŸç†" class="headerlink" title="2. SSHå·¥ä½œåŸç†"></a>2. SSHå·¥ä½œåŸç†</h2><p>åœ¨è®¨è®ºSSHçš„åŸç†å’Œä½¿ç”¨å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ†æä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦SSHï¼Ÿ</p><p>ä»1.1èŠ‚SSHçš„å®šä¹‰ä¸­å¯ä»¥çœ‹å‡ºï¼ŒSSHå’Œtelnetã€ftpç­‰åè®®ä¸»è¦çš„åŒºåˆ«åœ¨äºå®‰å…¨æ€§ã€‚è¿™å°±å¼•å‡ºä¸‹ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•å®ç°æ•°æ®çš„å®‰å…¨å‘¢ï¼Ÿé¦–å…ˆæƒ³åˆ°çš„å®ç°æ–¹æ¡ˆè‚¯å®šæ˜¯å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚åŠ å¯†çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ul><li>å¯¹ç§°åŠ å¯†ï¼ˆä¹Ÿç§°ä¸ºç§˜é’¥åŠ å¯†ï¼‰</li><li>éå¯¹ç§°åŠ å¯†ï¼ˆä¹Ÿç§°å…¬é’¥åŠ å¯†ï¼‰</li></ul><p>æ‰€è°“å¯¹ç§°åŠ å¯†ï¼ŒæŒ‡åŠ å¯†è§£å¯†ä½¿ç”¨åŒä¸€å¥—ç§˜é’¥ã€‚å¯¹ç§°åŠ å¯†çš„åŠ å¯†å¼ºåº¦é«˜ï¼Œå¾ˆéš¾ç ´è§£ã€‚ä½†æ˜¯åœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­ä¸å¾—ä¸é¢ä¸´ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šå¦‚ä½•å®‰å…¨çš„ä¿å­˜å¯†é’¥å‘¢ï¼Ÿå°¤å…¶æ˜¯è€ƒè™‘åˆ°æ•°é‡åºå¤§çš„Clientç«¯ï¼Œå¾ˆéš¾ä¿è¯å¯†é’¥ä¸è¢«æ³„éœ²ã€‚ä¸€æ—¦ä¸€ä¸ªClientç«¯çš„å¯†é’¥è¢«çªƒæ®ï¼Œé‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨æ€§ä¹Ÿå°±ä¸å¤å­˜åœ¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéå¯¹ç§°åŠ å¯†åº”è¿è€Œç”Ÿã€‚</p><p>éå¯¹ç§°åŠ å¯†æœ‰ä¸¤ä¸ªå¯†é’¥ï¼šâ€œå…¬é’¥â€å’Œâ€œç§é’¥â€ã€‚ä¸¤ä¸ªå¯†é’¥çš„ç‰¹æ€§ï¼šå…¬é’¥åŠ å¯†åçš„å¯†æ–‡ï¼Œåªèƒ½é€šè¿‡å¯¹åº”çš„ç§é’¥è¿›è¡Œè§£å¯†ã€‚è€Œé€šè¿‡å…¬é’¥æ¨ç†å‡ºç§é’¥çš„å¯èƒ½æ€§å¾®ä¹å…¶å¾®ã€‚</p><p><img src="assets/1.png" alt></p><p><strong>è¿™æ ·å°±ä¸€å®šå®‰å…¨äº†å—ï¼Ÿ</strong><br>ä¸Šè¿°æµç¨‹ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼šClientç«¯å¦‚ä½•ä¿è¯æ¥å—åˆ°çš„å…¬é’¥å°±æ˜¯ç›®æ ‡Serverç«¯çš„ï¼Ÿï¼Œå¦‚æœä¸€ä¸ªæ”»å‡»è€…ä¸­é€”æ‹¦æˆªClientçš„ç™»å½•è¯·æ±‚ï¼Œå‘å…¶å‘é€è‡ªå·±çš„å…¬é’¥ï¼ŒClientç«¯ç”¨æ”»å‡»è€…çš„å…¬é’¥è¿›è¡Œæ•°æ®åŠ å¯†ã€‚æ”»å‡»è€…æ¥æ”¶åˆ°åŠ å¯†ä¿¡æ¯åå†ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ï¼Œä¸å°±çªƒå–äº†Clientçš„ç™»å½•ä¿¡æ¯äº†å—ï¼Ÿè¿™å°±æ˜¯æ‰€è°“çš„ä¸­é—´äººæ”»å‡»</p><hr><p>åœ¨ä¸Šé¢ä»‹ç»çš„ç™»å½•æµç¨‹ä¸­å¯ä»¥å‘ç°ï¼Œæ¯æ¬¡ç™»å½•éƒ½éœ€è¦è¾“å…¥å¯†ç ï¼Œå¾ˆéº»çƒ¦ã€‚SSHæä¾›äº†å¦å¤–ä¸€ç§å¯ä»¥å…å»è¾“å…¥å¯†ç è¿‡ç¨‹çš„ç™»å½•æ–¹å¼ï¼šå…¬é’¥ç™»å½•ã€‚æµç¨‹å¦‚ä¸‹ï¼š<br><img src="assets/2.png" alt></p><ol><li>Clientå°†è‡ªå·±çš„å…¬é’¥å­˜æ”¾åœ¨Serverä¸Šï¼Œè¿½åŠ åœ¨æ–‡ä»¶authorized_keysä¸­ã€‚</li><li>Serverç«¯æ¥æ”¶åˆ°Clientçš„è¿æ¥è¯·æ±‚åï¼Œä¼šåœ¨authorized_keysä¸­åŒ¹é…åˆ°Clientçš„å…¬é’¥pubKeyï¼Œå¹¶ç”Ÿæˆéšæœºæ•°Rï¼Œç”¨Clientçš„å…¬é’¥å¯¹è¯¥éšæœºæ•°è¿›è¡ŒåŠ å¯†å¾—åˆ°pubKey(R)ï¼Œç„¶åå°†åŠ å¯†åä¿¡æ¯å‘é€ç»™Clientã€‚</li><li>Clientç«¯é€šè¿‡ç§é’¥è¿›è¡Œè§£å¯†å¾—åˆ°éšæœºæ•°Rï¼Œç„¶åå¯¹éšæœºæ•°Rå’Œæœ¬æ¬¡ä¼šè¯çš„SessionKeyåˆ©ç”¨MD5ç”Ÿæˆæ‘˜è¦Digest1ï¼Œå‘é€ç»™Serverç«¯ã€‚</li><li>Serverç«¯ä¼šä¹Ÿä¼šå¯¹Rå’ŒSessionKeyåˆ©ç”¨åŒæ ·æ‘˜è¦ç®—æ³•ç”ŸæˆDigest2ã€‚</li><li>Serverç«¯ä¼šæœ€åæ¯”è¾ƒDigest1å’ŒDigest2æ˜¯å¦ç›¸åŒï¼Œå®Œæˆè®¤è¯è¿‡ç¨‹ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> ssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaæ ¸å¿ƒçŸ¥è¯†--å¤šçº¿ç¨‹ç¯‡</title>
      <link href="/2022/12/14/day08-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E3%80%81volatile%E5%85%B3%E9%94%AE%E5%AD%97%E3%80%81%E5%8E%9F%E5%AD%90%E6%80%A7%E3%80%81%E5%B9%B6%E5%8F%91%E5%8C%85%E3%80%81%E6%AD%BB%E9%94%81%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
      <url>/2022/12/14/day08-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E3%80%81volatile%E5%85%B3%E9%94%AE%E5%AD%97%E3%80%81%E5%8E%9F%E5%AD%90%E6%80%A7%E3%80%81%E5%B9%B6%E5%8F%91%E5%8C%85%E3%80%81%E6%AD%BB%E9%94%81%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="ä»Šæ—¥å†…å®¹"><a href="#ä»Šæ—¥å†…å®¹" class="headerlink" title="ä»Šæ—¥å†…å®¹"></a>ä»Šæ—¥å†…å®¹</h2><ul><li>çº¿ç¨‹å®‰å…¨</li><li>volatileå…³é”®å­—</li><li>åŸå­æ€§</li><li>å¹¶å‘åŒ…</li><li>æ­»é”</li><li>çº¿ç¨‹æ± </li></ul><h2 id="å­¦ä¹ ç›®æ ‡"><a href="#å­¦ä¹ ç›®æ ‡" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h2><ul><li><p>èƒ½å¤Ÿè¯´å‡ºvolatileå…³é”®å­—çš„ä½œç”¨</p><ul><li>å®ç°æˆå‘˜å˜é‡å¤šä¸ªçº¿ç¨‹ä¿®æ”¹åçš„å¯è§æ€§ã€‚</li></ul></li><li><p>èƒ½å¤Ÿè¯´æ˜volatileå…³é”®å­—å’Œsynchronizedå…³é”®å­—çš„åŒºåˆ«</p><ul><li>volatileä¿®é¥°æˆå‘˜å˜é‡ï¼Œå®ç°å˜é‡çš„è®¿é—®å¯è§æ€§ï¼Œä½†æ˜¯ä¸èƒ½å®ç°åŸå­æ€§ã€‚</li><li>synchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•å’Œä»£ç å—ï¼ŒåŠ é”æœºåˆ¶ï¼Œå¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚åŠ é”ä»¥åå˜é‡è‡ªç„¶å¯è§ã€‚</li></ul></li><li><p>èƒ½å¤Ÿç†è§£åŸå­ç±»çš„å·¥ä½œæœºåˆ¶</p><ul><li>åŸºäºCASä¹è§‚é”ã€‚ä¿è¯äº†å®‰å…¨æ€§ã€‚</li></ul></li><li><p>èƒ½å¤ŸæŒæ¡åŸå­ç±»AtomicIntegerçš„ä½¿ç”¨</p></li><li><p>èƒ½å¤Ÿæè¿°ConcurrentHashMapç±»çš„ä½œç”¨</p><ul><li>å®‰å…¨æ€§é«˜ï¼Œçº¿ç¨‹å®‰å…¨çš„ï¼Œç»¼åˆæ€§èƒ½å¥½ã€‚</li></ul></li><li><p>èƒ½å¤Ÿæè¿°CountDownLatchç±»çš„ä½œç”¨</p></li><li><p>èƒ½å¤Ÿæè¿°CyclicBarrierç±»çš„ä½œç”¨</p></li><li><p>èƒ½å¤Ÿè¡¨è¿°Semaphoreç±»çš„ä½œç”¨</p></li><li><p>èƒ½å¤Ÿæè¿°Exchangerç±»çš„ä½œç”¨</p></li><li><p>èƒ½å¤Ÿæè¿°Javaä¸­çº¿ç¨‹æ± è¿è¡ŒåŸç†</p></li><li><p>èƒ½å¤Ÿæè¿°æ­»é”äº§ç”Ÿçš„åŸå› </p></li></ul><h1 id="ç¬¬ä¸€ç« -çº¿ç¨‹çŠ¶æ€"><a href="#ç¬¬ä¸€ç« -çº¿ç¨‹çŠ¶æ€" class="headerlink" title="ç¬¬ä¸€ç«  çº¿ç¨‹çŠ¶æ€"></a>ç¬¬ä¸€ç«  çº¿ç¨‹çŠ¶æ€</h1><h2 id="1-1-çº¿ç¨‹çŠ¶æ€æ¦‚è¿°"><a href="#1-1-çº¿ç¨‹çŠ¶æ€æ¦‚è¿°" class="headerlink" title="1.1 çº¿ç¨‹çŠ¶æ€æ¦‚è¿°"></a>1.1 çº¿ç¨‹çŠ¶æ€æ¦‚è¿°</h2><p><strong>çº¿ç¨‹ç”±ç”Ÿåˆ°æ­»çš„å®Œæ•´è¿‡ç¨‹ï¼š</strong></p><p>å½“çº¿ç¨‹è¢«åˆ›å»ºå¹¶å¯åŠ¨ä»¥åï¼Œå®ƒæ—¢ä¸æ˜¯ä¸€å¯åŠ¨å°±è¿›å…¥äº†æ‰§è¡ŒçŠ¶æ€ï¼Œä¹Ÿä¸æ˜¯ä¸€ç›´å¤„äºæ‰§è¡ŒçŠ¶æ€ã€‚åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæœ‰å‡ ç§çŠ¶æ€å‘¢ï¼Ÿåœ¨APIä¸­<code>java.lang.Thread.State</code>è¿™ä¸ªæšä¸¾ä¸­ç»™å‡ºäº†å…­ç§çº¿ç¨‹çŠ¶æ€ï¼š</p><p>è¿™é‡Œå…ˆåˆ—å‡ºå„ä¸ªçº¿ç¨‹çŠ¶æ€å‘ç”Ÿçš„æ¡ä»¶ï¼Œä¸‹é¢å°†ä¼šå¯¹æ¯ç§çŠ¶æ€è¿›è¡Œè¯¦ç»†è§£æ</p><table><thead><tr><th>çº¿ç¨‹çŠ¶æ€</th><th>å¯¼è‡´çŠ¶æ€å‘ç”Ÿæ¡ä»¶</th></tr></thead><tbody><tr><td>NEW(æ–°å»º)</td><td>çº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯å¹¶æœªå¯åŠ¨ã€‚è¿˜æ²¡è°ƒç”¨startæ–¹æ³•ã€‚MyThread t = new MyThreadåªæœ‰çº¿ç¨‹å¯¹è±¡ï¼Œæ²¡æœ‰çº¿ç¨‹ç‰¹å¾ã€‚</td></tr><tr><td>Runnable(å¯è¿è¡Œ)</td><td>çº¿ç¨‹å¯ä»¥åœ¨javaè™šæ‹Ÿæœºä¸­è¿è¡Œçš„çŠ¶æ€ï¼Œå¯èƒ½æ­£åœ¨è¿è¡Œè‡ªå·±ä»£ç ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼Œè¿™å–å†³äºæ“ä½œç³»ç»Ÿå¤„ç†å™¨ã€‚è°ƒç”¨äº†t.start()æ–¹æ³•   ï¼šå°±ç»ªï¼ˆç»å…¸æ•™æ³•ï¼‰</td></tr><tr><td>Blocked(é”é˜»å¡)</td><td>å½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è·å–ä¸€ä¸ªå¯¹è±¡é”ï¼Œè€Œè¯¥å¯¹è±¡é”è¢«å…¶ä»–çš„çº¿ç¨‹æŒæœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥BlockedçŠ¶æ€ï¼›å½“è¯¥çº¿ç¨‹æŒæœ‰é”æ—¶ï¼Œè¯¥çº¿ç¨‹å°†å˜æˆRunnableçŠ¶æ€ã€‚</td></tr><tr><td>Waiting(æ— é™ç­‰å¾…)</td><td>ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªï¼ˆå”¤é†’ï¼‰åŠ¨ä½œæ—¶ï¼Œè¯¥çº¿ç¨‹è¿›å…¥WaitingçŠ¶æ€ã€‚è¿›å…¥è¿™ä¸ªçŠ¶æ€åæ˜¯ä¸èƒ½è‡ªåŠ¨å”¤é†’çš„ï¼Œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨notifyæˆ–è€…notifyAllæ–¹æ³•æ‰èƒ½å¤Ÿå”¤é†’ã€‚</td></tr><tr><td>Timed Waiting(è®¡æ—¶ç­‰å¾…)</td><td>åŒwaitingçŠ¶æ€ï¼Œæœ‰å‡ ä¸ªæ–¹æ³•æœ‰è¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨ä»–ä»¬å°†è¿›å…¥Timed WaitingçŠ¶æ€ã€‚è¿™ä¸€çŠ¶æ€å°†ä¸€ç›´ä¿æŒåˆ°è¶…æ—¶æœŸæ»¡æˆ–è€…æ¥æ”¶åˆ°å”¤é†’é€šçŸ¥ã€‚å¸¦æœ‰è¶…æ—¶å‚æ•°çš„å¸¸ç”¨æ–¹æ³•æœ‰Thread.sleep ã€Object.waitã€‚</td></tr><tr><td>Teminated(è¢«ç»ˆæ­¢)</td><td>å› ä¸ºrunæ–¹æ³•æ­£å¸¸é€€å‡ºè€Œæ­»äº¡ï¼Œæˆ–è€…å› ä¸ºæ²¡æœ‰æ•è·çš„å¼‚å¸¸ç»ˆæ­¢äº†runæ–¹æ³•è€Œæ­»äº¡ã€‚</td></tr></tbody></table><p><img src="assets/1573352376549.png" alt="1573352376549"></p><p>â€‹    æˆ‘ä»¬ä¸éœ€è¦å»ç ”ç©¶è¿™å‡ ç§çŠ¶æ€çš„å®ç°åŸç†ï¼Œæˆ‘ä»¬åªéœ€çŸ¥é“åœ¨åšçº¿ç¨‹æ“ä½œä¸­å­˜åœ¨è¿™æ ·çš„çŠ¶æ€ã€‚é‚£æˆ‘ä»¬æ€ä¹ˆå»ç†è§£è¿™å‡ ä¸ªçŠ¶æ€å‘¢ï¼Œæ–°å»ºä¸è¢«ç»ˆæ­¢è¿˜æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„ï¼Œæˆ‘ä»¬å°±ç ”ç©¶ä¸€ä¸‹çº¿ç¨‹ä»Runnableï¼ˆå¯è¿è¡Œï¼‰çŠ¶æ€ä¸éè¿è¡ŒçŠ¶æ€ä¹‹é—´çš„è½¬æ¢é—®é¢˜ã€‚</p><h2 id="1-2-ç¡çœ sleepæ–¹æ³•"><a href="#1-2-ç¡çœ sleepæ–¹æ³•" class="headerlink" title="1.2 ç¡çœ sleepæ–¹æ³•"></a>1.2 ç¡çœ sleepæ–¹æ³•</h2><p>æˆ‘ä»¬çœ‹åˆ°çŠ¶æ€ä¸­æœ‰ä¸€ä¸ªçŠ¶æ€å«åšè®¡æ—¶ç­‰å¾…ï¼Œå¯ä»¥é€šè¿‡Threadç±»çš„æ–¹æ³•æ¥è¿›è¡Œæ¼”ç¤º.</p><p><code>public static void  sleep(long time)</code>  è®©å½“å‰çº¿ç¨‹è¿›å…¥åˆ°ç¡çœ çŠ¶æ€ï¼Œåˆ°æ¯«ç§’åè‡ªåŠ¨é†’æ¥ç»§ç»­æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=<span class="number">5</span>;i++)&#123;</span><br><span class="line">      Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        System.out.println(i)   </span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬å‘ç°ä¸»çº¿ç¨‹æ‰§è¡Œåˆ°sleepæ–¹æ³•ä¼šä¼‘çœ 1ç§’åå†ç»§ç»­æ‰§è¡Œã€‚</p><h2 id="1-3-ç­‰å¾…å’Œå”¤é†’"><a href="#1-3-ç­‰å¾…å’Œå”¤é†’" class="headerlink" title="1.3 ç­‰å¾…å’Œå”¤é†’"></a>1.3 ç­‰å¾…å’Œå”¤é†’</h2><p>Objectç±»çš„æ–¹æ³•</p><p><code>public void wait()</code> : è®©å½“å‰çº¿ç¨‹è¿›å…¥åˆ°ç­‰å¾…çŠ¶æ€ æ­¤æ–¹æ³•å¿…é¡»é”å¯¹è±¡è°ƒç”¨.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1_wait</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">   <span class="comment">// æ­¥éª¤1 : å­çº¿ç¨‹å¼€å¯,è¿›å…¥æ— é™ç­‰å¾…çŠ¶æ€, æ²¡æœ‰è¢«å”¤é†’,æ— æ³•ç»§ç»­è¿è¡Œ.</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">"begin wait ...."</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (<span class="string">""</span>) &#123;</span><br><span class="line">                    <span class="string">""</span>.wait();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"over"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>public void notify()</code> : å”¤é†’å½“å‰é”å¯¹è±¡ä¸Šç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹  æ­¤æ–¹æ³•å¿…é¡»é”å¯¹è±¡è°ƒç”¨.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2_notify</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">   <span class="comment">// æ­¥éª¤1 : å­çº¿ç¨‹å¼€å¯,è¿›å…¥æ— é™ç­‰å¾…çŠ¶æ€, æ²¡æœ‰è¢«å”¤é†’,æ— æ³•ç»§ç»­è¿è¡Œ.</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">"begin wait ...."</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (<span class="string">""</span>) &#123;</span><br><span class="line">                    <span class="string">""</span>.wait();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"over"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ­¥éª¤2:  åŠ å…¥å¦‚ä¸‹ä»£ç å, 3ç§’å,ä¼šæ‰§è¡Œnotifyæ–¹æ³•, å”¤é†’waitä¸­çº¿ç¨‹.</span></span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (<span class="string">""</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"å”¤é†’"</span>);</span><br><span class="line">                    <span class="string">""</span>.notify();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-4-ç­‰å¾…å”¤é†’æ¡ˆä¾‹ï¼ˆåŒ…å­é“ºå–åŒ…å­ï¼‰"><a href="#1-4-ç­‰å¾…å”¤é†’æ¡ˆä¾‹ï¼ˆåŒ…å­é“ºå–åŒ…å­ï¼‰" class="headerlink" title="1.4 ç­‰å¾…å”¤é†’æ¡ˆä¾‹ï¼ˆåŒ…å­é“ºå–åŒ…å­ï¼‰"></a>1.4 ç­‰å¾…å”¤é†’æ¡ˆä¾‹ï¼ˆåŒ…å­é“ºå–åŒ…å­ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®šä¹‰ä¸€ä¸ªé›†åˆï¼ŒåŒ…å­é“ºçº¿ç¨‹å®Œæˆç”Ÿäº§åŒ…å­ï¼ŒåŒ…å­æ·»åŠ åˆ°é›†åˆä¸­ï¼›åƒè´§çº¿ç¨‹å®Œæˆè´­ä¹°åŒ…å­ï¼ŒåŒ…å­ä»é›†åˆä¸­ç§»é™¤ã€‚</span><br><span class="line"><span class="number">1</span>. å½“åŒ…å­æ²¡æœ‰æ—¶ï¼ˆåŒ…å­çŠ¶æ€ä¸º<span class="keyword">false</span>ï¼‰ï¼Œåƒè´§çº¿ç¨‹ç­‰å¾….</span><br><span class="line"><span class="number">2</span>. åŒ…å­é“ºçº¿ç¨‹ç”Ÿäº§åŒ…å­ï¼ˆå³åŒ…å­çŠ¶æ€ä¸º<span class="keyword">true</span>ï¼‰ï¼Œå¹¶é€šçŸ¥åƒè´§çº¿ç¨‹ï¼ˆè§£é™¤åƒè´§çš„ç­‰å¾…çŠ¶æ€ï¼‰</span><br></pre></td></tr></table></figure><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><p>ç”ŸæˆåŒ…å­ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaoZiPu</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaoZiPu</span><span class="params">(String name,ArrayList&lt;String&gt; list)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>; </span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                    <span class="comment">//listä½œä¸ºé”å¯¹è±¡</span></span><br><span class="line">                    <span class="keyword">synchronized</span> (list)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                            <span class="comment">//å­˜å…ƒç´ çš„çº¿ç¨‹è¿›å…¥åˆ°ç­‰å¾…çŠ¶æ€</span></span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                list.wait();</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                                e.printStackTrace();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">//å¦‚æœçº¿ç¨‹æ²¡è¿›å…¥åˆ°ç­‰å¾…çŠ¶æ€ è¯´æ˜é›†åˆä¸­æ²¡æœ‰å…ƒç´ </span></span><br><span class="line">                        <span class="comment">//å‘é›†åˆä¸­æ·»åŠ å…ƒç´ </span></span><br><span class="line">                        list.add(<span class="string">"åŒ…å­"</span>+i++);</span><br><span class="line">                        System.out.println(list);</span><br><span class="line">                        <span class="comment">//é›†åˆä¸­å·²ç»æœ‰å…ƒç´ äº† å”¤é†’è·å–å…ƒç´ çš„çº¿ç¨‹</span></span><br><span class="line">                        list.notify();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹åŒ…å­ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChiHuo</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChiHuo</span><span class="params">(String name,ArrayList&lt;String&gt; list)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="comment">//ä¸ºäº†èƒ½çœ‹åˆ°æ•ˆæœ å†™ä¸ªæ­»å¾ªç¯</span></span><br><span class="line">                <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                    <span class="comment">//ç”±äºä½¿ç”¨çš„åŒä¸€ä¸ªé›†åˆ listä½œä¸ºé”å¯¹è±¡</span></span><br><span class="line">                    <span class="keyword">synchronized</span> (list)&#123;</span><br><span class="line">                        <span class="comment">//å¦‚æœé›†åˆä¸­æ²¡æœ‰å…ƒç´  è·å–å…ƒç´ çš„çº¿ç¨‹è¿›å…¥åˆ°ç­‰å¾…çŠ¶æ€</span></span><br><span class="line">                        <span class="keyword">if</span>(list.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                list.wait();</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                                e.printStackTrace();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//å¦‚æœé›†åˆä¸­æœ‰å…ƒç´  åˆ™è·å–å…ƒç´ çš„çº¿ç¨‹è·å–å…ƒç´ (åˆ é™¤)</span></span><br><span class="line">                        list.remove(<span class="number">0</span>);</span><br><span class="line">                        <span class="comment">//æ‰“å°é›†åˆ é›†åˆä¸­æ²¡æœ‰å…ƒç´ äº†</span></span><br><span class="line">                        System.out.println(list);</span><br><span class="line">                        <span class="comment">//é›†åˆä¸­å·²ç»æ²¡æœ‰å…ƒç´  åˆ™å”¤é†’æ·»åŠ å…ƒç´ çš„çº¿ç¨‹ å‘é›†åˆä¸­æ·»åŠ å…ƒç´ </span></span><br><span class="line">                        list.notify();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ç­‰å¾…å”¤é†’æ¡ˆä¾‹</span></span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹å¯¹è±¡        </span></span><br><span class="line">         BaoZiPu bzp = <span class="keyword">new</span> BaoZiPu(<span class="string">"åŒ…å­é“º"</span>,list);</span><br><span class="line">        ChiHuo ch = <span class="keyword">new</span> ChiHuo(<span class="string">"åƒè´§"</span>,list);</span><br><span class="line">        <span class="comment">// å¼€å¯çº¿ç¨‹</span></span><br><span class="line">        bzp.start();</span><br><span class="line">        ch.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬äºŒç« -volatileå…³é”®å­—"><a href="#ç¬¬äºŒç« -volatileå…³é”®å­—" class="headerlink" title="ç¬¬äºŒç«  volatileå…³é”®å­—"></a>ç¬¬äºŒç«  volatileå…³é”®å­—</h1><h2 id="2-1-çœ‹ç¨‹åºè¯´ç»“æœ"><a href="#2-1-çœ‹ç¨‹åºè¯´ç»“æœ" class="headerlink" title="2.1. çœ‹ç¨‹åºè¯´ç»“æœ"></a>2.1. çœ‹ç¨‹åºè¯´ç»“æœ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span> ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFlag</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> flag;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†flagçš„å€¼æ›´æ”¹ä¸ºtrue</span></span><br><span class="line">        <span class="keyword">this</span>.flag = <span class="keyword">true</span> ;</span><br><span class="line">        System.out.println(<span class="string">"flag="</span> + flag);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileThreadDemo</span> </span>&#123;<span class="comment">// æµ‹è¯•ç±»</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºVolatileThreadçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">        VolatileThread volatileThread = <span class="keyword">new</span> VolatileThread() ;</span><br><span class="line">        volatileThread.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// mainæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(volatileThread.isFlag()) &#123;</span><br><span class="line">                System.out.println(<span class="string">"æ‰§è¡Œäº†======"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="assets/%E6%97%A0%E6%A0%87%E9%A2%98.jpg" alt></p><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒVolatileThreadçº¿ç¨‹ä¸­å·²ç»å°†flagè®¾ç½®ä¸ºtrueï¼Œä½†main()æ–¹æ³•ä¸­å§‹ç»ˆæ²¡æœ‰è¯»åˆ°ï¼Œä»è€Œæ²¡æœ‰æ‰“å°ã€‚</p><h2 id="2-2-JMM"><a href="#2-2-JMM" class="headerlink" title="2.2. JMM"></a>2.2. JMM</h2><p>æ¦‚è¿°ï¼šJMM(Java Memory Model)Javaå†…å­˜æ¨¡å‹,æ˜¯javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ‰€å®šä¹‰çš„ä¸€ç§å†…å­˜æ¨¡å‹ã€‚</p><p>Javaå†…å­˜æ¨¡å‹(Java Memory Model)æè¿°äº†Javaç¨‹åºä¸­å„ç§å˜é‡(çº¿ç¨‹å…±äº«å˜é‡)çš„è®¿é—®è§„åˆ™ï¼Œä»¥åŠåœ¨JVMä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­è¯»å–å˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚</p><p>æ‰€æœ‰çš„å…±äº«å˜é‡éƒ½å­˜å‚¨äºä¸»å†…å­˜ã€‚è¿™é‡Œæ‰€è¯´çš„å˜é‡æŒ‡çš„æ˜¯å®ä¾‹å˜é‡å’Œç±»å˜é‡ã€‚ä¸åŒ…å«å±€éƒ¨å˜é‡ï¼Œå› ä¸ºå±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå› æ­¤ä¸å­˜åœ¨ç«äº‰é—®é¢˜ã€‚æ¯ä¸€ä¸ªçº¿ç¨‹è¿˜å­˜åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹</p><p>çš„å·¥ä½œå†…å­˜ï¼Œä¿ç•™äº†è¢«çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„å·¥ä½œå‰¯æœ¬ã€‚çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰çš„æ“ä½œ(è¯»ï¼Œå–)éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­å®Œæˆï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¹Ÿä¸èƒ½ç›´æ¥è®¿é—®</p><p>å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡çš„å€¼çš„ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜å®Œæˆã€‚</p><p><img src="assets/1561516472597.png" alt></p><h2 id="2-3-é—®é¢˜åˆ†æ"><a href="#2-3-é—®é¢˜åˆ†æ" class="headerlink" title="2.3. é—®é¢˜åˆ†æ"></a>2.3. é—®é¢˜åˆ†æ</h2><p><img src="assets/1561303332516.png" alt></p><ol><li><p>VolatileThreadçº¿ç¨‹ä»ä¸»å†…å­˜è¯»å–åˆ°æ•°æ®æ”¾å…¥å…¶å¯¹åº”çš„å·¥ä½œå†…å­˜</p></li><li><p>å°†flagçš„å€¼æ›´æ”¹ä¸ºtrueï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™flagçš„å€¼è¿˜æ²¡æœ‰å†™ä¼šä¸»å†…å­˜</p></li><li><p>æ­¤æ—¶mainæ–¹æ³•è¯»å–åˆ°äº†flagçš„å€¼ä¸ºfalse</p></li><li><p>å½“VolatileThreadçº¿ç¨‹å°†flagçš„å€¼å†™å›å»åï¼Œä½†æ˜¯mainå‡½æ•°é‡Œé¢çš„while(true)è°ƒç”¨çš„æ˜¯ç³»ç»Ÿæ¯”è¾ƒåº•å±‚çš„ä»£ç ï¼Œé€Ÿåº¦å¿«ï¼Œå¿«åˆ°æ²¡æœ‰æ—¶é—´å†å»è¯»å–ä¸»å­˜ä¸­çš„å€¼ï¼Œ</p><p>æ‰€ä»¥while(true)è¯»å–åˆ°çš„å€¼ä¸€ç›´æ˜¯falseã€‚(å¦‚æœæœ‰ä¸€ä¸ªæ—¶åˆ»mainçº¿ç¨‹ä»ä¸»å†…å­˜ä¸­è¯»å–åˆ°äº†ä¸»å†…å­˜ä¸­flagçš„æœ€æ–°å€¼ï¼Œé‚£ä¹ˆifè¯­å¥å°±å¯ä»¥æ‰§è¡Œï¼Œmainçº¿ç¨‹ä½•æ—¶ä»ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°çš„å€¼ï¼Œæˆ‘ä»¬æ— æ³•æ§åˆ¶)</p></li></ol><h2 id="2-4-é—®é¢˜å¤„ç†"><a href="#2-4-é—®é¢˜å¤„ç†" class="headerlink" title="2.4. é—®é¢˜å¤„ç†"></a>2.4. é—®é¢˜å¤„ç†</h2><h3 id="åŠ é”"><a href="#åŠ é”" class="headerlink" title="åŠ é”"></a>åŠ é”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mainæ–¹æ³•</span></span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (volatileThread) &#123;</span><br><span class="line">        <span class="keyword">if</span>(volatileThread.isFlag()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ‰§è¡Œäº†======"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   æŸä¸€ä¸ªçº¿ç¨‹è¿›å…¥synchronizedä»£ç å—å‰åï¼Œæ‰§è¡Œè¿‡ç¨‹å…¥å¦‚ä¸‹ï¼š</p><p>   a.çº¿ç¨‹è·å¾—é”</p><p>   b.æ¸…ç©ºå·¥ä½œå†…å­˜</p><p>   c.ä»ä¸»å†…å­˜æ‹·è´å…±äº«å˜é‡æœ€æ–°çš„å€¼åˆ°å·¥ä½œå†…å­˜æˆä¸ºå‰¯æœ¬</p><p>   d.æ‰§è¡Œä»£ç </p><p>   e.å°†ä¿®æ”¹åçš„å‰¯æœ¬çš„å€¼åˆ·æ–°å›ä¸»å†…å­˜ä¸­</p><p>   f.çº¿ç¨‹é‡Šæ”¾é”</p><h3 id="volatileå…³é”®å­—"><a href="#volatileå…³é”®å­—" class="headerlink" title="volatileå…³é”®å­—"></a>volatileå…³é”®å­—</h3><p>   ä½¿ç”¨volatileå…³é”®å­—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag ;</span><br></pre></td></tr></table></figure><p>   å·¥ä½œåŸç†ï¼š</p><p>  <img src="assets/1561517963033.png" alt></p><ol><li><p>VolatileThreadçº¿ç¨‹ä»ä¸»å†…å­˜è¯»å–åˆ°æ•°æ®æ”¾å…¥å…¶å¯¹åº”çš„å·¥ä½œå†…å­˜</p></li><li><p>å°†flagçš„å€¼æ›´æ”¹ä¸ºtrueï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™flagçš„å€¼è¿˜æ²¡æœ‰å†™ä¼šä¸»å†…å­˜</p></li><li><p>æ­¤æ—¶mainæ–¹æ³•mainæ–¹æ³•è¯»å–åˆ°äº†flagçš„å€¼ä¸ºfalse</p></li><li><p>å½“VolatileThreadçº¿ç¨‹å°†flagçš„å€¼å†™å›å»åï¼Œå¤±æ•ˆå…¶ä»–çº¿ç¨‹å¯¹æ­¤å˜é‡å‰¯æœ¬</p></li><li><p>å†æ¬¡å¯¹flagè¿›è¡Œæ“ä½œçš„æ—¶å€™çº¿ç¨‹ä¼šä»ä¸»å†…å­˜è¯»å–æœ€æ–°çš„å€¼ï¼Œæ”¾å…¥åˆ°å·¥ä½œå†…å­˜ä¸­</p><p>æ€»ç»“ï¼š volatileä¿è¯ä¸åŒçº¿ç¨‹å¯¹å…±äº«å˜é‡æ“ä½œçš„å¯è§æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†volatileä¿®é¥°çš„å˜é‡ï¼Œå½“ä¿®æ”¹å†™å›ä¸»å†…å­˜æ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ç«‹å³çœ‹åˆ°æœ€æ–°çš„å€¼ã€‚</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½†æ˜¯volatileä¸ä¿è¯åŸå­æ€§ã€‚</span><br></pre></td></tr></table></figure><h3 id="volatileä¸synchronized"><a href="#volatileä¸synchronized" class="headerlink" title="volatileä¸synchronized"></a>volatileä¸synchronized</h3><ul><li><p>volatileåªèƒ½ä¿®é¥°å®ä¾‹å˜é‡å’Œç±»å˜é‡ï¼Œè€Œsynchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œä»¥åŠä»£ç å—ã€‚</p></li><li><p>volatileä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†æ˜¯ä¸ä¿è¯åŸå­æ€§(å¤šçº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œä¸ä¿è¯çº¿ç¨‹å®‰å…¨);è€Œsynchronizedæ˜¯ä¸€ç§æ’ä»–ï¼ˆäº’æ–¥ï¼‰çš„æœºåˆ¶ï¼Œ</p></li></ul><h1 id="ç¬¬ä¸‰ç« -åŸå­æ€§"><a href="#ç¬¬ä¸‰ç« -åŸå­æ€§" class="headerlink" title="ç¬¬ä¸‰ç«  åŸå­æ€§"></a>ç¬¬ä¸‰ç«  åŸå­æ€§</h1><p>æ¦‚è¿°ï¼šæ‰€è°“çš„åŸå­æ€§æ˜¯æŒ‡åœ¨ä¸€æ¬¡æ“ä½œæˆ–è€…å¤šæ¬¡æ“ä½œä¸­ï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œå…¨éƒ¨éƒ½å¾—åˆ°äº†æ‰§è¡Œå¹¶ä¸”ä¸ä¼šå—åˆ°ä»»ä½•å› ç´ çš„å¹²æ‰°è€Œä¸­æ–­ï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½ä¸æ‰§è¡Œã€‚ </p><h2 id="3-1-çœ‹ç¨‹åºè¯´ç»“æœ"><a href="#3-1-çœ‹ç¨‹åºè¯´ç»“æœ" class="headerlink" title="3.1. çœ‹ç¨‹åºè¯´ç»“æœ"></a>3.1. çœ‹ç¨‹åºè¯´ç»“æœ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileAtomicThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªintç±»å‹çš„éå†</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¯¹è¯¥å˜é‡è¿›è¡Œ++æ“ä½œï¼Œ100æ¬¡</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span> ; x &lt; <span class="number">100</span> ; x++) &#123;</span><br><span class="line">            count++ ;</span><br><span class="line">            System.out.println(<span class="string">"count =========&gt;&gt;&gt;&gt; "</span> + count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileAtomicThreadDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºVolatileAtomicThreadå¯¹è±¡</span></span><br><span class="line">        VolatileAtomicThread volatileAtomicThread = <span class="keyword">new</span> VolatileAtomicThread() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯100ä¸ªçº¿ç¨‹å¯¹countè¿›è¡Œ++æ“ä½œ</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span> ; x &lt; <span class="number">100</span> ; x++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(volatileAtomicThread).start();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼šä¸ä¿è¯ä¸€å®šæ˜¯10000</p><h2 id="3-2-é—®é¢˜åŸç†è¯´æ˜"><a href="#3-2-é—®é¢˜åŸç†è¯´æ˜" class="headerlink" title="3.2. é—®é¢˜åŸç†è¯´æ˜"></a>3.2. é—®é¢˜åŸç†è¯´æ˜</h2><p>ä»¥ä¸Šé—®é¢˜ä¸»è¦æ˜¯å‘ç”Ÿåœ¨count++æ“ä½œä¸Šï¼š</p><p>count++æ“ä½œåŒ…å«3ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä»ä¸»å†…å­˜ä¸­è¯»å–æ•°æ®åˆ°å·¥ä½œå†…å­˜</li><li>å¯¹å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œ++æ“ä½œ</li><li>å°†å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®å†™å›åˆ°ä¸»å†…å­˜</li></ul><p>count++æ“ä½œä¸æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æŸä¸€ä¸ªæ—¶åˆ»å¯¹æŸä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œï¼Œæœ‰å¯èƒ½è¢«å…¶ä»–çš„çº¿ç¨‹æ‰“æ–­ã€‚</p><p><img src="assets/1561524132215.png" alt></p><p>1ï¼‰å‡è®¾æ­¤æ—¶xçš„å€¼æ˜¯100ï¼Œçº¿ç¨‹Aéœ€è¦å¯¹æ”¹å˜é‡è¿›è¡Œè‡ªå¢1çš„æ“ä½œï¼Œé¦–å…ˆå®ƒéœ€è¦ä»ä¸»å†…å­˜ä¸­è¯»å–å˜é‡xçš„å€¼ã€‚ç”±äºCPUçš„åˆ‡æ¢å…³ç³»ï¼Œæ­¤æ—¶CPUçš„æ‰§è¡Œæƒè¢«åˆ‡æ¢åˆ°äº†</p><p>Bçº¿ç¨‹ã€‚Açº¿ç¨‹å°±å¤„äºå°±ç»ªçŠ¶æ€ï¼ŒBçº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€</p><p>2ï¼‰çº¿ç¨‹Bä¹Ÿéœ€è¦ä»ä¸»å†…å­˜ä¸­è¯»å–xå˜é‡çš„å€¼,ç”±äºçº¿ç¨‹Aæ²¡æœ‰å¯¹xå€¼åšä»»ä½•ä¿®æ”¹å› æ­¤æ­¤æ—¶Bè¯»å–åˆ°çš„æ•°æ®è¿˜æ˜¯100</p><p>3ï¼‰çº¿ç¨‹Bå·¥ä½œå†…å­˜ä¸­xæ‰§è¡Œäº†+1æ“ä½œï¼Œä½†æ˜¯æœªåˆ·æ–°ä¹‹ä¸»å†…å­˜ä¸­</p><p>4ï¼‰æ­¤æ—¶CPUçš„æ‰§è¡Œæƒåˆ‡æ¢åˆ°äº†Açº¿ç¨‹ä¸Šï¼Œç”±äºæ­¤æ—¶çº¿ç¨‹Bæ²¡æœ‰å°†å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼Œå› æ­¤Açº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡å€¼è¿˜æ˜¯100ï¼Œæ²¡æœ‰å¤±æ•ˆã€‚</p><p>   Açº¿ç¨‹å¯¹å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œäº†+1æ“ä½œ</p><p>5ï¼‰çº¿ç¨‹Bå°†101å†™å…¥åˆ°ä¸»å†…å­˜</p><p>6ï¼‰çº¿ç¨‹Aå°†101å†™å…¥åˆ°ä¸»å†…å­˜</p><p>è™½ç„¶è®¡ç®—äº†2æ¬¡ï¼Œä½†æ˜¯åªå¯¹Aè¿›è¡Œäº†1æ¬¡ä¿®æ”¹ã€‚</p><h2 id="3-3-volatileåŸå­æ€§æµ‹è¯•"><a href="#3-3-volatileåŸå­æ€§æµ‹è¯•" class="headerlink" title="3.3. volatileåŸå­æ€§æµ‹è¯•"></a>3.3. volatileåŸå­æ€§æµ‹è¯•</h2><h3 id="ä»£ç æµ‹è¯•"><a href="#ä»£ç æµ‹è¯•" class="headerlink" title="ä»£ç æµ‹è¯•"></a>ä»£ç æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªintç±»å‹çš„å˜é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> count = <span class="number">0</span> ;</span><br></pre></td></tr></table></figure><p>å°ç»“ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œvolatileå…³é”®å­—å¯ä»¥ä¿è¯å…±äº«æ•°æ®çš„å¯è§æ€§ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¯¹æ•°æ®æ“ä½œçš„åŸå­æ€§ï¼ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹volatileä¿®é¥°çš„å˜é‡ä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼‰ã€‚</p><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œè¦ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨é”æœºåˆ¶ã€‚</p><h3 id="volatileçš„ä½¿ç”¨åœºæ™¯"><a href="#volatileçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="volatileçš„ä½¿ç”¨åœºæ™¯"></a>volatileçš„ä½¿ç”¨åœºæ™¯</h3><ul><li><p>å¼€å…³æ§åˆ¶</p><p>åˆ©ç”¨å¯è§æ€§ç‰¹ç‚¹ï¼Œæ§åˆ¶æŸä¸€æ®µä»£ç æ‰§è¡Œæˆ–è€…å…³é—­(æ¯”å¦‚ä»Šå¤©è¯¾ç¨‹çš„ç¬¬ä¸€ä¸ªæ¡ˆä¾‹)ã€‚</p></li><li><p>å¤šä¸ªçº¿ç¨‹æ“ä½œå…±äº«å˜é‡ï¼Œä½†æ˜¯æ˜¯æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶è¿›è¡Œå†™æ“ä½œï¼Œå…¶ä»–çš„çº¿ç¨‹éƒ½æ˜¯è¯»</p></li></ul><h2 id="3-4-é—®é¢˜è§£å†³"><a href="#3-4-é—®é¢˜è§£å†³" class="headerlink" title="3.4. é—®é¢˜è§£å†³"></a>3.4. é—®é¢˜è§£å†³</h2><h3 id="ä½¿ç”¨é”æœºåˆ¶"><a href="#ä½¿ç”¨é”æœºåˆ¶" class="headerlink" title="ä½¿ç”¨é”æœºåˆ¶"></a>ä½¿ç”¨é”æœºåˆ¶</h3><p>æˆ‘ä»¬å¯ä»¥ç»™count++æ“ä½œæ·»åŠ é”ï¼Œé‚£ä¹ˆcount++æ“ä½œå°±æ˜¯ä¸´ç•ŒåŒºçš„ä»£ç ï¼Œä¸´ç•ŒåŒºåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œï¼Œæ‰€ä»¥count++å°±å˜æˆäº†åŸå­æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileAtomicThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªintç±»å‹çš„å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> count = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object obj = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹è¯¥å˜é‡è¿›è¡Œ++æ“ä½œï¼Œ100æ¬¡</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span> ; x &lt; <span class="number">100</span> ; x++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">                count++ ;</span><br><span class="line">                System.out.println(<span class="string">"count =========&gt;&gt;&gt;&gt; "</span> + count);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸå­ç±»"><a href="#åŸå­ç±»" class="headerlink" title="åŸå­ç±»"></a>åŸå­ç±»</h3><p>æ¦‚è¿°ï¼šjavaä»JDK1.5å¼€å§‹æä¾›äº†java.util.concurrent.atomicåŒ…(ç®€ç§°AtomicåŒ…)ï¼Œè¿™ä¸ªåŒ…ä¸­çš„åŸå­æ“ä½œç±»æä¾›äº†ä¸€ç§ç”¨æ³•ç®€å•ï¼Œæ€§èƒ½é«˜æ•ˆï¼Œçº¿ç¨‹å®‰å…¨åœ°æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ–¹å¼ã€‚</p><h4 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a>AtomicInteger</h4><p>åŸå­å‹Integerï¼Œå¯ä»¥å®ç°åŸå­æ›´æ–°æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AtomicInteger</span><span class="params">()</span>ï¼š   åˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤å€¼ä¸º0çš„åŸå­å‹Integer</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AtomicInteger</span><span class="params">(<span class="keyword">int</span> initialValue)</span>ï¼š åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å®šå€¼çš„åŸå­å‹Integer</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">()</span>:     è·å–å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getAndIncrement</span><span class="params">()</span>:       ä»¥åŸå­æ–¹å¼å°†å½“å‰å€¼åŠ 1ï¼Œæ³¨æ„ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯è‡ªå¢å‰çš„å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">incrementAndGet</span><span class="params">()</span>:      ä»¥åŸå­æ–¹å¼å°†å½“å‰å€¼åŠ 1ï¼Œæ³¨æ„ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯è‡ªå¢åçš„å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">addAndGet</span><span class="params">(<span class="keyword">int</span> data)</span>: ä»¥åŸå­æ–¹å¼å°†è¾“å…¥çš„æ•°å€¼ä¸å®ä¾‹ä¸­çš„å€¼ï¼ˆAtomicIntegeré‡Œçš„valueï¼‰ç›¸åŠ ï¼Œå¹¶è¿”å›ç»“æœã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getAndSet</span><span class="params">(<span class="keyword">int</span> value)</span>:    ä»¥åŸå­æ–¹å¼è®¾ç½®ä¸ºnewValueçš„å€¼ï¼Œå¹¶è¿”å›æ—§å€¼ã€‚</span></span><br></pre></td></tr></table></figure><p>æ¼”ç¤ºåŸºæœ¬ä½¿ç”¨ã€‚</p><h4 id="æ¡ˆä¾‹æ”¹é€ "><a href="#æ¡ˆä¾‹æ”¹é€ " class="headerlink" title="æ¡ˆä¾‹æ”¹é€ "></a>æ¡ˆä¾‹æ”¹é€ </h4><p>ä½¿ç”¨AtomicIntegerå¯¹æ¡ˆä¾‹è¿›è¡Œæ”¹é€ .</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileAtomicThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªintç±»å‹çš„å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> AtomicInteger atomicInteger = <span class="keyword">new</span> AtomicInteger() ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹è¯¥å˜é‡è¿›è¡Œ++æ“ä½œï¼Œ100æ¬¡</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span> ; x &lt; <span class="number">100</span> ; x++) &#123;</span><br><span class="line">            <span class="keyword">int</span> i = atomicInteger.getAndIncrement();</span><br><span class="line">            System.out.println(<span class="string">"count =========&gt;&gt;&gt;&gt; "</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸå­ç±»CASæœºåˆ¶å®ç°çº¿ç¨‹å®‰å…¨ã€‚"><a href="#åŸå­ç±»CASæœºåˆ¶å®ç°çº¿ç¨‹å®‰å…¨ã€‚" class="headerlink" title="åŸå­ç±»CASæœºåˆ¶å®ç°çº¿ç¨‹å®‰å…¨ã€‚"></a>åŸå­ç±»CASæœºåˆ¶å®ç°çº¿ç¨‹å®‰å…¨ã€‚</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p><img src="assets/CAS.png" alt></p><p>CASçš„å…¨æˆæ˜¯ï¼š Compare And Swap(æ¯”è¾ƒå†äº¤æ¢); æ˜¯ç°ä»£CPUå¹¿æ³›æ”¯æŒçš„ä¸€ç§å¯¹å†…å­˜ä¸­çš„å…±äº«æ•°æ®è¿›è¡Œæ“ä½œçš„ä¸€ç§ç‰¹æ®ŠæŒ‡ä»¤ã€‚CASå¯ä»¥å°†read-modify-check-write</p><p>è½¬æ¢ä¸ºåŸå­æ“ä½œï¼Œè¿™ä¸ªåŸå­æ“ä½œç›´æ¥ç”±å¤„ç†å™¨ä¿è¯ã€‚</p><p>CASæœºåˆ¶å½“ä¸­ä½¿ç”¨äº†3ä¸ªåŸºæœ¬æ“ä½œæ•°ï¼šå†…å­˜åœ°å€Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚</p><p>ä¸¾ä¾‹ï¼š</p><ol><li>åœ¨å†…å­˜åœ°å€Vå½“ä¸­ï¼Œå­˜å‚¨ç€å€¼ä¸º10çš„å˜é‡ã€‚</li></ol><p><img src="assets/1561550710005.png" alt></p><ol start="2"><li>æ­¤æ—¶çº¿ç¨‹1æƒ³è¦æŠŠå˜é‡çš„å€¼å¢åŠ 1ã€‚å¯¹çº¿ç¨‹1æ¥è¯´ï¼Œæ—§çš„é¢„æœŸå€¼A=10ï¼Œè¦ä¿®æ”¹çš„æ–°å€¼B=11ã€‚</li></ol><p><img src="assets/1561550793084.png" alt></p><ol start="3"><li><p>åœ¨çº¿ç¨‹1è¦æäº¤æ›´æ–°ä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹2æŠ¢å…ˆä¸€æ­¥ï¼ŒæŠŠå†…å­˜åœ°å€Vä¸­çš„å˜é‡å€¼ç‡å…ˆæ›´æ–°æˆäº†11ã€‚</p><p><img src="assets/1561550911597.png" alt></p></li><li><p>çº¿ç¨‹1å¼€å§‹æäº¤æ›´æ–°ï¼Œé¦–å…ˆè¿›è¡ŒAå’Œåœ°å€Vçš„å®é™…å€¼æ¯”è¾ƒï¼ˆCompareï¼‰ï¼Œå‘ç°Aä¸ç­‰äºVçš„å®é™…å€¼ï¼Œæäº¤å¤±è´¥ã€‚</p></li></ol><p><img src="assets/1561551122602.png" alt></p><ol start="5"><li>çº¿ç¨‹1é‡æ–°è·å–å†…å­˜åœ°å€Vçš„å½“å‰å€¼ï¼Œå¹¶é‡æ–°è®¡ç®—æƒ³è¦ä¿®æ”¹çš„æ–°å€¼ã€‚æ­¤æ—¶å¯¹çº¿ç¨‹1æ¥è¯´ï¼ŒA=11ï¼ŒB=12ã€‚è¿™ä¸ªé‡æ–°å°è¯•çš„è¿‡ç¨‹è¢«ç§°ä¸ºè‡ªæ—‹ã€‚</li></ol><p><img src="assets/1561551254968.png" alt></p><ol start="6"><li>è¿™ä¸€æ¬¡æ¯”è¾ƒå¹¸è¿ï¼Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹æ”¹å˜åœ°å€Vçš„å€¼ã€‚çº¿ç¨‹1è¿›è¡ŒCompareï¼Œå‘ç°Aå’Œåœ°å€Vçš„å®é™…å€¼æ˜¯ç›¸ç­‰çš„ã€‚</li></ol><p><img src="assets/1561551329313.png" alt></p><ol start="7"><li>çº¿ç¨‹1è¿›è¡ŒSWAPï¼ŒæŠŠåœ°å€Vçš„å€¼æ›¿æ¢ä¸ºBï¼Œä¹Ÿå°±æ˜¯12ã€‚</li></ol><p><img src="assets/1561551377905.png" alt></p><h4 id="CASä¸Synchronizedï¼šä¹è§‚é”ï¼Œæ‚²è§‚é”ã€‚"><a href="#CASä¸Synchronizedï¼šä¹è§‚é”ï¼Œæ‚²è§‚é”ã€‚" class="headerlink" title="CASä¸Synchronizedï¼šä¹è§‚é”ï¼Œæ‚²è§‚é”ã€‚"></a>CASä¸Synchronizedï¼šä¹è§‚é”ï¼Œæ‚²è§‚é”ã€‚</h4><p>CASå’ŒSynchronizedéƒ½å¯ä»¥ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«æ•°æ®çš„å®‰å…¨æ€§ã€‚é‚£ä¹ˆä»–ä»¬ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>Synchronizedæ˜¯ä»æ‚²è§‚çš„è§’åº¦å‡ºå‘ï¼ˆæ‚²è§‚é”ï¼‰</p><p>æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”</p><p>ï¼ˆ<strong>å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹</strong>ï¼‰ã€‚å› æ­¤Synchronizedæˆ‘ä»¬ä¹Ÿå°†å…¶ç§°ä¹‹ä¸º<strong>æ‚²è§‚é”</strong>ã€‚jdkä¸­çš„ReentrantLockä¹Ÿæ˜¯ä¸€ç§æ‚²è§‚é”ã€‚æ€§èƒ½è¾ƒå·®ï¼ï¼</p><p>CASæ˜¯ä»ä¹è§‚çš„è§’åº¦å‡ºå‘:</p><p>æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ã€‚</p><p>CASè¿™ç§æœºåˆ¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶ç§°ä¹‹ä¸ºä¹è§‚é”ã€‚ç»¼åˆæ€§èƒ½è¾ƒå¥½ï¼</p><h1 id="ç¬¬å››ç« -å¹¶å‘åŒ…"><a href="#ç¬¬å››ç« -å¹¶å‘åŒ…" class="headerlink" title="ç¬¬å››ç«  å¹¶å‘åŒ…"></a>ç¬¬å››ç«  å¹¶å‘åŒ…</h1><p>åœ¨JDKçš„å¹¶å‘åŒ…é‡Œæä¾›äº†å‡ ä¸ªéå¸¸æœ‰ç”¨çš„å¹¶å‘å®¹å™¨å’Œå¹¶å‘å·¥å…·ç±»ã€‚ä¾›æˆ‘ä»¬åœ¨å¤šçº¿ç¨‹å¼€å‘ä¸­è¿›è¡Œä½¿ç”¨ã€‚</p><h2 id="4-1-ConcurrentHashMap"><a href="#4-1-ConcurrentHashMap" class="headerlink" title="4.1  ConcurrentHashMap"></a>4.1  ConcurrentHashMap</h2><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ConcurrentHashMapï¼š</p><ol><li>HashMapçº¿ç¨‹ä¸å®‰å…¨ï¼Œä¼šå¯¼è‡´æ•°æ®é”™ä¹±</li><li>ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„Hashtableæ•ˆç‡ä½ä¸‹</li></ol><p>åŸºäºä»¥ä¸Šä¸¤ä¸ªåŸå› ï¼Œä¾¿æœ‰äº†ConcurrentHashMapçš„ç™»åœºæœºä¼šã€‚</p><ul><li><strong>HashMapçº¿ç¨‹ä¸å®‰å…¨æ¼”ç¤ºã€‚</strong></li></ul><p>å…¬æœ‰ã€é™æ€çš„é›†åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Const</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹ï¼Œå‘mapä¸­å†™å…¥æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">500000</span>; i++) &#123;</span><br><span class="line">Const.map.put(<span class="keyword">this</span>.getName() + (i + <span class="number">1</span>), <span class="keyword">this</span>.getName() + i + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">    System.out.println(<span class="keyword">this</span>.getName() + <span class="string">" ç»“æŸï¼"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Thread1A a1 = <span class="keyword">new</span> Thread1A();</span><br><span class="line">Thread1A a2 = <span class="keyword">new</span> Thread1A();</span><br><span class="line">a1.setName(<span class="string">"çº¿ç¨‹1-"</span>);</span><br><span class="line">a2.setName(<span class="string">"çº¿ç¨‹2-"</span>);</span><br><span class="line"></span><br><span class="line">a1.start();</span><br><span class="line">a2.start();</span><br><span class="line"><span class="comment">//ä¼‘æ¯10ç§’ï¼Œç¡®ä¿ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span><br><span class="line"><span class="comment">//æ‰“å°é›†åˆå¤§å°</span></span><br><span class="line">System.out.println(<span class="string">"Mapå¤§å°ï¼š"</span> + Const.map.size());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«å‘åŒä¸€ä¸ªmapä¸­å†™å…¥50000ä¸ªé”®å€¼å¯¹ï¼Œæœ€åmapçš„sizeåº”ä¸ºï¼š100000ï¼Œä½†å¤šè¿è¡Œå‡ æ¬¡ä¼šå‘ç°æœ‰ä»¥ä¸‹å‡ ç§é”™è¯¯ï¼š</p><ol><li><p>å‡æ­»ï¼š</p><p><img src="assets/aba6.png" alt></p></li><li><p>å¼‚å¸¸ï¼š</p><p><img src="assets/HashMap%E5%BC%82%E5%B8%B8.png" alt></p></li><li><p>é”™è¯¯ç»“æœï¼š</p><p><img src="assets/HashMap%E9%94%99%E8%AF%AF%E7%BB%93%E6%9E%9C.png" alt></p></li></ol><ul><li><p><strong>ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨Hashtableã€‚æ³¨æ„ï¼šçº¿ç¨‹ä¸­åŠ å…¥äº†è®¡æ—¶</strong></p><p>å…¬æœ‰ã€é™æ€çš„é›†åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Const</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Hashtable&lt;String,String&gt; map = <span class="keyword">new</span> Hashtable&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹ï¼Œå‘mapä¸­å†™å…¥æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">500000</span>; i++) &#123;</span><br><span class="line">Const.map.put(<span class="keyword">this</span>.getName() + (i + <span class="number">1</span>), <span class="keyword">this</span>.getName() + i + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="keyword">this</span>.getName() + <span class="string">" ç»“æŸï¼ç”¨æ—¶ï¼š"</span> + (end - start) + <span class="string">" æ¯«ç§’"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Thread1A a1 = <span class="keyword">new</span> Thread1A();</span><br><span class="line">Thread1A a2 = <span class="keyword">new</span> Thread1A();</span><br><span class="line">a1.setName(<span class="string">"çº¿ç¨‹1-"</span>);</span><br><span class="line">a2.setName(<span class="string">"çº¿ç¨‹2-"</span>);</span><br><span class="line"></span><br><span class="line">a1.start();</span><br><span class="line">a2.start();</span><br><span class="line"><span class="comment">//ä¼‘æ¯10ç§’ï¼Œç¡®ä¿ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span><br><span class="line"><span class="comment">//æ‰“å°é›†åˆå¤§å°</span></span><br><span class="line">System.out.println(<span class="string">"Mapå¤§å°ï¼š"</span> + Const.map.size());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img src="assets/Hashtable%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4.png" alt></p></li></ul><p>å¯ä»¥çœ‹åˆ°ï¼ŒHashtableä¿è¯çš„çº¿ç¨‹å®‰å…¨ï¼Œæ—¶é—´æ˜¯2ç§’å¤šã€‚</p><ul><li><p><strong>å†çœ‹ConcurrentHashMap</strong></p><p>å…¬æœ‰ã€é™æ€çš„é›†åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Const</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ConcurrentHashMap&lt;String,String&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹ï¼Œå‘mapä¸­å†™å…¥æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">500000</span>; i++) &#123;</span><br><span class="line">Const.map.put(<span class="keyword">this</span>.getName() + (i + <span class="number">1</span>), <span class="keyword">this</span>.getName() + i + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="keyword">this</span>.getName() + <span class="string">" ç»“æŸï¼ç”¨æ—¶ï¼š"</span> + (end - start) + <span class="string">" æ¯«ç§’"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Thread1A a1 = <span class="keyword">new</span> Thread1A();</span><br><span class="line">Thread1A a2 = <span class="keyword">new</span> Thread1A();</span><br><span class="line">a1.setName(<span class="string">"çº¿ç¨‹1-"</span>);</span><br><span class="line">a2.setName(<span class="string">"çº¿ç¨‹2-"</span>);</span><br><span class="line"></span><br><span class="line">a1.start();</span><br><span class="line">a2.start();</span><br><span class="line"><span class="comment">//ä¼‘æ¯10ç§’ï¼Œç¡®ä¿ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span><br><span class="line"><span class="comment">//æ‰“å°é›†åˆå¤§å°</span></span><br><span class="line">System.out.println(<span class="string">"Mapå¤§å°ï¼š"</span> + Const.map.size());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img src="assets/ConcurrentHashMap%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4.png" alt></p><p>ConcurrentHashMapä»èƒ½ä¿è¯ç»“æœæ­£ç¡®ï¼Œè€Œä¸”æé«˜äº†æ•ˆç‡ã€‚</p></li></ul><p>HashTableæ•ˆç‡ä½ä¸‹åŸå› ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> V <span class="title">get</span><span class="params">(Object key)</span></span></span><br></pre></td></tr></table></figure><p>HashTableå®¹å™¨ä½¿ç”¨synchronizedæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†åœ¨çº¿ç¨‹ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹HashTableçš„æ•ˆç‡éå¸¸ä½ä¸‹ã€‚å› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®HashTableçš„åŒæ­¥æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿè®¿é—®HashTableçš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚å¦‚çº¿ç¨‹1ä½¿ç”¨putè¿›è¡Œå…ƒç´ æ·»åŠ ï¼Œçº¿ç¨‹2ä¸ä½†ä¸èƒ½ä½¿ç”¨putæ–¹æ³•æ·»åŠ å…ƒç´ ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨getæ–¹æ³•æ¥è·å–å…ƒç´ ï¼Œæ‰€ä»¥ç«äº‰è¶Šæ¿€çƒˆæ•ˆç‡è¶Šä½ã€‚</p><p><img src="assets/Hashtable%E9%94%81%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt></p><p><strong>ConcurrentHashMapé«˜æ•ˆçš„åŸå› ï¼šCAS + å±€éƒ¨(synchronized)é”å®š</strong>åˆ†æ®µå¼é”</p><p><img src="assets/ConcurrentHashMap%E9%94%81%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt></p><h2 id="4-2-CountDownLatch"><a href="#4-2-CountDownLatch" class="headerlink" title="4.2 CountDownLatch"></a>4.2 CountDownLatch</h2><p>CountDownLatchå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œï¼Œå†æ‰§è¡Œè‡ªå·±ã€‚</p><p>ä¾‹å¦‚ï¼šçº¿ç¨‹1è¦æ‰§è¡Œæ‰“å°ï¼šAå’ŒCï¼Œçº¿ç¨‹2è¦æ‰§è¡Œæ‰“å°ï¼šBï¼Œä½†çº¿ç¨‹1åœ¨æ‰“å°Aåï¼Œè¦çº¿ç¨‹2æ‰“å°Bä¹‹åæ‰èƒ½æ‰“å°Cï¼Œæ‰€ä»¥ï¼šçº¿ç¨‹1åœ¨æ‰“å°Aåï¼Œå¿…é¡»ç­‰å¾…çº¿ç¨‹2æ‰“å°å®ŒBä¹‹åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><p>CountDownLatchæ„é€ æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CountDownLatch</span><span class="params">(<span class="keyword">int</span> count)</span><span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å®šè®¡æ•°å™¨çš„CountDownLatchå¯¹è±¡</span></span></span><br></pre></td></tr></table></figure><p>CountDownLatché‡è¦æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException<span class="comment">// è®©å½“å‰çº¿ç¨‹ç­‰å¾…</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countDown</span><span class="params">()</span><span class="comment">// è®¡æ•°å™¨è¿›è¡Œå‡1</span></span></span><br></pre></td></tr></table></figure><ul><li><strong>ç¤ºä¾‹</strong><br>1). åˆ¶ä½œçº¿ç¨‹1ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CountDownLatch down ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(CountDownLatch down)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.down = down;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"A"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            down.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"C"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>2). åˆ¶ä½œçº¿ç¨‹2ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadB</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CountDownLatch down ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadB</span><span class="params">(CountDownLatch down)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.down = down;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"B"</span>);</span><br><span class="line">        down.countDown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3).åˆ¶ä½œæµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CountDownLatch down = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);<span class="comment">//åˆ›å»º1ä¸ªè®¡æ•°å™¨</span></span><br><span class="line">        <span class="keyword">new</span> ThreadA(down).start();</span><br><span class="line">        <span class="keyword">new</span> ThreadB(down).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4). æ‰§è¡Œç»“æœï¼š<br>ä¼šä¿è¯æŒ‰ï¼šA B Cçš„é¡ºåºæ‰“å°ã€‚</p><p>è¯´æ˜ï¼š</p><p>CountDownLatchä¸­count downæ˜¯å€’æ•°çš„æ„æ€ï¼Œlatchåˆ™æ˜¯é—¨é—©çš„å«ä¹‰ã€‚æ•´ä½“å«ä¹‰å¯ä»¥ç†è§£ä¸ºå€’æ•°çš„é—¨æ “ï¼Œä¼¼ä¹æœ‰ä¸€ç‚¹â€œä¸‰äºŒä¸€ï¼ŒèŠéº»å¼€é—¨â€çš„æ„Ÿè§‰ã€‚</p><p>CountDownLatchæ˜¯é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨æ¥å®ç°çš„ï¼Œæ¯å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆäº†è‡ªå·±çš„ä»»åŠ¡åï¼Œå¯ä»¥è°ƒç”¨countDown()æ–¹æ³•è®©è®¡æ•°å™¨-1ï¼Œå½“è®¡æ•°å™¨åˆ°è¾¾0æ—¶ï¼Œè°ƒç”¨CountDownLatchã€‚</p><p>await()æ–¹æ³•çš„çº¿ç¨‹é˜»å¡çŠ¶æ€è§£é™¤ï¼Œç»§ç»­æ‰§è¡Œã€‚</p><h2 id="4-3-CyclicBarrier"><a href="#4-3-CyclicBarrier" class="headerlink" title="4.3 CyclicBarrier"></a>4.3 CyclicBarrier</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>CyclicBarrierçš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ä½¿ç”¨ï¼ˆCyclicï¼‰çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼Œè®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­è¿è¡Œã€‚</p><p>ä¾‹å¦‚ï¼šå…¬å¸å¬é›†5åå‘˜å·¥å¼€ä¼šï¼Œç­‰5åå‘˜å·¥éƒ½åˆ°äº†ï¼Œä¼šè®®å¼€å§‹ã€‚</p><p> æˆ‘ä»¬åˆ›å»º5ä¸ªå‘˜å·¥çº¿ç¨‹ï¼Œ1ä¸ªå¼€ä¼šçº¿ç¨‹ï¼Œå‡ ä¹åŒæ—¶å¯åŠ¨ï¼Œä½¿ç”¨CyclicBarrierä¿è¯5åå‘˜å·¥çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œåï¼Œå†æ‰§è¡Œå¼€ä¼šçº¿ç¨‹ã€‚</p><p>CyclicBarrieræ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CyclicBarrier</span><span class="params">(<span class="keyword">int</span> parties, Runnable barrierAction)</span><span class="comment">// ç”¨äºåœ¨çº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œä¼˜å…ˆæ‰§è¡ŒbarrierActionï¼Œæ–¹ä¾¿å¤„ç†æ›´å¤æ‚çš„ä¸šåŠ¡åœºæ™¯</span></span></span><br></pre></td></tr></table></figure><p>CyclicBarrieré‡è¦æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">await</span><span class="params">()</span><span class="comment">// æ¯ä¸ªçº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•å‘Šè¯‰CyclicBarrieræˆ‘å·²ç»åˆ°è¾¾äº†å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡</span></span></span><br></pre></td></tr></table></figure><ul><li><strong>ç¤ºä¾‹ä»£ç ï¼š</strong><br>1). åˆ¶ä½œå‘˜å·¥çº¿ç¨‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> CyclicBarrier cbRef;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PersonThread</span><span class="params">(CyclicBarrier cbRef)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cbRef = cbRef;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep((<span class="keyword">int</span>) (Math.random() * <span class="number">1000</span>));</span><br><span class="line">System.out.println(Thread.currentThread().getName() + <span class="string">" åˆ°äº†! "</span>);</span><br><span class="line">cbRef.await();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>2). åˆ¶ä½œå¼€ä¼šçº¿ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MeetingThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å¥½äº†ï¼Œäººéƒ½åˆ°äº†ï¼Œå¼€å§‹å¼€ä¼š......"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3). åˆ¶ä½œæµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">CyclicBarrier cbRef = <span class="keyword">new</span> CyclicBarrier(<span class="number">5</span>, <span class="keyword">new</span> MeetingThread());<span class="comment">//ç­‰å¾…5ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†æ‰§è¡ŒMeetingThread</span></span><br><span class="line">PersonThread p1 = <span class="keyword">new</span> PersonThread(cbRef);</span><br><span class="line">PersonThread p2 = <span class="keyword">new</span> PersonThread(cbRef);</span><br><span class="line">PersonThread p3 = <span class="keyword">new</span> PersonThread(cbRef);</span><br><span class="line">PersonThread p4 = <span class="keyword">new</span> PersonThread(cbRef);</span><br><span class="line">PersonThread p5 = <span class="keyword">new</span> PersonThread(cbRef);</span><br><span class="line">p1.start();</span><br><span class="line">p2.start();</span><br><span class="line">p3.start();</span><br><span class="line">p4.start();</span><br><span class="line">p5.start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4). æ‰§è¡Œç»“æœï¼š</p><p><img src="imgs/CyclicBarrier_1.png" alt></p><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p>ä½¿ç”¨åœºæ™¯ï¼šCyclicBarrierå¯ä»¥ç”¨äºå¤šçº¿ç¨‹è®¡ç®—æ•°æ®ï¼Œæœ€ååˆå¹¶è®¡ç®—ç»“æœçš„åœºæ™¯ã€‚</p><p>éœ€æ±‚ï¼šä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹è¯»å–2ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œå½“ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®éƒ½è¯»å–å®Œæ¯•ä»¥åï¼Œè¿›è¡Œæ•°æ®çš„æ±‡æ€»æ“ä½œã€‚</p><h2 id="4-4-Semaphore"><a href="#4-4-Semaphore" class="headerlink" title="4.4 Semaphore"></a>4.4 Semaphore</h2><p>Semaphoreï¼ˆå‘ä¿¡å·ï¼‰çš„ä¸»è¦ä½œç”¨æ˜¯æ§åˆ¶çº¿ç¨‹çš„å¹¶å‘æ•°é‡ã€‚</p><p>synchronizedå¯ä»¥èµ·åˆ°â€é”â€çš„ä½œç”¨ï¼Œä½†æŸä¸ªæ—¶é—´æ®µå†…ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å…è®¸æ‰§è¡Œã€‚</p><p>Semaphoreå¯ä»¥è®¾ç½®åŒæ—¶å…è®¸å‡ ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p><p>Semaphoreå­—é¢æ„æ€æ˜¯ä¿¡å·é‡çš„æ„æ€ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ§åˆ¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°ç›®ã€‚</p><p>Semaphoreæ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits)</span>permits è¡¨ç¤ºè®¸å¯çº¿ç¨‹çš„æ•°é‡</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits, <span class="keyword">boolean</span> fair)</span>fair è¡¨ç¤ºå…¬å¹³æ€§ï¼Œå¦‚æœè¿™ä¸ªè®¾ä¸º <span class="keyword">true</span> çš„è¯ï¼Œä¸‹æ¬¡æ‰§è¡Œçš„çº¿ç¨‹ä¼šæ˜¯ç­‰å¾…æœ€ä¹…çš„çº¿ç¨‹</span></span><br></pre></td></tr></table></figure><p>Semaphoreé‡è¦æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedExceptionè¡¨ç¤ºè·å–è®¸å¯</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span><span class="title">release</span><span class="params">()</span> è¡¨ç¤ºé‡Šæ”¾è®¸å¯</span></span><br></pre></td></tr></table></figure><ul><li><strong>ç¤ºä¾‹ä¸€ï¼šåŒæ—¶å…è®¸1ä¸ªçº¿ç¨‹æ‰§è¡Œ</strong></li></ul><p>1). åˆ¶ä½œä¸€ä¸ªServiceç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">1</span>);<span class="comment">//1è¡¨ç¤ºè®¸å¯çš„æ„æ€ï¼Œè¡¨ç¤ºæœ€å¤šå…è®¸1ä¸ªçº¿ç¨‹æ‰§è¡Œacquire()å’Œrelease()ä¹‹é—´çš„å†…å®¹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            semaphore.acquire();</span><br><span class="line">            System.out.println(Thread.currentThread().getName()</span><br><span class="line">                    + <span class="string">" è¿›å…¥ æ—¶é—´="</span> + System.currentTimeMillis());</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()</span><br><span class="line">                    + <span class="string">"   ç»“æŸ æ—¶é—´="</span> + System.currentTimeMillis());</span><br><span class="line">            semaphore.release();</span><br><span class="line"><span class="comment">//acquire()å’Œrelease()æ–¹æ³•ä¹‹é—´çš„ä»£ç ä¸º"åŒæ­¥ä»£ç "</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2). åˆ¶ä½œçº¿ç¨‹ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Service service;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(Service service)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.service = service;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">service.testMethod();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3). æµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Service service = <span class="keyword">new</span> Service();</span><br><span class="line">        <span class="comment">//å¯åŠ¨5ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">ThreadA a = <span class="keyword">new</span> ThreadA(service);</span><br><span class="line">a.setName(<span class="string">"çº¿ç¨‹ "</span> + i);</span><br><span class="line">a.start();<span class="comment">//5ä¸ªçº¿ç¨‹ä¼šåŒæ—¶æ‰§è¡ŒServiceçš„testMethodæ–¹æ³•ï¼Œè€ŒæŸä¸ªæ—¶é—´æ®µåªèƒ½æœ‰1ä¸ªçº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4). ç»“æœï¼š</p><p><img src="assets/Semaphore1%E4%B8%AA%E7%BA%BF%E7%A8%8B%E6%89%A7%E8%A1%8C.png" alt></p><ul><li><strong>ç¤ºä¾‹äºŒï¼šåŒæ—¶å…è®¸2ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ</strong><br>1). ä¿®æ”¹Serviceç±»ï¼Œå°†new Semaphore(1)æ”¹ä¸º2å³å¯ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">2</span>);<span class="comment">//2è¡¨ç¤ºè®¸å¯çš„æ„æ€ï¼Œè¡¨ç¤ºæœ€å¤šå…è®¸2ä¸ªçº¿ç¨‹æ‰§è¡Œacquire()å’Œrelease()ä¹‹é—´çš„å†…å®¹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            semaphore.acquire();</span><br><span class="line">            System.out.println(Thread.currentThread().getName()</span><br><span class="line">                    + <span class="string">" è¿›å…¥ æ—¶é—´="</span> + System.currentTimeMillis());</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()</span><br><span class="line">                    + <span class="string">"   ç»“æŸ æ—¶é—´="</span> + System.currentTimeMillis());</span><br><span class="line">            semaphore.release();</span><br><span class="line"><span class="comment">//acquire()å’Œrelease()æ–¹æ³•ä¹‹é—´çš„ä»£ç ä¸º"åŒæ­¥ä»£ç "</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>2). å†æ¬¡æ‰§è¡Œç»“æœï¼š</p><p><img src="assets/Semaphore2%E4%B8%AA%E7%BA%BF%E7%A8%8B%E6%89%A7%E8%A1%8C.png" alt></p><h2 id="4-5-Exchanger"><a href="#4-5-Exchanger" class="headerlink" title="4.5 Exchanger"></a>4.5 Exchanger</h2><h3 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Exchangerï¼ˆäº¤æ¢è€…ï¼‰æ˜¯ä¸€ä¸ªç”¨äºçº¿ç¨‹é—´åä½œçš„å·¥å…·ç±»ã€‚Exchangerç”¨äºè¿›è¡Œçº¿ç¨‹é—´çš„æ•°æ®äº¤æ¢ã€‚</p><p>è¿™ä¸¤ä¸ªçº¿ç¨‹é€šè¿‡exchangeæ–¹æ³•äº¤æ¢æ•°æ®ï¼Œå¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œexchange()æ–¹æ³•ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿæ‰§è¡Œexchangeæ–¹æ³•ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾åŒæ­¥ç‚¹æ—¶ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹å°±å¯ä»¥äº¤æ¢æ•°æ®ï¼Œå°†æœ¬çº¿ç¨‹ç”Ÿäº§å‡ºæ¥çš„æ•°æ®ä¼ é€’ç»™å¯¹æ–¹ã€‚</p><p>Exchangeræ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Exchanger</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><p>Exchangeré‡è¦æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">exchange</span><span class="params">(V x)</span></span></span><br></pre></td></tr></table></figure><ul><li><strong>ç¤ºä¾‹ä¸€ï¼šexchangeæ–¹æ³•çš„é˜»å¡ç‰¹æ€§</strong></li></ul><p>1).åˆ¶ä½œçº¿ç¨‹Aï¼Œå¹¶èƒ½å¤Ÿæ¥æ”¶ä¸€ä¸ªExchangerå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Exchanger&lt;String&gt; exchanger;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(Exchanger&lt;String&gt; exchanger)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.exchanger = exchanger;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"çº¿ç¨‹Aæ¬²ä¼ é€’å€¼'ç¤¼ç‰©A'ç»™çº¿ç¨‹Bï¼Œå¹¶ç­‰å¾…çº¿ç¨‹Bçš„å€¼..."</span>);</span><br><span class="line">System.out.println(<span class="string">"åœ¨çº¿ç¨‹Aä¸­å¾—åˆ°çº¿ç¨‹Bçš„å€¼="</span> + exchanger.exchange(<span class="string">"ç¤¼ç‰©A"</span>));</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2). åˆ¶ä½œmain()æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Exchanger&lt;String&gt; exchanger = <span class="keyword">new</span> Exchanger&lt;String&gt;();</span><br><span class="line">ThreadA a = <span class="keyword">new</span> ThreadA(exchanger);</span><br><span class="line">a.start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3).æ‰§è¡Œç»“æœï¼š</p><p><img src="assets/Exchange%E9%98%BB%E5%A1%9E.png" alt></p><ul><li><strong>ç¤ºä¾‹äºŒï¼šexchangeæ–¹æ³•æ‰§è¡Œäº¤æ¢</strong></li></ul><p>1).åˆ¶ä½œçº¿ç¨‹Aï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Exchanger&lt;String&gt; exchanger;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(Exchanger&lt;String&gt; exchanger)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.exchanger = exchanger;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"çº¿ç¨‹Aæ¬²ä¼ é€’å€¼'ç¤¼ç‰©A'ç»™çº¿ç¨‹Bï¼Œå¹¶ç­‰å¾…çº¿ç¨‹Bçš„å€¼..."</span>);</span><br><span class="line">System.out.println(<span class="string">"åœ¨çº¿ç¨‹Aä¸­å¾—åˆ°çº¿ç¨‹Bçš„å€¼="</span> + exchanger.exchange(<span class="string">"ç¤¼ç‰©A"</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).åˆ¶ä½œçº¿ç¨‹Bï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadB</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Exchanger&lt;String&gt; exchanger;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadB</span><span class="params">(Exchanger&lt;String&gt; exchanger)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.exchanger = exchanger;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"çº¿ç¨‹Bæ¬²ä¼ é€’å€¼'ç¤¼ç‰©B'ç»™çº¿ç¨‹Aï¼Œå¹¶ç­‰å¾…çº¿ç¨‹Açš„å€¼..."</span>);</span><br><span class="line">System.out.println(<span class="string">"åœ¨çº¿ç¨‹Bä¸­å¾—åˆ°çº¿ç¨‹Açš„å€¼="</span> + exchanger.exchange(<span class="string">"ç¤¼ç‰©B"</span>));</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3).åˆ¶ä½œæµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Exchanger&lt;String&gt; exchanger = <span class="keyword">new</span> Exchanger&lt;String&gt;();</span><br><span class="line">ThreadA a = <span class="keyword">new</span> ThreadA(exchanger);</span><br><span class="line">ThreadB b = <span class="keyword">new</span> ThreadB(exchanger);</span><br><span class="line">a.start();</span><br><span class="line">b.start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4).æ‰§è¡Œç»“æœï¼š</p><p><img src="assets/Exchange%E4%BA%A4%E6%8D%A2.png" alt></p><ul><li><strong>ç¤ºä¾‹ä¸‰ï¼šexchangeæ–¹æ³•çš„è¶…æ—¶</strong></li></ul><p>1).åˆ¶ä½œçº¿ç¨‹Aï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Exchanger&lt;String&gt; exchanger;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(Exchanger&lt;String&gt; exchanger)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.exchanger = exchanger;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"çº¿ç¨‹Aæ¬²ä¼ é€’å€¼'ç¤¼ç‰©A'ç»™çº¿ç¨‹Bï¼Œå¹¶ç­‰å¾…çº¿ç¨‹Bçš„å€¼ï¼Œåªç­‰5ç§’..."</span>);</span><br><span class="line">System.out.println(<span class="string">"åœ¨çº¿ç¨‹Aä¸­å¾—åˆ°çº¿ç¨‹Bçš„å€¼ ="</span> + exchanger.exchange(<span class="string">"ç¤¼ç‰©A"</span>,<span class="number">5</span>, TimeUnit.SECONDS));</span><br><span class="line">System.out.println(<span class="string">"çº¿ç¨‹Aç»“æŸï¼"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (TimeoutException e) &#123;</span><br><span class="line">System.out.println(<span class="string">"5ç§’é’Ÿæ²¡ç­‰åˆ°çº¿ç¨‹Bçš„å€¼ï¼Œçº¿ç¨‹Aç»“æŸï¼"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).åˆ¶ä½œæµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Run</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Exchanger&lt;String&gt; exchanger = <span class="keyword">new</span> Exchanger&lt;String&gt;();</span><br><span class="line">ThreadA a = <span class="keyword">new</span> ThreadA(exchanger);</span><br><span class="line">a.start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3).æµ‹è¯•ç»“æœï¼š</p><p><img src="assets/Exchange%E8%B6%85%E6%97%B6.png" alt></p><h3 id="ä½¿ç”¨åœºæ™¯-1"><a href="#ä½¿ç”¨åœºæ™¯-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p>ä½¿ç”¨åœºæ™¯ï¼šå¯ä»¥åšæ•°æ®æ ¡å¯¹å·¥ä½œ</p><p>éœ€æ±‚ï¼šæ¯”å¦‚æˆ‘ä»¬éœ€è¦å°†çº¸åˆ¶é“¶è¡Œæµæ°´é€šè¿‡äººå·¥çš„æ–¹å¼å½•å…¥æˆç”µå­é“¶è¡Œæµæ°´ã€‚ä¸ºäº†é¿å…é”™è¯¯ï¼Œé‡‡ç”¨ABå²—ä¸¤äººè¿›è¡Œå½•å…¥ï¼Œå½•å…¥åˆ°ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼Œç³»ç»Ÿéœ€è¦åŠ è½½è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œ</p><p>å¹¶å¯¹ä¸¤ä¸ªæ–‡ä»¶æ•°æ®è¿›è¡Œæ ¡å¯¹ï¼Œçœ‹çœ‹æ˜¯å¦å½•å…¥ä¸€è‡´ï¼Œ</p><h1 id="ç¬¬äº”ç« -çº¿ç¨‹æ± æ–¹å¼"><a href="#ç¬¬äº”ç« -çº¿ç¨‹æ± æ–¹å¼" class="headerlink" title="ç¬¬äº”ç«  çº¿ç¨‹æ± æ–¹å¼"></a>ç¬¬äº”ç«  çº¿ç¨‹æ± æ–¹å¼</h1><h2 id="5-1-çº¿ç¨‹æ± çš„æ€æƒ³"><a href="#5-1-çº¿ç¨‹æ± çš„æ€æƒ³" class="headerlink" title="5.1 çº¿ç¨‹æ± çš„æ€æƒ³"></a>5.1 çº¿ç¨‹æ± çš„æ€æƒ³</h2><p><img src="assets/%E6%B8%B8%E6%B3%B3%E6%B1%A0.jpg" alt></p><p>æˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹çš„æ—¶å€™å°±å»åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å®ç°èµ·æ¥éå¸¸ç®€ä¾¿ï¼Œä½†æ˜¯å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼š</p><p>å¦‚æœå¹¶å‘çš„çº¿ç¨‹æ•°é‡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ—¶é—´å¾ˆçŸ­çš„ä»»åŠ¡å°±ç»“æŸäº†ï¼Œè¿™æ ·é¢‘ç¹åˆ›å»ºçº¿ç¨‹å°±ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ï¼Œå› ä¸ºé¢‘ç¹åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹éœ€è¦æ—¶é—´ï¼Œçº¿ç¨‹ä¹Ÿå±äºå®è´µçš„ç³»ç»Ÿèµ„æºã€‚</p><p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ä½¿å¾—çº¿ç¨‹å¯ä»¥å¤ç”¨ï¼Œå°±æ˜¯æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸è¢«é”€æ¯ï¼Œè€Œæ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡ï¼Ÿ</p><p>åœ¨Javaä¸­å¯ä»¥é€šè¿‡çº¿ç¨‹æ± æ¥è¾¾åˆ°è¿™æ ·çš„æ•ˆæœã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥è¯¦ç»†è®²è§£ä¸€ä¸‹Javaçš„çº¿ç¨‹æ± ã€‚</p><h2 id="5-2-07çº¿ç¨‹æ± æ¦‚å¿µ"><a href="#5-2-07çº¿ç¨‹æ± æ¦‚å¿µ" class="headerlink" title="5.2 07çº¿ç¨‹æ± æ¦‚å¿µ"></a>5.2 07çº¿ç¨‹æ± æ¦‚å¿µ</h2><ul><li><strong>çº¿ç¨‹æ± ï¼š</strong>å…¶å®å°±æ˜¯ä¸€ä¸ªå®¹çº³å¤šä¸ªçº¿ç¨‹çš„å®¹å™¨ï¼Œå…¶ä¸­çš„çº¿ç¨‹å¯ä»¥åå¤ä½¿ç”¨ï¼Œçœå»äº†é¢‘ç¹åˆ›å»ºçº¿ç¨‹å¯¹è±¡çš„æ“ä½œï¼Œæ— éœ€åå¤åˆ›å»ºçº¿ç¨‹è€Œæ¶ˆè€—è¿‡å¤šèµ„æºã€‚</li></ul><p>ç”±äºçº¿ç¨‹æ± ä¸­æœ‰å¾ˆå¤šæ“ä½œéƒ½æ˜¯ä¸ä¼˜åŒ–èµ„æºç›¸å…³çš„ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå°±ä¸å¤šèµ˜è¿°ã€‚æˆ‘ä»¬é€šè¿‡ä¸€å¼ å›¾æ¥äº†è§£çº¿ç¨‹æ± çš„å·¥ä½œåŸç†ï¼š</p><p><img src="assets/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86.bmp" alt></p><p>åˆç†åˆ©ç”¨çº¿ç¨‹æ± èƒ½å¤Ÿå¸¦æ¥ä¸‰ä¸ªå¥½å¤„ï¼š</p><ol><li>é™ä½èµ„æºæ¶ˆè€—ã€‚å‡å°‘äº†åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ¬¡æ•°ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½å¯ä»¥è¢«é‡å¤åˆ©ç”¨ï¼Œå¯æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚</li><li>æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦çš„ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚å¯ä»¥æ ¹æ®ç³»ç»Ÿçš„æ‰¿å—èƒ½åŠ›ï¼Œè°ƒæ•´çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿çº¿ç¨‹çš„æ•°ç›®ï¼Œé˜²æ­¢å› ä¸ºæ¶ˆè€—è¿‡å¤šçš„å†…å­˜ï¼Œè€ŒæŠŠæœåŠ¡å™¨ç´¯è¶´ä¸‹(æ¯ä¸ªçº¿ç¨‹éœ€è¦å¤§çº¦1MBå†…å­˜ï¼Œçº¿ç¨‹å¼€çš„è¶Šå¤šï¼Œæ¶ˆè€—çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§ï¼Œæœ€åæ­»æœº)ã€‚</li></ol><h2 id="5-3-çº¿ç¨‹æ± çš„ä½¿ç”¨"><a href="#5-3-çº¿ç¨‹æ± çš„ä½¿ç”¨" class="headerlink" title="5.3 çº¿ç¨‹æ± çš„ä½¿ç”¨"></a>5.3 çº¿ç¨‹æ± çš„ä½¿ç”¨</h2><p>Javaé‡Œé¢çº¿ç¨‹æ± çš„é¡¶çº§æ¥å£æ˜¯<code>java.util.concurrent.Executor</code>ï¼Œä½†æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šè®²<code>Executor</code>å¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè€Œåªæ˜¯ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹çš„å·¥å…·ã€‚çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£æ˜¯<code>java.util.concurrent.ExecutorService</code>ã€‚</p><p>è¦é…ç½®ä¸€ä¸ªçº¿ç¨‹æ± æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºçº¿ç¨‹æ± çš„åŸç†ä¸æ˜¯å¾ˆæ¸…æ¥šçš„æƒ…å†µä¸‹ï¼Œå¾ˆæœ‰å¯èƒ½é…ç½®çš„çº¿ç¨‹æ± ä¸æ˜¯è¾ƒä¼˜çš„ï¼Œå› æ­¤åœ¨<code>java.util.concurrent.Executors</code>çº¿ç¨‹å·¥å‚ç±»é‡Œé¢æä¾›äº†ä¸€äº›é™æ€å·¥å‚ï¼Œç”Ÿæˆä¸€äº›å¸¸ç”¨çš„çº¿ç¨‹æ± ã€‚å®˜æ–¹å»ºè®®ä½¿ç”¨Executorså·¥ç¨‹ç±»æ¥åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡ã€‚</p><p>Executorsç±»ä¸­æœ‰ä¸ªåˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li><code>public static ExecutorService newFixedThreadPool(int nThreads)</code>ï¼šè¿”å›çº¿ç¨‹æ± å¯¹è±¡ã€‚(åˆ›å»ºçš„æ˜¯æœ‰ç•Œçº¿ç¨‹æ± ,ä¹Ÿå°±æ˜¯æ± ä¸­çš„çº¿ç¨‹ä¸ªæ•°å¯ä»¥æŒ‡å®šæœ€å¤§æ•°é‡)</li></ul><p>è·å–åˆ°äº†ä¸€ä¸ªçº¿ç¨‹æ± ExecutorService å¯¹è±¡ï¼Œé‚£ä¹ˆæ€ä¹ˆä½¿ç”¨å‘¢ï¼Œåœ¨è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªä½¿ç”¨çº¿ç¨‹æ± å¯¹è±¡çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li><p><code>public Future&lt;?&gt; submit(Runnable task)</code>:è·å–çº¿ç¨‹æ± ä¸­çš„æŸä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œ</p><blockquote><p>Futureæ¥å£ï¼šç”¨æ¥è®°å½•çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åäº§ç”Ÿçš„ç»“æœã€‚</p></blockquote></li></ul><p>ä½¿ç”¨çº¿ç¨‹æ± ä¸­çº¿ç¨‹å¯¹è±¡çš„æ­¥éª¤ï¼š</p><ol><li>åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡ã€‚</li><li>åˆ›å»ºRunnableæ¥å£å­ç±»å¯¹è±¡ã€‚(task)</li><li>æäº¤Runnableæ¥å£å­ç±»å¯¹è±¡ã€‚(take task)</li><li>å…³é—­çº¿ç¨‹æ± (ä¸€èˆ¬ä¸åš)ã€‚</li></ol><p><strong>Runnableå®ç°ç±»ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æˆ‘è¦ä¸€ä¸ªæ•™ç»ƒ"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"æ•™ç»ƒæ¥äº†ï¼š "</span> + Thread.currentThread().getName());</span><br><span class="line">        System.out.println(<span class="string">"æ•™æˆ‘æ¸¸æ³³,äº¤å®Œåï¼Œæ•™ç»ƒå›åˆ°äº†æ¸¸æ³³æ± "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹æ± æµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡</span></span><br><span class="line">        ExecutorService service = Executors.newFixedThreadPool(<span class="number">2</span>);<span class="comment">//åŒ…å«2ä¸ªçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// åˆ›å»ºRunnableå®ä¾‹å¯¹è±¡</span></span><br><span class="line">        MyRunnable r = <span class="keyword">new</span> MyRunnable();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è‡ªå·±åˆ›å»ºçº¿ç¨‹å¯¹è±¡çš„æ–¹å¼</span></span><br><span class="line">        <span class="comment">// Thread t = new Thread(r);</span></span><br><span class="line">        <span class="comment">// t.start(); ---&gt; è°ƒç”¨MyRunnableä¸­çš„run()</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»çº¿ç¨‹æ± ä¸­è·å–çº¿ç¨‹å¯¹è±¡,ç„¶åè°ƒç”¨MyRunnableä¸­çš„run()</span></span><br><span class="line">        service.submit(r);</span><br><span class="line">        <span class="comment">// å†è·å–ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œè°ƒç”¨MyRunnableä¸­çš„run()</span></span><br><span class="line">        service.submit(r);</span><br><span class="line">        service.submit(r);</span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šsubmitæ–¹æ³•è°ƒç”¨ç»“æŸåï¼Œç¨‹åºå¹¶ä¸ç»ˆæ­¢ï¼Œæ˜¯å› ä¸ºçº¿ç¨‹æ± æ§åˆ¶äº†çº¿ç¨‹çš„å…³é—­ã€‚</span></span><br><span class="line">        <span class="comment">// å°†ä½¿ç”¨å®Œçš„çº¿ç¨‹åˆå½’è¿˜åˆ°äº†çº¿ç¨‹æ± ä¸­</span></span><br><span class="line">        <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="comment">//service.shutdown();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Callableæµ‹è¯•ä»£ç :</strong></p><ul><li><p><code>&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task)</code> : è·å–çº¿ç¨‹æ± ä¸­çš„æŸä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œ.</p><p>Future : è¡¨ç¤ºè®¡ç®—çš„ç»“æœ.</p></li><li><p><code>V get()</code> : è·å–è®¡ç®—å®Œæˆçš„ç»“æœã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolDemo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡</span></span><br><span class="line">      ExecutorService service = Executors.newFixedThreadPool(<span class="number">2</span>);<span class="comment">//åŒ…å«2ä¸ªçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºRunnableå®ä¾‹å¯¹è±¡</span></span><br><span class="line">        Callable&lt;Double&gt; c = <span class="keyword">new</span> Callable&lt;Double&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Double <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> Math.random();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»çº¿ç¨‹æ± ä¸­è·å–çº¿ç¨‹å¯¹è±¡,ç„¶åè°ƒç”¨Callableä¸­çš„call()</span></span><br><span class="line">        Future&lt;Double&gt; f1 = service.submit(c);</span><br><span class="line">        <span class="comment">// Futur è°ƒç”¨get() è·å–è¿ç®—ç»“æœ</span></span><br><span class="line">        System.out.println(f1.get());</span><br><span class="line"></span><br><span class="line">        Future&lt;Double&gt; f2 = service.submit(c);</span><br><span class="line">        System.out.println(f2.get());</span><br><span class="line"></span><br><span class="line">        Future&lt;Double&gt; f3 = service.submit(c);</span><br><span class="line">        System.out.println(f3.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-4-çº¿ç¨‹æ± çš„ç»ƒä¹ "><a href="#5-4-çº¿ç¨‹æ± çš„ç»ƒä¹ " class="headerlink" title="5.4 çº¿ç¨‹æ± çš„ç»ƒä¹ "></a>5.4 çº¿ç¨‹æ± çš„ç»ƒä¹ </h2><p><strong>éœ€æ±‚:</strong> ä½¿ç”¨çº¿ç¨‹æ± æ–¹å¼æ‰§è¡Œä»»åŠ¡,è¿”å›1-nçš„å’Œ</p><p><strong>åˆ†æ:</strong> å› ä¸ºéœ€è¦è¿”å›æ±‚å’Œç»“æœ,æ‰€ä»¥ä½¿ç”¨Callableæ–¹å¼çš„ä»»åŠ¡</p><p><strong>ä»£ç :</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        ExecutorService pool = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        SumCallable sc = <span class="keyword">new</span> SumCallable(<span class="number">100</span>);</span><br><span class="line">        Future&lt;Integer&gt; fu = pool.submit(sc);</span><br><span class="line">        Integer integer = fu.get();</span><br><span class="line">        System.out.println(<span class="string">"ç»“æœ: "</span> + integer);</span><br><span class="line">        </span><br><span class="line">        SumCallable sc2 = <span class="keyword">new</span> SumCallable(<span class="number">200</span>);</span><br><span class="line">        Future&lt;Integer&gt; fu2 = pool.submit(sc2);</span><br><span class="line">        Integer integer2 = fu2.get();</span><br><span class="line">        System.out.println(<span class="string">"ç»“æœ: "</span> + integer2);</span><br><span class="line"></span><br><span class="line">        pool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>SumCallable.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SumCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SumCallable</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// æ±‚1-nçš„å’Œ?</span></span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬å…­ç« -æ­»é”"><a href="#ç¬¬å…­ç« -æ­»é”" class="headerlink" title="ç¬¬å…­ç«  æ­»é”"></a>ç¬¬å…­ç«  æ­»é”</h1><h2 id="6-1-ä»€ä¹ˆæ˜¯æ­»é”"><a href="#6-1-ä»€ä¹ˆæ˜¯æ­»é”" class="headerlink" title="6.1 ä»€ä¹ˆæ˜¯æ­»é”"></a>6.1 ä»€ä¹ˆæ˜¯æ­»é”</h2><p>åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­,ä½¿ç”¨äº†å¤šæŠŠé”,é€ æˆçº¿ç¨‹ä¹‹é—´ç›¸äº’ç­‰å¾….ç¨‹åºä¸å¾€ä¸‹èµ°äº†ã€‚</p><h2 id="6-2-äº§ç”Ÿæ­»é”çš„æ¡ä»¶"><a href="#6-2-äº§ç”Ÿæ­»é”çš„æ¡ä»¶" class="headerlink" title="6.2 äº§ç”Ÿæ­»é”çš„æ¡ä»¶"></a>6.2 äº§ç”Ÿæ­»é”çš„æ¡ä»¶</h2><p>1.æœ‰å¤šæŠŠé”<br>2.æœ‰å¤šä¸ªçº¿ç¨‹<br>3.æœ‰åŒæ­¥ä»£ç å—åµŒå¥—</p><h2 id="6-3-æ­»é”ä»£ç "><a href="#6-3-æ­»é”ä»£ç " class="headerlink" title="6.3 æ­»é”ä»£ç "></a>6.3 æ­»é”ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyRunnable mr = <span class="keyword">new</span> MyRunnable();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(mr).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(mr).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    Object objA = <span class="keyword">new</span> Object();</span><br><span class="line">    Object objB = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    åµŒå¥—1 objA</span></span><br><span class="line"><span class="comment">    åµŒå¥—1 objB</span></span><br><span class="line"><span class="comment">    åµŒå¥—2 objB</span></span><br><span class="line"><span class="comment">    åµŒå¥—1 objA</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (objA) &#123;</span><br><span class="line">            System.out.println(<span class="string">"åµŒå¥—1 objA"</span>);</span><br><span class="line">            <span class="keyword">synchronized</span> (objB) &#123;<span class="comment">// t2, objA, æ‹¿ä¸åˆ°Bé”,ç­‰å¾…</span></span><br><span class="line">                System.out.println(<span class="string">"åµŒå¥—1 objB"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (objB) &#123;</span><br><span class="line">            System.out.println(<span class="string">"åµŒå¥—2 objB"</span>);</span><br><span class="line">            <span class="keyword">synchronized</span> (objA) &#123;<span class="comment">// t1 , objB, æ‹¿ä¸åˆ°Aé”,ç­‰å¾…</span></span><br><span class="line">                System.out.println(<span class="string">"åµŒå¥—2 objA"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„:<strong>æˆ‘ä»¬åº”è¯¥å°½é‡é¿å…æ­»é”</strong></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å†…éƒ¨ç±»ç›¸å…³</title>
      <link href="/2022/11/18/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(44)/"/>
      <url>/2022/11/18/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(44)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="é™æ€å†…éƒ¨ç±»ï¼š"><a href="#é™æ€å†…éƒ¨ç±»ï¼š" class="headerlink" title="é™æ€å†…éƒ¨ç±»ï¼š"></a><strong>é™æ€å†…éƒ¨ç±»ï¼š</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    ç›®æ ‡ï¼šé™æ€å†…éƒ¨ç±»çš„ç ”ç©¶ï¼ˆäº†è§£è¯­æ³•å³å¯ï¼‰</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ä»€ä¹ˆæ˜¯é™æ€å†…éƒ¨ç±»ï¼Ÿ</span></span><br><span class="line"><span class="comment">        æœ‰staticä¿®é¥°ï¼Œå±äºå¤–éƒ¨ç±»æœ¬èº«ï¼Œä¼šåŠ è½½ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    é™æ€å†…éƒ¨ç±»ä¸­çš„æˆåˆ†ç ”ç©¶ï¼š</span></span><br><span class="line"><span class="comment">        ç±»æœ‰çš„æˆåˆ†å®ƒéƒ½æœ‰ï¼Œé™æ€å†…éƒ¨ç±»å±äºå¤–éƒ¨ç±»æœ¬èº«ï¼Œåªä¼šåŠ è½½ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">        æ‰€ä»¥å®ƒçš„ç‰¹ç‚¹ä¸å¤–éƒ¨ç±»æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªæ˜¯ä½ç½®åœ¨åˆ«äººé‡Œé¢è€Œå·²ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        å¤–éƒ¨ç±»=å®¿ä¸»</span></span><br><span class="line"><span class="comment">        å†…éƒ¨ç±»=å¯„ç”Ÿ</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    é™æ€å†…éƒ¨ç±»çš„è®¿é—®æ ¼å¼ï¼š</span></span><br><span class="line"><span class="comment">        å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§°</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    é™æ€å†…éƒ¨ç±»åˆ›å»ºå¯¹è±¡çš„æ ¼å¼ï¼š</span></span><br><span class="line"><span class="comment">        å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§° å¯¹è±¡åç§° = new å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»æ„é€ å™¨;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    é™æ€å†…éƒ¨ç±»çš„è®¿é—®æ‹“å±•ï¼š</span></span><br><span class="line"><span class="comment">        é™æ€å†…éƒ¨ç±»ä¸­æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜?å¯ä»¥çš„ï¼Œå¤–éƒ¨ç±»çš„é™æ€æˆå‘˜åªæœ‰ä¸€ä»½ï¼Œå¯ä»¥è¢«å…±äº«ï¼</span></span><br><span class="line"><span class="comment">        é™æ€å†…éƒ¨ç±»ä¸­æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹æˆå‘˜?ä¸å¯ä»¥çš„,å¤–éƒ¨ç±»çš„æ˜¯æˆå‘˜å¿…é¡»ç”¨å¤–éƒ¨ç±»å¯¹è±¡è®¿é—®ï¼ï¼</span></span><br><span class="line"><span class="comment">    å°ç»“ï¼š</span></span><br><span class="line"><span class="comment">         é™æ€å†…éƒ¨ç±»å±äºå¤–éƒ¨ç±»æœ¬èº«ï¼Œåªä¼šåŠ è½½ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">         æ‰€ä»¥å®ƒçš„ç‰¹ç‚¹ä¸å¤–éƒ¨ç±»æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªæ˜¯ä½ç½®åœ¨åˆ«äººé‡Œé¢è€Œå·²ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§° å¯¹è±¡åç§° = new å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»æ„é€ å™¨</span></span><br><span class="line">        Outter.Inner in = <span class="keyword">new</span> Outter.Inner();</span><br><span class="line">        in.setName(<span class="string">"å¼ ä¸‰"</span>);</span><br><span class="line">        in.setAge(<span class="number">12</span>);</span><br><span class="line">        System.out.println(in.getName());</span><br><span class="line">        System.out.println(in.getAge());</span><br><span class="line">        in.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outter</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> age1 = <span class="number">12</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€å†…éƒ¨ç±»ï¼šæœ‰staticä¿®é¥°ï¼Œå±äºå¤–éƒ¨ç±»æœ¬èº«ï¼Œåªä¼šåŠ è½½ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> String schoolName = <span class="string">"é»‘é©¬"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(name+<span class="string">"--&gt;"</span>+age+<span class="string">"å²~"</span>);</span><br><span class="line">            System.out.println(age1);</span><br><span class="line">            <span class="comment">//System.out.println(salary);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Inner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Inner</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ä¸€èˆ¬å†…éƒ¨ç±»ï¼š"><a href="#ä¸€èˆ¬å†…éƒ¨ç±»ï¼š" class="headerlink" title="ä¸€èˆ¬å†…éƒ¨ç±»ï¼š"></a><strong>ä¸€èˆ¬å†…éƒ¨ç±»ï¼š</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    ç›®æ ‡ï¼šå†…éƒ¨ç±»_å®ä¾‹å†…éƒ¨ç±»ï¼ˆæˆå‘˜å†…éƒ¨ç±»ï¼‰(äº†è§£è¯­æ³•ä¸ºä¸»)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ä»€ä¹ˆæ˜¯å®ä¾‹å†…éƒ¨ç±»ï¼š</span></span><br><span class="line"><span class="comment">        æ— staticä¿®é¥°çš„å†…éƒ¨ç±»ï¼Œå±äºå¤–éƒ¨ç±»çš„æ¯ä¸ªå¯¹è±¡çš„ï¼Œè·Ÿç€å¯¹è±¡ä¸€èµ·åŠ è½½çš„ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    å®ä¾‹å†…éƒ¨ç±»çš„æˆåˆ†ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">        å®ä¾‹å†…éƒ¨ç±»ä¸­ä¸èƒ½å®šä¹‰é™æ€æˆå‘˜ï¼Œå…¶ä»–éƒ½å¯ä»¥å®šä¹‰ã€‚</span></span><br><span class="line"><span class="comment">        å¯ä»¥å®šä¹‰å¸¸é‡ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    å®ä¾‹å†…éƒ¨ç±»çš„è®¿é—®æ ¼å¼ï¼š</span></span><br><span class="line"><span class="comment">        å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§°ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    åˆ›å»ºå¯¹è±¡çš„æ ¼å¼ï¼š</span></span><br><span class="line"><span class="comment">        å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§° å¯¹è±¡åç§° = new å¤–éƒ¨ç±»æ„é€ å™¨.new å†…éƒ¨æ„é€ å™¨;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    æ‹“å±•ï¼š</span></span><br><span class="line"><span class="comment">        å®ä¾‹å†…éƒ¨ç±»ä¸­æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ï¼Ÿå¯ä»¥çš„ï¼Œå¤–éƒ¨ç±»çš„é™æ€æˆå‘˜å¯ä»¥è¢«å…±äº«è®¿é—®ï¼</span></span><br><span class="line"><span class="comment">        å®ä¾‹å†…éƒ¨ç±»ä¸­æ˜¯å¦å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹æˆå‘˜ï¼Ÿå¯ä»¥çš„ï¼Œå®ä¾‹å†…éƒ¨ç±»å±äºå¤–éƒ¨ç±»å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥è®¿é—®å½“å‰å¤–éƒ¨ç±»å¯¹è±¡çš„å®ä¾‹æˆå‘˜ï¼</span></span><br><span class="line"><span class="comment">    å°ç»“ï¼š</span></span><br><span class="line"><span class="comment">        å®ä¾‹å†…éƒ¨ç±»å±äºå¤–éƒ¨ç±»å¯¹è±¡ï¼Œéœ€è¦ç”¨å¤–éƒ¨ç±»å¯¹è±¡ä¸€èµ·åŠ è½½ï¼Œ</span></span><br><span class="line"><span class="comment">        å®ä¾‹å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„å…¨éƒ¨æˆå‘˜ï¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®ä¾‹å†…éƒ¨ç±»å±äºå¤–éƒ¨ç±»å¯¹è±¡ã€‚å®ä¾‹å†…éƒ¨ç±»çš„å®¿ä¸»æ˜¯å¤–éƒ¨ç±»å¯¹è±¡ï¼ï¼</span></span><br><span class="line">        Outter.Inner in = <span class="keyword">new</span> Outter().new Inner();</span><br><span class="line">        in.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¤–éƒ¨ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outter</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> age = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ä¾‹å†…éƒ¨ç±»ï¼šæ— staticä¿®é¥°ï¼Œå±äºå¤–éƒ¨ç±»çš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String schoolName = <span class="string">"é»‘é©¬"</span>;</span><br><span class="line">        <span class="comment">// ä¸èƒ½åœ¨å®ä¾‹å†…éƒ¨ç±»ä¸­å®šä¹‰é™æ€æˆå‘˜ï¼ï¼ï¼</span></span><br><span class="line"><span class="comment">//      public static String schoolName = "é»‘é©¬";</span></span><br><span class="line"><span class="comment">//      public static void test()&#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹æ–¹æ³•</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">            System.out.println(name+<span class="string">"åç§°ï¼"</span>);</span><br><span class="line">            System.out.println(age);</span><br><span class="line">            System.out.println(salary);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="åŒ¿åå†…éƒ¨ç±»ï¼š"><a href="#åŒ¿åå†…éƒ¨ç±»ï¼š" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»ï¼š"></a><strong>åŒ¿åå†…éƒ¨ç±»ï¼š</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    ç›®æ ‡ï¼šåŒ¿åå†…éƒ¨ç±»çš„æ¦‚è¿°ã€</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ä»€ä¹ˆæ˜¯åŒ¿åå†…éƒ¨ç±»ï¼Ÿ</span></span><br><span class="line"><span class="comment">        å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰åå­—çš„å±€éƒ¨å†…éƒ¨ç±»ã€‚</span></span><br><span class="line"><span class="comment">        åŒ¿åå†…éƒ¨ç±»ç›®çš„æ˜¯ä¸ºäº†ï¼šç®€åŒ–ä»£ç ï¼Œä¹Ÿæ˜¯å¼€å‘ä¸­å¸¸ç”¨çš„å½¢å¼ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    åŒ¿åå†…éƒ¨ç±»çš„æ ¼å¼ï¼š</span></span><br><span class="line"><span class="comment">        new ç±»å|æŠ½è±¡ç±»|æ¥å£(å½¢å‚)&#123;</span></span><br><span class="line"><span class="comment">            æ–¹æ³•é‡å†™ã€‚</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">     åŒ¿åå†…éƒ¨ç±»çš„ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">         1.åŒ¿åå†…éƒ¨ç±»æ˜¯ä¸€ä¸ªæ²¡æœ‰åå­—çš„å†…éƒ¨ç±»ã€‚</span></span><br><span class="line"><span class="comment">         2.åŒ¿åå†…éƒ¨ç±»ä¸€æ—¦å†™å‡ºæ¥ï¼Œå°±ä¼šç«‹å³åˆ›å»ºä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»çš„å¯¹è±¡è¿”å›ã€‚</span></span><br><span class="line"><span class="comment">         3.åŒ¿åå†…éƒ¨ç±»çš„å¯¹è±¡çš„ç±»å‹ç›¸å½“äºæ˜¯å½“å‰newçš„é‚£ä¸ªçš„ç±»å‹çš„å­ç±»ç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">    å°ç»“ï¼š</span></span><br><span class="line"><span class="comment">         1.åŒ¿åå†…éƒ¨ç±»æ˜¯ä¸€ä¸ªæ²¡æœ‰åå­—çš„å†…éƒ¨ç±»ã€‚</span></span><br><span class="line"><span class="comment">         2.åŒ¿åå†…éƒ¨ç±»ä¸€æ—¦å†™å‡ºæ¥ï¼Œå°±ä¼šç«‹å³åˆ›å»ºä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»çš„å¯¹è±¡è¿”å›ã€‚</span></span><br><span class="line"><span class="comment">         3.åŒ¿åå†…éƒ¨ç±»çš„å¯¹è±¡çš„ç±»å‹ç›¸å½“äºæ˜¯å½“å‰newçš„é‚£ä¸ªçš„ç±»å‹çš„å­ç±»ç±»å‹ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Anonymity</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Animal a = <span class="keyword">new</span> Animal()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"çŒ«è·‘çš„è´¼æºœ~~"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        a.run();</span><br><span class="line">        a.go();</span><br><span class="line"></span><br><span class="line">        Animal a1 = <span class="keyword">new</span> Animal() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"ç‹—è·‘çš„è´¼å¿«~~~"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        a1.run();</span><br><span class="line">        a1.go();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å¼€å§‹go~~~"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a><strong>æ³¨æ„äº‹é¡¹</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outter</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> y = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> z = <span class="number">5</span>;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> x = <span class="number">2</span>;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> z = <span class="number">6</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">            System.out.println(x);</span><br><span class="line">            System.out.println(Outter.x);</span><br><span class="line">            System.out.println(func());</span><br><span class="line">            System.out.println(Outter.func());</span><br><span class="line">            System.out.println(<span class="keyword">new</span> Inner().z);</span><br><span class="line">            System.out.println(<span class="keyword">new</span> Outter().z);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment"> * 2</span></span><br><span class="line"><span class="comment"> * 1</span></span><br><span class="line"><span class="comment"> * 5</span></span><br><span class="line"><span class="comment"> * 4</span></span><br><span class="line"><span class="comment"> * 6</span></span><br><span class="line"><span class="comment"> * 5</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜ï¼š</strong> </p><ul><li>åœ¨é™æ€å†…éƒ¨ç±»ä¸­,å’Œå¤–éƒ¨ç±»åŒåçš„å˜é‡å’Œæ–¹æ³•ä¼šè¦†ç›–å¤–éƒ¨çš„åŒåçš„é™æ€å˜é‡å’Œæ–¹æ³•ã€‚</li><li>è‹¥è¦è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æ–¹æ³•æˆ–è€…å˜é‡åˆ™éœ€è¦é€šè¿‡å¤–éƒ¨ç±»åæ¥è°ƒç”¨,æˆ–è€…åˆ›å»ºå¤–éƒ¨ç±»å¯¹è±¡æ¥è°ƒç”¨ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outter</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">2</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">            System.out.println(x);</span><br><span class="line">            System.out.println(<span class="keyword">this</span>);</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.x);</span><br><span class="line">            System.out.println(Outter.x);</span><br><span class="line">            System.out.println(Outter.<span class="keyword">this</span>);</span><br><span class="line">            System.out.println(Outter.<span class="keyword">this</span>.x);</span><br><span class="line">            System.out.println(<span class="keyword">new</span> Outter().x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outter.Inner inner = <span class="keyword">new</span> Outter().new Inner();</span><br><span class="line">        inner.function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment"> * 2</span></span><br><span class="line"><span class="comment"> * com.itheima._15å•ä¾‹æ¨¡å¼.Outter$Inner@15db9742</span></span><br><span class="line"><span class="comment"> * 2</span></span><br><span class="line"><span class="comment"> * 1</span></span><br><span class="line"><span class="comment"> * com.itheima._15å•ä¾‹æ¨¡å¼.Outter@6d06d69c</span></span><br><span class="line"><span class="comment"> * 1</span></span><br><span class="line"><span class="comment"> * 1</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜ï¼š</strong> </p><ul><li>åœ¨å®ä¾‹å†…éƒ¨ç±»ä¸­,å’Œå¤–éƒ¨ç±»åŒåçš„å˜é‡å’Œæ–¹æ³•ä¼šè¦†ç›–å¤–éƒ¨çš„åŒåçš„å˜é‡å’Œæ–¹æ³•ã€‚</li><li>è‹¥è¦è®¿é—®å¤–éƒ¨ç±»çš„æ–¹æ³•æˆ–è€…å˜é‡åˆ™éœ€è¦é€šè¿‡å¤–éƒ¨ç±»åæ¥è°ƒç”¨,æˆ–è€…åˆ›å»ºå¤–éƒ¨ç±»å¯¹è±¡æ¥è°ƒç”¨,æˆ–è€…é€šè¿‡å¤–éƒ¨ç±»å+thiså…³é”®å­—æ¥è°ƒç”¨ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx Luaæ‰©å±•æ¨¡å—</title>
      <link href="/2022/11/16/Nginx_Lua_Expansion_module/"/>
      <url>/2022/11/16/Nginx_Lua_Expansion_module/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-Luaæ‰©å±•æ¨¡å—"><a href="#Nginx-Luaæ‰©å±•æ¨¡å—" class="headerlink" title="Nginx Luaæ‰©å±•æ¨¡å—"></a>Nginx Luaæ‰©å±•æ¨¡å—</h1><h2 id="ngx-luaæ¨¡å—æ¦‚å¿µ"><a href="#ngx-luaæ¨¡å—æ¦‚å¿µ" class="headerlink" title="ngx_luaæ¨¡å—æ¦‚å¿µ"></a>ngx_luaæ¨¡å—æ¦‚å¿µ</h2><p><a href="https://github.com/openresty/lua-nginx-module#readme">ngx_lua å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://www.kancloud.cn/qq13867685/openresty-api-cn/159175" target="_blank" rel="noopener">ngx_lua ä¸­æ–‡æ–‡æ¡£</a></p><p>æ·˜å®å¼€å‘çš„ <code>ngx_lua</code> æ¨¡å—é€šè¿‡å°† Lua è§£é‡Šå™¨é›†æˆè¿› Nginxï¼Œå¯ä»¥é‡‡ç”¨ Lua è„šæœ¬å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œç”±äº Lua çš„ç´§å‡‘ã€å¿«é€Ÿä»¥åŠå†…å»ºåç¨‹ï¼Œæ‰€ä»¥åœ¨ä¿è¯é«˜å¹¶å‘æœåŠ¡èƒ½åŠ›çš„åŒæ—¶æå¤§åœ°é™ä½äº†ä¸šåŠ¡é€»è¾‘å®ç°æˆæœ¬ã€‚</p><h2 id="ngx-luaæ¨¡å—ç¯å¢ƒå‡†å¤‡"><a href="#ngx-luaæ¨¡å—ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ngx_luaæ¨¡å—ç¯å¢ƒå‡†å¤‡"></a>ngx_luaæ¨¡å—ç¯å¢ƒå‡†å¤‡</h2><p>ä¸‹è½½ <code>ngx-lua-module</code> æ¨¡å—æœ‰ä¸¤ä¸ªæ–¹å¼ã€‚</p><ul><li>æ–¹å¼ä¸€å®‰è£…æ¯”è¾ƒç¹çï¼Œéœ€è¦æ‰‹åŠ¨ä¸‹è½½å…¶ä»–ä¾èµ–</li><li>æ–¹å¼äºŒå®‰è£…ç®€å•å¿«æ·ï¼Œé›†æˆäº†ä¾èµ–ï¼Œä¸éœ€è¦æ‰‹åŠ¨ä¸‹è½½ä¾èµ–ï¼Œå»ºè®®æ–¹å¼äºŒ</li></ul><p>ä¸è®ºæ–¹å¼ä¸€è¿˜æ˜¯æ–¹å¼äºŒå®‰è£…ï¼Œ<strong>é¦–å…ˆç¡®ä¿ä½ ä¸ºå®ƒå®‰è£…å¥½äº†ç¯å¢ƒï¼Œå¦åˆ™ä¼šå®‰è£…æŠ¥é”™</strong>ã€‚ç¯å¢ƒåˆ†åˆ«ä¸ºï¼š<code>GCC</code>ã€<code>PCRE</code>ã€<code>zlib</code>ã€<code>OpenSSL</code>ã€‚<a href="/middleware/Nginx/Nginx_install/#nginxç¯å¢ƒå®‰è£…">ç¯å¢ƒå®‰è£…ä¼ é€é—¨</a>ã€‚</p><h3 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h3><p>æ–¹å¼ä¸€ä¸‹è½½ç¬¬ä¸‰æ–¹æ¨¡å— <code>lua-nginx-module</code>ï¼Œå‰ï¼Œéœ€è¦å…ˆä¸‹è½½ <code>LuaJIT</code> è§£æå™¨ã€‚</p><p><code>LuaJIT</code> å®˜ç½‘åœ°å€ä¸ºï¼š<a href="http://luajit.org/" target="_blank" rel="noopener">http://luajit.org/</a>ã€‚</p><ul><li><p>LuaJIT æ˜¯é‡‡ç”¨ C è¯­è¨€ç¼–å†™çš„ Lua ä»£è¡¨çš„è§£é‡Šå™¨ï¼Œæˆ‘ä»¬å…ˆä¸‹è½½å®ƒã€‚</p><p>åœ¨å®˜ç½‘ä¸Šæ‰¾åˆ°å¯¹åº”çš„ä¸‹è½½åœ°å€ï¼š<a href="https://luajit.org/download.html" target="_blank" rel="noopener">https://luajit.org/download.html</a></p><p>åœ¨ Linux ä¸Šä½¿ç”¨ wget æ¥ä¸‹è½½: <code>wget http://luajit.org/download/LuaJIT-2.0.5.tar.gz</code>ï¼Œè¿™é‡Œä¸‹è½½åœ¨ <code>/opt</code>ï¼Œä¸‹è½½çš„ç‰ˆæœ¬æ˜¯ 2.0.5ã€‚</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">wget http://luajit.org/download/LuaJIT-2.0.5.tar.gz</span><br></pre></td></tr></table></figure><p>å°†ä¸‹è½½çš„èµ„æºè¿›è¡Œè§£å‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf LuaJIT-2.0.5.tar.gz</span><br></pre></td></tr></table></figure><p>è¿›å…¥è§£å‹çš„ç›®å½•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> LuaJIT-2.0.5</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç¼–è¯‘å’Œå®‰è£…:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220807/image.50moe87h8k00.webp" alt="image"></p><ul><li>ä¸‹è½½ <code>lua-nginx-module</code></li></ul><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/openresty/lua-nginx-module/tags">https://github.com/openresty/lua-nginx-module/tags</a></p><p>åœ¨ Linux ä¸Šä½¿ç”¨ wget æ¥ä¸‹è½½: <code>wget https://github.com/openresty/lua-nginx-module/archive/v0.10.16rc4.tar.gz</code>ï¼Œè¿™é‡Œä¸‹è½½åœ¨ <code>/opt</code>ï¼Œç‰ˆæœ¬æ˜¯ 0.10.16rc4ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/openresty/lua-nginx-module/archive/v0.10.16rc4.tar.gz</span><br></pre></td></tr></table></figure><p>å°†ä¸‹è½½çš„èµ„æºè¿›è¡Œè§£å‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf lua-nginx-module-0.10.16rc4.tar.gz</span><br></pre></td></tr></table></figure><p>ç›®å½•åå¤ªé•¿ï¼Œæ›´æ”¹ç›®å½•å</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv lua-nginx-module-0.10.16rc4 lua-nginx-module</span><br></pre></td></tr></table></figure><p>å¯¼å…¥ç¯å¢ƒå˜é‡ï¼Œå‘Šè¯‰ Nginx å»å“ªé‡Œæ‰¾ LuaJIT</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> LUAJIT_LIB=/usr/<span class="built_in">local</span>/lib</span><br><span class="line"><span class="built_in">export</span> LUAJIT_INC=/usr/<span class="built_in">local</span>/include/luajit-2.0</span><br></pre></td></tr></table></figure><p>è¿›å…¥ Nginx çš„æºç ç›®å½•ï¼ˆå®‰è£…åŒ…ç›®å½•ï¼‰æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx --add-module=/opt/lua-nginx-module</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ol><li>å¦‚æœå¯åŠ¨ Nginx å‡ºç°å¦‚ä¸‹é”™è¯¯:</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220807/image.3mn8xd7igx20.webp" alt="image"></p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>è®¾ç½®è½¯é“¾æ¥ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/<span class="built_in">local</span>/lib/libluajit-5.1.so.2 /lib64/libluajit-5.1.so.2</span><br></pre></td></tr></table></figure><ol start="2"><li>å¦‚æœå¯åŠ¨ Nginx å‡ºç°ä»¥ä¸‹é”™è¯¯ä¿¡æ¯</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220807/image.6h5kw6afg4w0.webp" alt="image"></p><p>åˆ†æåŸå› ï¼šå› ä¸º <code>lua-nginx-module</code> æ˜¯æ¥è‡ª OpenRestyï¼Œé”™è¯¯ä¸­æç¤ºçš„ resty.core æ˜¯ OpenRestry çš„æ ¸å¿ƒæ¨¡å—ï¼Œå¯¹å…¶ä¸‹çš„å¾ˆå¤šå‡½æ•°è¿›è¡Œäº†ä¼˜åŒ–ç­‰å·¥ä½œã€‚ä»¥å‰çš„ç‰ˆæœ¬é»˜è®¤ä¸ä¼šæŠŠè¯¥æ¨¡å—ç¼–è¯‘è¿›å»ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨çš„è¯ï¼Œæˆ‘ä»¬å¾—æ‰‹åŠ¨å®‰è£…ï¼Œæˆ–è€…ç¦ç”¨å°±å¯ä»¥ã€‚ä½†æ˜¯æœ€æ–°çš„ <code>lua-nginx-module</code> æ¨¡å—å·²ç»å¼ºåˆ¶æ€§å®‰è£…äº†è¯¥æ¨¡å—ï¼Œæ‰€ä»¥æ­¤å¤„å› ä¸ºç¼ºå°‘ resty æ¨¡å—å¯¼è‡´çš„æŠ¥é”™ä¿¡æ¯ã€‚</p><p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼šä¸€ç§æ˜¯ä¸‹è½½å¯¹åº”çš„æ¨¡å—ï¼Œå¦ä¸€ç§åˆ™æ˜¯ç¦ç”¨æ‰ restry æ¨¡å—ï¼Œç¦ç”¨çš„æ–¹å¼ä¸ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line"><span class="attribute">lua_load_resty_core</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•</li></ul><p>åœ¨ nginx.conf ä¸‹é…ç½®å¦‚ä¸‹å†…å®¹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /lua&#123;</span><br><span class="line">    <span class="attribute">default_type</span> <span class="string">'text/html'</span>;</span><br><span class="line">    <span class="attribute">content_by_lua</span> <span class="string">'ngx.say("&lt;h1&gt;HELLO,LUA&lt;/h1&gt;")'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æˆåŠŸåï¼Œå¯åŠ¨ Nginxï¼Œé€šè¿‡æµè§ˆå™¨è¿›è¡Œè®¿é—®ï¼Œå¦‚æœè·å–åˆ°å¦‚ä¸‹ç»“æœï¼Œåˆ™è¯æ˜å®‰è£…æˆåŠŸã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220807/image.6dtqzlgzk5s0.webp" alt="image"></p><h3 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h3><p>æ–¹å¼äºŒä½¿ç”¨ OpenRestry è¿›è¡Œå®‰è£…ã€‚OpenRestry å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„ Nginx çš„ Spring ä¹‹ä¸€ã€‚</p><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>å‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼ŒOpenResty æ˜¯ç”±æ·˜å®å·¥ç¨‹å¸ˆå¼€å‘çš„ï¼Œæ‰€ä»¥å…¶å®˜æ–¹ç½‘ç«™ï¼ˆ<a href="http://openresty.org/cn/" target="_blank" rel="noopener">http://openresty.org/</a>ï¼‰æˆ‘ä»¬è¯»èµ·æ¥æ˜¯éå¸¸çš„æ–¹ä¾¿ã€‚OpenResty æ˜¯ä¸€ä¸ªåŸºäº Nginx ä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚æ‰€ä»¥æœ¬èº« OpenResty å†…éƒ¨å°±å·²ç»é›†æˆäº† Nginx å’Œ Luaï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ã€‚</p><h4 id="Linuxå®‰è£…"><a href="#Linuxå®‰è£…" class="headerlink" title="Linuxå®‰è£…"></a>Linuxå®‰è£…</h4><p>ä¸‹è½½åœ°å€ï¼š<a href="http://openresty.org/cn/download.html" target="_blank" rel="noopener">http://openresty.org/cn/download.html</a>ã€‚è¿™é‡Œä¸‹è½½ 1.19.9.1 ç‰ˆæœ¬ã€‚</p><ul><li><p>å¯ä»¥åœ¨ Windows ä¸‹è½½ OpenRestyï¼š<a href="https://openresty.org/download/openresty-1.19.9.1.tar.gz" target="_blank" rel="noopener">https://openresty.org/download/openresty-1.19.9.1.tar.gz</a>ï¼Œç„¶åä¸Šä¼ åˆ° Linux</p><p>æˆ–è€…ç›´æ¥åœ¨ Linux ä½¿ç”¨ wget ä¸‹è½½: <code>wget https://openresty.org/download/openresty-1.19.9.1.tar.gz</code></p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/openresty    <span class="comment"># æ²¡æœ‰å°±åˆ›å»ºï¼šmkdir /opt/openresty</span></span><br><span class="line"></span><br><span class="line">wget https://openresty.org/download/openresty-1.19.9.1.tar.gz</span><br></pre></td></tr></table></figure><ul><li>è§£å‹ç¼©</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf openresty-1.19.9.1.tar.gz</span><br></pre></td></tr></table></figure><ul><li>è¿›å…¥ OpenResty ç›®å½•</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> openresty-1.19.9.1</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œå‘½ä»¤</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œå‘½ä»¤è¿›è¡Œç¼–è¯‘å’Œå®‰è£…</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">gmake &amp;&amp; gmake install</span><br></pre></td></tr></table></figure><p>é»˜è®¤å®‰è£…åœ¨ <code>/usr/local/</code> ä¸‹ã€‚</p><ul><li>è¿›å…¥ OpenResty çš„ç›®å½•ï¼Œæ‰¾åˆ° nginx</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/openresty/nginx</span><br></pre></td></tr></table></figure><ul><li>åœ¨ conf ç›®å½•ä¸‹çš„ nginx.conf æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim conf/nginx.conf</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /lua &#123;</span><br><span class="line">    <span class="attribute">default_type</span> <span class="string">'text/html'</span>;</span><br><span class="line">    <span class="attribute">content_by_lua</span> <span class="string">'ngx.say("&lt;h1&gt;HELLO,OpenRestry&lt;/h1&gt;")'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯ Nginx é…ç½®æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><ul><li>å…ˆæŠŠ Nginx åœæ­¢è¿è¡Œ</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop Nginx</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ sbin ç›®å½•ä¸‹å¯åŠ¨å¯æ‰§è¡Œæ–‡ä»¶ nginx</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sbin/nginx</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡æµè§ˆå™¨è®¿é—®æµ‹è¯•<code>192.168.91.200</code></li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220807/image.502009iyfd00.webp" alt="image"></p><ul><li>é€šè¿‡æµè§ˆå™¨è®¿é—®æµ‹è¯•<code>192.168.91.200/lua</code></li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220807/image.4r1610qz44g0.webp" alt="image"></p><h3 id="OpenRestyå¸è½½"><a href="#OpenRestyå¸è½½" class="headerlink" title="OpenRestyå¸è½½"></a>OpenRestyå¸è½½</h3><p>å¸è½½éå¸¸ç®€å•ç²—æš´ï¼Œç›¸ä¿¡æˆ‘ï¼Œè¿™æ ·å¸è½½æ˜¯å¯¹çš„ï¼Œæ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><ol><li>åœæ­¢ Nginx æœåŠ¡</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ Nginx æ˜¯å¦åœæ­¢ï¼Œæ²¡æœ‰åˆ™å»åœæ­¢</span></span><br><span class="line">ps -ef | grep nginx </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥ sbin ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/openresty/nginx/sbin</span><br><span class="line">./nginx -s stop</span><br></pre></td></tr></table></figure><ol start="2"><li>è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤å…¨å±€æŸ¥æ‰¾ OpenResty ç›¸å…³çš„æ–‡ä»¶</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name openresty</span><br></pre></td></tr></table></figure><ol start="3"><li>find / -name openresty</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf  æ­¤å¤„è·ŸæŸ¥æ‰¾å‡ºæ¥çš„ Openresty æ–‡ä»¶</span><br></pre></td></tr></table></figure><h2 id="ngx-luaæŒ‡ä»¤å›¾"><a href="#ngx-luaæŒ‡ä»¤å›¾" class="headerlink" title="ngx_luaæŒ‡ä»¤å›¾"></a>ngx_luaæŒ‡ä»¤å›¾</h2><p>ä½¿ç”¨ Lua ç¼–å†™ Nginx è„šæœ¬çš„åŸºæœ¬æ„å»ºå—æ˜¯æŒ‡ä»¤ã€‚æŒ‡ä»¤ç”¨äºæŒ‡å®šä½•æ—¶è¿è¡Œç”¨æˆ· Lua ä»£ç ä»¥åŠå¦‚ä½•ä½¿ç”¨ç»“æœã€‚</p><p>ä¸‹å›¾æ˜¾ç¤ºäº†æ‰§è¡ŒæŒ‡ä»¤çš„é¡ºåºã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220807/image.3xichpazdxy0.webp" alt="image"></p><p>å…ˆæ¥è§£é‡Šä¸‹ * çš„ä½œç”¨</p><ul><li>* ä»£è¡¨ *_by_lua æŒ‡ä»¤ï¼ŒæŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ lua æŒ‡ä»¤</li><li>*:_fileï¼Œå³ *_by_lua_file æŒ‡ä»¤ï¼Œåé¢è·Ÿçš„æ˜¯ lua æ–‡ä»¶</li><li>*:_blockï¼Œå³ *_by_lua_block æŒ‡ä»¤ï¼Œåœ¨ 0.9.17 ç‰ˆåæ›¿æ¢ init_by_lua_file</li></ul><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒOpenResty çš„æ‰§è¡Œé˜¶æ®µåˆ†ä¸ºï¼š</p><ul><li>init_by_lua*ï¼šåœ¨æ¯æ¬¡ Nginx é‡æ–°åŠ è½½é…ç½®æ—¶æ‰§è¡Œï¼Œåˆå§‹åŒ–ä¸€äº›å…¨å±€é…ç½®ã€‚</li><li>init_worker_by_lua*ï¼šè¯¥æŒ‡ä»¤ç”¨äºå¯åŠ¨ä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œå¦‚å¿ƒè·³æ£€æŸ¥ã€å®šæ—¶æ‹‰å–æœåŠ¡å™¨é…ç½®ç­‰ã€‚</li><li>set_by_lua* : æµç¨‹åˆ†æ”¯å¤„ç†åˆ¤æ–­å˜é‡åˆå§‹åŒ–</li><li>rewrite_by_lua* : è½¬å‘ã€é‡å®šå‘ã€ç¼“å­˜ç­‰åŠŸèƒ½(ä¾‹å¦‚ç‰¹å®šè¯·æ±‚ä»£ç†åˆ°å¤–ç½‘)</li><li>access_by_lua* : IP å‡†å…¥ã€æ¥å£æƒé™ç­‰æƒ…å†µé›†ä¸­å¤„ç†(ä¾‹å¦‚é…åˆ iptable å®Œæˆç®€å•é˜²ç«å¢™)</li><li>content_by_lua* : å†…å®¹ç”Ÿæˆ</li><li>header_filter_by_lua* : å“åº”å¤´éƒ¨è¿‡æ»¤å¤„ç†(ä¾‹å¦‚æ·»åŠ å¤´éƒ¨ä¿¡æ¯)</li><li>body_filter_by_lua* : å“åº”ä½“è¿‡æ»¤å¤„ç†(ä¾‹å¦‚å®Œæˆåº”ç­”å†…å®¹ç»Ÿä¸€æˆå¤§å†™)</li><li>log_by_lua* : ä¼šè¯å®Œæˆåæœ¬åœ°å¼‚æ­¥å®Œæˆæ—¥å¿—è®°å½•(æ—¥å¿—å¯ä»¥è®°å½•åœ¨æœ¬åœ°ï¼Œè¿˜å¯ä»¥åŒæ­¥åˆ°å…¶ä»–æœºå™¨)</li></ul><h2 id="è¯­æ³•API"><a href="#è¯­æ³•API" class="headerlink" title="è¯­æ³•API"></a>è¯­æ³•API</h2><h3 id="ngx-say"><a href="#ngx-say" class="headerlink" title="ngx.say"></a>ngx.say</h3><p>è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.say(&quot;&quot;)</code>ã€‚</p><figure class="highlight nginx"><figcaption><span>&#123;4&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">default_type</span> <span class="string">'text/plain'</span>;</span><br><span class="line">    <span class="section">content_by_lua_block</span> &#123;</span><br><span class="line">        ngx.say("Hello World")</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šåœ¨ç½‘é¡µä¸Šçœ‹åˆ° Hello Worldã€‚</p><h3 id="ngx-print"><a href="#ngx-print" class="headerlink" title="ngx.print"></a>ngx.print</h3><p>å°†è¾“å…¥å‚æ•°åˆå¹¶å‘é€ç»™ HTTP å®¢æˆ·ç«¯ (ä½œä¸º HTTP å“åº”ä½“)ã€‚å¦‚æœæ­¤æ—¶è¿˜æ²¡æœ‰å‘é€å“åº”å¤´ä¿¡æ¯ï¼Œæœ¬å‡½æ•°å°†å…ˆå‘é€ HTTP å“åº”å¤´ï¼Œå†è¾“å‡ºå“åº”ä½“ã€‚</p><p>è¯­æ³•ï¼š<code>ok, err = ngx.print(...)</code></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">table</span> = &#123;</span><br><span class="line">     <span class="string">"hello, "</span>,</span><br><span class="line">     &#123;<span class="string">"world: "</span>, <span class="literal">true</span>, <span class="string">" or "</span>, <span class="literal">false</span>,</span><br><span class="line">         &#123;<span class="string">": "</span>, <span class="literal">nil</span>&#125;&#125;</span><br><span class="line"> &#125;</span><br><span class="line">ok, err = ngx.<span class="built_in">print</span>(<span class="built_in">table</span>)</span><br></pre></td></tr></table></figure><p>å°†è¾“å‡ºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello, world: <span class="literal">true</span> <span class="keyword">or</span> <span class="literal">false</span>: <span class="literal">nil</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ ok å­˜å‚¨ç€è¾“å‡ºçš„å†…å®¹ï¼Œå¦‚æœè¾“å‡ºå¤±è´¥ï¼Œerr å­˜å‚¨å¤±è´¥çš„åŸå› ã€‚</p><p>æœ¬å‡½æ•°ä¸ºå¼‚æ­¥è°ƒç”¨ï¼Œå°†ç«‹å³è¿”å›ï¼Œä¸ä¼šç­‰å¾…æ‰€æœ‰æ•°æ®è¢«å†™å…¥ç³»ç»Ÿå‘é€ç¼“å†²åŒºã€‚è¦ä»¥åŒæ­¥æ¨¡å¼è¿è¡Œï¼Œè¯·åœ¨è°ƒç”¨ <code>ngx.print</code> ä¹‹åè°ƒç”¨ <code>ngx.flush</code>ã€‚</p><h3 id="ngx-flush"><a href="#ngx-flush" class="headerlink" title="ngx.flush"></a>ngx.flush</h3><p>å‘å®¢æˆ·ç«¯åˆ·æ–°å“åº”è¾“å‡ºã€‚</p><p>è¯­æ³•ï¼š<code>ok, err = ngx.flush(wait)</code></p><p><code>ngx.flush</code> æ¥å—ä¸€ä¸ªå¸ƒå°”å‹å¯é€‰å‚æ•° <code>wait</code> (é»˜è®¤å€¼ <code>false</code>)ã€‚å½“é€šè¿‡é»˜è®¤å‚æ•°ï¼ˆ<code>false</code>ï¼‰è°ƒç”¨æ—¶ï¼Œæœ¬å‡½æ•°å‘èµ·ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ã€‚å½“æŠŠ <code>wait</code> å‚æ•°è®¾ç½®ä¸º <code>true</code> æ—¶ï¼Œæœ¬å‡½æ•°å°†ä»¥åŒæ­¥æ¨¡å¼æ‰§è¡Œã€‚</p><ul><li>å¼‚æ­¥è°ƒç”¨ä¸‹ï¼Œç›´æ¥å°†æ•°æ®è¿”å›ï¼Œä¸ç­‰å¾…è¾“å‡ºæ•°æ®è¢«å†™å…¥ç³»ç»Ÿå‘é€ç¼“å†²åŒºã€‚</li><li>åŒæ­¥æ¨¡å¼ä¸‹ï¼Œæœ¬å‡½æ•°ä¸ä¼šç«‹å³è¿”å›ï¼Œä¸€ç›´åˆ°æ‰€æœ‰è¾“å‡ºæ•°æ®è¢«å†™å…¥ç³»ç»Ÿè¾“å‡ºç¼“å†²åŒºï¼Œæˆ–åˆ°è¾¾å‘é€è¶…æ—¶ send_timeout æ—¶é—´ã€‚</li></ul><p>è¿™ä¸ªè¦å’Œä¸Šæ–¹çš„ ngx.print è¿›è¡Œé…åˆä½¿ç”¨ï¼Œå¼€å¯åŒæ­¥æ¨¡å¼ï¼Œå¯ä»¥ä¼˜åŒ–è¿”å›å®¢æˆ·ç«¯å¤šæ¡æ•°æ®çš„é€Ÿåº¦ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">table</span> = &#123;</span><br><span class="line">     <span class="string">"hello, "</span>,</span><br><span class="line">     &#123;<span class="string">"world: "</span>, <span class="literal">true</span>, <span class="string">" or "</span>, <span class="literal">false</span>,</span><br><span class="line">         &#123;<span class="string">": "</span>, <span class="literal">nil</span>&#125;&#125;</span><br><span class="line"> &#125;</span><br><span class="line">ok, err = ngx.<span class="built_in">print</span>(<span class="built_in">table</span>)</span><br><span class="line">ngx.<span class="built_in">flush</span>(<span class="literal">true</span>) <span class="comment">-- å¼€å¯åŒæ­¥æ¨¡å¼</span></span><br></pre></td></tr></table></figure><h3 id="ngx-arg"><a href="#ngx-arg" class="headerlink" title="ngx.arg"></a>ngx.arg</h3><p>è·å–å®šä¹‰çš„å˜é‡ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.arg[n]</code>ã€‚</p><figure class="highlight nginx"><figcaption><span>&#123;4&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /foo &#123;</span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$a</span> <span class="number">32</span>;</span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$b</span> <span class="number">56</span>;</span><br><span class="line">    <span class="attribute">sum</span> = ngx.arg[<span class="number">1</span>] + ngx.arg[<span class="number">2</span>]  <span class="comment"># ç­‰ä»·äº $a + $b</span></span><br><span class="line">    echo <span class="variable">$sum</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†è¾“å‡º 88ï¼Œæ˜¯ 32 å’Œ 56 çš„å’Œã€‚</p><h3 id="ngx-var"><a href="#ngx-var" class="headerlink" title="ngx.var"></a>ngx.var</h3><p>è¯»å†™ Nginx å˜é‡å€¼ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.var.xxx</code>ã€‚</p><figure class="highlight nginx"><figcaption><span>&#123;2,4&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /foo &#123;</span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$my_var</span> <span class="string">''</span>;  <span class="comment"># åˆ›å»º $my_var å˜é‡</span></span><br><span class="line">    <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">        ngx.var.my_var = 123;  # ä½¿ç”¨ <span class="variable">$my_var</span> å˜é‡</span></span><br><span class="line"><span class="string">    '</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ngx-log"><a href="#ngx-log" class="headerlink" title="ngx.log"></a>ngx.log</h3><p>è¾“å‡ºåˆ°æ—¥å¿—ä¸­ã€‚æ ¼å¼ï¼š<code>ngx.log(ngx.level,...)</code></p><p>å¯æŒ‡å®šå¤šä¸ªæ—¥å¿—å¸¸é‡ ngx.levelã€‚</p><p>ngx.levelæœ‰ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ngx.STDERR    <span class="comment">-- ä¾‹å¦‚ ngx.log(ngx.STDERR)</span></span><br><span class="line">ngx.EMERG</span><br><span class="line">ngx.ALERT</span><br><span class="line">ngx.CRIT</span><br><span class="line">ngx.ERR</span><br><span class="line">ngx.WARN</span><br><span class="line">ngx.NOTICE</span><br><span class="line">ngx.INFO</span><br><span class="line">ngx.DEBUG</span><br></pre></td></tr></table></figure><h3 id="HTTP-æ–¹æ³•å¸¸é‡"><a href="#HTTP-æ–¹æ³•å¸¸é‡" class="headerlink" title="HTTP æ–¹æ³•å¸¸é‡"></a>HTTP æ–¹æ³•å¸¸é‡</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ngx.HTTP_GET</span><br><span class="line">ngx.HTTP_HEAD</span><br><span class="line">ngx.HTTP_PUT</span><br><span class="line">ngx.HTTP_POST</span><br><span class="line">ngx.HTTP_DELETE</span><br><span class="line">ngx.HTTP_OPTIONS   (v0<span class="number">.5</span><span class="number">.0</span>rc24 ç‰ˆæœ¬åŠ å…¥)</span><br><span class="line">ngx.HTTP_MKCOL     (v0<span class="number">.8</span><span class="number">.2</span> ç‰ˆæœ¬åŠ å…¥)</span><br><span class="line">ngx.HTTP_COPY      (v0<span class="number">.8</span><span class="number">.2</span> ç‰ˆæœ¬åŠ å…¥)</span><br><span class="line">ngx.HTTP_MOVE      (v0<span class="number">.8</span><span class="number">.2</span> ç‰ˆæœ¬åŠ å…¥)</span><br><span class="line">ngx.HTTP_PROPFIND  (v0<span class="number">.8</span><span class="number">.2</span> ç‰ˆæœ¬åŠ å…¥)</span><br><span class="line">ngx.HTTP_PROPPATCH (v0<span class="number">.8</span><span class="number">.2</span> ç‰ˆæœ¬åŠ å…¥)</span><br><span class="line">ngx.HTTP_LOCK      (v0<span class="number">.8</span><span class="number">.2</span> ç‰ˆæœ¬åŠ å…¥)</span><br><span class="line">ngx.HTTP_UNLOCK    (v0<span class="number">.8</span><span class="number">.2</span> ç‰ˆæœ¬åŠ å…¥)</span><br><span class="line">ngx.HTTP_PATCH     (v0<span class="number">.8</span><span class="number">.2</span> ç‰ˆæœ¬åŠ å…¥)</span><br><span class="line">ngx.HTTP_TRACE     (v0<span class="number">.8</span><span class="number">.2</span> ç‰ˆæœ¬åŠ å…¥)</span><br></pre></td></tr></table></figure><h3 id="HTTP-çŠ¶æ€å¸¸é‡"><a href="#HTTP-çŠ¶æ€å¸¸é‡" class="headerlink" title="HTTP çŠ¶æ€å¸¸é‡"></a>HTTP çŠ¶æ€å¸¸é‡</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">value = ngx.HTTP_OK (ç­‰äº <span class="number">200</span>)</span><br><span class="line">value = ngx.HTTP_CREATED (ç­‰äº <span class="number">201</span>)</span><br><span class="line">value = ngx.HTTP_SPECIAL_RESPONSE (ç­‰äº <span class="number">300</span>)</span><br><span class="line">value = ngx.HTTP_MOVED_PERMANENTLY (ç­‰äº <span class="number">301</span>)</span><br><span class="line">value = ngx.HTTP_MOVED_TEMPORARILY (ç­‰äº <span class="number">302</span>)</span><br><span class="line">value = ngx.HTTP_SEE_OTHER (ç­‰äº <span class="number">303</span>)</span><br><span class="line">value = ngx.HTTP_NOT_MODIFIED (ç­‰äº <span class="number">304</span>)</span><br><span class="line">value = ngx.HTTP_BAD_REQUEST (ç­‰äº <span class="number">400</span>)</span><br><span class="line">value = ngx.HTTP_UNAUTHORIZED (ç­‰äº <span class="number">401</span>)</span><br><span class="line">value = ngx.HTTP_FORBIDDEN (ç­‰äº <span class="number">403</span>)</span><br><span class="line">value = ngx.HTTP_NOT_FOUND (ç­‰äº <span class="number">404</span>)</span><br><span class="line">value = ngx.HTTP_NOT_ALLOWED (ç­‰äº <span class="number">405</span>)</span><br><span class="line">value = ngx.HTTP_GONE (ç­‰äº <span class="number">410</span>)</span><br><span class="line">value = ngx.HTTP_INTERNAL_SERVER_ERROR (ç­‰äº <span class="number">500</span>)</span><br><span class="line">value = ngx.HTTP_METHOD_NOT_IMPLEMENTED (ç­‰äº <span class="number">501</span>)</span><br><span class="line">value = ngx.HTTP_SERVICE_UNAVAILABLE (ç­‰äº <span class="number">503</span>)</span><br><span class="line">value = ngx.HTTP_GATEWAY_TIMEOUT (ç­‰äº <span class="number">504</span>) (v0<span class="number">.3</span><span class="number">.1</span>rc38 ç‰ˆæœ¬åŠ å…¥)</span><br></pre></td></tr></table></figure><h3 id="print"><a href="#print" class="headerlink" title="print"></a>print</h3><p>å°†å‚æ•°å€¼ä»¥ <code>ngx.NOTICE</code> æ—¥å¿—çº§åˆ«å†™å…¥ Nginx çš„ <code>error.log</code> æ–‡ä»¶ã€‚</p><p>è¯­æ³•ï¼š<code>print(...)</code>ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"Hello"</span>)</span><br></pre></td></tr></table></figure><p>ç­‰ä»·äº</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ngx.<span class="built_in">log</span>(ngx.NOTICE, <span class="string">"Hello"</span>)</span><br></pre></td></tr></table></figure><h3 id="ngx-ctx"><a href="#ngx-ctx" class="headerlink" title="ngx.ctx"></a>ngx.ctx</h3><p>ä¸€ä¸ª location æ¨¡å—é‡Œçš„å…¨å±€ç¯å¢ƒå˜é‡ï¼Œå­˜å‚¨åŸºäºè¯·æ±‚çš„ Lua ç¯å¢ƒæ•°æ®ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.ctx.xxx</code>ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /sub &#123;</span><br><span class="line">    <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">        ngx.say("sub pre: ", ngx.ctx.blah)</span></span><br><span class="line"><span class="string">        ngx.ctx.blah = 32</span></span><br><span class="line"><span class="string">        ngx.say("sub post: ", ngx.ctx.blah)</span></span><br><span class="line"><span class="string">    '</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /main &#123;</span><br><span class="line">    <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">        ngx.ctx.blah = 73</span></span><br><span class="line"><span class="string">        ngx.say("main pre: ", ngx.ctx.blah)</span></span><br><span class="line"><span class="string">        local res = ngx.location.capture("/sub")</span></span><br><span class="line"><span class="string">        ngx.print(res.body)</span></span><br><span class="line"><span class="string">        ngx.say("main post: ", ngx.ctx.blah)</span></span><br><span class="line"><span class="string">    '</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <code>GET /main</code> è¾“å‡ºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">main pre: <span class="number">73</span></span><br><span class="line"><span class="built_in">sub</span> pre: <span class="literal">nil</span></span><br><span class="line"><span class="built_in">sub</span> post: <span class="number">32</span></span><br><span class="line">main post: <span class="number">73</span></span><br></pre></td></tr></table></figure><h3 id="ngx-exit"><a href="#ngx-exit" class="headerlink" title="ngx.exit"></a>ngx.exit</h3><p>é€€å‡ºæŸä¸ªé˜¶æ®µï¼Œå¦‚å¤„ç†è¯·æ±‚é˜¶æ®µã€é‡å®šå‘é˜¶æ®µç­‰ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.exit(status)</code>ã€‚</p><p><code>status</code> å‚æ•°å¯ä»¥æ˜¯ <code>ngx.OK</code>ï¼Œ<code>ngx.ERROR</code> ç­‰ç­‰ <a href="/middleware/Nginx/Nginx_Lua_Expansion_module/#http-çŠ¶æ€å¸¸é‡">HTTP çŠ¶æ€å¸¸é‡</a></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ngx.<span class="built_in">status</span> = ngx.HTTP_GONE</span><br><span class="line">ngx.say(<span class="string">"This is our own content"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- é€€å‡ºæ•´ä¸ªè¯·æ±‚è€Œä¸æ˜¯å½“å‰å¤„ç†é˜¶æ®µ</span></span><br><span class="line">ngx.<span class="built_in">exit</span>(ngx.HTTP_OK)</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›´æ¥ä½¿ç”¨æ•°å­—ä½œä¸ºå‚æ•°ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ngx.<span class="built_in">exit</span>(<span class="number">501</span>)</span><br></pre></td></tr></table></figure><p>::: warning</p><p>æ•°å­—ä½œä¸ºå‚æ•°ä»…æ”¯æŒ <code>NGX_OK</code> å’Œ <code>NGX_ERROR</code> çš„æ•°å­—ã€‚</p><p>:::</p><h3 id="ngx-sleep"><a href="#ngx-sleep" class="headerlink" title="ngx.sleep"></a>ngx.sleep</h3><p>æ— é˜»å¡åœ°ä¼‘çœ ç‰¹å®šç§’ã€‚æ—¶é—´å¯ä»¥ç²¾ç¡®åˆ° 0.001 ç§’ (æ¯«ç§’)ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.sleep(seconds)</code>ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ngx.sleep(<span class="number">1000</span>)</span><br></pre></td></tr></table></figure><h2 id="è¯·æ±‚API"><a href="#è¯·æ±‚API" class="headerlink" title="è¯·æ±‚API"></a>è¯·æ±‚API</h2><h3 id="ngx-req-get-uri-args"><a href="#ngx-req-get-uri-args" class="headerlink" title="ngx.req.get_uri_args"></a>ngx.req.get_uri_args</h3><p>è¿”å›ä¸€ä¸ª Lua tableï¼ŒåŒ…å«å½“å‰è¯·æ±‚çš„æ‰€æœ‰ URL æŸ¥è¯¢å‚æ•°ã€‚</p><p>è¯­æ³•ï¼š<code>args = ngx.req.get_uri_args([max_args])</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> = /test &#123;</span><br><span class="line">     <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">         local args = ngx.req.get_uri_args()</span></span><br><span class="line"><span class="string">         for key, val in pairs(args) do</span></span><br><span class="line"><span class="string">             if type(val) == "table" then</span></span><br><span class="line"><span class="string">                 ngx.say(key, ": ", table.concat(val, ", "))</span></span><br><span class="line"><span class="string">             else</span></span><br><span class="line"><span class="string">                 ngx.say(key, ": ", val)</span></span><br><span class="line"><span class="string">             end</span></span><br><span class="line"><span class="string">         end</span></span><br><span class="line"><span class="string">     '</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <code>GET /test?foo=bar&amp;bar=baz&amp;bar=blah</code> å°†è¾“å‡ºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo: bar</span><br><span class="line">bar: baz, blah</span><br></pre></td></tr></table></figure><p>å¤šæ¬¡å‡ºç°åŒä¸€ä¸ªå‚æ•° key æ—¶ï¼Œå°†ç”Ÿæˆä¸€ä¸ª Lua tableï¼ŒæŒ‰é¡ºåºä¿å­˜å…¶æ‰€æœ‰ valueã€‚</p><h3 id="ngx-req-set-uri-args"><a href="#ngx-req-set-uri-args" class="headerlink" title="ngx.req.set_uri_args"></a>ngx.req.set_uri_args</h3><p>ç”¨ <code>args</code> å‚æ•°é‡å†™å½“å‰è¯·æ±‚çš„ URI è¯·æ±‚å‚æ•°ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.req.set_uri_args(args)</code>ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ngx.req.set_uri_args(<span class="string">"a=3&amp;b=hello%20world"</span>)</span><br><span class="line"></span><br><span class="line">ngx.req.set_uri_args(&#123; a = <span class="number">3</span>, b = <span class="string">"hello world"</span> &#125;)</span><br><span class="line"></span><br><span class="line">ngx.req.set_uri_args(&#123; a = <span class="number">3</span>, b = &#123;<span class="number">5</span>, <span class="number">6</span>&#125; &#125;)</span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œæœ¬æ–¹æ³•å°†æ ¹æ® URI è½¬ä¹‰è§„åˆ™è½¬ä¹‰å‚æ•°çš„ key å’Œ valueã€‚</p><p>åœ¨ç¬¬ä¸‰ç§æƒ…å†µä¸‹ï¼Œè¯·æ±‚å‚æ•°å­—ç¬¦ä¸²ä¸º <code>a=3&amp;b=5&amp;b=6</code>ã€‚</p><h3 id="ngx-header-HEADER"><a href="#ngx-header-HEADER" class="headerlink" title="ngx.header.HEADER"></a>ngx.header.HEADER</h3><p>ä¿®æ”¹ã€æ·»åŠ ã€æˆ–æ¸…é™¤å½“å‰è¯·æ±‚å¾…å‘é€çš„ <code>HEADER</code> å“åº”å¤´ä¿¡æ¯ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.header.HEADER = VALUE</code>ã€‚</p><p><code>HEADER</code> å“åº”å¤´ä¿¡æ¯ä¸æ˜¯è‡ªå®šä¹‰çš„ï¼Œæ˜¯è¯·æ±‚å¤´å¸¦æœ‰çš„ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸ ngx.header["Content-Type"] = 'text/plain' ç›¸åŒ</span></span><br><span class="line">ngx.header.content_type = <span class="string">'text/plain'</span>;</span><br><span class="line"></span><br><span class="line">ngx.header[<span class="string">"X-My-Header"</span>] = <span class="string">'blah blah'</span></span><br></pre></td></tr></table></figure><h3 id="ngx-req-get-method"><a href="#ngx-req-get-method" class="headerlink" title="ngx.req.get_method"></a>ngx.req.get_method</h3><p>è·å–å½“å‰è¯·æ±‚çš„ HTTP è¯·æ±‚æ–¹æ³•åç§°ã€‚ç»“æœä¸ºç±»ä¼¼ <code>&quot;GET&quot;</code> å’Œ <code>&quot;POST&quot;</code> çš„å­—ç¬¦ä¸²ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.req.get_method</code>ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = ngx.req.get_method</span><br></pre></td></tr></table></figure><h3 id="ngx-req-set-method"><a href="#ngx-req-set-method" class="headerlink" title="ngx.req.set_method"></a>ngx.req.set_method</h3><p>ç”¨ <code>method_id</code> å‚æ•°çš„å€¼æ”¹å†™å½“å‰è¯·æ±‚çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚å½“å‰ä»…æ”¯æŒ <a href="/middleware/Nginx/Nginx_Lua_Expansion_module/#http-æ–¹æ³•å¸¸é‡">HTTP è¯·æ±‚æ–¹æ³•</a> ä¸­å®šä¹‰çš„æ•°å€¼å¸¸é‡ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.req.set_method(method_id)</code>ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ngx.req.set_method(method_id)</span><br><span class="line"></span><br><span class="line">ngx.req.set_method(ngx.HTTP_GET)</span><br></pre></td></tr></table></figure><h3 id="ngx-req-read-body"><a href="#ngx-req-read-body" class="headerlink" title="ngx.req.read_body"></a>ngx.req.read_body</h3><p>åŒæ­¥è¯»å–å®¢æˆ·ç«¯è¯·æ±‚ä½“ï¼Œä¸é˜»å¡ Nginx äº‹ä»¶å¾ªç¯ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.req.read_body()</code>ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ngx.req.read_body()</span><br><span class="line"><span class="keyword">local</span> args = ngx.req.get_post_args()</span><br></pre></td></tr></table></figure><h3 id="ngx-req-get-post-args"><a href="#ngx-req-get-post-args" class="headerlink" title="ngx.req.get_post_args"></a>ngx.req.get_post_args</h3><p>è¿”å›ä¸€ä¸ª Lua tableï¼ŒåŒ…å«å½“å‰è¯·æ±‚çš„æ‰€æœ‰ POST æŸ¥è¯¢å‚æ•°ã€‚</p><p>è¯­æ³•ï¼š<code>args, err = ngx.req.get_post_args(max_args?)</code></p><p>::: warning</p><p>ä½¿ç”¨ <code>ngx.req.get_post_args</code> è·å–å‚æ•°å‰ï¼Œå¿…é¡»ä½¿ç”¨ <code>ngx.req.read_body</code> è¯»å–è¯·æ±‚ä½“ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">location = /test &#123;</span><br><span class="line">    content_by_lua <span class="string">'</span></span><br><span class="line"><span class="string">        ngx.req.read_body()</span></span><br><span class="line"><span class="string">        local args, err = ngx.req.get_post_args()</span></span><br><span class="line"><span class="string">        if not args then</span></span><br><span class="line"><span class="string">            ngx.say("failed to get post args: ", err)</span></span><br><span class="line"><span class="string">            return</span></span><br><span class="line"><span class="string">        end</span></span><br><span class="line"><span class="string">        for key, val in pairs(args) do</span></span><br><span class="line"><span class="string">            if type(val) == "table" then</span></span><br><span class="line"><span class="string">                ngx.say(key, ": ", table.concat(val, ", "))</span></span><br><span class="line"><span class="string">            else</span></span><br><span class="line"><span class="string">                ngx.say(key, ": ", val)</span></span><br><span class="line"><span class="string">            end</span></span><br><span class="line"><span class="string">        end</span></span><br><span class="line"><span class="string">    '</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ±‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Post request with the body 'foo=bar&amp;bar=baz&amp;bar=blah'</span></span><br><span class="line">$ curl --data <span class="string">'foo=bar&amp;bar=baz&amp;bar=blah'</span> localhost/<span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>å°†è¾“å‡ºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo: bar</span><br><span class="line">bar: baz, blah</span><br></pre></td></tr></table></figure><p>å¤šæ¬¡å‡ºç°åŒä¸€ä¸ªå‚æ•° key æ—¶ï¼Œå°†ç”Ÿæˆä¸€ä¸ª Lua tableï¼ŒæŒ‰é¡ºåºä¿å­˜å…¶æ‰€æœ‰ valueã€‚</p><h3 id="ngx-redirect"><a href="#ngx-redirect" class="headerlink" title="ngx.redirect"></a>ngx.redirect</h3><p>å‘å‡ºä¸€ä¸ª HTTP <code>301</code> æˆ– <code>302</code> é‡å®šå‘åˆ° <code>uri</code>ã€‚</p><p>å¯é€‰é¡¹ <code>status</code> å‚æ•°æŒ‡å®š <code>301</code> æˆ– <code>302</code> å“ªä¸ªè¢«ä½¿ç”¨ã€‚ é»˜è®¤ä½¿ç”¨ <code>302</code>ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.redirect(uri, [status])</code>ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> ngx.redirect(<span class="string">"/foo"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">return</span> ngx.redirect(<span class="string">"/foo"</span>, <span class="number">301</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">return</span> ngx.redirect(<span class="string">"/foo"</span>, ngx.HTTP_MOVED_TEMPORARILY)</span><br></pre></td></tr></table></figure><p>é‡å®šå‘åˆ°ä»»æ„å¤–éƒ¨ URL ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> ngx.redirect(<span class="string">"http://www.baidu.com"</span>)</span><br></pre></td></tr></table></figure><h3 id="ngx-exec"><a href="#ngx-exec" class="headerlink" title="ngx.exec"></a>ngx.exec</h3><p>ä½¿ç”¨ <code>uri</code>ã€<code>args</code> å‚æ•°æ‰§è¡Œä¸€ä¸ªå†…éƒ¨è·³è½¬ã€‚å†…éƒ¨æŒ‡çš„æ˜¯ Nginx çš„æŸä¸ª location æ¨¡å—ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.exec(uri, [args])</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /foo &#123;</span><br><span class="line">     <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">         ngx.exec("/bar", "a=goodbye");</span></span><br><span class="line"><span class="string">     '</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="attribute">location</span> /bar &#123;</span><br><span class="line">     <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">         local args = ngx.req.get_uri_args()</span></span><br><span class="line"><span class="string">         for key, val in pairs(args) do</span></span><br><span class="line"><span class="string">             if key == "a" then</span></span><br><span class="line"><span class="string">                 ngx.say(val)</span></span><br><span class="line"><span class="string">             end</span></span><br><span class="line"><span class="string">         end</span></span><br><span class="line"><span class="string">     '</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <code>GET /foo/file.php?a=hello</code>ï¼Œå°†è¿”å› ã€ hello ã€ ï¼Œè€Œä¸æ˜¯ ã€ goodbye ã€</p><p>::: warning</p><p><code>ngx.exec</code> æ–¹æ³•ä¸ <a href="/middleware/Nginx/Nginx_Lua_Expansion_module#nginx-redirect">ngx.redirect</a> æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå‰è€…æ˜¯ä¸ªçº¯ç²¹çš„å†…éƒ¨è·³è½¬å¹¶ä¸”æ²¡æœ‰å¼•å…¥ä»»ä½•é¢å¤– HTTP ä¿¡å·ã€‚</p><p>æ­¤æ–¹æ³•çš„è°ƒç”¨ç»ˆæ­¢å½“å‰è¯·æ±‚çš„å¤„ç†ã€‚</p><h3 id="ngx-location-capture"><a href="#ngx-location-capture" class="headerlink" title="ngx.location.capture"></a>ngx.location.capture</h3><p>å‘ <code>uri</code> å‘èµ·ä¸€ä¸ªåŒæ­¥éé˜»å¡ Nginx å­è¯·æ±‚ã€‚</p><p>è¯­æ³•ï¼š<code>ngx.location.capture(uri,[options])</code>ã€‚</p><p>::: warning</p><p>å®ƒä¼šè¯·æ±‚ Nginx çš„å…¶ä»– location æ¨¡å—ï¼Œlocation æ¨¡å—å¯ä»¥æ˜¯å…¶ä»–æ–‡ä»¶ç›®å½•çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ–ä»»ä½•å…¶ä»– Nginx æ¨¡å—ã€‚</p><p>:::</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = ngx.location.capture(uri,[options])</span><br></pre></td></tr></table></figure><p><code>res</code> æ˜¯è¿”å›çš„ç»“æœï¼Œå®ƒæ˜¯ä¸€ä¸ªã€Œå¯¹è±¡ã€ï¼Œå°†åŒ…å«å››ä¸ªå…ƒç´ çš„ Lua è¡¨ (<code>res.status</code>, <code>res.header</code>, <code>res.body</code>, å’Œ <code>res.truncated</code>)ã€‚</p><ul><li><code>res.status</code> (çŠ¶æ€) ä¿å­˜å­è¯·æ±‚çš„å“åº”çŠ¶æ€ç ã€‚</li><li><code>res.header</code> (å¤´) ç”¨ä¸€ä¸ªæ ‡å‡† Lua è¡¨å‚¨å­è¯·æ±‚å“åº”çš„æ‰€æœ‰å¤´ä¿¡æ¯ã€‚å¦‚æœæ˜¯â€œå¤šå€¼â€å“åº”å¤´ï¼Œè¿™äº›å€¼å°†ä½¿ç”¨ Lua (æ•°ç»„) è¡¨é¡ºåºå­˜å‚¨ã€‚</li></ul><p>å¦‚æœå­è¯·æ±‚å“åº”å¤´åŒ…å«ä¸‹é¢çš„è¡Œï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: a=<span class="number">3</span></span><br><span class="line">Set-Cookie: foo=bar</span><br><span class="line">Set-Cookie: baz=blah</span><br></pre></td></tr></table></figure><p>åˆ™ <code>res.header[&quot;Set-Cookie&quot;]</code> å°†å­˜å‚¨ Lua è¡¨ <code>{&quot;a=3&quot;, &quot;foo=bar&quot;, &quot;baz=blah&quot;}</code>ã€‚</p><p><strong>options é€‰é¡¹</strong></p><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>method</td><td>æŒ‡å®šå­è¯·æ±‚çš„è¯·æ±‚æ–¹æ³•, åªæ¥å—ç±»ä¼¼ <code>ngx.HTTP_POST</code> çš„å¸¸é‡</td></tr><tr><td>body</td><td>æŒ‡å®šå­è¯·æ±‚çš„è¯·æ±‚ä½“ (ä»…æ¥å—å­—ç¬¦ä¸²å€¼)</td></tr><tr><td>args</td><td>æŒ‡å®šå­è¯·æ±‚çš„ URI è¯·æ±‚å‚æ•° (å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€… Lua è¡¨)</td></tr><tr><td>ctx</td><td>æŒ‡å®šä¸€ä¸ª Lua è¡¨ä½œä¸ºå­è¯·æ±‚çš„ ngx.ctx è¡¨ï¼Œå¯ä»¥æ˜¯å½“å‰è¯·æ±‚çš„ ngx.ctx è¡¨</td></tr><tr><td>vars</td><td>ç”¨ä¸€ä¸ª Lua è¡¨è®¾ç½®å­è¯·æ±‚ä¸­çš„ Nginx å˜é‡å€¼</td></tr><tr><td>copy_all_vars</td><td>è®¾ç½®æ˜¯å¦å¤åˆ¶æ‰€æœ‰å½“å‰è¯·æ±‚çš„ Nginx å˜é‡å€¼åˆ°å­è¯·æ±‚ä¸­ï¼Œä¿®æ”¹å­è¯·æ±‚çš„ nginx å˜é‡å€¼ä¸å½±å“å½“å‰ (çˆ¶) è¯·æ±‚</td></tr><tr><td>share_all_vars</td><td>è®¾ç½®æ˜¯å¦å…±äº«æ‰€æœ‰å½“å‰ (çˆ¶) è¯·æ±‚çš„ Nginx å˜é‡å€¼åˆ°å­è¯·æ±‚ä¸­ï¼Œä¿®æ”¹å­è¯·æ±‚çš„ nginx å˜é‡å€¼å°†å½±å“å½“å‰ (çˆ¶) è¯·æ±‚</td></tr><tr><td>always_forward_body</td><td>å½“è®¾ç½®ä¸º true æ—¶ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® <code>body</code> é€‰é¡¹ï¼Œå½“å‰ (çˆ¶) è¯·æ±‚çš„è¯·æ±‚ä½“å°†è¢«è½¬å‘ç»™å­è¯·æ±‚</td></tr></tbody></table><p>ä¾‹å¦‚ï¼Œå‘é€ä¸€ä¸ª POST å­è¯·æ±‚ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">res</span> = ngx.location.capture(</span><br><span class="line">    <span class="string">'/foo/bar'</span>,</span><br><span class="line">    &#123; <span class="attribute">method</span> = ngx.HTTP_POST, args = &#123; <span class="attribute">a</span> = <span class="number">1</span>,b = <span class="number">3</span>&#125;, body = <span class="string">'Helloï¼ŒWorld'</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ç­‰ä»·äºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = ngx.location.capture(<span class="string">'/foo/bar?a=1&amp;b=3'</span>)</span><br></pre></td></tr></table></figure><p><code>method</code> é€‰é¡¹é»˜è®¤å€¼æ˜¯ <code>ngx.HTTP_GET</code>ã€‚</p><p>å…¶ä»–å†…å®¹å…·ä½“çœ‹ä¸­æ–‡æ–‡æ¡£ï¼Œå¼€å¤´æœ‰è½¬é€é—¨ã€‚</p><p>::: tip ngx.exec å’Œ ngx.location.capture åŒºåˆ«</p><p><code>ngx.exec</code> åªä¼šè®¿é—®åŒä¸€ä¸ªé…ç½®æ–‡ä»¶çš„ location æ¨¡å—ã€‚</p><p><code>ngx.location.capture</code> ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥è®¿é—®å…¶ä»–é…ç½®æ–‡ä»¶çš„ location æ¨¡å—ã€‚</p><h3 id="ngx-req-set-uri"><a href="#ngx-req-set-uri" class="headerlink" title="ngx.req.set_uri"></a>ngx.req.set_uri</h3><p>è¯­æ³•ï¼š<code>ngx.req.set_uri(uri, jump?)</code></p><p>é€šè¿‡å‚æ•° uri é‡å†™å½“å‰è¯·æ±‚çš„ uriï¼›å‚æ•° jumpï¼Œè¡¨æ˜æ˜¯å¦è¿›è¡Œ locations çš„é‡æ–°åŒ¹é…ã€‚å½“ jump ä¸º true æ—¶ï¼Œè°ƒç”¨ <code>ngx.req.set_uri</code> åï¼ŒNginx å°†ä¼šæ ¹æ®ä¿®æ”¹åçš„ uriï¼Œé‡æ–°åŒ¹é…æ–°çš„ locationsï¼›å¦‚æœ jump ä¸º falseï¼Œå°†ä¸ä¼šè¿›è¡Œ locations çš„é‡æ–°åŒ¹é…ï¼Œè€Œä»…ä»…æ˜¯ä¿®æ”¹äº†å½“å‰è¯·æ±‚çš„ URI è€Œå·²ã€‚jump çš„é»˜è®¤å€¼ä¸º falseã€‚</p><ul><li>jump ä¸º trueï¼Œç­‰ä»·äº rewriteâ€¦last</li><li>jump ä¸º falseï¼Œç­‰ä»·äº rewriteâ€¦break</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ngx.req.set_uri(<span class="string">"/foo"</span>, <span class="literal">true</span>)  === rewrite ^ /foo last;</span><br><span class="line"></span><br><span class="line">ngx.req.set_uri(<span class="string">"/foo"</span>, <span class="literal">false</span>)  ===  rewrite ^ /foo <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><h2 id="æŒ‡ä»¤API"><a href="#æŒ‡ä»¤API" class="headerlink" title="æŒ‡ä»¤API"></a>æŒ‡ä»¤API</h2><h3 id="init-by-lua"><a href="#init-by-lua" class="headerlink" title="init_by_lua"></a>init_by_lua</h3><p>è¯¥æŒ‡ä»¤åœ¨æ¯æ¬¡ Nginx é‡æ–°åŠ è½½é…ç½®æ—¶æ‰§è¡Œï¼Œå¯ä»¥ç”¨æ¥å®Œæˆä¸€äº›è€—æ—¶æ¨¡å—çš„åŠ è½½ï¼Œæˆ–è€…åˆå§‹åŒ–ä¸€äº›å…¨å±€é…ç½®ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªå…¬å…±æ¨¡å—ï¼ŒæŠŠæ‰€æœ‰éƒ½ç”¨åˆ°çš„ä»£ç æ”¾åˆ°è¿™ä¸ªæ¨¡å—é‡Œï¼Œé¿å…é‡å¤ä½¿ç”¨ç›¸åŒçš„ä»£ç ã€‚</p><p>æ¯”å¦‚æ¯ä¸ªæ¨¡å—éƒ½éœ€è¦ MySQL å’Œ Redisï¼Œåˆ™åœ¨è¿™ä¸ªå…¬å…±æ¨¡å—è¿›è¡Œå¼•ç”¨ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">init_by_lua_block&#123;</span><br><span class="line">    <span class="attribute">mysql</span> = require <span class="string">"resty.mysql"</span></span><br><span class="line">redis = require <span class="string">"resty.redis"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ä¸‹æ–¹ç›´æ¥ä½¿ç”¨ MySQL å’Œ Redis çš„ API</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å–œæ¬¢ç›´æ¥å†™ Lua è¯­æ³•ï¼ŒæŠŠ Lua è¯­æ³• æ”¾åˆ° Lua æ–‡ä»¶é‡Œï¼Œä½¿ç”¨ <code>init_by_lua_file</code> å¼•ç”¨ Lua æ–‡ä»¶ã€‚</p><h3 id="init-worker-by-lua"><a href="#init-worker-by-lua" class="headerlink" title="init_worker_by_lua"></a>init_worker_by_lua</h3><p>è¯¥æŒ‡ä»¤ç”¨äºå¯åŠ¨ä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œå¦‚å¿ƒè·³æ£€æŸ¥ã€å®šæ—¶æ‹‰å–æœåŠ¡å™¨é…ç½®ç­‰ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">init_worker_by_lua <span class="string">'</span></span><br><span class="line"><span class="string">    local delay = 3  -- in seconds</span></span><br><span class="line"><span class="string">    local new_timer = ngx.timer.at</span></span><br><span class="line"><span class="string">    local log = ngx.log</span></span><br><span class="line"><span class="string">    local ERR = ngx.ERR</span></span><br><span class="line"><span class="string">    local check</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    check = function(premature)</span></span><br><span class="line"><span class="string">        if not premature then</span></span><br><span class="line"><span class="string">            -- do the health check or other routine work</span></span><br><span class="line"><span class="string">            local ok, err = new_timer(delay, check)</span></span><br><span class="line"><span class="string">            if not ok then</span></span><br><span class="line"><span class="string">                log(ERR, "failed to create timer: ", err)</span></span><br><span class="line"><span class="string">                return</span></span><br><span class="line"><span class="string">            end</span></span><br><span class="line"><span class="string">        end</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    local ok, err = new_timer(delay, check)</span></span><br><span class="line"><span class="string">    if not ok then</span></span><br><span class="line"><span class="string">        log(ERR, "failed to create timer: ", err)</span></span><br><span class="line"><span class="string">        return</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">'</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å–œæ¬¢ç›´æ¥å†™ Lua è¯­æ³•ï¼ŒæŠŠ Lua è¯­æ³• æ”¾åˆ° Lua æ–‡ä»¶é‡Œï¼Œä½¿ç”¨ <code>init_worker_by_lua_file</code> å¼•ç”¨ Lua æ–‡ä»¶ã€‚</p><h3 id="set-by-lua"><a href="#set-by-lua" class="headerlink" title="set_by_lua"></a>set_by_lua</h3><p>è¯¥æŒ‡ä»¤åªè¦ç”¨æ¥åšå˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¸€æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶å°†ç»“æœèµ‹å€¼ç»™ Nginx ä¸­æŒ‡å®šçš„å˜é‡ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>set_by_lua* &lt;key&gt; &lt;value&gt;</td><td>keyè¦åŠ ä¸Š $ ç¬¦å·ï¼Œvalue æ˜¯ Lua è¯­è¨€çš„æ ¼å¼</td></tr></tbody></table><p>ä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set_by_lua $name <span class="string">"</span></span><br><span class="line"><span class="string">local uri_args = ngx.req.get_uri_args()   -- è·å–è¯·æ±‚ ? åçš„å‚æ•°</span></span><br><span class="line"><span class="string">name = uri_args['name']   -- è·å– key ä¸º name çš„å‚æ•°</span></span><br><span class="line"><span class="string">return name..'å…ˆç”Ÿ'   -- åœ¨ name åé¢åŠ ä¸Š å…ˆç”Ÿï¼Œä½œä¸º $name çš„ value è¿”å›ç»™å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="string">"</span>;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ key ä¸º <code>$name</code> çš„ value å€¼æ˜¯ URL çš„å‚æ•° name åŠ ä¸Šã€Œå…ˆç”Ÿã€ã€‚</p><p>å¦‚æœä¸å–œæ¬¢ç›´æ¥å†™ Lua è¯­æ³•ï¼ŒæŠŠ Lua è¯­æ³• æ”¾åˆ° Lua æ–‡ä»¶é‡Œï¼Œä½¿ç”¨ <code>set_by_lua_file</code> å¼•ç”¨ Lua æ–‡ä»¶ã€‚</p><h3 id="rewrite-by-lua"><a href="#rewrite-by-lua" class="headerlink" title="rewrite_by_lua"></a>rewrite_by_lua</h3><p>è¯¥æŒ‡ä»¤ç”¨äºæ‰§è¡Œå†…éƒ¨ URL é‡å†™æˆ–è€…å¤–éƒ¨é‡å®šå‘ï¼Œå…¸å‹çš„å¦‚ä¼ªé™æ€åŒ– URL é‡å†™ï¼Œæœ¬é˜¶æ®µåœ¨ Rewrite å¤„ç†é˜¶æ®µçš„æœ€åé»˜è®¤æ‰§è¡Œã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /foo &#123;</span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$a</span> <span class="number">12</span>; <span class="comment"># åˆ›å»ºå˜é‡ $a</span></span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$b</span> <span class="string">""</span>; <span class="comment"># åˆ›å»ºå˜é‡ $b</span></span><br><span class="line">    <span class="attribute">rewrite_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">         ngx.var.b = tonumber(ngx.var.a) + 1  # æ­¤æ—¶ b = 13</span></span><br><span class="line"><span class="string">         if tonumber(ngx.var.b) == 13 then</span></span><br><span class="line"><span class="string">             return ngx.redirect("/bar");   # é‡å®šå‘åˆ° /bar</span></span><br><span class="line"><span class="string">         end</span></span><br><span class="line"><span class="string">     '</span>;</span><br><span class="line">    <span class="attribute">echo</span> <span class="string">"res = <span class="variable">$b</span>"</span>;  <span class="comment"># res = 13</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å–œæ¬¢ç›´æ¥å†™ Lua è¯­æ³•ï¼ŒæŠŠ Lua è¯­æ³• æ”¾åˆ° Lua æ–‡ä»¶é‡Œï¼Œä½¿ç”¨ <code>rewrite_by_lua_file</code> å¼•ç”¨ Lua æ–‡ä»¶ã€‚</p><h3 id="access-by-lua"><a href="#access-by-lua" class="headerlink" title="access_by_lua"></a>access_by_lua</h3><p>è¯¥æŒ‡ä»¤ç”¨äºè®¿é—®æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªå…è®¸å†…ç½‘ IP è®¿é—®ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">access_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">        local res = ngx.location.capture("/auth")</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        if res.status == ngx.HTTP_OK then</span></span><br><span class="line"><span class="string">        return</span></span><br><span class="line"><span class="string">        end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        if res.status == ngx.HTTP_FORBIDDEN then</span></span><br><span class="line"><span class="string">        ngx.exit(res.status)</span></span><br><span class="line"><span class="string">        end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        ngx.exit(ngx.HTTP_INTERNAL_SERVER_ERROR)</span></span><br><span class="line"><span class="string">        '</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># proxy_pass/fastcgi_pass/postgres_pass/...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåœ¨ access_by_lua å¤„ç†å†…éƒ¨ï¼Œå½“è°ƒç”¨ <code>ngx.exit(ngx.OK)</code> æ—¶ï¼Œnginx è¯·æ±‚å°†ç»§ç»­ä¸‹ä¸€é˜¶æ®µçš„å†…å®¹å¤„ç†ã€‚è¦åœ¨ access_by_lua å¤„ç†ä¸­ç»ˆç»“å½“å‰è¯·æ±‚ï¼Œè°ƒç”¨ ngx.exit ï¼ŒæˆåŠŸçš„è¯·æ±‚è®¾å®š status &gt;= 200 (<code>ngx.HTTP_OK</code>) å¹¶ status &lt; 300 (<code>ngx.HTTP_SPECIAL_RESPONSE</code>)ï¼Œå¤±è´¥çš„è¯·æ±‚è®¾å®š<code>ngx.exit(ngx.HTTP_INTERNAL_SERVER_ERROR)</code> (æˆ–å…¶ä»–ç›¸å…³çš„)ã€‚</p><p>å¦‚æœä¸å–œæ¬¢ç›´æ¥å†™ Lua è¯­æ³•ï¼ŒæŠŠ Lua è¯­æ³• æ”¾åˆ° Lua æ–‡ä»¶é‡Œï¼Œä½¿ç”¨ <code>access_by_lua_file</code> å¼•ç”¨ Lua æ–‡ä»¶ã€‚</p><h3 id="content-by-lua"><a href="#content-by-lua" class="headerlink" title="content_by_lua"></a>content_by_lua</h3><p><strong>è¯¥æŒ‡ä»¤æ˜¯åº”ç”¨æœ€å¤šçš„æŒ‡ä»¤</strong>ï¼Œå¤§éƒ¨åˆ†ä»»åŠ¡æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µå®Œæˆçš„ï¼Œå…¶ä»–çš„è¿‡ç¨‹å¾€å¾€ä¸ºè¿™ä¸ªé˜¶æ®µå‡†å¤‡æ•°æ®ï¼Œæ­£å¼å¤„ç†åŸºæœ¬éƒ½åœ¨æœ¬é˜¶æ®µã€‚</p><p>è¿™ä¸ªæŒ‡ä»¤å°±ç›¸å½“äº Java çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½éœ€è¦ä¸€ä¸ªæ–¹æ³•ä½“ä½œä¸ºç¯å¢ƒã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">content_by_lua_block &#123;</span><br><span class="line">    set_by_lua $name <span class="string">"</span></span><br><span class="line"><span class="string">        local uri_args = ngx.req.get_uri_args()   -- è·å–è¯·æ±‚ ? åçš„å‚æ•°</span></span><br><span class="line"><span class="string">        name = uri_args['name']   -- è·å– key ä¸º name çš„å‚æ•°</span></span><br><span class="line"><span class="string">        return name..'å…ˆç”Ÿ'   -- åœ¨ name åé¢åŠ ä¸Š å…ˆç”Ÿï¼Œä½œä¸º $name çš„ value è¿”å›ç»™å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="string">    "</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å–œæ¬¢ç›´æ¥å†™ Lua è¯­æ³•ï¼ŒæŠŠ Lua è¯­æ³• æ”¾åˆ° Lua æ–‡ä»¶é‡Œï¼Œä½¿ç”¨ <code>content_by_lua_file</code> å¼•ç”¨ Lua æ–‡ä»¶ã€‚</p><h3 id="header-filter-by-lua"><a href="#header-filter-by-lua" class="headerlink" title="header_filter_by_lua"></a>header_filter_by_lua</h3><p>è¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®åº”ç­”æ¶ˆæ¯çš„å¤´éƒ¨ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"> <span class="attribute">proxy_pass</span> http://mybackend;</span><br><span class="line"> <span class="attribute">header_filter_by_lua</span> <span class="string">'ngx.header.username = "frx"'</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šåœ¨è¯·æ±‚å¤´çœ‹åˆ° name ä¸º frx</p><p>å¦‚æœä¸å–œæ¬¢ç›´æ¥å†™ Lua è¯­æ³•ï¼ŒæŠŠ Lua è¯­æ³• æ”¾åˆ° Lua æ–‡ä»¶é‡Œï¼Œä½¿ç”¨ <code>header_filter_by_lua_file</code> å¼•ç”¨ Lua æ–‡ä»¶ã€‚</p><h3 id="body-filter-by-lua"><a href="#body-filter-by-lua" class="headerlink" title="body_filter_by_lua"></a>body_filter_by_lua</h3><p>è¯¥æŒ‡ä»¤æ˜¯å¯¹å“åº”æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æˆªæ–­ã€æ›¿æ¢ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨è¾“å‡ºä½“è½¬æ¢æ‰€æœ‰çš„å°å†™å­—æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç”¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://mybackend;</span><br><span class="line">    body_filter_by_lua <span class="string">'ngx.arg[1] = string.upper(ngx.arg[1])'</span>;  <span class="comment"># è½¬å°å†™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å–œæ¬¢ç›´æ¥å†™ Lua è¯­æ³•ï¼ŒæŠŠ Lua è¯­æ³• æ”¾åˆ° Lua æ–‡ä»¶é‡Œï¼Œä½¿ç”¨ <code>body_filter_by_lua_file</code> å¼•ç”¨ Lua æ–‡ä»¶ã€‚</p><h3 id="log-by-lua"><a href="#log-by-lua" class="headerlink" title="log_by_lua"></a>log_by_lua</h3><p>è¯¥æŒ‡ä»¤ç”¨äºåœ¨ log è¯·æ±‚å¤„ç†é˜¶æ®µï¼Œç”¨ Lua ä»£ç å¤„ç†æ—¥å¿—ï¼Œä½†å¹¶ä¸æ›¿æ¢åŸæœ‰ log å¤„ç†ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://mybackend;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">log_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">            local log_dict = ngx.shared.log_dict</span></span><br><span class="line"><span class="string">            local upstream_time = tonumber(ngx.var.upstream_response_time)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            local sum = log_dict:get("upstream_time-sum") or 0</span></span><br><span class="line"><span class="string">            sum = sum + upstream_time</span></span><br><span class="line"><span class="string">            log_dict:set("upstream_time-sum", sum)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            local newval, err = log_dict:incr("upstream_time-nb", 1)</span></span><br><span class="line"><span class="string">            if not newval and err == "not found" then</span></span><br><span class="line"><span class="string">            log_dict:add("upstream_time-nb", 0)</span></span><br><span class="line"><span class="string">            log_dict:incr("upstream_time-nb", 1)</span></span><br><span class="line"><span class="string">            end</span></span><br><span class="line"><span class="string">            '</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å–œæ¬¢ç›´æ¥å†™ Lua è¯­æ³•ï¼ŒæŠŠ Lua è¯­æ³• æ”¾åˆ° Lua æ–‡ä»¶é‡Œï¼Œä½¿ç”¨ <code>log_by_lua_file</code> å¼•ç”¨ Lua æ–‡ä»¶ã€‚</p><h3 id="balancer-by-lua"><a href="#balancer-by-lua" class="headerlink" title="balancer_by_lua"></a>balancer_by_lua</h3><p> è¯¥æŒ‡ä»¤ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°ä¸Šæ¸¸æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å™¨ç®—æ³•</p><h3 id="ssl-certificate-by"><a href="#ssl-certificate-by" class="headerlink" title="ssl_certificate_by"></a>ssl_certificate_by</h3><p>è¯¥æŒ‡ä»¤ä½œç”¨åœ¨ Nginx å’Œä¸‹æ¸¸æœåŠ¡å¼€å§‹ä¸€ä¸ª SSL æ¡æ‰‹æ“ä½œæ—¶å°†å…è®¸æœ¬é…ç½®é¡¹çš„ Lua ä»£ç ã€‚</p><h2 id="ç®€å•æ¡ˆä¾‹"><a href="#ç®€å•æ¡ˆä¾‹" class="headerlink" title="ç®€å•æ¡ˆä¾‹"></a>ç®€å•æ¡ˆä¾‹</h2><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>å‘é€è¯·æ±‚ï¼š<code>http://192.168.91.200?name=å¼ ä¸‰&amp;gender=1</code></p><p>Nginx æ¥æ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ® gender ä¼ å…¥çš„å€¼è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœ gender ä¼ å…¥çš„æ˜¯ 1ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰å…ˆç”Ÿ,å¦‚æœ gender ä¼ å…¥çš„æ˜¯ 0ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰å¥³å£«ï¼Œå¦‚æœæœªä¼ æˆ–è€…ä¼ å…¥çš„ä¸æ˜¯ 1 å’Œ 2ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰ã€‚</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>åœ¨é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /getByGender &#123;</span><br><span class="line"><span class="attribute">default_type</span> <span class="string">'text/html'</span>;</span><br><span class="line">    </span><br><span class="line"><span class="attribute">set_by_lua</span> <span class="variable">$name</span> <span class="string">"</span></span><br><span class="line"><span class="string">local uri_args = ngx.req.get_uri_args()</span></span><br><span class="line"><span class="string">gender = uri_args['gender']</span></span><br><span class="line"><span class="string">name = uri_args['name']</span></span><br><span class="line"><span class="string">if gender=='1' then</span></span><br><span class="line"><span class="string">return name..'å…ˆç”Ÿ'</span></span><br><span class="line"><span class="string">elseif gender=='0' then</span></span><br><span class="line"><span class="string">return name..'å¥³å£«'</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">return name</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">"</span>;</span><br><span class="line"><span class="attribute">header_filter_by_lua</span> <span class="string">"</span></span><br><span class="line"><span class="string">ngx.header.aaa='bbb'</span></span><br><span class="line"><span class="string">"</span>;</span><br><span class="line"><span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®æµ‹è¯•ï¼š<code>http://192.168.91.200/getByGender?name=å†¯è£æ—­&amp;gender=1</code></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220807/image.43wr3kwp3ag0.webp" alt="image"></p><p>è®¿é—®æµ‹è¯•ï¼š<code>http://192.168.91.200/getByGender?name=å†¯è£æ—­</code></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220807/image.44pzvk2lzlk0.webp" alt="image"></p><h2 id="ngx-luaæ“ä½œRedis"><a href="#ngx-luaæ“ä½œRedis" class="headerlink" title="ngx_luaæ“ä½œRedis"></a>ngx_luaæ“ä½œRedis</h2><p>Redis åœ¨ç³»ç»Ÿä¸­ç»å¸¸ä½œä¸ºæ•°æ®ç¼“å­˜ã€å†…å­˜æ•°æ®åº“ä½¿ç”¨ï¼Œåœ¨å¤§å‹ç³»ç»Ÿä¸­æ‰®æ¼”ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚</p><p>åœ¨ Nginx æ ¸å¿ƒç³»ç»Ÿä¸­ï¼ŒRedis æ˜¯å¸¸å¤‡ç»„ä»¶ã€‚Nginx æ”¯æŒ 3 ç§æ–¹æ³•è®¿é—® Redisï¼Œåˆ†åˆ«æ˜¯ HttpRedis æ¨¡å—ã€HttpRedis2Module æ¨¡å—ã€lua-resty-redis åº“ã€‚</p><p>è¿™ä¸‰ç§æ–¹å¼ä¸­ HttpRedis æ¨¡å—æä¾›çš„æŒ‡ä»¤å°‘ï¼ŒåŠŸèƒ½å•ä¸€ï¼Œé€‚åˆåšç®€å•ç¼“å­˜ã€‚HttpRedis2Module æ¨¡å—æ¯” HttpRedis æ¨¡å—æ“ä½œæ›´çµæ´»ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚è€ŒLua-resty-redis åº“æ˜¯ OpenResty æä¾›çš„ä¸€ä¸ªæ“ä½œ Redis çš„æ¥å£åº“ï¼Œå¯æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æƒ…å†µåšä¸€äº›é€»è¾‘å¤„ç†ï¼Œé€‚åˆåšå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚</p><p>æœ¬å†…å®¹å°†ä¸»è¦ä»¥ Lua-resty-redis æ¥è¿›è¡Œè®²è§£ã€‚</p><h3 id="Redisç¯å¢ƒå‡†å¤‡"><a href="#Redisç¯å¢ƒå‡†å¤‡" class="headerlink" title="Redisç¯å¢ƒå‡†å¤‡"></a>Redisç¯å¢ƒå‡†å¤‡</h3><p>å‡†å¤‡ä¸€ä¸ª Redis ç¯å¢ƒï¼Œå¹¶ç¡®ä¿æ­£å¸¸è¿æ¥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥åœ°å€</span></span><br><span class="line">host= 192.168.91.200</span><br><span class="line">port=6379</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master <span class="built_in">local</span>]<span class="comment"># /usr/local/bin/redis-server /etc/redis.conf</span></span><br><span class="line">[root@master <span class="built_in">local</span>]<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><h3 id="APIå­¦ä¹ "><a href="#APIå­¦ä¹ " class="headerlink" title="APIå­¦ä¹ "></a>APIå­¦ä¹ </h3><p><code>lua-resty-redis</code> æä¾›äº†è®¿é—® Redis çš„è¯¦ç»† APIï¼ŒåŒ…æ‹¬åˆ›å»ºå¯¹æ¥ã€è¿æ¥ã€æ“ä½œã€æ•°æ®å¤„ç†ç­‰ã€‚è¿™äº› API åŸºæœ¬ä¸Šä¸ Redis çš„æ“ä½œä¸€ä¸€å¯¹åº”ã€‚</p><table><thead><tr><th>API</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>redis = require â€œresty.redisâ€</td><td>å¼•å…¥ Redis æ¨¡å—ï¼Œç±»ä¼¼äº Java çš„ importã€‚</td></tr><tr><td>redis,err = redis:new()</td><td>åˆ›å»ºä¸€ä¸ª Redis å¯¹è±¡ç»™ redisï¼Œerr è®°å½•åˆ›å»ºå¤±è´¥çš„åŸå› ã€‚</td></tr><tr><td>ok,err=redis:connect(host,port[,options_table])</td><td>è®¾ç½®è¿æ¥ Redis çš„è¿æ¥ä¿¡æ¯ã€‚ okï¼šè¿æ¥æˆåŠŸè¿”å› 1ï¼Œè¿æ¥å¤±è´¥è¿”å› nilã€‚ errï¼šè¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</td></tr><tr><td>redis:set_timeout(time)</td><td>è®¾ç½®è¯·æ±‚æ“ä½œ Redis çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’ã€‚</td></tr><tr><td>ok,err = redis:close()</td><td>å…³é—­å½“å‰è¿æ¥ã€‚ okï¼šè¿æ¥æˆåŠŸè¿”å› 1ï¼Œè¿æ¥å¤±è´¥è¿”å› nilã€‚ errï¼šè¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</td></tr><tr><td>åŸç”Ÿ Redis å‘½ä»¤å¦‚ getã€setã€lpush ç­‰</td><td>æ‰€æœ‰çš„ Redis å‘½ä»¤éƒ½æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œæ–¹æ³•åå­—å’Œå‘½ä»¤åå­—ç›¸åŒï¼Œåªæ˜¯å…¨éƒ¨ä¸ºå°å†™ã€‚</td></tr></tbody></table><h3 id="æ•ˆæœå®ç°"><a href="#æ•ˆæœå®ç°" class="headerlink" title="æ•ˆæœå®ç°"></a>æ•ˆæœå®ç°</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">location /redis &#123;</span><br><span class="line">    default_type <span class="string">"text/html"</span>;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> redis = <span class="built_in">require</span> <span class="string">"resty.redis"</span> <span class="comment">-- å¼•å…¥ Redis</span></span><br><span class="line">        <span class="keyword">local</span> redisObj = redis:new()  <span class="comment">-- åˆ›å»º Redis å¯¹è±¡</span></span><br><span class="line">        redisObj:set_timeout(<span class="number">1000</span>) <span class="comment">-- è®¾ç½®è¶…æ—¶æ•°æ®ä¸º 1s</span></span><br><span class="line">        <span class="keyword">local</span> ok,err = redisObj:connect(<span class="string">"192.168.91.200"</span>,<span class="number">6379</span>) <span class="comment">-- è®¾ç½® Redis è¿æ¥ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span> <span class="comment">-- åˆ¤æ–­æ˜¯å¦è¿æ¥æˆåŠŸ</span></span><br><span class="line">            ngx.say(<span class="string">"failed to connection redis"</span>,err)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        ok,err = redisObj:set(<span class="string">"username"</span>,<span class="string">"TOM"</span>)<span class="comment">-- å­˜å…¥æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span> <span class="comment">-- åˆ¤æ–­æ˜¯å¦å­˜å…¥æˆåŠŸ</span></span><br><span class="line">            ngx.say(<span class="string">"failed to set username"</span>,err)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">local</span> res,err = redisObj:get(<span class="string">"username"</span>) <span class="comment">-- ä» Redis ä¸­è·å–æ•°æ®</span></span><br><span class="line">        ngx.say(res) <span class="comment">-- å°†æ•°æ®å†™ä¼šæ¶ˆæ¯ä½“ä¸­</span></span><br><span class="line">        redisObj:<span class="built_in">close</span>() <span class="comment">-- å…³é—­ Redis è¿æ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•æ•ˆæœ</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220807/image.4iflh85c7ma0.webp" alt="image"></p><ul><li>æŸ¥è¯¢redis</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master conf]<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; get username</span><br><span class="line"><span class="string">"TOM"</span></span><br></pre></td></tr></table></figure><h2 id="ngx-luaæ“ä½œMysql"><a href="#ngx-luaæ“ä½œMysql" class="headerlink" title="ngx_luaæ“ä½œMysql"></a>ngx_luaæ“ä½œMysql</h2><p>MySQL æ˜¯ä¸€ä¸ªä½¿ç”¨å¹¿æ³›çš„å…³ç³»å‹æ•°æ®åº“ã€‚åœ¨ ngx_lua ä¸­ï¼ŒMySQL æœ‰ä¸¤ç§è®¿é—®æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯æ˜¯ï¼š</p><ul><li>ç”¨ <code>ngx_lua</code> æ¨¡å—å’Œ <code>lua-resty-mysql</code> æ¨¡å—ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—æ˜¯å®‰è£… OpenResty æ—¶é»˜è®¤å®‰è£…çš„ã€‚</li><li>ä½¿ç”¨ <code>drizzle_nginx_module</code>ï¼ˆHttpDrizzleModuleï¼‰æ¨¡å—ï¼Œéœ€è¦å•ç‹¬å®‰è£…ï¼Œè¿™ä¸ªåº“ç°ä¸åœ¨ OpenResty ä¸­ã€‚</li></ul><h3 id="lua-resty-mysql"><a href="#lua-resty-mysql" class="headerlink" title="lua-resty-mysql"></a>lua-resty-mysql</h3><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ <code>lua-resty-mysql</code> æ¨¡å—ã€‚</p><p><code>lua-resty-mysql</code> æ˜¯ OpenResty å¼€å‘çš„æ¨¡å—ï¼Œä½¿ç”¨çµæ´»ã€åŠŸèƒ½å¼ºå¤§ï¼Œé€‚åˆå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼ŒåŒæ—¶æ”¯æŒå­˜å‚¨è¿‡ç¨‹çš„è®¿é—®ã€‚</p><h3 id="MySQLç¯å¢ƒå‡†å¤‡"><a href="#MySQLç¯å¢ƒå‡†å¤‡" class="headerlink" title="MySQLç¯å¢ƒå‡†å¤‡"></a>MySQLç¯å¢ƒå‡†å¤‡</h3><p>å‡†å¤‡ MySQLï¼Œç¡®ä¿èƒ½æ­£å¸¸è¿æ¥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">host: 192.168.91.200</span><br><span class="line">port: 3306</span><br><span class="line">username: root</span><br><span class="line">password: 12345678</span><br></pre></td></tr></table></figure><h3 id="APIå­¦ä¹ -1"><a href="#APIå­¦ä¹ -1" class="headerlink" title="APIå­¦ä¹ "></a>APIå­¦ä¹ </h3><ul><li><p><code>mysql = require &quot;resty.mysql&quot;</code></p><p>å¼•å…¥ MySQL æ¨¡å—ï¼Œç±»ä¼¼äº Java çš„ importã€‚</p></li><li><p><code>db,err = mysql:new()</code></p><p>åˆ›å»ºä¸€ä¸ª MySQL è¿æ¥å¯¹è±¡ç»™ dbï¼Œè¿æ¥å¯¹è±¡é‡åˆ°é”™è¯¯æ—¶ï¼Œdb ä¸ºnilï¼Œerr ä¸ºé”™è¯¯æè¿°ä¿¡æ¯ã€‚</p></li><li><p><code>ok,err = db:connect(Options)</code></p><p>å°è¯•è¿æ¥åˆ°ä¸€ä¸ªMySQLæœåŠ¡å™¨ã€‚Options æ˜¯ä¸€ä¸ªå‚æ•°çš„ Lua è¡¨ç»“æ„ï¼Œé‡Œé¢åŒ…å«æ•°æ®åº“è¿æ¥çš„ç›¸å…³ä¿¡æ¯ã€‚</p><p>Options é€‰é¡¹ï¼š</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hostï¼šæœåŠ¡å™¨ä¸»æœºåæˆ–IPåœ°å€</span><br><span class="line">portï¼šæœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º3306</span><br><span class="line">userï¼šç™»å½•çš„ç”¨æˆ·å</span><br><span class="line">passwordï¼šç™»å½•å¯†ç </span><br><span class="line">databaseï¼šä½¿ç”¨çš„æ•°æ®åº“å</span><br></pre></td></tr></table></figure><ul><li><p><code>db:set_timeout(time)</code></p><p>è®¾ç½®å­è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’ã€‚</p></li><li><p><code>ok,err = db:close()</code></p><p>å…³é—­å½“å‰ MySQL è¿æ¥å¹¶è¿”å›çŠ¶æ€ã€‚</p></li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">okï¼šå¦‚æœæˆåŠŸï¼Œåˆ™è¿”å› <span class="number">1</span>ï¼›å¦‚æœå‡ºç°ä»»ä½•é”™è¯¯ï¼Œåˆ™å°†è¿”å› <span class="literal">nil</span>ã€‚</span><br><span class="line">errï¼šå¦‚æœå‡ºç°ä»»ä½•é”™è¯¯ï¼Œè¿”å›é”™è¯¯æè¿°ã€‚</span><br></pre></td></tr></table></figure><ul><li><p><code>bytes,err=db:send_query(sql)</code></p><p>å¼‚æ­¥å‘è¿œç¨‹ MySQL å‘é€ä¸€ä¸ªæŸ¥è¯¢ã€‚</p><p>å¦‚æœæˆåŠŸåˆ™è¿”å›æˆåŠŸå‘é€çš„å­—èŠ‚æ•°ï¼›å¦‚æœé”™è¯¯ï¼Œåˆ™è¿”å› nil å’Œé”™è¯¯æè¿°ã€‚</p></li><li><p><code>res, err, errcode, sqlstate = db:read_result([rows])</code></p><p>ä» MySQL æœåŠ¡å™¨è¿”å›ç»“æœä¸­è¯»å–ä¸€è¡Œæ•°æ®ã€‚</p><p><code>rows</code> æŒ‡å®šè¿”å›ç»“æœé›†çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸º 4ï¼Œå¯ä¸å†™ã€‚</p></li></ul><p>è¿”å›å€¼ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resï¼šæ“ä½œçš„ç»“æœé›†ï¼Œè¿”å›ä¸€ä¸ªæè¿° OK åŒ…æˆ–ç»“æœé›†åŒ…çš„ Lua è¡¨</span><br><span class="line">errï¼šé”™è¯¯ä¿¡æ¯</span><br><span class="line">errcodeï¼šMySQL çš„é”™è¯¯ç ï¼Œæ¯”å¦‚ <span class="number">1064</span></span><br><span class="line">sqlstateï¼šè¿”å›ç”± <span class="number">5</span> ä¸ªå­—ç¬¦ç»„æˆçš„æ ‡å‡† SQL é”™è¯¯ç ï¼Œæ¯”å¦‚ <span class="number">42000</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æŸ¥è¯¢ï¼Œåˆ™è¿”å›ä¸€ä¸ªå®¹çº³å¤šè¡Œçš„æ•°ç»„ã€‚æ¯è¡Œæ˜¯ä¸€ä¸ªæ•°æ®åˆ—çš„key-valueå¯¹ï¼Œå¦‚ä¸‹:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &#123;id=1,username="TOM",birthday="1988-11-11",salary=10000.0&#125;,</span><br><span class="line">&#123;id=2,username="JERRY",birthday="1989-11-11",salary=20000.0&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å¢åˆ æ”¹ï¼Œåˆ™è¿”å›ç±»ä¸Šå¦‚ä¸‹æ•°æ®</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    insert_id = 0,</span><br><span class="line">    server_status=2,</span><br><span class="line">    warning_count=1,</span><br><span class="line">    affected_rows=2,</span><br><span class="line">    message=nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“è¿æ¥å››è¦ç´ :</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driverClass=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://192.168.91.200:3306/nginx_db</span><br><span class="line">username=root</span><br><span class="line">password=12345678</span><br></pre></td></tr></table></figure><h3 id="è¡¨åˆ›å»ºå¹¶æ’å…¥æ•°æ®"><a href="#è¡¨åˆ›å»ºå¹¶æ’å…¥æ•°æ®" class="headerlink" title="è¡¨åˆ›å»ºå¹¶æ’å…¥æ•°æ®"></a>è¡¨åˆ›å»ºå¹¶æ’å…¥æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span>(<span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>));</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">id</span>,<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">"TOM"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">id</span>,<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">"JERRY"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">id</span>,<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">"ROWS"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">id</span>,<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">"LUCY"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">id</span>,<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">"JACK"</span>);</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æŸ¥è¯¢"><a href="#æ•°æ®æŸ¥è¯¢" class="headerlink" title="æ•°æ®æŸ¥è¯¢"></a>æ•°æ®æŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">location /testMysql &#123;</span><br><span class="line">    content_by_lua_block&#123;</span><br><span class="line">        local mysql = require "resty.mysql"</span><br><span class="line">        local db, err = mysql:new()  <span class="comment">-- åˆ›å»ºå®ä¾‹  </span></span><br><span class="line">        if not db then  </span><br><span class="line">            ngx.say("new mysql error : ", err)  </span><br><span class="line">            return  </span><br><span class="line">        <span class="keyword">end</span>  </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">local</span> ok,err = db:<span class="keyword">connect</span>&#123;</span><br><span class="line">            host=<span class="string">"192.168.91.200"</span>,</span><br><span class="line">            port=<span class="number">3306</span>,</span><br><span class="line">            <span class="keyword">user</span>=<span class="string">"root"</span>,</span><br><span class="line">            <span class="keyword">password</span>=<span class="string">"12345678"</span>,</span><br><span class="line">            <span class="keyword">database</span>=<span class="string">"nginx_db"</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        db:set_timeout(<span class="number">1000</span>)<span class="comment">-- è®¾ç½®è¶…æ—¶æ—¶é—´(æ¯«ç§’)  </span></span><br><span class="line">        <span class="comment">-- æŸ¥è¯¢è¯­å¥</span></span><br><span class="line"><span class="keyword">local</span> query_sql = <span class="string">"select * from users"</span></span><br><span class="line">        db:send_query(query_sql)</span><br><span class="line">        <span class="keyword">local</span> res,err,errcode,<span class="keyword">sqlstate</span> = db:read_result()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- è¿”å›æ•°æ® .. ä»£è¡¨æ‹¼æ¥</span></span><br><span class="line">        ngx.say(res[<span class="number">1</span>].id..<span class="string">","</span>..res[<span class="number">1</span>].name)</span><br><span class="line">    db:<span class="keyword">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong></p><p>ä¸Šé¢è¿”å›çš„æ˜¯éœ€è¦æˆ‘ä»¬æŒ‡å®šè¿”å›çš„æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬æ ¹æœ¬ä¸çŸ¥é“æŸ¥è¯¢çš„æ•°æ®æœ‰å¤šå°‘æ¡ï¼Œé•¿ä»€ä¹ˆæ ·å­ã€‚</p><ul><li>å¦‚ä½•è·å–è¿”å›æ•°æ®çš„å†…å®¹</li><li>å¦‚ä½•å®ç°æŸ¥è¯¢å¤šæ¡æ•°æ®</li><li>å¦‚ä½•å®ç°æ•°æ®åº“çš„åˆ æ”¹æ“ä½œ</li></ul><h3 id="lua-cjsonå¤„ç†æŸ¥è¯¢ç»“æœ"><a href="#lua-cjsonå¤„ç†æŸ¥è¯¢ç»“æœ" class="headerlink" title="lua-cjsonå¤„ç†æŸ¥è¯¢ç»“æœ"></a>lua-cjsonå¤„ç†æŸ¥è¯¢ç»“æœ</h3><p>é€šè¿‡ä¸Šè¿°çš„æ¡ˆä¾‹å­¦ä¹ ï¼Œread_result() å¾—åˆ°çš„ç»“æœ res éƒ½æ˜¯ table ç±»å‹ï¼Œè¦æƒ³åœ¨é¡µé¢ä¸Šå±•ç¤ºï¼Œå°±å¿…é¡»çŸ¥é“ table çš„å…·ä½“æ•°æ®ç»“æ„æ‰èƒ½è¿›è¡Œéå†è·å–ã€‚å¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ä¸€ç§ç®€å•æ–¹å¼ cjsonï¼Œä½¿ç”¨å®ƒå°±å¯ä»¥å°† table ç±»å‹çš„æ•°æ®è½¬æ¢æˆ Json å­—ç¬¦ä¸²ï¼ŒæŠŠ Json å­—ç¬¦ä¸²å±•ç¤ºåœ¨é¡µé¢ä¸Šå³å¯ã€‚</p><p>æ­¥éª¤ä¸€ï¼šå¼•å…¥ cjson æ¨¡å—</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> cjson = <span class="built_in">require</span> <span class="string">"cjson"</span></span><br></pre></td></tr></table></figure><p>æ­¥éª¤äºŒï¼šè°ƒç”¨ cjson çš„ encode æ–¹æ³•è¿›è¡Œç±»å‹è½¬æ¢</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cjson.encode(res)</span><br></pre></td></tr></table></figure><p>æ­¥éª¤ä¸‰ï¼šæµ‹è¯•</p><figure class="highlight lua"><figcaption><span>&#123;20-27&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">location /testMysql &#123;</span><br><span class="line">    content_by_lua_block&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">local</span> mysql = <span class="built_in">require</span> <span class="string">"resty.mysql"</span></span><br><span class="line">        <span class="keyword">local</span> cjson = <span class="built_in">require</span> <span class="string">"cjson"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">local</span> db = mysql:new()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">local</span> ok,err = db:connect&#123;</span><br><span class="line">            host=<span class="string">"192.168.199.27"</span>,</span><br><span class="line">            port=<span class="number">3306</span>,</span><br><span class="line">            user=<span class="string">"root"</span>,</span><br><span class="line">            password=<span class="string">"123456"</span>,</span><br><span class="line">            database=<span class="string">"nginx_db"</span></span><br><span class="line">        &#125;</span><br><span class="line">        db:set_timeout(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- db:send_query("select * from users where id = 1")</span></span><br><span class="line">        </span><br><span class="line">        db:send_query(<span class="string">"select * from users"</span>)</span><br><span class="line">        <span class="keyword">local</span> res,err,errcode,sqlstate = db:read_result()</span><br><span class="line">        </span><br><span class="line">        ngx.say(cjson.encode(res))   <span class="comment">-- è½¬ä¸º JSON å­—ç¬¦ä¸²æ ¼å¼</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(res) <span class="keyword">do</span>     <span class="comment">-- å¾ªç¯æ¥è¿”å›æ•°æ®</span></span><br><span class="line">            ngx.say(<span class="string">"è¿”å›çš„æ•°æ®ï¼š"</span>ï¼Œv.id..<span class="string">","</span>..v.name)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">        db:<span class="built_in">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“åˆ æ”¹"><a href="#æ•°æ®åº“åˆ æ”¹" class="headerlink" title="æ•°æ®åº“åˆ æ”¹"></a>æ•°æ®åº“åˆ æ”¹</h3><p>ä¼˜åŒ– <code>send_query</code> å’Œ <code>read_result</code>ï¼Œä¸¤ä¸ªå¯ä»¥å˜æˆä¸€ä½“ã€‚</p><p>æœ¬æ–¹æ³•æ˜¯ <code>send_query</code> å’Œ <code>read_result</code> ç»„åˆçš„å¿«æ·æ–¹æ³•ã€‚</p><p>è¯­æ³•:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res, err, errcode, sqlstate = db:query(sql[,rows])</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¯¥ APIï¼Œä¸Šé¢çš„ä»£ç æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå¯¹åº”çš„ä¼˜åŒ–ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight lua"><figcaption><span>&#123;22,24&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">location /testMysql &#123;</span><br><span class="line">    content_by_lua_block&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">local</span> mysql = <span class="built_in">require</span> <span class="string">"resty.mysql"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">local</span> db = mysql:new()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">local</span> ok,err = db:connect&#123;</span><br><span class="line">            host=<span class="string">"192.168.91.200"</span>,</span><br><span class="line">            port=<span class="number">3306</span>,</span><br><span class="line">            user=<span class="string">"root"</span>,</span><br><span class="line">            password=<span class="string">"12345678"</span>,</span><br><span class="line">            database=<span class="string">"nginx_db"</span>,</span><br><span class="line">            max_packet_size=<span class="number">1024</span>,</span><br><span class="line">            compact_arrays=<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        db:set_timeout(<span class="number">1000</span>)</span><br><span class="line">        <span class="comment">-- æŸ¥è¯¢æ“ä½œ</span></span><br><span class="line">        <span class="keyword">local</span> res,err,errcode,sqlstate = db:send_query(<span class="string">"select * from users where id = 1"</span>)</span><br><span class="line">        <span class="comment">-- ä¿®æ”¹æ“ä½œ</span></span><br><span class="line">        <span class="keyword">local</span> res,err,errcode,sqlstate = db:query(<span class="string">"update users set name = 'bing' where id = 1"</span>)</span><br><span class="line">        <span class="comment">-- åˆ é™¤æ“ä½œ</span></span><br><span class="line">        <span class="keyword">local</span> res,err,errcode,sqlstate = db:query(<span class="string">"delete from users where id = 1"</span>)</span><br><span class="line">        <span class="comment">-- æ’å…¥æ“ä½œ</span></span><br><span class="line">        <span class="keyword">local</span> insert_sql = <span class="string">"insert into users(id,name) values(null,'kele')"</span></span><br><span class="line">        db:<span class="built_in">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> ç»¼åˆå°æ¡ˆä¾‹</p><p>ä½¿ç”¨ ngx_lua æ¨¡å—å®ŒæˆæŸ¥è¯¢ MySQL æ•°æ®ï¼Œç„¶ååœ¨ Redis ç¼“å­˜é¢„çƒ­ã€‚</p><p>åˆ†æ:</p><ol><li>å…ˆå¾—æœ‰ä¸€å¼ è¡¨ï¼ˆusersï¼‰ï¼Œä¸Šé¢å·²ç»åˆ›å»º</li><li>æµè§ˆå™¨è¾“å…¥å¦‚ä¸‹åœ°å€</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://191.168.91.200?name=frx</span><br></pre></td></tr></table></figure><ol start="3"><li>ä»MySQL è¡¨ä¸­æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œæ­¤æ—¶è·å–çš„ç»“æœä¸º table ç±»å‹</li><li>ä½¿ç”¨ cjson å°† table æ•°æ®è½¬æ¢æˆ json å­—ç¬¦ä¸²</li><li>å°†æŸ¥è¯¢çš„ç»“æœæ•°æ®å­˜å…¥ Redis ä¸­</li></ol><p>è¿™é‡Œåˆ©ç”¨åˆ° <code>init_by_lua_block</code> æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤ä¸Šé¢ä»‹ç»è¿‡ï¼Œç”¨äºåˆå§‹åŒ–å…¨å±€å˜é‡ã€‚è¿™é‡Œç”¨äºåˆå§‹åŒ– MySQLã€Redisã€cjson æ¨¡å—ã€‚</p><p>è¿˜æ˜¯ä½¿ç”¨äº† <code>quote_sql_str</code> æŒ‡ä»¤ï¼Œé˜²æ­¢ã€Œæ‹¼ã€SQLï¼Œå¯¼è‡´ SQL æ³¨å…¥ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">init_by_lua_block&#123;</span><br><span class="line">    redis = <span class="built_in">require</span> <span class="string">"resty.redis"</span></span><br><span class="line">    mysql = <span class="built_in">require</span> <span class="string">"resty.mysql"</span></span><br><span class="line">    cjson = <span class="built_in">require</span> <span class="string">"cjson"</span></span><br><span class="line">&#125;</span><br><span class="line">location /testMysql &#123;</span><br><span class="line">    default_type <span class="string">"text/html"</span>;</span><br><span class="line">    content_by_lua_block&#123;</span><br><span class="line">        <span class="comment">-- è·å–è¯·æ±‚çš„å‚æ•° name</span></span><br><span class="line">        <span class="keyword">local</span> param = ngx.req.get_uri_args()[<span class="string">"name"</span>]</span><br><span class="line">        <span class="comment">-- å»ºç«‹ mysql æ•°æ®åº“çš„è¿æ¥</span></span><br><span class="line">        <span class="keyword">local</span> db = mysql:new()</span><br><span class="line">        <span class="keyword">local</span> ok,err = db:connect&#123;</span><br><span class="line">            host=<span class="string">"192.168.91.200"</span>,</span><br><span class="line">            port=<span class="number">3306</span>,</span><br><span class="line">            user=<span class="string">"root"</span>,</span><br><span class="line">            password=<span class="string">"12345678"</span>,</span><br><span class="line">            database=<span class="string">"nginx_db"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">            ngx.say(<span class="string">"failed connect to mysql:"</span>,err)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        db:set_timeout(<span class="number">1000</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- æŸ¥è¯¢æ•°æ®</span></span><br><span class="line">        <span class="keyword">local</span> sql = <span class="string">""</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> param <span class="keyword">then</span></span><br><span class="line">            sql=<span class="string">"select * from users"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            sql=<span class="string">"select * from users where name="</span> .. <span class="string">"'"</span> .. param ..<span class="string">"'"</span> <span class="comment">-- sql æ³¨å…¥ ï¼Œä¸å»ºè®®</span></span><br><span class="line">            sql=<span class="string">"select * from users where name="</span> .. ngx.quote_sql_str(ch_param) <span class="comment">-- é˜²æ­¢ sql æ³¨å…¥</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">local</span> res,err,errcode,sqlstate=db:query(sql)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> res <span class="keyword">then</span></span><br><span class="line">            ngx.say(<span class="string">"failed to query from mysql:"</span>,err)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- è¿æ¥redis</span></span><br><span class="line">        <span class="keyword">local</span> rd = redis:new()</span><br><span class="line">        ok,err = rd:connect(<span class="string">"192.168.91.200"</span>,<span class="number">6379</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">            ngx.say(<span class="string">"failed to connect to redis:"</span>,err)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">        rd:set_timeout(<span class="number">1000</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- å¾ªç¯éå†æ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(res) <span class="keyword">do</span></span><br><span class="line">            rd:set(<span class="string">"user_"</span>..v.username,cjson.encode(v))</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">        ngx.say(<span class="string">"success"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- å…³é—­ MySQL å’Œ Rdis çš„è¿æ¥</span></span><br><span class="line">        rd:<span class="built_in">close</span>()</span><br><span class="line">        db:<span class="built_in">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx Luaå­¦ä¹ </title>
      <link href="/2022/11/16/Nginx_Lua_learn/"/>
      <url>/2022/11/16/Nginx_Lua_learn/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-Luaå­¦ä¹ "><a href="#Nginx-Luaå­¦ä¹ " class="headerlink" title="Nginx Luaå­¦ä¹ "></a>Nginx Luaå­¦ä¹ </h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>Nginx æ˜¯å¯æ‰©å±•çš„ï¼Œå¯ç”¨äºå¤„ç†å„ç§ä½¿ç”¨åœºæ™¯ã€‚æœ¬å†…å®¹ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ ä½¿ç”¨ Lua æ‰©å±• Nginx çš„åŠŸèƒ½ã€‚</p><p>Lua æ˜¯ä¸€ç§è½»é‡ã€å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡† C è¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ã€‚è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åˆ°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚</p><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><p>è·Ÿå…¶ä»–è¯­è¨€è¿›è¡Œæ¯”è¾ƒï¼ŒLua æœ‰å…¶è‡ªèº«çš„ç‰¹ç‚¹ï¼š</p><ul><li><p>è½»é‡çº§</p><p>Lua ç”¨æ ‡å‡† C è¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ï¼Œç¼–è¯‘åä»…ä»…ä¸€ç™¾ä½™åƒå­—èŠ‚ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åµŒå…¥åˆ°å…¶ä»–ç¨‹åºä¸­ã€‚</p></li><li><p>å¯æ‰©å±•</p><p>Lua æä¾›éå¸¸ä¸°å¯Œæ˜“äºä½¿ç”¨çš„æ‰©å±•æ¥å£å’Œæœºåˆ¶ï¼Œç”±å®¿ä¸»è¯­è¨€ï¼ˆé€šå¸¸æ˜¯ C æˆ– C++ï¼‰æä¾›åŠŸèƒ½ï¼ŒLua å¯ä»¥ä½¿ç”¨å®ƒä»¬ï¼Œå°±åƒå†…ç½®çš„åŠŸèƒ½ä¸€æ ·ã€‚</p></li><li><p>æ”¯æŒé¢å‘è¿‡ç¨‹ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹</p></li></ul><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p>Lua åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­å¾—åˆ°å¤§é‡åº”ç”¨ï¼Œåœºæ™¯çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹:</p><p>æ¸¸æˆå¼€å‘ã€ç‹¬ç«‹åº”ç”¨è„šæœ¬ã€Web åº”ç”¨è„šæœ¬ã€æ‰©å±•å’Œæ•°æ®åº“æ’ä»¶ã€ç³»ç»Ÿå®‰å…¨ä¸Šã€‚</p><h2 id="Luaçš„å®‰è£…"><a href="#Luaçš„å®‰è£…" class="headerlink" title="Luaçš„å®‰è£…"></a>Luaçš„å®‰è£…</h2><p>åœ¨ Linux ä¸Šå®‰è£… Lua éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸‹è½½æºç åŒ…å¹¶åœ¨ç»ˆç«¯è§£å‹ã€ç¼–è¯‘å³å¯ä½¿ç”¨ã€‚</p><p>Lua çš„å®˜ç½‘åœ°å€ä¸ºï¼š<a href="https://www.lua.org/" target="_blank" rel="noopener">https://www.lua.org</a></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.4tduh26e2b20.webp" alt="image"></p><p>ç‚¹å‡» download å¯ä»¥æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„ä¸‹è½½åœ°å€ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨æœ€æ–°ç‰ˆ lua-5.4.4ï¼Œå…¶å¯¹åº”çš„èµ„æºé“¾æ¥åœ°å€ä¸º <code>https://www.lua.org/ftp/lua-5.4.4.tar.gz</code>ï¼Œä¹Ÿå¯ä»¥åœ¨ Linux ä½¿ç”¨ wget å‘½ä»¤ç›´æ¥ä¸‹è½½</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.lua.org/ftp/lua-5.4.4.tar.gz</span><br></pre></td></tr></table></figure><ul><li>æˆ‘è¿™é‡Œä¸‹è½½åœ¨ <code>/opt/lua</code></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/lua</span><br><span class="line"><span class="built_in">cd</span> /opt/lua</span><br><span class="line">wget https://www.lua.org/ftp/lua-5.4.4.tar.gz</span><br></pre></td></tr></table></figure><ul><li>è§£å‹</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf lua-5.4.4.tar.gz</span><br></pre></td></tr></table></figure><ul><li>æ£€æµ‹æ˜¯å¦æ»¡è¶³ Lua éœ€è¦çš„ç¯å¢ƒ</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/lua/lua-5.4.4</span><br><span class="line">make linux <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨æ‰§è¡Œ <code>make linux test</code> å¤±è´¥ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯(å¦‚æœæ²¡æœ‰,åˆ™ç¼–è¯‘å®‰è£…):</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.3h3rcto261s0.webp" alt="image"></p><p>è¯´æ˜å½“å‰ç³»ç»Ÿç¼ºå°‘ libreadline-dev ä¾èµ–åŒ…ï¼Œéœ€è¦é€šè¿‡å‘½ä»¤æ¥è¿›è¡Œå®‰è£…ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y readline-devel</span><br></pre></td></tr></table></figure><ul><li>ç¼–è¯‘å®‰è£…</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure><ul><li>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua-5.4.4]<span class="comment"># lua -v</span></span><br><span class="line">Lua 5.4.4  Copyright (C) 1994-2022 Lua.org, PUC-Rio</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸€ä¸ªLuaç¨‹åº"><a href="#ç¬¬ä¸€ä¸ªLuaç¨‹åº" class="headerlink" title="ç¬¬ä¸€ä¸ªLuaç¨‹åº"></a>ç¬¬ä¸€ä¸ªLuaç¨‹åº</h2><p>Lua å’Œ C/C++ è¯­æ³•éå¸¸ç›¸ä¼¼ï¼Œæ•´ä½“ä¸Šæ¯”è¾ƒæ¸…æ™°ï¼Œç®€æ´ã€‚æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°è°ƒç”¨éƒ½ä¸ C/C++ åŸºæœ¬ä¸€è‡´ã€‚å¦‚æœå¯¹ C/C++ ä¸å¤ªç†Ÿæ‚‰ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸ºå¤©ä¸‹è¯­è¨€æ˜¯ä¸€å®¶ï¼ŒåŸºæœ¬ä¸Šç†è§£èµ·æ¥éƒ½ä¸ä¼šå¤ªå›°éš¾ã€‚ä¸‹é¢ä¸€ç‚¹ä¸€ç‚¹è¿›è¡Œè®²è§£ã€‚</p><p>å¤§å®¶éœ€è¦çŸ¥é“çš„æ˜¯ï¼ŒLua æœ‰ä¸¤ç§äº¤äº’æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ï¼šäº¤äº’å¼å’Œè„šæœ¬å¼ï¼Œè¿™ä¸¤è€…çš„åŒºåˆ«ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥è®²è§£ä¸‹ï¼š</p><h3 id="äº¤äº’å¼"><a href="#äº¤äº’å¼" class="headerlink" title="äº¤äº’å¼"></a>äº¤äº’å¼</h3><p>äº¤äº’å¼æ˜¯æŒ‡å¯ä»¥åœ¨å‘½ä»¤è¡Œè¾“å…¥ç¨‹åºï¼Œç„¶åå›è½¦å°±å¯ä»¥çœ‹åˆ°è¿è¡Œçš„æ•ˆæœã€‚</p><p>Lua äº¤äº’å¼ç¼–ç¨‹æ¨¡å¼å¯ä»¥é€šè¿‡å‘½ä»¤ <code>lua -i</code> æˆ– <code>lua</code> æ¥å¯ç”¨ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lua -i</span><br><span class="line">// æˆ–è€…</span><br><span class="line">lua</span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua<span class="number">-5.4</span><span class="number">.4</span>]# lua</span><br><span class="line">Lua <span class="number">5.4</span><span class="number">.4</span>  Copyright (C) <span class="number">1994</span><span class="number">-2022</span> Lua.org, PUC-Rio</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶æŒ‰å›è½¦ï¼Œä¼šæœ‰è¾“å‡ºåœ¨æ§åˆ¶å°ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"Hello world"</span>)</span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">print</span>(<span class="string">"HelloWorld"</span>)</span><br><span class="line">HelloWorld</span><br></pre></td></tr></table></figure><p>CTRL + C äº¤äº’å¼ç»ˆç«¯ã€‚</p><h3 id="è„šæœ¬å¼"><a href="#è„šæœ¬å¼" class="headerlink" title="è„šæœ¬å¼"></a>è„šæœ¬å¼</h3><p>è„šæœ¬å¼æ˜¯å°†ä»£ç ä¿å­˜åˆ°ä¸€ä¸ªä»¥ lua ä¸ºæ‰©å±•åçš„æ–‡ä»¶ä¸­å¹¶æ‰§è¡Œçš„æ–¹å¼ã€‚</p><p>æ–¹å¼ä¸€ï¼š</p><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–‡ä»¶åä¸º hello.luaï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ è¦æ‰§è¡Œçš„ä»£ç ï¼Œç„¶åé€šè¿‡å‘½ä»¤ <code>lua hello.lua</code> æ¥æ‰§è¡Œï¼Œä¼šåœ¨æ§åˆ¶å°è¾“å‡ºå¯¹åº”çš„ç»“æœã€‚</p><p>åˆ›å»º hello.lua æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir lua_demo</span><br><span class="line"><span class="built_in">cd</span> lua_demo</span><br><span class="line">vim hello.lua</span><br></pre></td></tr></table></figure><p>hello.lua æ–‡ä»¶å†…å®¹</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"HelloWorld"</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ hello.lua æ–‡ä»¶ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lua hello.lua</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]<span class="comment"># lua hello.lua</span></span><br><span class="line">HelloWorld</span><br></pre></td></tr></table></figure><p><strong>ä¸æƒ³æ¯æ¬¡éƒ½æ˜¯ç”¨ lua hello.lua æ¥æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œå¯ä¸å¯ä»¥ç›´æ¥æ‰§è¡Œ hello.lua æ–‡ä»¶ï¼Ÿ</strong></p><p>æ–¹å¼äºŒï¼š</p><p>å°† hello.lua åšå¦‚ä¸‹ä¿®æ”¹</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/<span class="keyword">local</span>/bin/lua</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Hello World!!!"</span>)</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œç”¨æ¥æŒ‡å®š Lua è§£é‡Šå™¨å‘½ä»¤æ‰€åœ¨ä½ç½®ä¸º <code>/usr/local/bin/lua</code>ï¼ŒåŠ ä¸Š # å·æ ‡è®°ï¼Œè§£é‡Šå™¨ä¼šå¿½ç•¥å®ƒã€‚ä¸€èˆ¬æƒ…å†µä¸‹ #! å°±æ˜¯ç”¨æ¥æŒ‡å®šç”¨å“ªä¸ªç¨‹åºæ¥è¿è¡Œæœ¬æ–‡ä»¶ã€‚</p><p>ä½†æ˜¯ hello.lua å¹¶ä¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œéœ€è¦é€šè¿‡ chmod æ¥è®¾ç½®å¯æ‰§è¡Œæƒé™ï¼Œæœ€ç®€å•çš„æ–¹å¼ä¸ºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 hello.lua</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hello.lua</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]<span class="comment"># ./hello.lua</span></span><br><span class="line">Hello World!!!</span><br></pre></td></tr></table></figure><p>è¡¥å……ä¸€ç‚¹ï¼Œå¦‚æœæƒ³åœ¨äº¤äº’å¼ä¸­è¿è¡Œè„šæœ¬å¼çš„ hello.lua ä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª dofile å‡½æ•°ï¼Œå¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dofile</span>(<span class="string">"lua_demo/hello.lua"</span>)</span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]# lua</span><br><span class="line">Lua <span class="number">5.4</span><span class="number">.4</span>  Copyright (C) <span class="number">1994</span><span class="number">-2022</span> Lua.org, PUC-Rio</span><br><span class="line">&gt; <span class="built_in">dofile</span>(<span class="string">"hello.lua"</span>)</span><br><span class="line">Hello World!!!</span><br></pre></td></tr></table></figure><p>::: warning</p><p>åœ¨ Lua è¯­è¨€ä¸­ï¼Œè¿ç»­è¯­å¥ä¹‹é—´çš„åˆ†éš”ç¬¦å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åé¢ä¸éœ€è¦åŠ åˆ†å·ï¼Œå½“ç„¶åŠ ä¸Šä¹Ÿä¸ä¼šæŠ¥é”™ã€‚</p><p>:::</p><p>åœ¨ Lua è¯­è¨€ä¸­ï¼Œè¡¨è¾¾å¼ä¹‹é—´çš„æ¢è¡Œä¹Ÿèµ·ä¸åˆ°ä»»ä½•ä½œç”¨ã€‚å¦‚ä»¥ä¸‹å››ä¸ªå†™æ³•ï¼Œå…¶å®éƒ½æ˜¯ç­‰æ•ˆçš„</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†™æ³•ä¸€ï¼šæ¢è¡Œï¼Œä¸åŠ åˆ†å·</span></span><br><span class="line">a=1</span><br><span class="line">b=a+2</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™æ³•äºŒï¼šæ¢è¡Œï¼ŒåŠ åˆ†å·</span></span><br><span class="line">a=1;</span><br><span class="line">b=a+2;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™æ³•ä¸‰ï¼šä¸æ¢è¡Œï¼ŒåŠ åˆ†å·</span></span><br><span class="line">a=1; b=a+2;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™æ³•å››ï¼šä¸æ¢è¡Œï¼Œä¸åŠ åˆ†å·</span></span><br><span class="line">a=1 b=a+2</span><br></pre></td></tr></table></figure><p>ä¸å»ºè®®ä½¿ç”¨ç¬¬å››ç§æ–¹å¼ï¼Œå¯è¯»æ€§å¤ªå·®ã€‚</p><h2 id="Luaçš„æ³¨é‡Š"><a href="#Luaçš„æ³¨é‡Š" class="headerlink" title="Luaçš„æ³¨é‡Š"></a>Luaçš„æ³¨é‡Š</h2><p>å…³äº Lua æ–‡ä»¶çš„æ³¨é‡Šè¦åˆ†ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯å•è¡Œæ³¨é‡Šï¼Œç¬¬äºŒç§æ˜¯å¤šè¡Œæ³¨é‡Šã€‚</p><p>å•è¡Œæ³¨é‡Šçš„è¯­æ³•ä¸ºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ³¨é‡Šå†…å®¹</span></span><br></pre></td></tr></table></figure><p>å¤šè¡Œæ³¨é‡Šçš„è¯­æ³•ä¸º:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">æ³¨é‡Šå†…å®¹</span></span><br><span class="line"><span class="comment">æ³¨é‡Šå†…å®¹</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/<span class="keyword">local</span>/bin/lua</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Hello World!!!"</span>)</span><br><span class="line"><span class="comment">-- print("HelloWorld")</span></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">print("HelloWorld2")</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³å–æ¶ˆå¤šè¡Œæ³¨é‡Šï¼Œåªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªâ€“ä¹‹å‰åœ¨åŠ ä¸€ä¸ª-å³å¯ï¼Œå¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">---[[</span></span><br><span class="line">æ³¨é‡Šå†…å®¹</span><br><span class="line">æ³¨é‡Šå†…å®¹</span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></table></figure><h2 id="Luaæ ‡è¯†ç¬¦"><a href="#Luaæ ‡è¯†ç¬¦" class="headerlink" title="Luaæ ‡è¯†ç¬¦"></a>Luaæ ‡è¯†ç¬¦</h2><p>æ¢å¥è¯è¯´æ ‡è¯†ç¬¦å°±æ˜¯æˆ‘ä»¬çš„å˜é‡åï¼ŒLua å®šä¹‰å˜é‡åä»¥ä¸€ä¸ªå­—æ¯ A åˆ° Z æˆ– a åˆ° z æˆ–ä¸‹åˆ’çº¿ _ å¼€å¤´ååŠ ä¸Š 0 ä¸ªæˆ–å¤šä¸ªå­—æ¯ï¼Œä¸‹åˆ’çº¿ï¼Œæ•°å­—ï¼ˆ0 åˆ° 9ï¼‰ã€‚è¿™å—å»ºè®®å¤§å®¶æœ€å¥½ä¸è¦ä½¿ç”¨ä¸‹åˆ’çº¿åŠ å¤§å†™å­—æ¯çš„æ ‡è¯†ç¬¦ï¼Œå¦‚ _VERSIONï¼Œå› ä¸º Lua çš„ä¿ç•™å­—ä¹Ÿæ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œå®¹æ˜“å‘ç”Ÿå†²çªã€‚æ³¨æ„ Lua æ˜¯åŒºåˆ†å¤§å°å†™å­—æ¯çš„ã€‚</p><h2 id="Luaå…³é”®å­—"><a href="#Luaå…³é”®å­—" class="headerlink" title="Luaå…³é”®å­—"></a>Luaå…³é”®å­—</h2><p>ä¸‹åˆ—æ˜¯ Lua çš„å…³é”®å­—ï¼Œå¤§å®¶åœ¨å®šä¹‰å¸¸é‡ã€å˜é‡æˆ–å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰æ ‡è¯†ç¬¦éƒ½è¦é¿å…ä½¿ç”¨ä»¥ä¸‹è¿™äº›å…³é”®å­—ï¼š</p><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>and</td><td>break</td><td>do</td><td>else</td></tr><tr><td>elseif</td><td>end</td><td>false</td><td>for</td></tr><tr><td>function</td><td>if</td><td>in</td><td>local</td></tr><tr><td>nil</td><td>not</td><td>or</td><td>repeat</td></tr><tr><td>return</td><td>then</td><td>true</td><td>until</td></tr><tr><td>while</td><td>goto</td><td></td><td></td></tr></tbody></table><p>ä¸€èˆ¬çº¦å®šï¼Œä»¥ä¸‹åˆ’çº¿å¼€å¤´è¿æ¥ä¸€ä¸²å¤§å†™å­—æ¯çš„åå­—ï¼ˆæ¯”å¦‚ _VERSIONï¼‰è¢«ä¿ç•™ç”¨äº Lua å†…éƒ¨å…¨å±€å˜é‡ã€‚è¿™ä¸ªä¹Ÿæ˜¯ä¸Šé¢æˆ‘ä»¬ä¸å»ºè®®è¿™ä¹ˆå®šä¹‰æ ‡è¯†ç¬¦çš„åŸå› ã€‚</p><h2 id="Luaè¿ç®—ç¬¦"><a href="#Luaè¿ç®—ç¬¦" class="headerlink" title="Luaè¿ç®—ç¬¦"></a>Luaè¿ç®—ç¬¦</h2><p>Luaä¸­æ”¯æŒçš„è¿ç®—ç¬¦æœ‰ç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦ã€é€»è¾‘è¿ç®—ç¬¦ã€å…¶ä»–è¿ç®—ç¬¦ã€‚</p><h3 id="ç®—æœ¯è¿ç®—ç¬¦"><a href="#ç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="ç®—æœ¯è¿ç®—ç¬¦"></a>ç®—æœ¯è¿ç®—ç¬¦</h3><table><thead><tr><th>ç¬¦å·</th><th>ä½œç”¨</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>+</td><td>åŠ æ³•</td><td>10 + 20 â€“&gt; 30</td></tr><tr><td>-</td><td>å‡æ³•</td><td>20 - 10 â€“&gt; 10</td></tr><tr><td>*</td><td>ä¹˜æ³•</td><td>10 * 20 â€“&gt; 200</td></tr><tr><td>/</td><td>é™¤æ³•</td><td>20 / 10 â€“&gt; 2</td></tr><tr><td>%</td><td>å–ä½™</td><td>3 % 2 â€“&gt; 1</td></tr><tr><td>^</td><td>ä¹˜å¹‚</td><td>10 ^ 2 â€“&gt; 100</td></tr><tr><td>-</td><td>ç¬¦å·</td><td>-10 â€“&gt; -10</td></tr></tbody></table><h3 id="å…³ç³»è¿ç®—ç¬¦"><a href="#å…³ç³»è¿ç®—ç¬¦" class="headerlink" title="å…³ç³»è¿ç®—ç¬¦"></a>å…³ç³»è¿ç®—ç¬¦</h3><table><thead><tr><th>ç¬¦å·</th><th>ä½œç”¨</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>==</td><td>ç­‰äº</td><td>10 == 10 â€“&gt; true</td></tr><tr><td>~=</td><td>ä¸ç­‰äº</td><td>10 ~= 10 â€“&gt; false</td></tr><tr><td>&gt;</td><td>å¤§äº</td><td>20 &gt; 10 â€“&gt; true</td></tr><tr><td>&lt;</td><td>å°äº</td><td>20 &lt; 10 â€“&gt; false</td></tr><tr><td>&gt;=</td><td>å¤§äºç­‰äº</td><td>20 &gt;= 10 â€“&gt; true</td></tr><tr><td>&lt;=</td><td>å°äºç­‰äº</td><td>20 &lt;= 10 â€“&gt; false</td></tr></tbody></table><h3 id="é€»è¾‘è¿ç®—ç¬¦"><a href="#é€»è¾‘è¿ç®—ç¬¦" class="headerlink" title="é€»è¾‘è¿ç®—ç¬¦"></a>é€»è¾‘è¿ç®—ç¬¦</h3><table><thead><tr><th>ç¬¦å·</th><th>ä½œç”¨</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>and</td><td>é€»è¾‘ä¸</td><td>A and Bï¼ˆç­‰ä»·äº Java çš„ a &amp;&amp; bï¼‰</td></tr><tr><td>or</td><td>é€»è¾‘æˆ–</td><td>A or Bï¼ˆç­‰ä»·äº Java çš„ a || bï¼‰</td></tr><tr><td>not</td><td>é€»è¾‘é</td><td>not Aï¼ˆå–åï¼Œå¦‚æœ A ä¸º trueï¼Œåˆ™è¿”å› falseï¼‰</td></tr></tbody></table><p>é€»è¾‘è¿ç®—ç¬¦å¯ä»¥ä½œä¸º if çš„åˆ¤æ–­æ¡ä»¶ï¼Œè¿”å›çš„ç»“æœå¦‚ä¸‹:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">A = <span class="literal">true</span></span><br><span class="line">B = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">A <span class="keyword">and</span> B    <span class="comment">--&gt; true</span></span><br><span class="line">A <span class="keyword">or</span>  B     <span class="comment">--&gt; true</span></span><br><span class="line"><span class="keyword">not</span> A     <span class="comment">--&gt; false</span></span><br><span class="line"></span><br><span class="line">A = <span class="literal">true</span></span><br><span class="line">B = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">A <span class="keyword">and</span> B   <span class="comment">--&gt; false</span></span><br><span class="line">A <span class="keyword">or</span>  B    <span class="comment">--&gt; true</span></span><br><span class="line"><span class="keyword">not</span> A    <span class="comment">--&gt; false</span></span><br><span class="line"></span><br><span class="line">A = <span class="literal">false</span></span><br><span class="line">B = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">A <span class="keyword">and</span> B   <span class="comment">--&gt; false</span></span><br><span class="line">A <span class="keyword">or</span>  B    <span class="comment">--&gt; true</span></span><br><span class="line"><span class="keyword">not</span> A    <span class="comment">--&gt; true</span></span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–è¿ç®—ç¬¦"><a href="#å…¶ä»–è¿ç®—ç¬¦" class="headerlink" title="å…¶ä»–è¿ç®—ç¬¦"></a>å…¶ä»–è¿ç®—ç¬¦</h3><table><thead><tr><th>ç¬¦å·</th><th>ä½œç”¨</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>..</td><td>è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²</td><td>â€œHELLO â€œ..â€WORLDâ€ â€“&gt; HELLO WORLD</td></tr><tr><td>#</td><td>ä¸€å…ƒé¢„ç®—æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²æˆ–è¡¨çš„é•¿åº¦</td><td>#â€HELLOâ€ â€“&gt; 5</td></tr></tbody></table><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]# lua</span><br><span class="line">Lua <span class="number">5.4</span><span class="number">.4</span>  Copyright (C) <span class="number">1994</span><span class="number">-2022</span> Lua.org, PUC-Rio</span><br><span class="line">&gt; <span class="string">"Hello"</span>..<span class="string">"World"</span></span><br><span class="line">HelloWorld</span><br><span class="line">&gt; #<span class="string">"HelloWorld"</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><h2 id="Luaå…¨å±€å˜é‡-amp-å±€éƒ¨å˜é‡"><a href="#Luaå…¨å±€å˜é‡-amp-å±€éƒ¨å˜é‡" class="headerlink" title="Luaå…¨å±€å˜é‡&amp;å±€éƒ¨å˜é‡"></a>Luaå…¨å±€å˜é‡&amp;å±€éƒ¨å˜é‡</h2><p>åœ¨ Lua è¯­è¨€ä¸­ï¼Œå…¨å±€å˜é‡æ— é¡»å£°æ˜å³å¯ä½¿ç”¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ€»æ˜¯è®¤ä¸ºæ˜¯å…¨å±€çš„ï¼Œå¦‚æœæœªæå‰èµ‹å€¼ï¼Œé»˜è®¤ä¸º nil:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]# lua</span><br><span class="line">Lua <span class="number">5.4</span><span class="number">.4</span>  Copyright (C) <span class="number">1994</span><span class="number">-2022</span> Lua.org, PUC-Rio</span><br><span class="line">&gt; <span class="built_in">print</span>(b)</span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">&gt; b=<span class="number">100</span></span><br><span class="line">&gt; <span class="built_in">print</span>(b)</span><br><span class="line"><span class="number">100</span></span><br><span class="line">&gt; b=<span class="literal">nil</span></span><br><span class="line">&gt; <span class="built_in">print</span>(b)</span><br><span class="line"><span class="literal">nil</span></span><br></pre></td></tr></table></figure><p>è¦æƒ³å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œéœ€è¦ä½¿ç”¨ local æ¥å£°æ˜</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]# lua</span><br><span class="line">Lua <span class="number">5.4</span><span class="number">.4</span>  Copyright (C) <span class="number">1994</span><span class="number">-2022</span> Lua.org, PUC-Rio</span><br><span class="line">&gt; <span class="keyword">local</span> a=<span class="number">100</span></span><br><span class="line">&gt; <span class="built_in">print</span>(a)</span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">&gt; <span class="keyword">local</span> a=<span class="number">100</span> <span class="built_in">print</span>(a)</span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œç»ˆç«¯äº¤äº’å¼çš„ local å£°æ˜çš„å˜é‡åœ¨åŒä¸€è¡Œä½¿ç”¨ï¼Œæ¢è¡Œäº†åˆ™ç¦»å¼€äº†è¯¥å˜é‡çš„ä½œç”¨åŸŸã€‚å¦‚æœä½¿ç”¨äº† function ä¹‹ç±»çš„ç»“æ„æˆ–è€…åœ¨æ–‡ä»¶é‡Œä½¿ç”¨ localï¼Œåˆ™å¯ä»¥æ¢è¡Œï¼Œå…·ä½“å¾€ä¸‹çœ‹ã€‚</p><h2 id="Luaæ•°æ®ç±»å‹"><a href="#Luaæ•°æ®ç±»å‹" class="headerlink" title="Luaæ•°æ®ç±»å‹"></a>Luaæ•°æ®ç±»å‹</h2><p>Lua æœ‰ 8 ä¸ªæ•°æ®ç±»å‹</p><table><thead><tr><th>æ•°æ®ç±»å‹å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>nil</td><td>ç©ºï¼Œæ— æ•ˆå€¼</td></tr><tr><td>boolean</td><td>å¸ƒå°”ï¼Œtrue | false</td></tr><tr><td>number</td><td>æ•°å€¼</td></tr><tr><td>string</td><td>å­—ç¬¦ä¸²</td></tr><tr><td>function</td><td>å‡½æ•°</td></tr><tr><td>table</td><td>è¡¨</td></tr><tr><td>thread</td><td>çº¿ç¨‹</td></tr><tr><td>userdata</td><td>ç”¨æˆ·æ•°æ®</td></tr></tbody></table><p>å¯ä»¥ä½¿ç”¨ type å‡½æ•°æµ‹è¯•ç»™å®šå˜é‡æˆ–è€…çš„ç±»å‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="literal">nil</span>))<span class="comment">--&gt; nil</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="literal">true</span>))               <span class="comment">--&gt; boolean</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">1.1</span>*<span class="number">1.1</span>))            <span class="comment">--&gt; number</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="string">"Hello world"</span>))      <span class="comment">--&gt; string</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">io</span>.<span class="built_in">stdin</span>))<span class="comment">--&gt; userdata</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">print</span>))              <span class="comment">--&gt; function</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">type</span>))               <span class="comment">--&gt; function</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>&#123;&#125;)<span class="comment">--&gt; table</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">type</span>(X)))            <span class="comment">--&gt; string</span></span><br></pre></td></tr></table></figure><h3 id="nil"><a href="#nil" class="headerlink" title="nil"></a>nil</h3><p>nil æ˜¯ä¸€ç§åªæœ‰ä¸€ä¸ª nil å€¼çš„ç±»å‹ï¼Œå®ƒçš„ä½œç”¨å¯ä»¥ç”¨æ¥ä¸å…¶ä»–æ‰€æœ‰å€¼è¿›è¡ŒåŒºåˆ†ã€‚å½“æƒ³è¦ç§»é™¤ä¸€ä¸ªå˜é‡æ—¶ï¼Œåªéœ€è¦å°†è¯¥å˜é‡åèµ‹å€¼ä¸º nilï¼Œåƒåœ¾å›æ”¶å°±ä¼šä¼šé‡Šæ”¾è¯¥å˜é‡æ‰€å ç”¨çš„å†…å­˜ã€‚</p><h3 id="boolean"><a href="#boolean" class="headerlink" title="boolean"></a>boolean</h3><p>boolean ç±»å‹å…·æœ‰ä¸¤ä¸ªå€¼ï¼Œtrue å’Œ falseã€‚boolean ç±»å‹ä¸€èˆ¬è¢«ç”¨æ¥åšæ¡ä»¶åˆ¤æ–­çš„çœŸä¸å‡ã€‚åœ¨ Lua è¯­è¨€ä¸­ï¼Œåªä¼šå°† false å’Œ nil è§†ä¸ºå‡ï¼Œå…¶ä»–çš„éƒ½è§†ä¸ºçœŸï¼Œ<strong>ç‰¹åˆ«æ˜¯åœ¨æ¡ä»¶æ£€æµ‹ä¸­ 0 å’Œç©ºå­—ç¬¦ä¸²éƒ½ä¼šè®¤ä¸ºæ˜¯çœŸ</strong>ï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„å¤§å¤šæ•°è¯­è¨€ä¸å¤ªä¸€æ ·ã€‚</p><h3 id="number"><a href="#number" class="headerlink" title="number"></a>number</h3><p>åœ¨ Lua5.3 ç‰ˆæœ¬å¼€å§‹ï¼ŒLua è¯­è¨€ä¸ºæ•°å€¼æ ¼å¼æä¾›äº†ä¸¤ç§é€‰æ‹© integerï¼ˆæ•´å‹ï¼‰å’Œ floatï¼ˆåŒç²¾åº¦æµ®ç‚¹å‹ï¼‰ï¼Œå’Œå…¶ä»–è¯­è¨€ä¸å¤ªä¸€æ ·ï¼Œfloat ä¸ä»£è¡¨å•ç²¾åº¦ç±»å‹ã€‚</p><p>æ•°å€¼å¸¸é‡çš„è¡¨ç¤ºæ–¹å¼ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span><span class="comment">--&gt; 4</span></span><br><span class="line"><span class="number">0.4</span><span class="comment">--&gt; 0.4</span></span><br><span class="line"><span class="number">4.75e-3</span><span class="comment">--&gt; 0.00475</span></span><br><span class="line"><span class="number">4.75e3</span><span class="comment">--&gt; 4750.0</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]# lua</span><br><span class="line">Lua <span class="number">5.4</span><span class="number">.4</span>  Copyright (C) <span class="number">1994</span><span class="number">-2022</span> Lua.org, PUC-Rio</span><br><span class="line">&gt; <span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">&gt; <span class="number">0.4</span></span><br><span class="line"><span class="number">0.4</span></span><br><span class="line">&gt; <span class="number">4.75e-3</span></span><br><span class="line"><span class="number">0.00475</span></span><br><span class="line">&gt; <span class="number">4.75e3</span></span><br><span class="line"><span class="number">4750.0</span></span><br></pre></td></tr></table></figure><p>ä¸ç®¡æ˜¯æ•´å‹è¿˜æ˜¯åŒç²¾åº¦æµ®ç‚¹å‹ï¼Œä½¿ç”¨ type() å‡½æ•°æ¥å–å…¶ç±»å‹ï¼Œéƒ½ä¼šè¿”å›çš„æ˜¯ number</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>(<span class="number">3</span>)<span class="comment">--&gt; number</span></span><br><span class="line"><span class="built_in">type</span>(<span class="number">3.3</span>)<span class="comment">--&gt; number</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]# lua</span><br><span class="line">Lua <span class="number">5.4</span><span class="number">.4</span>  Copyright (C) <span class="number">1994</span><span class="number">-2022</span> Lua.org, PUC-Rio</span><br><span class="line">&gt; <span class="built_in">type</span>(<span class="number">3</span>)</span><br><span class="line">number</span><br><span class="line">&gt; <span class="built_in">type</span>(<span class="number">3.3</span>)</span><br><span class="line">number</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å®ƒä»¬ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ï¼ŒåŒæ—¶ï¼Œå…·æœ‰ç›¸åŒç®—æœ¯å€¼çš„æ•´å‹å€¼å’Œæµ®ç‚¹å‹å€¼åœ¨ Lua è¯­è¨€ä¸­æ˜¯ç›¸ç­‰çš„</p><h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><p>Lua è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å³å¯ä»¥è¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€æ•´æœ¬ä¹¦ç±ã€‚åœ¨ Lua è¯­è¨€ä¸­ï¼Œæ“ä½œ 100K æˆ–è€… 1M ä¸ªå­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²çš„ç¨‹åºå¾ˆå¸¸è§ã€‚</p><p>å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·æ¥å£°æ˜å­—ç¬¦ä¸²</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">"hello"</span></span><br><span class="line">b = <span class="string">'world'</span></span><br><span class="line"><span class="built_in">print</span>(a)<span class="comment">--&gt; hello</span></span><br><span class="line"><span class="built_in">print</span>(b) <span class="comment">--&gt; world</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]# lua</span><br><span class="line">Lua <span class="number">5.4</span><span class="number">.4</span>  Copyright (C) <span class="number">1994</span><span class="number">-2022</span> Lua.org, PUC-Rio</span><br><span class="line">&gt; a = <span class="string">"Hello"</span></span><br><span class="line">&gt; b = <span class="string">"World"</span></span><br><span class="line">&gt; <span class="built_in">print</span>(a)</span><br><span class="line">Hello</span><br><span class="line">&gt; <span class="built_in">print</span>(b)</span><br><span class="line">World</span><br></pre></td></tr></table></figure><p>å¦‚æœå£°æ˜çš„å­—ç¬¦ä¸²æ¯”è¾ƒé•¿æˆ–è€…æœ‰å¤šè¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œå£°æ˜</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">html = <span class="string">[[</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;Lua-string&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;a href="http://www.lua.org"&gt;Lua&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">]]</span></span><br></pre></td></tr></table></figure><h3 id="table"><a href="#table" class="headerlink" title="table"></a>table</h3><p>table æ˜¯ Lua è¯­è¨€ä¸­æœ€ä¸»è¦å’Œå¼ºå¤§çš„æ•°æ®ç»“æ„ã€‚ä½¿ç”¨ table è¡¨æ—¶ï¼ŒLua è¯­è¨€å¯ä»¥ä»¥ä¸€ç§ç®€å•ã€ç»Ÿä¸€ä¸”é«˜æ•ˆçš„æ–¹å¼è¡¨ç¤ºæ•°ç»„ã€é›†åˆã€è®°å½•å’Œå…¶ä»–å¾ˆå¤šæ•°æ®ç»“æ„ã€‚Lua è¯­è¨€ä¸­çš„è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è¾…åŠ©æ•°ç»„ã€‚è¿™ç§æ•°ç»„æ¯” Java ä¸­çš„æ•°ç»„æ›´åŠ çµæ´»ï¼Œå¯ä»¥ä½¿ç”¨æ•°å€¼åšç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æˆ–å…¶ä»–ä»»æ„ç±»å‹çš„å€¼ä½œç´¢å¼•ï¼ˆé™¤ nil å¤–ï¼‰ã€‚</p><p>åˆ›å»ºè¡¨çš„æœ€ç®€å•æ–¹å¼ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºæ•°ç»„æ–¹å¼ä¸€</strong></p><p>æˆ‘ä»¬éƒ½çŸ¥é“æ•°ç»„å°±æ˜¯ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ æŒ‰ç…§ä¸€å®šé¡ºåºæ’åˆ—çš„é›†åˆï¼Œé‚£ä¹ˆä½¿ç”¨ table å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ•°ç»„å‘¢ï¼Ÿ</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr = &#123;<span class="string">"TOM"</span>,<span class="string">"JERRY"</span>,<span class="string">"ROSE"</span>&#125;</span><br></pre></td></tr></table></figure><p>è¦æƒ³è·å–æ•°ç»„ä¸­çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å†…å®¹æ¥è·å–ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(arr[<span class="number">0</span>])<span class="comment">-- nil</span></span><br><span class="line"><span class="built_in">print</span>(arr[<span class="number">1</span>])<span class="comment">-- TOM</span></span><br><span class="line"><span class="built_in">print</span>(arr[<span class="number">2</span>])<span class="comment">-- JERRY</span></span><br><span class="line"><span class="built_in">print</span>(arr[<span class="number">3</span>])<span class="comment">-- ROSE</span></span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼Œ<strong>æ•°ç»„çš„ä¸‹æ ‡é»˜è®¤æ˜¯ä» 1 å¼€å§‹çš„</strong>ã€‚</p><p><strong>åˆ›å»ºæ•°ç»„æ–¹å¼äºŒ</strong></p><p>ä¸Šè¿°åˆ›å»ºæ•°ç»„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥åˆ›å»ºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr = &#123;&#125;</span><br><span class="line">arr[<span class="number">1</span>] = <span class="string">"TOM"</span></span><br><span class="line">arr[<span class="number">2</span>] = <span class="string">"JERRY"</span></span><br><span class="line">arr[<span class="number">3</span>] = <span class="string">"ROSE"</span></span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºæ•°ç»„æ–¹å¼ä¸‰</strong></p><p>è¡¨çš„ç´¢å¼•å³å¯ä»¥æ˜¯æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç­‰å…¶ä»–çš„å†…å®¹ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å°†ç´¢å¼•æ›´æ”¹ä¸ºå­—ç¬¦ä¸²æ¥åˆ›å»ºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr = &#123;&#125;</span><br><span class="line">arr[<span class="string">"X"</span>] = <span class="number">10</span></span><br><span class="line">arr[<span class="string">"Y"</span>] = <span class="number">20</span></span><br><span class="line">arr[<span class="string">"Z"</span>] = <span class="number">30</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå¦‚æœæƒ³è¦è·å–è¿™äº›æ•°ç»„ä¸­çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ–¹å¼ä¸€</span></span><br><span class="line"><span class="built_in">print</span>(arr[<span class="string">"X"</span>])</span><br><span class="line"><span class="built_in">print</span>(arr[<span class="string">"Y"</span>])</span><br><span class="line"><span class="built_in">print</span>(arr[<span class="string">"Z"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹å¼äºŒ</span></span><br><span class="line"><span class="built_in">print</span>(arr.X)</span><br><span class="line"><span class="built_in">print</span>(arr.Y)</span><br><span class="line"><span class="built_in">print</span>(arr.Z)</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºæ•°ç»„æ–¹å¼å››</strong></p><p>å½“å‰ table çš„çµæ´»ä¸ä»…äºæ­¤ï¼Œè¿˜æœ‰æ›´çµæ´»çš„å£°æ˜æ–¹å¼ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr = &#123;<span class="string">"TOM"</span>,X=<span class="number">10</span>,<span class="string">"JERRY"</span>,Y=<span class="number">20</span>,<span class="string">"ROSE"</span>,Z=<span class="number">30</span>&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•è·å–ä¸Šé¢çš„å€¼ï¼Ÿ</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arr[<span class="number">1</span>]       <span class="comment">-- TOM</span></span><br><span class="line">arr[<span class="string">"X"</span>] <span class="comment">-- 10</span></span><br><span class="line">arr.X    <span class="comment">-- 10</span></span><br><span class="line">arr[<span class="number">2</span>] <span class="comment">-- JERRY</span></span><br><span class="line">arr[<span class="string">"Y"</span>] <span class="comment">-- 20</span></span><br><span class="line">arr.Y <span class="comment">--20</span></span><br><span class="line">arr[<span class="number">3</span>] <span class="comment">-- ROSE</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]# lua</span><br><span class="line">Lua <span class="number">5.4</span><span class="number">.4</span>  Copyright (C) <span class="number">1994</span><span class="number">-2022</span> Lua.org, PUC-Rio</span><br><span class="line">&gt; arr = &#123;<span class="string">"TOM"</span>,X=<span class="number">10</span>,<span class="string">"JERRY"</span>,Y=<span class="number">20</span>,<span class="string">"ROSE"</span>,Z=<span class="number">30</span>&#125;</span><br><span class="line">&gt; arr[<span class="number">0</span>]</span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">&gt; arr[<span class="number">1</span>]</span><br><span class="line">TOM</span><br><span class="line">&gt; arr[<span class="number">2</span>]</span><br><span class="line">JERRY</span><br><span class="line">&gt; arr[<span class="number">3</span>]</span><br><span class="line">ROSE</span><br><span class="line">&gt; arr[<span class="string">"X"</span>]</span><br><span class="line"><span class="number">10</span></span><br><span class="line">&gt; arr[<span class="string">"Y"</span>]</span><br><span class="line"><span class="number">20</span></span><br><span class="line">&gt; arr[<span class="string">"Z"</span>]</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure><h3 id="function"><a href="#function" class="headerlink" title="function"></a>function</h3><p>åœ¨ Lua è¯­è¨€ä¸­ï¼Œå‡½æ•°ï¼ˆFunctionï¼‰æ˜¯å¯¹è¯­å¥å’Œè¡¨è¾¾å¼è¿›è¡ŒæŠ½è±¡çš„ä¸»è¦æ–¹å¼ã€‚</p><p>å®šä¹‰å‡½æ•°çš„è¯­æ³•ä¸ºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">functionName</span><span class="params">(params)</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¸ªæ•°ä¸å®šä¹‰å‡½æ•°æ—¶ä½¿ç”¨çš„å‚æ•°ä¸ªæ•°ä¸ä¸€è‡´çš„æ—¶å€™ï¼ŒLua è¯­è¨€ä¼šé€šè¿‡æŠ›å¼ƒå¤šä½™å‚æ•°å’Œå°†ä¸è¶³çš„å‚æ•°è®¾ä¸º nil çš„æ–¹å¼æ¥è°ƒæ•´å‚æ•°çš„ä¸ªæ•°ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">f</span><span class="params">(a,b)</span></span></span><br><span class="line">    <span class="built_in">print</span>(a,b)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è°ƒç”¨å‡½æ•°</span></span><br><span class="line">f()<span class="comment">--&gt; nil  nil</span></span><br><span class="line">f(<span class="number">2</span>)<span class="comment">--&gt; 2 nil</span></span><br><span class="line">f(<span class="number">2</span>,<span class="number">6</span>)<span class="comment">--&gt; 2 6</span></span><br><span class="line">f(<span class="number">2.6</span><span class="number">.8</span>)<span class="comment">--&gt; 2 6 (8 è¢«ä¸¢å¼ƒ)</span></span><br></pre></td></tr></table></figure><p>å¯å˜é•¿å‚æ•°å‡½æ•°</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(...)</span></span></span><br><span class="line">    a,b,c=...    <span class="comment">-- æŒ‰é¡ºåºä»¤ a,b,c ç­‰äºå¤šä¸ªå‚æ•°çš„å‰ä¸‰ä¸ª</span></span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="built_in">print</span>(b)</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è°ƒç”¨å‡½æ•°</span></span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)  <span class="comment">--&gt; 1 2 3</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@master lua_demo]# lua</span><br><span class="line">Lua <span class="number">5.4</span><span class="number">.4</span>  Copyright (C) <span class="number">1994</span><span class="number">-2022</span> Lua.org, PUC-Rio</span><br><span class="line">&gt; <span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">(a,b)</span></span></span><br><span class="line">&gt;&gt; <span class="keyword">return</span> a,b</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line">&gt; x,y = f(<span class="number">11</span>,<span class="number">12</span>)</span><br><span class="line">&gt; <span class="built_in">print</span>(x,y)</span><br><span class="line"><span class="number">11</span>      <span class="number">12</span></span><br><span class="line">&gt; <span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(...)</span></span></span><br><span class="line">&gt;&gt; a,b,c=...</span><br><span class="line">&gt;&gt; <span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; <span class="built_in">print</span>(b)</span><br><span class="line">&gt;&gt; <span class="built_in">print</span>(c)</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line">&gt; add(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><p>å‡½æ•°è¿”å›å€¼å¯ä»¥æœ‰å¤šä¸ªï¼Œè¿™ç‚¹å’Œ Java ä¸å¤ªä¸€æ ·</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">(a,b)</span></span></span><br><span class="line">    <span class="keyword">return</span> a,b</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è°ƒç”¨å‡½æ•°</span></span><br><span class="line">x,y = f(<span class="number">11</span>,<span class="number">22</span>)<span class="comment">--&gt; x=11,y=22</span></span><br></pre></td></tr></table></figure><h3 id="thread"><a href="#thread" class="headerlink" title="thread"></a>thread</h3><p>thread ç¿»è¯‘è¿‡æ¥æ˜¯çº¿ç¨‹çš„æ„æ€ï¼Œåœ¨ Lua ä¸­ï¼Œthread ç”¨æ¥è¡¨ç¤ºæ‰§è¡Œçš„ç‹¬ç«‹çº¿è·¯ï¼Œç”¨æ¥æ‰§è¡ŒååŒç¨‹åºã€‚</p><h3 id="userdata"><a href="#userdata" class="headerlink" title="userdata"></a>userdata</h3><p>userdata æ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œç”¨äºè¡¨ç¤ºä¸€ç§ç”±åº”ç”¨ç¨‹åºæˆ– C/C++ è¯­è¨€åº“æ‰€åˆ›å»ºçš„ç±»å‹ã€‚</p><h2 id="Luaæ§åˆ¶ç»“æ„"><a href="#Luaæ§åˆ¶ç»“æ„" class="headerlink" title="Luaæ§åˆ¶ç»“æ„"></a>Luaæ§åˆ¶ç»“æ„</h2><p>Lua è¯­è¨€æä¾›äº†ä¸€ç»„ç²¾ç®€ä¸”å¸¸ç”¨çš„æ§åˆ¶ç»“æ„ï¼ŒåŒ…æ‹¬ç”¨äºæ¡ä»¶æ‰§è¡Œçš„è¯ ä»¥åŠç”¨äºå¾ªç¯çš„ whileã€repeat å’Œ forã€‚æ‰€æœ‰çš„æ§åˆ¶ç»“æ„è¯­æ³•ä¸Šéƒ½æœ‰ä¸€ä¸ªæ˜¾å¼çš„ç»ˆç»“ç¬¦ï¼šend ç”¨äºç»ˆç»“ ifã€for åŠ while ç»“æ„ï¼Œuntil ç”¨äºç»ˆç»“ repeat ç»“æ„ã€‚</p><h3 id="ifåˆ¤æ–­"><a href="#ifåˆ¤æ–­" class="headerlink" title="ifåˆ¤æ–­"></a>ifåˆ¤æ–­</h3><p>if è¯­å¥å…ˆæµ‹è¯•å…¶æ¡ä»¶ï¼Œå¹¶æ ¹æ®æ¡ä»¶æ˜¯å¦æ»¡è¶³æ‰§è¡Œç›¸åº”çš„ then éƒ¨åˆ†æˆ– else éƒ¨åˆ†ã€‚else éƒ¨åˆ†æ˜¯å¯é€‰çš„ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testif</span><span class="params">(a)</span></span></span><br><span class="line">    <span class="keyword">if</span> a &gt; <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"aæ˜¯æ­£æ•°"</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testif</span><span class="params">(a)</span></span></span><br><span class="line">    <span class="keyword">if</span> a &gt; <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"aæ˜¯æ­£æ•°"</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"aæ˜¯è´Ÿæ•°"</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè¦ç¼–å†™åµŒå¥—çš„ if è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨ elseifã€‚ å®ƒç±»ä¼¼äºåœ¨ else åé¢ç´§è·Ÿä¸€ä¸ªifã€‚æ ¹æ®ä¼ å…¥çš„å¹´é¾„è¿”å›ä¸åŒçš„ç»“æœï¼Œå¦‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(age)</span></span></span><br><span class="line">    <span class="keyword">if</span> age&lt;=<span class="number">18</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"é’å°‘å¹´"</span></span><br><span class="line">    <span class="keyword">elseif</span> age&gt;<span class="number">18</span> <span class="keyword">and</span> age&lt;=<span class="number">45</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"é’å¹´"</span></span><br><span class="line">    <span class="keyword">elseif</span> age&gt;<span class="number">45</span> <span class="keyword">and</span> age&lt;=<span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ä¸­å¹´äºº"</span></span><br><span class="line">    <span class="keyword">elseif</span> age&gt;<span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"è€å¹´äºº"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(age)</span></span></span><br><span class="line">&gt;&gt;      <span class="keyword">if</span> age&lt;=<span class="number">18</span> <span class="keyword">then</span></span><br><span class="line">&gt;&gt;              <span class="keyword">return</span> <span class="string">"é’å°‘å¹´"</span></span><br><span class="line">&gt;&gt;      <span class="keyword">elseif</span> age&gt;<span class="number">18</span> <span class="keyword">and</span> age&lt;=<span class="number">45</span> <span class="keyword">then</span></span><br><span class="line">&gt;&gt;              <span class="keyword">return</span> <span class="string">"é’å¹´"</span></span><br><span class="line">&gt;&gt;      <span class="keyword">elseif</span> age&gt;<span class="number">45</span> <span class="keyword">and</span> age&lt;=<span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">&gt;&gt;              <span class="keyword">return</span> <span class="string">"ä¸­å¹´äºº"</span></span><br><span class="line">&gt;&gt;      <span class="keyword">elseif</span> age&gt;<span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">&gt;&gt;              <span class="keyword">return</span> <span class="string">"è€å¹´äºº"</span></span><br><span class="line">&gt;&gt;      <span class="keyword">end</span></span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line">&gt; show(<span class="number">59</span>)</span><br><span class="line">ä¸­å¹´äºº</span><br></pre></td></tr></table></figure><h3 id="whileå¾ªç¯"><a href="#whileå¾ªç¯" class="headerlink" title="whileå¾ªç¯"></a>whileå¾ªç¯</h3><p>é¡¾åæ€ä¹‰ï¼Œå½“æ¡ä»¶ä¸ºçœŸæ—¶ while å¾ªç¯ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ã€‚Lua è¯­è¨€å…ˆæµ‹è¯• while è¯­å¥çš„æ¡ä»¶ï¼Œè‹¥æ¡ä»¶ä¸ºå‡åˆ™å¾ªç¯ç»“æŸï¼›å¦åˆ™ï¼ŒLua ä¼šæ‰§è¡Œå¾ªç¯ä½“å¹¶ä¸æ–­åœ°é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> æ¡ä»¶ <span class="keyword">do</span></span><br><span class="line">å¾ªç¯ä½“</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼šå®ç°æ•°ç»„çš„å¾ªç¯</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testWhile</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= <span class="number">10</span> <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="function"><span class="keyword">function</span> <span class="title">testwhile</span><span class="params">()</span></span></span><br><span class="line">&gt;&gt;      <span class="keyword">local</span> i=<span class="number">1</span></span><br><span class="line">&gt;&gt;      <span class="keyword">while</span> i&lt;=<span class="number">10</span> <span class="keyword">do</span></span><br><span class="line">&gt;&gt;              <span class="built_in">print</span>(i)</span><br><span class="line">&gt;&gt;              i=i+<span class="number">1</span></span><br><span class="line">&gt;&gt;      <span class="keyword">end</span></span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line">&gt; testwhile()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><h3 id="repeatå¾ªç¯"><a href="#repeatå¾ªç¯" class="headerlink" title="repeatå¾ªç¯"></a>repeatå¾ªç¯</h3><p>é¡¾åæ€ä¹‰ï¼Œ repeat-until è¯­å¥ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ç›´åˆ°æ¡ä»¶ä¸ºçœŸæ—¶ç»“æŸã€‚ç”±äºæ¡ä»¶æµ‹è¯•åœ¨å¾ªç¯ä½“ä¹‹åæ‰§è¡Œï¼Œæ‰€ä»¥å¾ªç¯ä½“è‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">repeat</span></span><br><span class="line">å¾ªç¯ä½“</span><br><span class="line"><span class="keyword">until</span> æ¡ä»¶</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testRepeat</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> i = <span class="number">10</span></span><br><span class="line">    <span class="keyword">repeat</span></span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        i = i - <span class="number">1</span></span><br><span class="line">    <span class="keyword">until</span> i &lt; <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="function"><span class="keyword">function</span> <span class="title">testRepeat</span><span class="params">()</span></span></span><br><span class="line">&gt;&gt;      <span class="keyword">local</span> i=<span class="number">10</span></span><br><span class="line">&gt;&gt;      <span class="keyword">repeat</span></span><br><span class="line">&gt;&gt;              <span class="built_in">print</span>(i)</span><br><span class="line">&gt;&gt;              i=i<span class="number">-1</span></span><br><span class="line">&gt;&gt;      <span class="keyword">until</span> i&lt;<span class="number">1</span></span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line">&gt; testRepeat(<span class="number">10</span>)</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="forå¾ªç¯"><a href="#forå¾ªç¯" class="headerlink" title="forå¾ªç¯"></a>forå¾ªç¯</h3><p><strong>æ•°å€¼å‹ for å¾ªç¯</strong></p><p>è¯­æ³•:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> param = exp1,exp2,exp3 <span class="keyword">do</span></span><br><span class="line">å¾ªç¯ä½“</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>param çš„å€¼ä» exp1 å˜åŒ–åˆ° exp2 ä¹‹å‰çš„æ¯æ¬¡å¾ªç¯ä¼šæ‰§è¡Œå¾ªç¯ä½“ï¼Œå¹¶åœ¨æ¯æ¬¡å¾ªç¯ç»“æŸåå°†æ­¥é•¿ï¼ˆstepï¼‰exp3 èµ‹å€¼ç»™åˆ° param ä¸Šã€‚exp3 å¯é€‰ï¼Œå¦‚æœä¸è®¾ç½®é»˜è®¤ä¸º 1ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>,<span class="number">100</span>,<span class="number">10</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">100</span>,<span class="number">10</span> <span class="keyword">do</span></span><br><span class="line">&gt;&gt;      <span class="built_in">print</span>(i)</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">21</span></span><br><span class="line"><span class="number">31</span></span><br><span class="line"><span class="number">41</span></span><br><span class="line"><span class="number">51</span></span><br><span class="line"><span class="number">61</span></span><br><span class="line"><span class="number">71</span></span><br><span class="line"><span class="number">81</span></span><br><span class="line"><span class="number">91</span></span><br></pre></td></tr></table></figure><p><strong>æ³›å‹ for å¾ªç¯</strong></p><p>æ³›å‹ for å¾ªç¯é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°æ¥éå†æ‰€æœ‰å€¼ï¼Œç±»ä¼¼äº Java ä¸­çš„ foreach è¯­å¥ã€‚</p><p>è¯­æ³•ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(x) <span class="keyword">do</span></span><br><span class="line">å¾ªç¯ä½“</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>i æ˜¯æ•°ç»„ç´¢å¼•å€¼ï¼Œv æ˜¯å¯¹åº”ç´¢å¼•çš„æ•°ç»„å…ƒç´ å€¼ï¼Œipairs æ˜¯ Lua æä¾›çš„ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°ï¼Œç”¨æ¥è¿­ä»£æ•°ç»„ï¼Œx æ˜¯è¦éå†çš„æ•°ç»„ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr = &#123;<span class="string">"TOME"</span>,<span class="string">"JERRY"</span>,<span class="string">"ROWS"</span>,<span class="string">"LUCY"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i,v)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; arr =&#123;<span class="string">"TOM"</span>,<span class="string">"JERRY"</span>,<span class="string">"ROWS"</span>,<span class="string">"LUCY"</span>&#125;</span><br><span class="line">&gt; <span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">&gt;&gt;      <span class="built_in">print</span>(i,v)</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line"><span class="number">1</span>       TOM</span><br><span class="line"><span class="number">2</span>       JERRY</span><br><span class="line"><span class="number">3</span>       ROWS</span><br><span class="line"><span class="number">4</span>       LUCY</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœå°† arr çš„å€¼è¿›è¡Œä¿®æ”¹ä¸ºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr = &#123;<span class="string">"TOME"</span>,<span class="string">"JERRY"</span>,<span class="string">"ROWS"</span>,x=<span class="string">"JACK"</span>,<span class="string">"LUCY"</span>&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±åªèƒ½çœ‹åˆ°å’Œä¹‹å‰ä¸€æ ·çš„ç»“æœï¼Œè€Œå…¶ä¸­çš„ x ä¸º JACK å°±æ— æ³•éå†å‡ºæ¥ï¼Œç¼ºå¤±äº†æ•°æ®ï¼Œå¦‚æœè§£å†³å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥å°†è¿­ä»£å™¨å‡½æ•°ç”± <code>ipairs</code> å˜æˆ <code>pairs</code>ï¼Œå¦‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; arr = &#123;<span class="string">"TOM"</span>,<span class="string">"JERRY"</span>,<span class="string">"ROWS"</span>,x=<span class="string">"JACK"</span>,<span class="string">"LUCY"</span>&#125;</span><br><span class="line">&gt; <span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">pairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">&gt;&gt;      <span class="built_in">print</span>(i,v)</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line"><span class="number">1</span>       TOM</span><br><span class="line"><span class="number">2</span>       JERRY</span><br><span class="line"><span class="number">3</span>       ROWS</span><br><span class="line"><span class="number">4</span>       LUCY</span><br><span class="line">x       JACK</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å¸¸é‡åˆå§‹åŒ–ç›¸å…³é—®é¢˜</title>
      <link href="/2022/11/16/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(43)/"/>
      <url>/2022/11/16/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(43)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>çœ‹è¿™æ®µä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        b = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------- //    </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> aa = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> bb;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> cc;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        bb = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Test()&#123;</span><br><span class="line">        cc = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// b = 1;   ERROR</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------- //    </span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     b = 1;   ERROR</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// static&#123;</span></span><br><span class="line">    <span class="comment">//     bb = 1;  ERROR</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸¸é‡åˆå§‹åŒ–é—®é¢˜æ€»ç»“ï¼š</p><ul><li>é™æ€å¸¸é‡åˆå§‹åŒ–ï¼š<ul><li>å®šä¹‰æ—¶èµ‹å€¼</li><li>é™æ€ä»£ç å¿«ä¸­èµ‹å€¼</li></ul></li><li>æˆå‘˜å¸¸é‡åˆå§‹åŒ–ï¼š<ul><li>å®šä¹‰æ—¶èµ‹å€¼</li><li>éé™æ€ä»£ç å¿«èµ‹å€¼</li><li>æ„é€ å‡½æ•°ä¸­èµ‹å€¼</li></ul></li><li>æ³¨æ„å‡ºé”™æƒ…å†µï¼š<ul><li>åœ¨éé™æ€ä»£ç å¿«ä¸­æˆ–æ„é€ å‡½æ•°ä¸­ä¸ºé™æ€å¸¸é‡èµ‹å€¼</li><li>åœ¨é™æ€ä»£ç å¿«ä¸­ä¸ºæˆå‘˜å¸¸é‡èµ‹å€¼</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx éƒ¨ç½²ä¸é›†ç¾¤</title>
      <link href="/2022/11/15/Nginx_Deployment_and_cluster/"/>
      <url>/2022/11/15/Nginx_Deployment_and_cluster/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-éƒ¨ç½²ä¸é›†ç¾¤"><a href="#Nginx-éƒ¨ç½²ä¸é›†ç¾¤" class="headerlink" title="Nginx éƒ¨ç½²ä¸é›†ç¾¤"></a>Nginx éƒ¨ç½²ä¸é›†ç¾¤</h1><h2 id="Nginxä¸Tomcatéƒ¨ç½²"><a href="#Nginxä¸Tomcatéƒ¨ç½²" class="headerlink" title="Nginxä¸Tomcatéƒ¨ç½²"></a>Nginxä¸Tomcatéƒ¨ç½²</h2><p>å‰é¢å·²ç»å°† Nginx çš„å¤§éƒ¨åˆ†å†…å®¹è¿›è¡Œäº†è®²è§£ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“äº† Nginx åœ¨é«˜å¹¶å‘åœºæ™¯å’Œå¤„ç†é™æ€èµ„æºæ˜¯éå¸¸é«˜æ€§èƒ½çš„ï¼Œä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­é™¤äº†é™æ€èµ„æºè¿˜æœ‰å°±æ˜¯åå°ä¸šåŠ¡ä»£ç æ¨¡å—ï¼Œä¸€èˆ¬åå°ä¸šåŠ¡éƒ½ä¼šè¢«éƒ¨ç½²åœ¨ Tomcatã€weblogic æˆ–è€…æ˜¯ websphere ç­‰ Web æœåŠ¡å™¨ä¸Šã€‚é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ Nginx æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚å¹¶æŠŠè¯·æ±‚è½¬å‘åˆ°åå° Web æœåŠ¡å™¨ï¼Ÿ</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.iachagf6u0g.webp" alt="image"></p><p>æ­¥éª¤åˆ†æ:</p><ul><li>åœ¨æœåŠ¡å™¨ A ä¸Šå‡†å¤‡ Tomcat ç¯å¢ƒï¼Œå¹¶åœ¨ Tomcat ä¸Šéƒ¨ç½²ä¸€ä¸ª Web é¡¹ç›®ã€‚è¿™æ­¥éª¤åœ¨ <a href="/middleware/Nginx/Nginx_Deployment_and_cluster/#ç¯å¢ƒå‡†å¤‡-tomcat">ç¯å¢ƒå‡†å¤‡(Tomcat)</a></li><li>åœ¨æœåŠ¡å™¨ B ä¸Šå‡†å¤‡ Nginx ç¯å¢ƒï¼Œä½¿ç”¨ Nginx æ¥æ”¶è¯·æ±‚ï¼Œå¹¶æŠŠè¯·æ±‚åˆ†å‘åˆ° Tomcat ä¸Šã€‚è¿™æ­¥éª¤åœ¨ <a href="/middleware/Nginx/Nginx_Deployment_and_cluster/#ç¯å¢ƒå‡†å¤‡-nginx">ç¯å¢ƒå‡†å¤‡(Nginx)</a></li></ul><h3 id="ç¯å¢ƒå‡†å¤‡-Tomcat"><a href="#ç¯å¢ƒå‡†å¤‡-Tomcat" class="headerlink" title="ç¯å¢ƒå‡†å¤‡(Tomcat)"></a>ç¯å¢ƒå‡†å¤‡(Tomcat)</h3><p>æœ¬æ¬¡å°†é‡‡ç”¨ Tomcat ä½œä¸ºåå° Web æœåŠ¡å™¨ã€‚</p><ul><li>åœ¨ æœåŠ¡å™¨ A ä¸Šå‡†å¤‡ä¸€ä¸ª Tomcat<ul><li>Tomcat å®˜ç½‘åœ°å€ï¼š<a href="https://tomcat.apache.org/" target="_blank" rel="noopener">https://tomcat.apache.org/</a></li></ul></li><li>ä¸‹è½½ Tomcatï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ <code>apache-tomcat-9.0.54.tar.gz</code></li><li>è¿›å…¥ä¸Šä¼ ç›®å½•ï¼Œå°† Tomcat è¿›è¡Œè§£å‹ç¼©</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/<span class="built_in">local</span>/tomcat</span><br><span class="line"></span><br><span class="line">tar -zxf apache-tomcat-9.0.54.tar.gz -C /usr/<span class="built_in">local</span>/tomcat</span><br></pre></td></tr></table></figure><p>å‡†å¤‡ä¸€ä¸ª Web é¡¹ç›®ï¼Œå°†å…¶æ‰“åŒ…ä¸º War åŒ…ï¼Œè¿™é‡Œæ˜¯ demo.war</p><ul><li>å°†å†™å¥½çš„ War åŒ…ä¸Šä¼ åˆ° Tomcat ç›®å½•ä¸‹çš„ webapps åŒ…ä¸‹</li><li>å°† Tomcat è¿›è¡Œå¯åŠ¨ï¼Œè¿›å…¥ Tomcat çš„ bin ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./startup.sh</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å®Œæˆ Tomcat åï¼Œè¿›è¡Œè®¿é—®æµ‹è¯•</p><p>æµè§ˆå™¨è®¿é—®ï¼š</p><ul><li>é™æ€èµ„æºï¼š<code>http://192.168.200.146:8080/demo/index.html</code></li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.pln0ovd1h1c.webp" alt="image"></p><ul><li>åŠ¨æ€èµ„æºï¼š<code>http://192.168.200.146:8080/demo/getAddress</code></li></ul><p>åŠ¨æ€èµ„æºå¯ä»¥æ˜¯ç«¯å£å·ï¼Œæ­¤æ—¶çš„ç«¯å£æ˜¯ 8080<img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.31nc8e1cdee0.webp" alt="image"></p><p>è‡ªæ­¤ï¼ŒæœåŠ¡å™¨ A çš„ Tomcat éƒ¨ç½²å·²ç»å®ç°ã€‚</p><p><strong>demo.war çš„å†…å®¹æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ</strong></p><p>å…¶å®ä½ å¯ä»¥è‡ªå·±åˆ¶ä½œä¸€ä¸ª war åŒ…ï¼Œè¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œdemo.war é‡Œæœ‰ä¸¤ä¸ªå›¾ç‰‡ï¼Œå’Œä¸€ä¸ª index.html</p><p>index.html æ–‡ä»¶å¼•ç”¨äº†ä¸¤ä¸ªå›¾ç‰‡ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        $(function()&#123;</span><br><span class="line">           $.get('http://192.168.200.133/demo/getAddress',function(data)&#123;</span><br><span class="line">               $("#msg").html(data);</span><br><span class="line">           &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/logo.png"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Nginxå¦‚ä½•å°†è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/mv.png"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œå½“è®¿é—® index.html æ—¶ï¼Œå®ƒä¼šä¸»åŠ¨å»è¯·æ±‚ <code>/getAddress</code>ï¼Œè¿™ä¸ªè¯·æ±‚è¿”å›ç«¯å£å·ï¼Œå³æŠŠ 8080 å½“ä½œåŠ¨æ€èµ„æºï¼Œæ˜¾ç¤ºåˆ°é¡µé¢ä¸Šï¼Œå¦‚æœæ˜¯ 9090 ç«¯å£è®¿é—®ï¼Œåˆ™è¿”å› 9090 æ˜¾ç¤ºé¡µé¢ä¸Šã€‚ä½ ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—® <code>/getAddress</code>ï¼Œç›´æ¥è·å–ç«¯å£å·ã€‚</p><h3 id="ç¯å¢ƒå‡†å¤‡-Nginx"><a href="#ç¯å¢ƒå‡†å¤‡-Nginx" class="headerlink" title="ç¯å¢ƒå‡†å¤‡(Nginx)"></a>ç¯å¢ƒå‡†å¤‡(Nginx)</h3><p>æˆ‘ä»¬å·²ç»åœ¨ Tomcat å®ç°äº†ä¸¤ä¸ªæ•ˆæœï¼Œé‚£ä¹ˆç°åœ¨éœ€è¦æŠŠ Tomcat çš„åœ°å€æ”¾åˆ° Nginx é‡Œï¼Œç”± Nginx å¸®æˆ‘ä»¬ä»£ç†è¿™ä¸ª Tomcat åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬è®¿é—® Nginxï¼Œå®é™…ä¸Šå°±æ˜¯è®¿é—® Tomcatã€‚</p><ol><li>ä½¿ç”¨ Nginx çš„åå‘ä»£ç†ï¼Œå°†è¯·æ±‚è½¬ç»™ Tomcat è¿›è¡Œå¤„ç†ã€‚</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> webservice &#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:8080</span>;  <span class="comment"># æœåŠ¡å™¨ A çš„ Tomcat  åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line">    <span class="attribute">listen</span><span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">location</span> /demo &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://webservice;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å¯åŠ¨è®¿é—®æœåŠ¡å™¨ Bï¼Œæµ‹è¯•æ˜¯å¦ä»£ç†åˆ°æœåŠ¡å™¨ A çš„ Tomcatï¼Œæ•ˆæœå¦‚å›¾ï¼š</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.6taygwj4nt80.webp" alt="image"></p><p>å­¦ä¹ åˆ°è¿™ï¼Œå¯èƒ½å¤§å®¶ä¼šæœ‰ä¸€ä¸ªå›°æƒ‘ï¼Œæ˜æ˜ç›´æ¥é€šè¿‡ Tomcat å°±èƒ½è®¿é—®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¤šåŠ ä¸€ä¸ª Nginxï¼Œè¿™æ ·ä¸æ˜¯åè€Œæ˜¯ç³»ç»Ÿçš„å¤æ‚åº¦å˜é«˜äº†ä¹ˆ? é‚£æ¥ä¸‹æ¥æˆ‘ä»¬ä»ä¸¤ä¸ªæ–¹ä¾¿ç»™å¤§å®¶åˆ†æä¸‹è¿™ä¸ªé—®é¢˜ï¼Œ</p><ul><li>ç¬¬ä¸€ä¸ªä½¿ç”¨ Nginx å®ç°åŠ¨é™åˆ†ç¦»</li><li>ç¬¬äºŒä¸ªä½¿ç”¨ Nginx æ­å»º Tomcat çš„é›†ç¾¤</li></ul><h2 id="åŠ¨é™åˆ†ç¦»"><a href="#åŠ¨é™åˆ†ç¦»" class="headerlink" title="åŠ¨é™åˆ†ç¦»"></a>åŠ¨é™åˆ†ç¦»</h2><p><strong>ä»€ä¹ˆæ˜¯åŠ¨é™åˆ†ç¦»ï¼Ÿ</strong></p><ul><li>åŠ¨ï¼šåå°åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡å¤„ç†</li><li>é™ï¼šç½‘ç«™çš„é™æ€èµ„æºï¼ˆhtmlï¼ŒjavaScriptï¼Œcssï¼Œimages ç­‰æ–‡ä»¶ï¼‰</li><li>åˆ†ç¦»ï¼šå°†ä¸¤è€…è¿›è¡Œåˆ†å¼€éƒ¨ç½²è®¿é—®ï¼Œæä¾›ç”¨æˆ·è¿›è¡Œè®¿é—®ã€‚</li></ul><p><strong>ä¸¾ä¾‹è¯´æ˜å°±æ˜¯ä»¥åæ‰€æœ‰å’Œé™æ€èµ„æºç›¸å…³çš„å†…å®¹éƒ½äº¤ç»™ Nginx æ¥éƒ¨ç½²è®¿é—®ï¼Œéé™æ€å†…å®¹åˆ™äº¤ä¸ªç±»ä¼¼äº Tomcat çš„æœåŠ¡å™¨æ¥éƒ¨ç½²è®¿é—®ã€‚</strong></p><p><strong>ä¸ºä»€ä¹ˆè¦åŠ¨é™åˆ†ç¦»ï¼Ÿ</strong></p><p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ Nginx åœ¨å¤„ç†é™æ€èµ„æºçš„æ—¶å€™ï¼Œæ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œè€Œä¸” Nginx çš„å¹¶å‘è®¿é—®é‡ä¹Ÿæ˜¯ååˆ—å‰èŒ…ï¼Œè€Œ Tomcat åˆ™ç›¸å¯¹æ¯”è¾ƒå¼±ä¸€äº›ï¼Œæ‰€ä»¥æŠŠé™æ€èµ„æºäº¤ç»™ Nginx åï¼Œå¯ä»¥å‡è½» Tomcat æœåŠ¡å™¨çš„è®¿é—®å‹åŠ›å¹¶æé«˜é™æ€èµ„æºçš„è®¿é—®é€Ÿåº¦ã€‚</p><p>åŠ¨é™åˆ†ç¦»ä»¥åï¼Œé™ä½äº†åŠ¨æ€èµ„æºå’Œé™æ€èµ„æºçš„è€¦åˆåº¦ã€‚å¦‚åŠ¨æ€èµ„æºå®•æœºäº†ä¹Ÿä¸å½±å“é™æ€èµ„æºçš„å±•ç¤ºã€‚</p><p><strong>å¦‚ä½•å®ç°åŠ¨é™åˆ†ç¦»?</strong></p><p>å®ç°åŠ¨é™åˆ†ç¦»çš„æ–¹å¼å¾ˆå¤šï¼Œæ¯”å¦‚é™æ€èµ„æºå¯ä»¥éƒ¨ç½²åˆ° CDNã€Nginx ç­‰æœåŠ¡å™¨ä¸Šï¼ŒåŠ¨æ€èµ„æºå¯ä»¥éƒ¨ç½²åˆ° Tomcatã€weblogic æˆ–è€… websphere ä¸Šã€‚è¿™é‡Œä½¿ç”¨ Nginx + Tomcat æ¥å®ç°åŠ¨é™åˆ†ç¦»ã€‚</p><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>å¦‚ä¸‹å›¾ï¼Œå› ä¸º Nginx å¤„ç†é™æ€èµ„æºæ€§èƒ½é«˜ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠé™æ€èµ„æºæ”¾åœ¨ Nginx æœåŠ¡å™¨ä¸Šï¼Œç„¶åæŠŠåŠ¨æ€èµ„æºæ”¾åˆ° Tomcat æœåŠ¡å™¨ä¸Šã€‚å½“è®¿é—® Nginx çš„é™æ€èµ„æºæ—¶ï¼ŒNginx ä¼šå»è®¿é—® Tocmat è·å–åŠ¨æ€èµ„æºã€‚å®ç°åŠ¨é™åˆ†ç¦»ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.2v1uen08t3c0.webp" alt="image"></p><h3 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h3><ul><li><p>å°† demo.war é¡¹ç›®ä¸­çš„é™æ€èµ„æºï¼ˆä¸¤ä¸ªå›¾ç‰‡ï¼‰éƒ½åˆ é™¤æ‰ï¼Œé‡æ–°æ‰“åŒ…ç”Ÿæˆä¸€ä¸ª War åŒ…</p><p>è¿™æ—¶å€™ War åŒ…åªç•™ä¸‹åŠ¨æ€èµ„æºï¼Œè€Œé™æ€èµ„æºè¦æ”¾åˆ° Nginx ä¸Šã€‚</p></li><li><p>å°†æ–°çš„ War åŒ…éƒ¨ç½²åˆ° Tomcat ä¸­ï¼ŒæŠŠä¹‹å‰éƒ¨ç½²çš„å†…å®¹åˆ é™¤æ‰</p><ul><li>è¿›å…¥åˆ° tomcat çš„ webapps ç›®å½•ä¸‹ï¼Œå°†ä¹‹å‰çš„ demo ç›®å½•å’Œ demo.war åŒ…åˆ é™¤æ‰</li><li>å°†æ–°çš„ War åŒ…å¤åˆ¶åˆ° webapps ä¸‹</li><li>å°† tomcat å¯åŠ¨</li></ul></li><li><p>åœ¨ Nginx æ‰€åœ¨çš„æœåŠ¡å™¨ B ä¸Šåˆ›å»ºå¦‚ä¸‹ç›®å½•ï¼Œå¹¶å°†å¯¹åº”çš„é™æ€èµ„æºæ”¾å…¥æŒ‡å®šçš„ä½ç½®</p></li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.3e4j68pre4k0.webp" alt="image"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/<span class="built_in">local</span>/nginx/html/web/images</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/nginx/html/web/js</span><br><span class="line"></span><br><span class="line">cp logo.png /usr/<span class="built_in">local</span>/nginx/html/web/images</span><br><span class="line">cp mv.png /usr/<span class="built_in">local</span>/nginx/html/web/images</span><br><span class="line">cp jquery.min.js /usr/<span class="built_in">local</span>/nginx/html/web/js</span><br><span class="line"></span><br><span class="line">vim /usr/<span class="built_in">local</span>/nginx/html/web/index.html</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ index.html é¡µé¢çš„å†…å®¹å¦‚ä¸‹:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        $(function()&#123;</span><br><span class="line">           $.get('http://192.168.200.133/demo/getAddress',function(data)&#123;</span><br><span class="line">               $("#msg").html(data);</span><br><span class="line">           &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/logo.png"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Nginxå¦‚ä½•å°†è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/mv.png"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬ 9 è¡Œä»£ç ï¼Œå®ƒè®¿é—®çš„è¿™ä¸ªåœ°å€æ˜¯æœåŠ¡å™¨ B çš„ Nginxï¼Œé€šè¿‡è¿™ä¸ªåœ°å€è®© Nginx å»è·å–æœåŠ¡å™¨ A çš„ Tomcat åŠ¨æ€èµ„æºã€‚</p><ul><li>åœ¨é…ç½®æ–‡ä»¶é…ç½® Nginx çš„é™æ€èµ„æºä¸åŠ¨æ€èµ„æºçš„è®¿é—®</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> webservice&#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.200.146:8080</span>;  <span class="comment"># æœåŠ¡å™¨ A çš„ Tocmat</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ¨æ€èµ„æºä» Tomcat è·å–</span></span><br><span class="line">    <span class="attribute">location</span> /demo &#123;      <span class="comment"># index.html ç¬¬ 9 è¡Œä»£ç è§¦å‘è¯¥ location</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://webservice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># é™æ€èµ„æºä»è‡ªå·±èº«ä¸Šè·å–</span></span><br><span class="line">    <span class="attribute">location</span> ~/.*\.(png|jpg|gif|js)&#123;</span><br><span class="line">        <span class="attribute">root</span> html/web;</span><br><span class="line">        <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   html/web;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨æµ‹è¯•ï¼Œè®¿é—® <code>http://192.168.200.133</code></li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.2yip3al9lva0.webp" alt="image"></p><p>å‡å¦‚æŸä¸ªæ—¶é—´ç‚¹ï¼Œç”±äºæŸä¸ªåŸå› å¯¼è‡´ Tomcat åçš„æœåŠ¡å™¨å®•æœºäº†ï¼Œæˆ‘ä»¬å†æ¬¡è®¿é—® Nginxï¼Œä¼šå¾—åˆ°å¦‚ä¸‹æ•ˆæœï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.3s0ttch8r4i0.webp" alt="image"></p><p>ç”¨æˆ·è¿˜æ˜¯èƒ½çœ‹åˆ°é¡µé¢ï¼Œåªæ˜¯ç¼ºå¤± Tomcat çš„åŠ¨æ€èµ„æºï¼Œè¿™å°±æ˜¯å‰åç«¯è€¦åˆåº¦é™ä½çš„æ•ˆæœï¼Œå¹¶ä¸”æ•´ä¸ªè¯·æ±‚åªå’Œåçš„æœåŠ¡å™¨äº¤äº’äº†ä¸€æ¬¡ï¼Œjs å’Œ images éƒ½ç›´æ¥ä» Nginx æœåŠ¡å™¨é‡Œè¿”å›ï¼Œæä¾›äº†æ•ˆç‡ï¼Œé™ä½äº†åç«¯æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><h2 id="Tomcaté›†ç¾¤æ­å»º"><a href="#Tomcaté›†ç¾¤æ­å»º" class="headerlink" title="Tomcaté›†ç¾¤æ­å»º"></a>Tomcaté›†ç¾¤æ­å»º</h2><p>åœ¨ä½¿ç”¨ Nginx å’Œ Tomcat éƒ¨ç½²é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸€å° Nginx æœåŠ¡å™¨å’Œä¸€å° Tomcat æœåŠ¡å™¨ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.4ukvicg3of80.webp" alt="image"></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœ Tomcat çš„çœŸçš„å®•æœºäº†ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¼šä¸å®Œæ•´ï¼Œæ‰€ä»¥å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜ï¼Ÿ</p><p>ä¸€å°æœåŠ¡å™¨å®¹æ˜“å®•æœºï¼Œé‚£å°±å¤šæ­å»ºå‡ å° Tomcat æœåŠ¡å™¨ï¼Œè¿™æ ·çš„è¯å°±æå‡äº†åçš„æœåŠ¡å™¨çš„å¯ç”¨æ€§ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„é›†ç¾¤ï¼Œæ­å»º Tomcat çš„é›†ç¾¤éœ€è¦ç”¨åˆ°äº† Nginx çš„åå‘ä»£ç†å’Œèµ‹å€¼å‡è¡¡çš„çŸ¥è¯†ï¼Œå…·ä½“å¦‚ä½•æ¥å®ç°ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹åŸç†ï¼š</p><p>ç”¨æˆ·è¯·æ±‚åˆ° Nginxï¼ŒNginx ä½¿ç”¨è´Ÿè½½å‡è¡¡å¯¹ä¸‰ä¸ª Tomcat æœåŠ¡å™¨è¿›è¡Œè®¿é—®ï¼Œå¦‚æœä¸€ä¸ª Tomcat æœåŠ¡å™¨å®•æœºäº†ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸¤ä¸ª Tomcat æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.664h3o0m8y00.webp" alt="image"></p><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><ol><li>å‡†å¤‡ 3 å° Tomcat æœåŠ¡å™¨ï¼Œä½¿ç”¨ç«¯å£è¿›è¡ŒåŒºåˆ†ï¼ˆå®é™…ç¯å¢ƒåº”è¯¥æ˜¯ä¸‰å°æœåŠ¡å™¨ï¼‰ï¼Œä¿®æ”¹ Tomcat çš„ server.xmlï¼Œå°†ç«¯å£ä¿®æ”¹åˆ†åˆ«ä¿®æ”¹ä¸º 8080ã€8180ã€8280</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp -r apache-tomcat-9.0.54 tomcat01</span><br><span class="line">cp -r apache-tomcat-9.0.54 tomcat02</span><br><span class="line">cp -r apache-tomcat-9.0.54 tomcat03</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸‰ä¸ª Tocmat é…ç½®æ–‡ä»¶çš„ç«¯å£</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim tomcat01/conf/server.xml</span><br><span class="line">vim tomcat02/conf/server.xml</span><br><span class="line">vim tomcat03/conf/server.xml</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹çš„å†…å®¹ä½ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.76l3jwkc3b40.webp" alt="image"></p><ol start="2"><li>åœ¨ Nginx å¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹:</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> webservice&#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.200.146:8080</span>;     <span class="comment"># tomcat01</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.200.146:8180</span>;  <span class="comment"># tomcat02</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.200.146:8280</span>; <span class="comment"># tomcat03</span></span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line">    <span class="attribute">listen</span><span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">location</span> /demo &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://webservice;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>å¯åŠ¨ Tomcat å¹¶è®¿é—®æµ‹è¯•</li></ol><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://192.168.200.146:8080/demo/getAddress</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.2389oc46sdxc.webp" alt="image"></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://192.168.200.146:8180/demo/getAddress</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.1sjv5fphqk8w.webp" alt="image"></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://192.168.200.146:8280/demo/getAddress</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.6uckjob0ptc0.webp" alt="image"></p><p>å¥½äº†ï¼Œå®Œæˆäº†ä¸Šè¿°ç¯å¢ƒçš„éƒ¨ç½²ï¼Œæˆ‘ä»¬å·²ç»è§£å†³äº† Tomcat çš„é«˜å¯ç”¨æ€§ï¼Œä¸€å°æœåŠ¡å™¨å®•æœºï¼Œè¿˜æœ‰å…¶ä»–ä¸¤æ¡å¯¹å¤–æä¾›æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å®ç°åå°æœåŠ¡å™¨çš„ä¸é—´æ–­æ›´æ–°ã€‚</p><p><strong>ä½†æ˜¯æ–°é—®é¢˜å‡ºç°äº†ï¼Œä¸Šè¿°ç¯å¢ƒä¸­ï¼Œå¦‚æœæ˜¯ Nginx å®•æœºäº†å‘¢ï¼Œé‚£ä¹ˆæ•´å¥—ç³»ç»Ÿéƒ½å°†æœåŠ¡å¯¹å¤–æä¾›æœåŠ¡äº†ï¼Œè¿™ä¸ªå¦‚ä½•è§£å†³ï¼Ÿ</strong></p><h2 id="Nginxé›†ç¾¤æ­å»º"><a href="#Nginxé›†ç¾¤æ­å»º" class="headerlink" title="Nginxé›†ç¾¤æ­å»º"></a>Nginxé›†ç¾¤æ­å»º</h2><p>é’ˆå¯¹äºä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸‹è¦æƒ³è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œéœ€è¦é¢ä¸´å“ªäº›é—®é¢˜ï¼Ÿ</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.664h3o0m8y00.webp" alt="image"></p><p>éœ€è¦ä¸¤å°ä»¥ä¸Šçš„ Nginx æœåŠ¡å™¨å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥è§£å†³å…¶ä¸­ä¸€å°å®•æœºäº†ï¼Œå¦å¤–ä¸€å°è¿˜èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸¤å° Nginx æœåŠ¡å™¨çš„è¯ï¼Œä¼šæœ‰ä¸¤ä¸ª IP åœ°å€ï¼Œç”¨æˆ·è¯¥è®¿é—®å“ªå°æœåŠ¡å™¨ï¼Œç”¨æˆ·æ€ä¹ˆçŸ¥é“å“ªå°æ˜¯å¥½çš„ï¼Œå“ªå°æ˜¯å®•æœºäº†çš„ï¼Ÿ</p><h3 id="Keepalived"><a href="#Keepalived" class="headerlink" title="Keepalived"></a>Keepalived</h3><p>ä½¿ç”¨ Keepalived æ¥è§£å†³ï¼ŒKeepalived è½¯ä»¶ç”± C ç¼–å†™çš„ï¼Œæœ€åˆæ˜¯ä¸“ä¸º LVS è´Ÿè½½å‡è¡¡è½¯ä»¶è®¾è®¡çš„ï¼ŒKeepalived è½¯ä»¶ä¸»è¦æ˜¯é€šè¿‡ VRRP åè®®å®ç°é«˜å¯ç”¨åŠŸèƒ½ã€‚</p><h3 id="VRRPä»‹ç»"><a href="#VRRPä»‹ç»" class="headerlink" title="VRRPä»‹ç»"></a>VRRPä»‹ç»</h3><p>VRRPï¼ˆVirtual Route Redundancy Protocolï¼‰åè®®ï¼Œç¿»è¯‘è¿‡æ¥ä¸ºè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ã€‚VRRP åè®®å°†ä¸¤å°æˆ–å¤šå°è·¯ç”±å™¨è®¾å¤‡è™šæ‹Ÿæˆä¸€ä¸ªè®¾å¤‡ï¼Œå¯¹å¤–æä¾›è™šæ‹Ÿè·¯ç”±å™¨ IPï¼Œè€Œåœ¨è·¯ç”±å™¨ç»„å†…éƒ¨ï¼Œå¦‚æœå®é™…æ‹¥æœ‰è¿™ä¸ªå¯¹å¤– IP çš„è·¯ç”±å™¨å¦‚æœå·¥ä½œæ­£å¸¸çš„è¯å°±æ˜¯ MASTERï¼ŒMASTER å®ç°é’ˆå¯¹è™šæ‹Ÿè·¯ç”±å™¨IPçš„å„ç§ç½‘ç»œåŠŸèƒ½ã€‚å…¶ä»–è®¾å¤‡ä¸æ‹¥æœ‰è¯¥è™šæ‹Ÿ IPï¼ŒçŠ¶æ€ä¸º BACKUPï¼Œå¤„äº†æ¥æ”¶ MASTER çš„ VRRP çŠ¶æ€é€šå‘Šä¿¡æ¯ä»¥å¤–ï¼Œä¸æ‰§è¡Œå¯¹å¤–çš„ç½‘ç»œåŠŸèƒ½ã€‚å½“ä¸»æœºå¤±æ•ˆæ—¶ï¼ŒBACKUP å°†æ¥ç®¡åŸå…ˆ MASTER çš„ç½‘ç»œåŠŸèƒ½ã€‚</p><p>çœ‹å›¾åˆ†æï¼šVRRP æŠŠä¸¤ä¸ª Nginx åˆ†æˆä¸¤ä¸ªè·¯ç”±ï¼ˆVRRP è·¯ç”± 1 å’Œ VRRP è·¯ç”± 2ï¼‰ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª Virtual è·¯ç”±ï¼Œç”¨æˆ·è®¿é—®çš„æ˜¯ Virtual è·¯ç”±ï¼Œè¯¥è·¯ç”±ä¼šå»è®¿é—®ä¸¤ä¸ª Nginx ç”Ÿæˆçš„ VRRP è·¯ç”±ã€‚é‚£ä¹ˆåˆ°åº•è®¿é—®è°å‘¢ï¼ŸVRRP ä¼šç»™ä¸¤ä¸ªè·¯ç”±åˆ†é…è§’è‰²ï¼Œä¸€ä¸ªæ˜¯ Masterï¼ˆè€å¤§ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ Backupï¼ˆå¤‡ä»½ï¼‰ï¼Œæ‰€ä»¥è®¿é—®çš„æ˜¯ Master è§’è‰²çš„è·¯ç”±ï¼Œå½“ Master è§’è‰²è·¯ç”±å®•æœºäº†ï¼Œæ‰ä¼šæ‰¾åˆ° Backup å¤‡ä»½è·¯ç”±ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.zc2md5tuu0w.webp" alt="image"></p><p>ä»ä¸Šé¢çš„ä»‹ç»ä¿¡æ¯è·å–åˆ°çš„å†…å®¹å°±æ˜¯ VRRP æ˜¯ä¸€ç§åè®®ï¼Œé‚£è¿™ä¸ªåè®®æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ</p><ol><li><p>é€‰æ‹©åè®®</p><p>VRRP å¯ä»¥æŠŠä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨çš„è´£ä»»åŠ¨æ€åˆ†é…åˆ°å±€åŸŸç½‘ä¸Šçš„ VRRP è·¯ç”±å™¨ä¸­çš„ä¸€å°ã€‚å…¶ä¸­çš„è™šæ‹Ÿè·¯ç”±å³ Virtual è·¯ç”±æ˜¯ç”± VRRP è·¯ç”±ç¾¤ç»„åˆ›å»ºçš„ä¸€ä¸ªä¸çœŸå®å­˜åœ¨çš„è·¯ç”±ï¼Œè¿™ä¸ªè™šæ‹Ÿè·¯ç”±ä¹Ÿæ˜¯æœ‰å¯¹åº”çš„ IP åœ°å€ã€‚è€Œä¸” VRRP è·¯ç”± 1 å’Œ VRRP è·¯ç”± 2 ä¹‹é—´ä¼šæœ‰ç«äº‰é€‰æ‹©ï¼Œé€šè¿‡é€‰æ‹©ä¼šäº§ç”Ÿä¸€ä¸ª Master è·¯ç”±å’Œä¸€ä¸ª Backup è·¯ç”±ã€‚</p></li><li><p>è·¯ç”±å®¹é”™åè®®</p><p>Master è·¯ç”±å’Œ Backup è·¯ç”±ä¹‹é—´ä¼šæœ‰ä¸€ä¸ªå¿ƒè·³æ£€æµ‹ï¼ŒMaster ä¼šå®šæ—¶å‘ŠçŸ¥ Backup è‡ªå·±çš„çŠ¶æ€ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼ŒBackup æ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªé€šçŸ¥å†…å®¹ï¼ŒBackup å°±ä¼šæ›¿ä»£ Master æˆä¸ºæ–°çš„ Masterã€‚Master è·¯ç”±æœ‰ä¸€ä¸ªç‰¹æƒå°±æ˜¯è™šæ‹Ÿè·¯ç”±å’Œåç«¯æœåŠ¡å™¨éƒ½æ˜¯é€šè¿‡ Master è¿›è¡Œæ•°æ®ä¼ é€’äº¤äº’çš„ï¼Œè€Œå¤‡ä»½èŠ‚ç‚¹åˆ™ä¼šç›´æ¥ä¸¢å¼ƒè¿™äº›è¯·æ±‚å’Œæ•°æ®ï¼Œä¸åšå¤„ç†ï¼Œåªæ˜¯å»ç›‘å¬ Master çš„çŠ¶æ€ã€‚</p></li></ol><p>ç”¨äº† Keepalived åï¼Œè§£å†³æ–¹æ¡ˆå¦‚å›¾ä¸‹:</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.3n6clkv1blk0.webp" alt="image"></p><p>çœ‹å›¾åˆ†æï¼šVIP æ˜¯è™šæ‹Ÿè·¯ç”±ï¼Œæ˜¯ä¸“é—¨ç»™ç”¨æˆ·å‘é€è¯·æ±‚ã€‚ä¸€æ—¦ç”¨æˆ·å‘é€è¯·æ±‚åˆ° VIPï¼ŒVIP å°±ä¼šå‘é€ç»™ Masterï¼ˆä¸»ï¼‰çš„ Nginxï¼Œå¦‚æœ Masterï¼ˆä¸»ï¼‰Nginx å®•æœºäº†ï¼Œæ‰ä¼šå‘é€ç»™ Backupï¼ˆå¤‡ä»½ï¼‰ Nginx è·¯ç”±ã€‚</p><h3 id="ç¯å¢ƒæ­å»º-1"><a href="#ç¯å¢ƒæ­å»º-1" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>VIP IP</th><th>Nginx IP</th><th>ä¸»æœºå</th><th>ä¸»/ä»</th></tr></thead><tbody><tr><td></td><td>192.168.200.133ï¼ˆæœåŠ¡å™¨ Aï¼‰</td><td>keepalived1</td><td>Master</td></tr><tr><td>192.168.200.222</td><td></td><td></td><td></td></tr><tr><td></td><td>192.168.200.122ï¼ˆæœåŠ¡å™¨ Bï¼‰</td><td>keepalived2</td><td>Backup</td></tr></tbody></table><p><strong>ç¡®ä¿æœåŠ¡å™¨ A å’ŒæœåŠ¡å™¨ B çš„ Nginx é…ç½®ä¿æŒä¸€è‡´ã€‚</strong></p><p>keepalived çš„å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>æ­¥éª¤1ï¼šä»å®˜æ–¹ç½‘ç«™ä¸‹è½½ keepalivedï¼Œå®˜ç½‘åœ°å€ <a href="https://keepalived.org/" target="_blank" rel="noopener">https://keepalived.org/</a></li><li>æ­¥éª¤2ï¼šå°†ä¸‹è½½çš„èµ„æºä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œè¿™é‡Œæ˜¯ <code>keepalived-2.0.20.tar.gz</code></li><li>æ­¥éª¤3ï¼šåœ¨ <code>/opt</code> ç›®å½•ä¸‹åˆ›å»º keepalived ç›®å½•ï¼Œæ–¹ä¾¿ç®¡ç†èµ„æº</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/keepalived</span><br></pre></td></tr></table></figure><ul><li>æ­¥éª¤4ï¼šå°†å‹ç¼©æ–‡ä»¶è¿›è¡Œè§£å‹ç¼©ï¼Œè§£å‹ç¼©åˆ°æŒ‡å®šçš„ç›®å½•</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf keepalived-2.0.20.tar.gz -C /opt/keepalived</span><br></pre></td></tr></table></figure><ul><li>æ­¥éª¤5ï¼šå¯¹ keepalived è¿›è¡Œé…ç½®ï¼Œç¼–è¯‘å’Œå®‰è£…</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/keepalived/keepalived-2.0.20</span><br><span class="line"></span><br><span class="line">./configure --sysconf=/etc --prefix=/usr/<span class="built_in">local</span>   <span class="comment"># å®‰è£…åˆ° /usr/local ç›®å½•ä¸‹ï¼Œå¯ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p><strong>ä¸¤å° Nginx æœåŠ¡å™¨éƒ½è¦å®‰è£… keepaliveã€‚</strong></p><p>å®‰è£…å®Œæˆåï¼Œæœ‰ä¸¤ä¸ªæ–‡ä»¶éœ€è¦æˆ‘ä»¬è®¤è¯†ä¸‹ï¼š</p><ul><li><code>/etc/keepalived/keepalived.conf</code>ï¼škeepalived çš„ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸»è¦æ“ä½œçš„å°±æ˜¯è¯¥æ–‡ä»¶</li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.5hd9zg18lp80.webp" alt="image"></p><ul><li><code>/usr/local/sbin</code> ç›®å½•ä¸‹çš„ <code>keepalived</code>ï¼šè¿™æ˜¯ç³»ç»Ÿé…ç½®è„šæœ¬ï¼Œç”¨æ¥å¯åŠ¨å’Œå…³é—­ keepalived</li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.54vzhzf4avw0.webp" alt="image"></p><h3 id="Keepalivedé…ç½®æ–‡ä»¶ä»‹ç»"><a href="#Keepalivedé…ç½®æ–‡ä»¶ä»‹ç»" class="headerlink" title="Keepalivedé…ç½®æ–‡ä»¶ä»‹ç»"></a>Keepalivedé…ç½®æ–‡ä»¶ä»‹ç»</h3><p>æ‰“å¼€ keepalived.conf é…ç½®æ–‡ä»¶</p><p>è¿™é‡Œé¢ä¼šåˆ†ä¸‰éƒ¨ï¼š</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ global å…¨å±€é…ç½®</li><li>ç¬¬äºŒéƒ¨åˆ†æ˜¯ vrrp ç›¸å…³é…ç½®</li><li>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ LVS ç›¸å…³é…ç½®ã€‚</li></ul><p>è¿™é‡Œä¸»è¦æ˜¯ä½¿ç”¨ keepalived å®ç°é«˜å¯ç”¨éƒ¨ç½²ï¼Œæ²¡æœ‰ç”¨åˆ° LVSï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„æ˜¯å‰ä¸¤éƒ¨åˆ†ã€‚</p><p>æ‰“å¼€ keepalived.conf æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å†…å®¹éƒ¨åˆ†ä»‹ç»å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># globalå…¨å±€éƒ¨åˆ†</span></span><br><span class="line"><span class="section">global_defs</span> &#123;</span><br><span class="line">    </span><br><span class="line">   <span class="section">notification_email</span> &#123;  <span class="comment"># é€šçŸ¥é‚®ä»¶ï¼Œå½“ keepalived åˆ‡æ¢ Master å’Œ Backup æ—¶éœ€è¦å‘ email ç»™å…·ä½“çš„é‚®ç®±åœ°å€</span></span><br><span class="line">     tom@itcast.cn</span><br><span class="line">     jerry@itcast.cn</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="attribute">notification_email_from</span> kele<span class="variable">@youngkbt</span>.com   <span class="comment"># è®¾ç½®å‘ä»¶äººçš„é‚®ç®±ä¿¡æ¯</span></span><br><span class="line">   </span><br><span class="line">   smtp_server <span class="number">192.168.200.1</span>   <span class="comment"># æŒ‡å®š smpt æœåŠ¡åœ°å€</span></span><br><span class="line">   </span><br><span class="line">   smtp_connect_timeout <span class="number">30</span>   <span class="comment"># æŒ‡å®š smpt æœåŠ¡è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">   </span><br><span class="line">   router_id LVS_DEVEL   <span class="comment"># è¿è¡Œ keepalived æœåŠ¡å™¨çš„ä¸€ä¸ªæ ‡è¯†ï¼Œå¯ä»¥ç”¨ä½œå‘é€é‚®ä»¶çš„ä¸»é¢˜ä¿¡æ¯</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment"># é»˜è®¤æ˜¯ä¸è·³è¿‡æ£€æŸ¥ã€‚æ£€æŸ¥æ”¶åˆ°çš„ VRRP é€šå‘Šä¸­çš„æ‰€æœ‰åœ°å€å¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œè®¾ç½®æ­¤å‘½ä»¤çš„æ„æ€æ˜¯ï¼Œå¦‚æœé€šå‘Šä¸æ¥æ”¶çš„ä¸Šä¸€ä¸ªé€šå‘Šæ¥è‡ªç›¸åŒçš„ master è·¯ç”±å™¨ï¼Œåˆ™ä¸æ‰§è¡Œæ£€æŸ¥(è·³è¿‡æ£€æŸ¥)</span></span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   </span><br><span class="line">   vrrp_strict    <span class="comment"># ä¸¥æ ¼éµå®ˆ VRRP åè®®</span></span><br><span class="line">  </span><br><span class="line">   vrrp_garp_interval <span class="number">0</span>   <span class="comment"># åœ¨ä¸€ä¸ªæ¥å£å‘é€çš„ä¸¤ä¸ªå…è´¹ ARP ä¹‹é—´çš„å»¶è¿Ÿã€‚å¯ä»¥ç²¾ç¡®åˆ°æ¯«ç§’çº§ã€‚é»˜è®¤æ˜¯ 0</span></span><br><span class="line">   </span><br><span class="line">   vrrp_gna_interval <span class="number">0</span>  <span class="comment"># åœ¨ä¸€ä¸ªç½‘å¡ä¸Šæ¯ç»„æ¶ˆæ¯ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼Œé»˜è®¤ä¸º 0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦ä¿®æ”¹çš„æ˜¯ 5ã€6ã€8 è¡Œä»£ç ã€‚</p><p>VRRP éƒ¨åˆ†å¯ä»¥åŒ…å«ä»¥ä¸‹å››ä¸ªå­æ¨¡å—ï¼š</p><ol><li>vrrp_script</li><li>vrrp_sync_group</li><li>garp_group</li><li>vrrp_instance</li></ol><p>æˆ‘ä»¬ä¼šç”¨åˆ°ç¬¬ä¸€ä¸ªï¼ˆ<a href="/middleware/Nginx/Nginx_Deployment_and_cluster/#vrrp-script">vrrp_script</a>ï¼‰å’Œç¬¬å››ä¸ªï¼ˆ<a href="/middleware/Nginx/Nginx_Deployment_and_cluster/#vrrp-instance">vrrp_instance</a>ï¼‰ã€‚</p><h3 id="vrrp-instance"><a href="#vrrp-instance" class="headerlink" title="vrrp_instance"></a>vrrp_instance</h3><p><code>vrrp_instance</code> æ¨¡å—å†…å®¹ï¼š</p><figure class="highlight nginx"><figcaption><span>&#123;3,5,6,7,13&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½® keepalived å®ä¾‹çš„ç›¸å…³ä¿¡æ¯ï¼ŒVI_1 ä¸º VRRP å®ä¾‹åç§°</span></span><br><span class="line"><span class="attribute">vrrp_instance</span> VI_1 &#123;</span><br><span class="line">    <span class="attribute">state</span> MASTER    <span class="comment"># æœ‰ä¸¤ä¸ªå€¼å¯é€‰ MASTER ä¸»ï¼ŒBACKUP å¤‡</span></span><br><span class="line">    interface ens33  <span class="comment"># vrrp å®ä¾‹ç»‘å®šçš„æ¥å£ï¼Œç”¨äºå‘é€ VRRP åŒ…[å½“å‰æœåŠ¡å™¨ä½¿ç”¨çš„ç½‘å¡åç§°]</span></span><br><span class="line">    virtual_router_id <span class="number">51</span>  <span class="comment"># æŒ‡å®š VRRP å®ä¾‹ IDï¼ŒèŒƒå›´æ˜¯ 0-255</span></span><br><span class="line">    priority <span class="number">100</span>  <span class="comment"># æŒ‡å®šä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„å°†æˆä¸º MASTER</span></span><br><span class="line">    advert_int <span class="number">1</span>  <span class="comment"># æŒ‡å®šå‘é€ VRRP é€šå‘Šçš„é—´éš”ï¼Œå•ä½æ˜¯ç§’ã€‚è¿™é‡Œæ˜¯å¿ƒè·³æ£€æŸ¥çš„æ—¶é—´</span></span><br><span class="line">    authentication &#123;  <span class="comment"># vrrp ä¹‹é—´é€šä¿¡çš„è®¤è¯ä¿¡æ¯</span></span><br><span class="line">        <span class="attribute">auth_type</span> PASS  <span class="comment"># æŒ‡å®šè®¤è¯æ–¹å¼ã€‚PASS ç®€å•å¯†ç è®¤è¯(æ¨è)</span></span><br><span class="line">        auth_pass <span class="number">1111</span>  <span class="comment"># æŒ‡å®šè®¤è¯ä½¿ç”¨çš„å¯†ç ï¼Œæœ€å¤š 8 ä½</span></span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;   <span class="comment"># è™šæ‹Ÿ IP åœ°å€è®¾ç½®è™šæ‹Ÿ IP åœ°å€ï¼Œä¾›ç”¨æˆ·è®¿é—®ä½¿ç”¨ï¼Œå¯è®¾ç½®å¤šä¸ªï¼Œä¸€è¡Œä¸€ä¸ª</span></span><br><span class="line">        192.168.200.222</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>vrrp_instance</code> æ¨¡å—ä¸­æˆ‘ä»¬ä¿®æ”¹çš„æ˜¯ç¬¬ 3ã€5ã€6ã€7ã€13 è¡Œä»£ç ã€‚</p><p>ç¬¬ 3 è¡Œä»£ç æ˜¯è¯´æ˜å½“å‰ Nginx æœåŠ¡å™¨çš„è§’è‰²æ˜¯ Master è¿˜æ˜¯ Backupã€‚åˆ†åˆ«åœ¨æœåŠ¡å™¨ A å’Œ B è¿›è¡Œè§’è‰²é…ç½®ã€‚</p><p>ç¬¬ 5 è¡Œä»£ç æ˜¯ VIP çš„ IDï¼Œå¦‚æœä½¿ç”¨ç›¸åŒçš„è™šæ‹Ÿè·¯ç”± VIPï¼Œè¯·ä¿æŒ ID ä¸€è‡´ã€‚</p><p>ç¬¬ 6 è¡Œä»£ç æ˜¯ä¼˜å…ˆçº§ï¼Œè¯·è®© Master æœåŠ¡å™¨çš„ä¼˜å…ˆçº§å¤§äº Backup æœåŠ¡å™¨çš„ä¼˜å…ˆçº§ã€‚å¦‚ 100 &gt; 90ã€‚</p><p>ç¬¬ 7 è¡Œä»£ç æ˜¯ Master å’Œ Backup ä¹‹é—´é€šä¿¡çš„é—´éš”æ—¶é—´ï¼Œå¦‚æœæ— æ³•é€šä¿¡ï¼Œè¯´æ˜ Master å·²ç»å®•æœºï¼Œåˆ™åˆ‡æ¢ä¸º Backupã€‚</p><p>ç¬¬ 13 è¡Œä»£ç æ˜¯ç”¨æˆ·è®¿é—®çš„è™šæ‹Ÿ IP åœ°å€ï¼Œå³ VIPï¼Œå®ƒä¼šå‘é€ç»™ Nginx æœåŠ¡å™¨ã€‚</p><h3 id="æœåŠ¡å™¨é…ç½®"><a href="#æœåŠ¡å™¨é…ç½®" class="headerlink" title="æœåŠ¡å™¨é…ç½®"></a>æœåŠ¡å™¨é…ç½®</h3><p>Keepalived çš„å…·ä½“é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p><p><strong>æœåŠ¡å™¨A</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">global_defs</span> &#123;</span><br><span class="line">   <span class="section">notification_email</span> &#123;</span><br><span class="line">        tom@itcast.cn</span><br><span class="line">        jerry@itcast.cn</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="attribute">notification_email_from</span> zhaomin<span class="variable">@itcast</span>.cn</span><br><span class="line">   smtp_server <span class="number">192.168.200.1</span></span><br><span class="line">   smtp_connect_timeout <span class="number">30</span></span><br><span class="line">   router_id keepalived1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   vrrp_strict</span><br><span class="line">   vrrp_garp_interval <span class="number">0</span></span><br><span class="line">   vrrp_gna_interval <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    <span class="attribute">state</span> MASTER</span><br><span class="line">    interface ens33</span><br><span class="line">    virtual_router_id <span class="number">51</span></span><br><span class="line">    priority <span class="number">100</span></span><br><span class="line">    advert_int <span class="number">1</span></span><br><span class="line">    authentication &#123;</span><br><span class="line">        <span class="attribute">auth_type</span> PASS</span><br><span class="line">        auth_pass <span class="number">1111</span></span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.200.222</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœåŠ¡å™¨B</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line"><span class="section">global_defs</span> &#123;</span><br><span class="line">   <span class="section">notification_email</span> &#123;</span><br><span class="line">        tom@itcast.cn</span><br><span class="line">        jerry@itcast.cn</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="attribute">notification_email_from</span> zhaomin<span class="variable">@itcast</span>.cn</span><br><span class="line">   smtp_server <span class="number">192.168.200.1</span></span><br><span class="line">   smtp_connect_timeout <span class="number">30</span></span><br><span class="line">   router_id keepalived2</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   vrrp_strict</span><br><span class="line">   vrrp_garp_interval <span class="number">0</span></span><br><span class="line">   vrrp_gna_interval <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    <span class="attribute">state</span> BACKUP</span><br><span class="line">    interface ens33</span><br><span class="line">    virtual_router_id <span class="number">51</span></span><br><span class="line">    priority <span class="number">90</span></span><br><span class="line">    advert_int <span class="number">1</span></span><br><span class="line">    authentication &#123;</span><br><span class="line">        <span class="attribute">auth_type</span> PASS</span><br><span class="line">        auth_pass <span class="number">1111</span></span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.200.222</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®æµ‹è¯•"><a href="#è®¿é—®æµ‹è¯•" class="headerlink" title="è®¿é—®æµ‹è¯•"></a>è®¿é—®æµ‹è¯•</h3><ol><li>å¯åŠ¨ keepalived ä¹‹å‰ï¼Œå…ˆä½¿ç”¨å‘½ä»¤ <code>ip a</code>ï¼ŒæŸ¥çœ‹ <code>192.168.200.133</code> å’Œ <code>192.168.200.122</code> è¿™ä¸¤å°æœåŠ¡å™¨çš„ IP æƒ…å†µ</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.4lh36tkt0kk0.webp" alt="image"></p><ol start="2"><li>åˆ†åˆ«å¯åŠ¨ä¸¤å°æœåŠ¡å™¨çš„ keepalived</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/sbin</span><br><span class="line"></span><br><span class="line">./keepalived</span><br></pre></td></tr></table></figure><p>å†æ¬¡é€šè¿‡ <code>ip a</code> æŸ¥çœ‹ IP</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.79pu8lyco700.webp" alt="image"></p><p>æ­¤æ—¶å‘ç°æœåŠ¡å™¨ A å¤šå‡ºäº† <code>192.168.200.222</code>ï¼Œæ­£æ˜¯é…ç½®çš„è™šæ‹Ÿè·¯ç”± VIPï¼Œè€ŒæœåŠ¡å™¨ B å¹¶æ²¡æœ‰ï¼Œè¯´æ˜æœåŠ¡å™¨ A æ˜¯ Masterï¼Œä¼˜å…ˆçº§é«˜äºæœåŠ¡å™¨ Bã€‚</p><ol start="3"><li>å½“æŠŠ <code>192.168.200.133</code> æœåŠ¡å™¨ A ä¸Šçš„ keepalived å…³é—­åï¼Œå†æ¬¡æŸ¥çœ‹ IP</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.qwb7iteldn4.webp" alt="image"></p><p>è¯´æ˜å½“ Master æœåŠ¡å™¨ A å®•æœºåï¼ŒæœåŠ¡å™¨ B ç”± Backup æ™‹å‡ä¸º Masterã€‚</p><p>é€šè¿‡ä¸Šè¿°çš„æµ‹è¯•ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œè™šæ‹Ÿ IP(VIP)ä¼šåœ¨ Master èŠ‚ç‚¹ä¸Šï¼Œå½“ Master èŠ‚ç‚¹ä¸Šçš„ keepalived å‡ºé—®é¢˜ä»¥åï¼Œå› ä¸º Backup æ— æ³•æ”¶åˆ° Master å‘å‡ºçš„ VRRP çŠ¶æ€é€šè¿‡ä¿¡æ¯ï¼Œå°±ä¼šç›´æ¥å‡ä¸º Master ã€‚VIP ä¹Ÿä¼šã€Œæ¼‚ç§»ã€åˆ°æ–°çš„ Master ã€‚</p><p><strong>ä¸Šé¢æµ‹è¯•å’Œ Nginx æœ‰ä»€ä¹ˆå…³ç³»?</strong></p><p>æˆ‘ä»¬æŠŠ <code>192.168.200.133</code> æœåŠ¡å™¨ A çš„ keepalived å†æ¬¡å¯åŠ¨ä¸‹ï¼Œç”±äºå®ƒçš„ä¼˜å…ˆçº§é«˜äº <code>192.168.200.122</code> æœåŠ¡å™¨ Bï¼Œæ‰€æœ‰å®ƒä¼šå†æ¬¡æˆä¸º Masterï¼ŒVIP ä¹Ÿä¼šã€Œæ¼‚ç§»ã€è¿‡å»ã€‚</p><p>æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://192.168.200.222/</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.6xosmovingw0.webp" alt="image"></p><p>å¦‚æœæŠŠ <code>192.168.200.133</code> æœåŠ¡å™¨ A çš„ keepalived è¿›ç¨‹å…³é—­æ‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> keepalived</span><br></pre></td></tr></table></figure><p>å†æ¬¡è®¿é—®ç›¸åŒçš„åœ°å€ï¼Œæ•ˆæœå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.60wzzgrveak0.webp" alt="image"></p><p>è™½ç„¶æ•ˆæœæˆåŠŸå®ç°äº†ï¼Œä½†æ˜¯æ­¤æ—¶æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æŠŠæœåŠ¡å™¨ä¸Šçš„ keepalived å…³é—­ï¼Œæ‰è®© VIP è¿›è¡Œåˆ‡æ¢ã€‚</p><p><strong>è€Œä»€ä¹ˆæ—¶å€™å…³é—­ keepalived å‘¢ï¼Ÿ</strong></p><p>åº”è¯¥æ˜¯åœ¨ keepalived æ‰€åœ¨æœåŠ¡å™¨çš„ Nginx å‡ºç°é—®é¢˜åï¼ŒæŠŠ keepalived å…³é—­æ‰ï¼Œå°±å¯ä»¥è®© VIP æ‰§è¡Œå¦å¤–ä¸€å°æœåŠ¡å™¨ã€‚<strong>ä½†æ˜¯ç°åœ¨è¿™æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯é€šè¿‡æ‰‹åŠ¨æ¥å®Œæˆçš„</strong>ï¼Œæˆ‘ä»¬å¦‚ä½•èƒ½è®©ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­å½“å‰æœåŠ¡å™¨çš„ Nginx æ˜¯å¦æ­£ç¡®å¯åŠ¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¦èƒ½è®© VIP è‡ªåŠ¨è¿›è¡Œã€Œæ¼‚ç§»ã€ï¼Œè¿™ä¸ªé—®é¢˜è¯¥å¦‚ä½•è§£å†³ï¼Ÿå¾€ä¸‹çœ‹ã€‚</p><h3 id="vrrp-script"><a href="#vrrp-script" class="headerlink" title="vrrp_script"></a>vrrp_script</h3><p>keepalived åªèƒ½åšåˆ°å¯¹ç½‘ç»œæ•…éšœå’Œ keepalived æœ¬èº«çš„ç›‘æ§ï¼Œå³å½“å‡ºç°ç½‘ç»œæ•…éšœæˆ–è€… keepalived æœ¬èº«å‡ºç°é—®é¢˜æ—¶ï¼Œè¿›è¡Œåˆ‡æ¢ã€‚ä½†æ˜¯è¿™äº›è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç›‘æ§ keepalived æ‰€åœ¨æœåŠ¡å™¨ä¸Šçš„å…¶ä»–ä¸šåŠ¡ï¼Œæ¯”å¦‚ Nginxï¼Œå¦‚æœ Nginx å‡ºç°å¼‚å¸¸äº†ï¼Œè€Œ keepalived å´ä¿æŒæ­£å¸¸ï¼Œæ˜¯æ— æ³•å®Œæˆç³»ç»Ÿçš„æ­£å¸¸å·¥ä½œçš„ï¼Œå› æ­¤éœ€è¦æ ¹æ®ä¸šåŠ¡è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€å†³å®šæ˜¯å¦éœ€è¦è¿›è¡Œä¸»å¤‡åˆ‡æ¢ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬å¯¹ä¸šåŠ¡è¿›ç¨‹è¿›è¡Œæ£€æµ‹ç›‘æ§ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ keepalived çš„ vrrp_script çš„é…ç½®æ¨¡æ¿ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vrrp_script</span> è„šæœ¬åç§°</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">script</span> <span class="string">"è„šæœ¬ä½ç½®"</span></span><br><span class="line">    interval <span class="number">3</span> <span class="comment"># æ‰§è¡Œæ—¶é—´é—´éš”</span></span><br><span class="line">    weight -<span class="number">20</span> <span class="comment"># åŠ¨æ€è°ƒæ•´ vrrp_instance çš„ä¼˜å…ˆçº§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°æ­¥éª¤ï¼š</p><ul><li>ç¼–å†™è„šæœ¬ï¼Œè¿™é‡Œçš„è„šæœ¬åæ˜¯ <code>ck_nginx.sh</code>ï¼Œä½ç½®åœ¨ <code>/etc/keepalived</code> è·¯å¾„ä¸‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">num=`ps -C nginx --no-header | wc -l`  # æŸ¥è¯¢ Nginx çš„è¿›ç¨‹æ•°</span><br><span class="line"></span><br><span class="line">if [ $num -eq 0 ];then              # å¦‚æœ Nginx çš„è¿›ç¨‹æ•°ç­‰äº 0</span><br><span class="line">/usr/local/nginx/sbin/nginx   # åˆ™å¯æ‰§è¡Œæ–‡ä»¶ nginxï¼Œå¯åŠ¨ Nginx æœåŠ¡</span><br><span class="line"></span><br><span class="line">sleep 2   # é˜»å¡ 2 ç§’ </span><br><span class="line"></span><br><span class="line">if [ `ps -C nginx --no-header | wc -l` -eq 0 ]; then  # å†æ¬¡æŸ¥è¯¢ Nginx çš„è¿›ç¨‹æ•°</span><br><span class="line">killall keepalived# å¦‚æœ Nginx çš„è¿›ç¨‹æ•°ä¸ç­‰äº 0ï¼Œåˆ™æ€æ­» keepalived è¿›ç¨‹</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><ul><li>ps å‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰è¿›ç¨‹ (process) çš„çŠ¶æ€ã€‚</li><li>-C(command)ï¼šæŒ‡å®šå‘½ä»¤çš„æ‰€æœ‰è¿›ç¨‹</li><li>â€“no-headerï¼šæ’é™¤æ ‡é¢˜</li></ul><p>å‘½ä»¤çš„æ•ˆæœå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.1ypeqh0nut8g.webp" alt="image"></p><p>ä»£è¡¨ç›®å‰çš„ num = 3ã€‚</p><p>è¿™ä¸ªè„šæœ¬å…¶å®å°±æ˜¯åˆ¤æ–­ Nginx æ˜¯å¦å¯åŠ¨è¿˜æ˜¯å®•æœºäº†ï¼Œå¦‚æœæ²¡æœ‰å¯åŠ¨ï¼Œåˆ™é‡æ–°å¯åŠ¨ã€‚é‡æ–°å¯åŠ¨åå†æ¬¡æŸ¥çœ‹ Nginx æ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œå¦‚æœæ²¡æœ‰å¯åŠ¨ï¼Œè¯´æ˜ Nginx å®•æœºäº†ï¼Œåˆ™æ€æ­» keepalived è¿›ç¨‹ï¼Œè¿™æ ·ï¼Œå¦ä¸€å°æœåŠ¡å™¨çš„ Nginx å°±æ™‹å‡ä¸º Masterã€‚</p><ul><li>ä¸ºè„šæœ¬æ–‡ä»¶è®¾ç½®æƒé™</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 ck_ngi</span><br></pre></td></tr></table></figure><ul><li>å°†è„šæœ¬æ·»åŠ åˆ° Master æœåŠ¡å™¨ A çš„ keepalived çš„é…ç½®æ–‡ä»¶é‡Œ</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure><p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vrrp_script</span> ck_nginx &#123;</span><br><span class="line">   <span class="attribute">script</span> <span class="string">"/etc/keepalived/ck_nginx.sh"</span> <span class="comment"># æ‰§è¡Œè„šæœ¬çš„ä½ç½®</span></span><br><span class="line">   interval <span class="number">2</span><span class="comment"># æ‰§è¡Œè„šæœ¬çš„å‘¨æœŸï¼Œç§’ä¸ºå•ä½</span></span><br><span class="line">   weight -<span class="number">20</span><span class="comment"># æƒé‡çš„è®¡ç®—æ–¹å¼</span></span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    <span class="attribute">state</span> MASTER</span><br><span class="line">    interface ens33</span><br><span class="line">    virtual_router_id <span class="number">10</span></span><br><span class="line">    priority <span class="number">100</span></span><br><span class="line">    advert_int <span class="number">1</span></span><br><span class="line">    authentication &#123;</span><br><span class="line">        <span class="attribute">auth_type</span> PASS</span><br><span class="line">        auth_pass <span class="number">1111</span></span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.200.111</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">track_script</span> &#123;</span><br><span class="line">      ck_nginx</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ•ˆæœæ²¡æœ‰å‡ºæ¥ï¼Œå¯ä»¥ä½¿ç”¨ <code>tail -f /var/log/messages</code> æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ï¼Œæ‰¾å¯¹åº”çš„é”™è¯¯ä¿¡æ¯</li><li>ä¸¤ä¸ª Nginx å¯åŠ¨åï¼Œå…³é—­ Master çš„ Nginxï¼Œé€šè¿‡ <code>ip a</code> æŸ¥çœ‹ Backup çš„ Nginx çš„IPï¼Œæ˜¯å¦æ™‹å‡ä¸º Master</li></ul><p><strong>é—®é¢˜æ€è€ƒ</strong></p><p>é€šå¸¸å¦‚æœ Master æœåŠ¡æ­»æ‰åï¼ŒBackup ä¼šå˜æˆ Masterï¼Œä½†æ˜¯å½“åŸæ¥çš„ Master æœåŠ¡åˆæ¢å¤äº†ï¼Œå®ƒä¼šå’ŒåŸæ¥çš„ Backup ä¼šæŠ¢å  VIPï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿä¸¤æ¬¡åˆ‡æ¢ï¼Œè¿™å¯¹ä¸šåŠ¡ç¹å¿™çš„ç½‘ç«™æ¥è¯´æ˜¯ä¸å¥½çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åœ¨é…ç½®æ–‡ä»¶åŠ å…¥ nopreempt éæŠ¢å ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°åªèƒ½ç”¨äº Backup çš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç”¨é…ç½®çš„æ—¶å€™ï¼Œæœ€å¥½ Master å’Œ Backup çš„ state éƒ½è®¾ç½®æˆ Backupï¼Œè¿™æ ·å®ƒä»¬åªèƒ½é€šè¿‡ priority ä¼˜å…ˆçº§æ¥ç«äº‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx ç«™ç‚¹ä¸è®¤è¯</title>
      <link href="/2022/11/15/Nginx_Site_and_certification/"/>
      <url>/2022/11/15/Nginx_Site_and_certification/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-ç«™ç‚¹ä¸è®¤è¯"><a href="#Nginx-ç«™ç‚¹ä¸è®¤è¯" class="headerlink" title="Nginx ç«™ç‚¹ä¸è®¤è¯"></a>Nginx ç«™ç‚¹ä¸è®¤è¯</h1><h2 id="Nginxåˆ¶ä½œä¸‹è½½ç«™ç‚¹"><a href="#Nginxåˆ¶ä½œä¸‹è½½ç«™ç‚¹" class="headerlink" title="Nginxåˆ¶ä½œä¸‹è½½ç«™ç‚¹"></a>Nginxåˆ¶ä½œä¸‹è½½ç«™ç‚¹</h2><p>é¦–å…ˆæˆ‘ä»¬å…ˆè¦æ¸…æ¥šä»€ä¹ˆæ˜¯ä¸‹è½½ç«™ç‚¹ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç½‘ç«™ <a href="http://nginx.org/download/" target="_blank" rel="noopener">http://nginx.org/download/</a></p><p>è¿™ä¸ªæ˜¯å¤§å®¶å»ä¸‹è½½ Nginx æ—¶ç»å¸¸è®¿é—®çš„ç½‘ç«™ï¼Œè¯¥ç½‘ç«™ä¸»è¦å°±æ˜¯ç”¨æ¥æä¾›ç”¨æˆ·æ¥ä¸‹è½½ç›¸å…³èµ„æºçš„ç½‘ç«™ï¼Œå°±å«åšä¸‹è½½ç½‘ç«™ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.17v6jxd79kao.webp" alt="image"></p><p>å¦‚ä½•åˆ¶ä½œä¸€ä¸ªä¸‹è½½ç«™ç‚¹ï¼š</p><ul><li><p>Nginx ä½¿ç”¨çš„æ˜¯æ¨¡å— <code>ngx_http_autoindex_module</code> æ¥å®ç°çš„ï¼ˆè‡ªå¸¦ï¼‰ï¼Œè¯¥æ¨¡å—å¤„ç†ä»¥æ–œæ (ã€ / ã€)ç»“å°¾çš„è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆç›®å½•åˆ—è¡¨ã€‚</p></li><li><p>Nginx ç¼–è¯‘çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ è½½è¯¥æ¨¡å—ï¼Œä½†æ˜¯è¯¥æ¨¡å—é»˜è®¤æ˜¯å…³é—­çš„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹æ¥æŒ‡ä»¤æ¥å®Œæˆå¯¹åº”çš„é…ç½®</p></li></ul><h3 id="autoindex"><a href="#autoindex" class="headerlink" title="autoindex"></a>autoindex</h3><p><code>autoindex</code> æŒ‡ä»¤å¯ç”¨æˆ–ç¦ç”¨ç›®å½•åˆ—è¡¨çš„è¾“å‡º</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>autoindex &lt;on | off&gt;;</td><td>autoindex off;</td><td>httpã€serverã€location</td></tr></tbody></table><h3 id="autoindex-exact-size"><a href="#autoindex-exact-size" class="headerlink" title="autoindex_exact_size"></a>autoindex_exact_size</h3><p><code>autoindex_exact_size</code> æŒ‡ä»¤å¯¹åº” HTLM æ ¼å¼ï¼ŒæŒ‡å®šæ˜¯å¦åœ¨ç›®å½•åˆ—è¡¨å±•ç¤ºæ–‡ä»¶çš„è¯¦ç»†å¤§å°ã€‚</p><p>é»˜è®¤ä¸º onï¼Œæ˜¾ç¤ºå‡ºæ–‡ä»¶çš„ç¡®åˆ‡å¤§å°ï¼Œå•ä½æ˜¯ bytesã€‚</p><p>æ”¹ä¸º off åï¼Œæ˜¾ç¤ºå‡ºæ–‡ä»¶çš„å¤§æ¦‚å¤§å°ï¼Œå•ä½æ˜¯ kB æˆ–è€… MB æˆ–è€… GBã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>autoindex_exact_size &lt;on | off&gt;;</td><td>autoindex_exact_size on;</td><td>httpã€serverã€location</td></tr></tbody></table><h3 id="autoindex-format"><a href="#autoindex-format" class="headerlink" title="autoindex_format"></a>autoindex_format</h3><p><code>autoindex_format</code> æŒ‡ä»¤è®¾ç½®ç›®å½•åˆ—è¡¨çš„æ ¼å¼ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>autoindex_format &lt;html | xml | json | jsonp&gt;;</td><td>autoindex_format html;</td><td>httpã€serverã€location</td></tr></tbody></table><p>åªæœ‰å½“ <code>autoindex_format</code> æŒ‡ä»¤è®¾ç½®ä¸º html æ—¶å€™ï¼Œä¸Šæ–¹çš„ <code>autoindex_exact_size</code> æŒ‡ä»¤æ‰ä¼šèµ·ä½œç”¨ã€‚</p><p>è¯¥æŒ‡ä»¤åœ¨ 1.7.9 åŠä»¥åç‰ˆæœ¬ä¸­å‡ºç°ã€‚</p><h3 id="autoindex-localtime"><a href="#autoindex-localtime" class="headerlink" title="autoindex_localtime"></a>autoindex_localtime</h3><p><code>autoindex_localtime</code> æŒ‡ä»¤å¯¹åº” HTML æ ¼å¼ï¼Œæ˜¯å¦åœ¨ç›®å½•åˆ—è¡¨ä¸Šæ˜¾ç¤ºæ—¶é—´ã€‚</p><p>é»˜è®¤ä¸º offï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸º GMT æ—¶é—´ã€‚</p><p>æ”¹ä¸º on åï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸ºæ–‡ä»¶çš„æœåŠ¡å™¨æ—¶é—´ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>autoindex_localtime &lt;on |off&gt;;</td><td>autoindex_localtime off;</td><td>httpã€serverã€location</td></tr></tbody></table><h3 id="å®ç°æ¡ˆä¾‹"><a href="#å®ç°æ¡ˆä¾‹" class="headerlink" title="å®ç°æ¡ˆä¾‹"></a>å®ç°æ¡ˆä¾‹</h3><p>è‡ªè¡Œå‡†å¤‡å‡ ä¸ªæ–‡ä»¶æˆ–è€…å‹ç¼©åŒ…ï¼Œæˆ‘è¿™é‡Œå‡†å¤‡äº† 4 ä¸ªç”¨è¿‡çš„å‹ç¼©åŒ…ã€‚</p><ul><li>åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå°†å‹ç¼©åŒ…æ”¾å…¥å…¶ä¸­ï¼Œæˆ‘è¿™é‡Œåˆ›å»ºçš„è·¯å¾„æ˜¯ <code>/opt/download</code></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/download</span><br></pre></td></tr></table></figure><ul><li>ç„¶åæŠŠå‹ç¼©åŒ…éƒ½æ”¾åˆ°è¯¥ç›®å½•ä¸‹</li></ul><p>æ•ˆæœå¦‚ä¸‹:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master download]<span class="comment"># pwd</span></span><br><span class="line">/opt/download</span><br><span class="line">[root@master download]<span class="comment"># ll</span></span><br><span class="line">æ€»ç”¨é‡ 545504</span><br><span class="line">-rw-r--r--. 1 root root 408587111 3æœˆ  12 22:02 hadoop-2.10.1.tar.gz</span><br><span class="line">-rw-r--r--. 1 root root 145520298 3æœˆ  12 21:29 jdk-8u301-linux-x64.tar.gz</span><br><span class="line">-rw-r--r--  1 root root     25680 4æœˆ  27 2017 mysql57-community-release-el7-11.noarch.rpm</span><br><span class="line">-rw-r--r--  1 root root   4456335 5æœˆ   9 19:40 mysql-connector-java-5.1.48.tar.gz</span><br></pre></td></tr></table></figure><ul><li>æ‰“å¼€ Nginx çš„é…ç½®æ–‡ä»¶</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><ul><li>æ·»åŠ é…ç½®å¦‚ä¸‹å†…å®¹ï¼š</li></ul><p><strong>æœ‰æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /download &#123;</span><br><span class="line">    <span class="attribute">root</span> /opt;                <span class="comment"># ä¸‹è½½ç›®å½•æ‰€åœ¨çš„è·¯å¾„ï¼Œlocation åé¢çš„ /download æ‹¼æ¥åˆ° /opt åé¢</span></span><br><span class="line">    <span class="comment"># ä»¥è¿™äº›åç¼€çš„æ–‡ä»¶ç‚¹å‡»åä¸ºä¸‹è½½ï¼Œæ³¨é‡Šæ‰åˆ™ txt ç­‰æ–‡ä»¶æ˜¯åœ¨ç½‘é¡µæ‰“å¼€å¹¶æŸ¥çœ‹å†…å®¹</span></span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$request_filename</span> <span class="regexp">~* ^.*?\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx|conf)$)</span>&#123;</span><br><span class="line">  <span class="attribute">add_header</span> Content-Disposition <span class="string">'attachment;'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;  <span class="comment"># å¯ç”¨ç›®å½•åˆ—è¡¨çš„è¾“å‡º</span></span><br><span class="line">    <span class="attribute">autoindex_exact_size</span> <span class="literal">on</span>;  <span class="comment"># åœ¨ç›®å½•åˆ—è¡¨å±•ç¤ºæ–‡ä»¶çš„è¯¦ç»†å¤§å°</span></span><br><span class="line">    <span class="attribute">autoindex_format</span> html;  <span class="comment"># è®¾ç½®ç›®å½•åˆ—è¡¨çš„æ ¼å¼ä¸º html</span></span><br><span class="line">    <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;   <span class="comment"># ç›®å½•åˆ—è¡¨ä¸Šæ˜¾ç¤ºç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ— æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /download &#123;</span><br><span class="line">    <span class="attribute">root</span> /opt;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$request_filename</span> <span class="regexp">~* ^.*?\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx|conf)$)</span>&#123;</span><br><span class="line">  <span class="attribute">add_header</span> Content-Disposition <span class="string">'attachment;'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">autoindex_exact_size</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">autoindex_format</span> html;</span><br><span class="line">    <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><p>root æŒ‡ä»¤åé¢å¿…é¡»æ˜¯ä¸‹è½½è·¯å¾„ï¼Œå› ä¸ºæˆ‘çš„ä¸‹è½½è·¯å¾„æ˜¯ <code>/opt/download</code>ï¼Œæ‰€ä»¥è¿™é‡Œå¡«å†™ <code>/opt</code>ï¼Œè€Œ location çš„ <code>/download</code> ä¼šè‡ªåŠ¨æ‹¼æ¥åˆ°åé¢ï¼Œå½¢æˆå®Œæ•´çš„ä¸‹è½½è·¯å¾„ã€‚</p><ul><li>è®¿é—® <code>192.168.91.200/download</code></li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.3gmq4emy84w0.webp" alt="image"></p><ul><li>JSONå’ŒXMLæ ¼å¼(ä¸€èˆ¬ä¸ç”¨è¿™ä¸¤ç§æ ¼å¼)</li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.6n5evv8oo5k0.webp" alt="image"></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.kvsekaaiu40.webp" alt="image"></p><h2 id="Nginxç”¨æˆ·è®¤è¯æ¨¡å—"><a href="#Nginxç”¨æˆ·è®¤è¯æ¨¡å—" class="headerlink" title="Nginxç”¨æˆ·è®¤è¯æ¨¡å—"></a>Nginxç”¨æˆ·è®¤è¯æ¨¡å—</h2><p>å¯¹åº”ç³»ç»Ÿèµ„æºçš„è®¿é—®ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦é™åˆ¶è°èƒ½è®¿é—®ï¼Œè°ä¸èƒ½è®¿é—®ã€‚è¿™å—å°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„è®¤è¯éƒ¨åˆ†ï¼Œè®¤è¯éœ€è¦åšçš„å°±æ˜¯æ ¹æ®ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç æ¥åˆ¤å®šç”¨æˆ·æ˜¯å¦ä¸ºåˆæ³•ç”¨æˆ·ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œè®¿é—®ï¼Œå¦‚æœä¸æ˜¯åˆ™æ‹’ç»è®¿é—®ã€‚</p><p>Nginx å¯¹åº”ç”¨æˆ·è®¤è¯è¿™å—æ˜¯é€šè¿‡ <code>ngx_http_auth_basic_module</code> æ¨¡å—æ¥å®ç°çš„ï¼Œå®ƒå…è®¸é€šè¿‡ä½¿ç”¨ã€ŒHTTPåŸºæœ¬èº«ä»½éªŒè¯ã€åè®®éªŒè¯ç”¨æˆ·åå’Œå¯†ç æ¥é™åˆ¶å¯¹èµ„æºçš„è®¿é—®ã€‚é»˜è®¤æƒ…å†µä¸‹ Nginx æ˜¯å·²ç»å®‰è£…äº†è¯¥æ¨¡å—ï¼Œå¦‚æœä¸éœ€è¦åˆ™ä½¿ç”¨ <code>--without-http_auth_basic_module</code> åˆ é™¤è®¤è¯æ¨¡å—ã€‚</p><p>è¯¥æ¨¡å—çš„æŒ‡ä»¤æ¯”è¾ƒç®€å•ã€‚</p><h3 id="auth-basic"><a href="#auth-basic" class="headerlink" title="auth_basic"></a>auth_basic</h3><p><code>auth_basic</code> æŒ‡ä»¤ä½¿ç”¨ã€ŒHTTPåŸºæœ¬èº«ä»½éªŒè¯ã€åè®®å¯ç”¨ç”¨æˆ·åå’Œå¯†ç çš„éªŒè¯ã€‚é»˜è®¤å…³é—­ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>auth_basic &lt;string | off&gt;;</td><td>auth_basic off;</td><td>httpã€serverã€locationã€limit_except</td></tr></tbody></table><p>å¼€å¯åï¼ŒæœåŠ¡ç«¯ä¼šè¿”å› 401ï¼ŒæŒ‡å®šçš„å­—ç¬¦ä¸²ä¼šè¿”å›åˆ°å®¢æˆ·ç«¯ï¼Œç»™ç”¨æˆ·ä»¥æç¤ºä¿¡æ¯ï¼Œä½†æ˜¯ä¸åŒçš„æµè§ˆå™¨å¯¹å†…å®¹çš„å±•ç¤ºä¸ä¸€è‡´ã€‚</p><h3 id="auth-basic-user-file"><a href="#auth-basic-user-file" class="headerlink" title="auth_basic_user_file"></a>auth_basic_user_file</h3><p><code>auth_basic_user_file</code> æŒ‡ä»¤æŒ‡å®šç”¨æˆ·åå’Œå¯†ç æ‰€åœ¨æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ‰€åœ¨çš„è·¯å¾„ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>auth_basic_user_file <file>;</file></td><td>â€”</td><td>httpã€serverã€locationã€limit_except</td></tr></tbody></table><p>æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œè¯¥æ–‡ä»¶ä¸­è®¾ç½®ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯†ç éœ€è¦è¿›è¡ŒåŠ å¯†ã€‚å¯ä»¥é‡‡ç”¨å·¥å…·è‡ªåŠ¨ç”Ÿæˆã€‚</p><h3 id="å®ç°æ¡ˆä¾‹-1"><a href="#å®ç°æ¡ˆä¾‹-1" class="headerlink" title="å®ç°æ¡ˆä¾‹"></a>å®ç°æ¡ˆä¾‹</h3><ul><li>åœ¨é…ç½®æ–‡ä»¶ nginx.conf æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</li></ul><p><strong>æœ‰æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /download&#123;</span><br><span class="line">    <span class="comment"># ä¸‹è½½ç«™ç‚¹çŸ¥è¯†</span></span><br><span class="line">    <span class="attribute">root</span> /opt;                <span class="comment"># ä¸‹è½½ç›®å½•æ‰€åœ¨çš„è·¯å¾„ï¼Œlocation åé¢çš„ /download æ‹¼æ¥åˆ° /opt åé¢</span></span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;  <span class="comment"># å¯ç”¨ç›®å½•åˆ—è¡¨çš„è¾“å‡º</span></span><br><span class="line">    <span class="attribute">autoindex_exact_size</span> <span class="literal">on</span>;  <span class="comment"># åœ¨ç›®å½•åˆ—è¡¨å±•ç¤ºæ–‡ä»¶çš„è¯¦ç»†å¤§å°</span></span><br><span class="line">    <span class="attribute">autoindex_format</span> html;  <span class="comment"># è®¾ç½®ç›®å½•åˆ—è¡¨çš„æ ¼å¼ä¸º html</span></span><br><span class="line">    <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;   <span class="comment"># ç›®å½•åˆ—è¡¨ä¸Šæ˜¾ç¤ºç³»ç»Ÿæ—¶é—´</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¤è¯æ¨¡å—çŸ¥è¯†</span></span><br><span class="line">    <span class="attribute">auth_basic</span> <span class="string">'please input your auth'</span>;   <span class="comment"># å¯ç”¨æˆ·åå’Œå¯†ç çš„éªŒè¯ï¼Œå¹¶åœ¨è¯·æ±‚å¤´æ’å…¥æ•°æ®</span></span><br><span class="line">    <span class="attribute">auth_basic_user_file</span> htpasswd;    <span class="comment"># å­˜ç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ— æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /download&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">root</span> /opt;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">autoindex_exact_size</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">autoindex_format</span> html;</span><br><span class="line">    <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">auth_basic</span> <span class="string">'please input your auth'</span>;   </span><br><span class="line">    <span class="attribute">auth_basic_user_file</span> htpasswd;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>htpasswd</code> å·¥å…·ç”ŸæˆåŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y httpd-tools</span><br></pre></td></tr></table></figure><p>è¯¥å·¥å…·åŸºæœ¬æ“ä½œæŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c /usr/<span class="built_in">local</span>/nginx/conf/htpasswd username   <span class="comment"># åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶è®°å½•ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯†ç åé¢å¼¹å‡ºè¾“å…¥</span></span><br><span class="line">htpasswd -b /usr/<span class="built_in">local</span>/nginx/conf/htpasswd username password   <span class="comment"># åœ¨æŒ‡å®šæ–‡ä»¶æ–°å¢ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line">htpasswd -D /usr/<span class="built_in">local</span>/nginx/conf/htpasswd username   <span class="comment"># ä»æŒ‡å®šæ–‡ä»¶åˆ é™¤ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">htpasswd -v /usr/<span class="built_in">local</span>/nginx/conf/htpasswd username   <span class="comment"># éªŒè¯ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®éœ€æ±‚æŒ‡å®šç”Ÿæˆè·¯å¾„çš„ä½ç½®ã€‚</p><ul><li>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª frx çš„ç”¨æˆ·åï¼Œå¯†ç æ˜¯ 123456</li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.5uqgyc41uuc0.webp" alt="image"></p><p>å¯ä»¥æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master conf]<span class="comment"># cat /usr/local/nginx/conf/htpasswd</span></span><br><span class="line">frx:<span class="variable">$apr1</span><span class="variable">$wDXdSh0O</span><span class="variable">$yR66Agylnta9zupO7cD3k</span>.</span><br></pre></td></tr></table></figure><ul><li>æµè§ˆå™¨è®¿é—® <code>192.168.91.200/download</code><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220806/image.1j6bwl4jr2g0.webp" alt="image"></li></ul><p>ä¸Šè¿°æ–¹å¼è™½ç„¶èƒ½å®ç°ç”¨æˆ·åå’Œå¯†ç çš„éªŒè¯ï¼Œä½†æ˜¯å¤§å®¶ä¹Ÿçœ‹åˆ°äº†ï¼Œæ‰€æœ‰çš„ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯éƒ½è®°å½•åœ¨æ–‡ä»¶é‡Œé¢ï¼Œå¦‚æœç”¨æˆ·é‡è¿‡å¤§çš„è¯ï¼Œè¿™ç§æ–¹å¼å°±æ˜¾å¾—æœ‰ç‚¹éº»çƒ¦äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¾—é€šè¿‡åå°ä¸šåŠ¡ä»£ç æ¥è¿›è¡Œç”¨æˆ·æƒé™çš„æ ¡éªŒäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--é™æ€æˆå‘˜çš„ç»§æ‰¿é—®é¢˜</title>
      <link href="/2022/11/15/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(42)/"/>
      <url>/2022/11/15/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(42)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>çœ‹ä¸¤æ®µä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendsDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Cat c = <span class="keyword">new</span> Cat();</span><br><span class="line">        c.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String schoolName =<span class="string">"é»‘çŒ«"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(schoolName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment"> * é»‘çŒ«</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è¡¨æ˜é™æ€çš„çˆ¶ç±»æˆå‘˜ä¾æ—§æ˜¯å¯ä»¥è¢«ç»§æ‰¿åˆ°å­ç±»çš„ï¼Œå¦åˆ™ä¸å¯èƒ½é€šè¿‡å­ç±»å¼•ç”¨è®¿é—®åˆ°è¿™ä¸ªé™æ€çš„çˆ¶ç±»æ–¹æ³•ã€‚</p><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendsDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Cat c = <span class="keyword">new</span> Cat();</span><br><span class="line">        Animal a = <span class="keyword">new</span> Cat();</span><br><span class="line"></span><br><span class="line">        c.test();</span><br><span class="line">        a.test();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String schoolName = <span class="string">"ç™½çŒ«"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(schoolName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String schoolName =<span class="string">"é»‘çŒ«"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(schoolName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment"> * ç™½çŒ«</span></span><br><span class="line"><span class="comment"> * é»‘çŒ«</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è¡¨æ˜ï¼Œè™½ç„¶é™æ€æˆå‘˜å¯ä»¥è¢«ç»§æ‰¿ï¼Œä½†æ˜¯å’Œå­ç±»çš„åŒåé™æ€æ–¹æ³•å¹¶ä¸æ„æˆé‡å†™å…³ç³»ï¼Œå­ç±»çš„åŒåé™æ€æ–¹æ³•ä¼šå°†çˆ¶ç±»åŒåé™æ€æ–¹æ³•éšè—ï¼Œå› æ­¤ä¹Ÿä¸æ”¯æŒå¤šæ€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx è´Ÿè½½å‡è¡¡</title>
      <link href="/2022/11/14/Nginx_load_balancing/"/>
      <url>/2022/11/14/Nginx_load_balancing/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-è´Ÿè½½å‡è¡¡"><a href="#Nginx-è´Ÿè½½å‡è¡¡" class="headerlink" title="Nginx è´Ÿè½½å‡è¡¡"></a>Nginx è´Ÿè½½å‡è¡¡</h1><p><strong>è´Ÿè½½å‡è¡¡</strong></p><p>è´Ÿè½½å‡è¡¡æ˜¯å®é™…å¼€å‘å¿…é¡»æŒæ¡çš„æŠ€èƒ½ï¼ŒNginx å¦‚ä½•å°†å°‘æ•°è¯·æ±‚è·Ÿå¤šå°æœåŠ¡å™¨è¿›è¡Œæ²Ÿé€šï¼Œè®©æ¯ä¸€å°æœåŠ¡å™¨çš„è¯·æ±‚å¤„ç†é¢é¢ä¿±åˆ°ï¼Ÿæœ¬å†…å®¹å°†å­¦ä¹  Nginx çš„è´Ÿè½½å‡è¡¡çŸ¥è¯†ã€‚</p><h2 id="è´Ÿè½½å‡è¡¡æ¦‚è¿°"><a href="#è´Ÿè½½å‡è¡¡æ¦‚è¿°" class="headerlink" title="è´Ÿè½½å‡è¡¡æ¦‚è¿°"></a>è´Ÿè½½å‡è¡¡æ¦‚è¿°</h2><p>æ—©æœŸçš„ç½‘ç«™æµé‡å’Œä¸šåŠ¡åŠŸèƒ½éƒ½æ¯”è¾ƒç®€å•ï¼Œå•å°æœåŠ¡å™¨è¶³ä»¥æ»¡è¶³åŸºæœ¬çš„éœ€æ±‚ï¼Œä½†æ˜¯éšç€äº’è”ç½‘çš„å‘å±•ï¼Œä¸šåŠ¡æµé‡è¶Šæ¥è¶Šå¤§å¹¶ä¸”ä¸šåŠ¡é€»è¾‘ä¹Ÿè·Ÿç€è¶Šæ¥è¶Šå¤æ‚ï¼Œå•å°æœåŠ¡å™¨çš„æ€§èƒ½åŠå•ç‚¹æ•…éšœé—®é¢˜å°±å‡¸æ˜¾å‡ºæ¥äº†ï¼Œå› æ­¤éœ€è¦å¤šå°æœåŠ¡å™¨è¿›è¡Œæ€§èƒ½çš„æ°´å¹³æ‰©å±•åŠé¿å…å•ç‚¹æ•…éšœå‡ºç°ã€‚é‚£ä¹ˆå¦‚ä½•å°†ä¸åŒç”¨æˆ·çš„è¯·æ±‚æµé‡åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šå‘¢ï¼Ÿè¿™å°±éœ€è¦è´Ÿè½½å‡è¡¡æ¥å¤„ç†ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220803/image.5kgql84ikx80.webp" alt="image"></p><h2 id="è´Ÿè½½å‡è¡¡åŸç†åŠå¤„ç†æµç¨‹"><a href="#è´Ÿè½½å‡è¡¡åŸç†åŠå¤„ç†æµç¨‹" class="headerlink" title="è´Ÿè½½å‡è¡¡åŸç†åŠå¤„ç†æµç¨‹"></a>è´Ÿè½½å‡è¡¡åŸç†åŠå¤„ç†æµç¨‹</h2><p>ç³»ç»Ÿçš„æ‰©å±•å¯ä»¥åˆ†ä¸ºçºµå‘æ‰©å±•å’Œæ¨ªå‘æ‰©å±•ã€‚</p><ul><li>çºµå‘æ‰©å±•æ˜¯ä»å•æœºçš„è§’åº¦å‡ºå‘ï¼Œé€šè¿‡å¢åŠ ç³»ç»Ÿçš„ç¡¬ä»¶å¤„ç†èƒ½åŠ›æ¥æå‡æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›</li><li>æ¨ªå‘æ‰©å±•æ˜¯é€šè¿‡æ·»åŠ æœºå™¨æ¥æ»¡è¶³å¤§å‹ç½‘ç«™æœåŠ¡çš„å¤„ç†èƒ½åŠ›</li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220803/image.1xwd1pm6du68.webp" alt="image"></p><p>å¦‚ä¸Šå›¾ï¼Œè´Ÿè½½å‡è¡¡æ¶‰åŠåˆ°ä¸¤ä¸ªé‡è¦çš„è§’è‰²åˆ†åˆ«æ˜¯ã€Œåº”ç”¨é›†ç¾¤ã€å’Œã€Œè´Ÿè½½å‡è¡¡å™¨ã€ã€‚</p><ul><li>åº”ç”¨é›†ç¾¤ï¼šå°†åŒä¸€åº”ç”¨éƒ¨ç½²åˆ°å¤šå°æœºå™¨ä¸Šï¼Œç»„æˆå¤„ç†é›†ç¾¤ï¼Œæ¥æ”¶è´Ÿè½½å‡è¡¡è®¾å¤‡åˆ†å‘çš„è¯·æ±‚ï¼Œè¿›è¡Œå¤„ç†å¹¶è¿”å›å“åº”çš„æ•°æ®</li><li>è´Ÿè½½å‡è¡¡å™¨ï¼šå°†ç”¨æˆ·è®¿é—®çš„è¯·æ±‚æ ¹æ®å¯¹åº”çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåˆ†å‘åˆ°é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨è¿›è¡Œå¤„ç†</li></ul><h3 id="è´Ÿè½½å‡è¡¡ä½œç”¨"><a href="#è´Ÿè½½å‡è¡¡ä½œç”¨" class="headerlink" title="è´Ÿè½½å‡è¡¡ä½œç”¨"></a>è´Ÿè½½å‡è¡¡ä½œç”¨</h3><ul><li>è§£å†³æœåŠ¡å™¨çš„é«˜å¹¶å‘å‹åŠ›ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„å¤„ç†æ€§èƒ½</li><li>æä¾›æ•…éšœè½¬ç§»ï¼Œå®ç°é«˜å¯ç”¨</li><li>é€šè¿‡æ·»åŠ æˆ–å‡å°‘æœåŠ¡å™¨æ•°é‡ï¼Œå¢å¼ºç½‘ç«™çš„å¯æ‰©å±•æ€§</li><li>åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸Šè¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§</li></ul><h2 id="è´Ÿè½½å‡è¡¡å¸¸ç”¨å¤„ç†æ–¹å¼"><a href="#è´Ÿè½½å‡è¡¡å¸¸ç”¨å¤„ç†æ–¹å¼" class="headerlink" title="è´Ÿè½½å‡è¡¡å¸¸ç”¨å¤„ç†æ–¹å¼"></a>è´Ÿè½½å‡è¡¡å¸¸ç”¨å¤„ç†æ–¹å¼</h2><p>å…ˆè¯´æ˜ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ˜¯ <a href="/middleware/Nginx/Nginx_load_balancing/#å››-ä¸ƒå±‚è´Ÿè½½å‡è¡¡">å››/ä¸ƒå±‚è´Ÿè½½å‡è¡¡</a> æ–¹å¼ï¼Œå‰é¢ä¸¤ä¸ªæ–¹å¼å¯ä»¥äº†è§£ã€‚</p><h3 id="ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©"><a href="#ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©" class="headerlink" title="ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©"></a>ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©</h3><p>è¿™ç§æ–¹å¼æ¯”è¾ƒåŸå§‹ï¼Œä¸»è¦å®ç°çš„æ–¹å¼å°±æ˜¯åœ¨ç½‘ç«™ä¸»é¡µä¸Šé¢æä¾›ä¸åŒçº¿è·¯ã€ä¸åŒæœåŠ¡å™¨é“¾æ¥æ–¹å¼ï¼Œè®©ç”¨æˆ·æ¥é€‰æ‹©è‡ªå·±è®¿é—®çš„å…·ä½“æœåŠ¡å™¨ï¼Œæ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œç”¨æˆ·ç‚¹å‡»ä¸åŒçš„ä¸‹è½½æ–¹å¼ï¼Œå°±ä¼šè·³è½¬åˆ°ä¸åŒçš„ä¸‹è½½åœ°å€ã€‚è¿™æ˜¯ä¸»åŠ¨å¼çš„è´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬æ— æ³•æ§åˆ¶ç”¨æˆ·çš„é€‰æ‹©ã€‚å¦‚æœç”¨æˆ·å…¨éƒ¨ç‚¹å‡»ç¬¬ä¸€ä¸ªä¸‹è½½æ–¹å¼ï¼Œé‚£ä¹ˆæœåŠ¡å™¨çš„å‹åŠ›å°†éå¸¸å¤§ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220803/image.2auhoddxb2zo.webp" alt="image"></p><h3 id="DNSè½®è¯¢æ–¹å¼"><a href="#DNSè½®è¯¢æ–¹å¼" class="headerlink" title="DNSè½®è¯¢æ–¹å¼"></a>DNSè½®è¯¢æ–¹å¼</h3><p>DNSï¼šåŸŸåç³»ç»Ÿï¼ˆæœåŠ¡ï¼‰åè®®ï¼ˆDNSï¼‰æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç½‘ç»œç›®å½•æœåŠ¡ï¼Œä¸»è¦ç”¨äºåŸŸåä¸ IP åœ°å€çš„ç›¸äº’è½¬æ¢ã€‚</p><p>å¤§å¤šåŸŸåæ³¨å†Œå•†éƒ½æ”¯æŒå¯¹åŒä¸€ä¸ªä¸»æœºåæ·»åŠ å¤šæ¡ A è®°å½•ï¼Œè¿™å°±æ˜¯ DNS è½®è¯¢ï¼ŒDNS æœåŠ¡å™¨å°†è§£æè¯·æ±‚æŒ‰ç…§ A è®°å½•çš„é¡ºåºï¼Œéšæœºåˆ†é…åˆ°ä¸åŒçš„ IP ä¸Šï¼Œè¿™æ ·å°±èƒ½å®Œæˆç®€å•çš„è´Ÿè½½å‡è¡¡ã€‚DNS è½®è¯¢çš„æˆæœ¬éå¸¸ä½ï¼Œåœ¨ä¸€äº›ä¸é‡è¦çš„æœåŠ¡å™¨ï¼Œè¢«ç»å¸¸ä½¿ç”¨ã€‚</p><p>å¦‚ä¸‹å›¾ï¼šå®¢æˆ·ç«¯å¦‚æœæƒ³è®¿é—®æœåŠ¡å™¨é›†ç¾¤ï¼Œé¦–å…ˆå» DNS æœåŠ¡å™¨è·å–æˆ‘ä»¬æ›¾ç»åœ¨ DNS æœåŠ¡å™¨ä¿å­˜çš„ã€Œè®°å½•è¡¨ã€ï¼Œè¿™ä¸ªã€Œè®°å½•è¡¨ã€å°†ä¼šæŠŠæŸä¸ªæœåŠ¡å™¨çš„åœ°å€è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å†æ ¹æ®è¿™ä¸ªåœ°å€ï¼Œè®¿é—®æŒ‡å®šçš„æœåŠ¡å™¨ã€‚è¿™ä¸ªã€Œè®°å½•è¡¨ã€åœ¨å¼€å§‹æœŸé—´éœ€è¦æˆ‘ä»¬å» DNS æœåŠ¡å™¨è¿›è¡Œæ·»åŠ ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220803/image.b1m3qaeuxsk.webp" alt="image"></p><p>ã€Œè®°å½•è¡¨ã€é•¿ä»€ä¹ˆæ ·ï¼Œå¦‚ä¸‹å›¾çš„ä¸»æœºè®°å½• wwwã€‚è¿™æ˜¯æˆ‘ä¸ºæŸä¸€ä¸ªåŸŸåæ·»åŠ çš„ IP åœ°å€ï¼Œç”¨ 2 å°æœåŠ¡å™¨æ¥åšè´Ÿè½½å‡è¡¡ã€‚å…¶ä¸­ä¸¤ä¸ªè®°å½•å€¼éƒ½ç»‘å®šäº† <code>www.nginx521.cn</code> åœ°å€ã€‚(ä¸€ä¸ªåŸŸåå¯ä»¥ç»‘å®šå¤šä¸ªIPåœ°å€)</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220803/image.3drj9szeeus0.webp" alt="image"></p><p>éªŒè¯:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.nginx521.cn</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè®°å¾—æ¸…ç©ºæœ¬åœ°çš„ DNS ç¼“å­˜ï¼Œå¦‚æœæœ¬åœ°æœ‰ç¼“å­˜ï¼Œæ— è®ºä½ æ€ä¹ˆ <code>ping</code>ï¼Œéƒ½ä¼š <code>ping</code> åˆ°ç¼“å­˜çš„æœåŠ¡å™¨åœ°å€ï¼Œæ— æ³•è´Ÿè½½å‡è¡¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig/flushdns</span><br></pre></td></tr></table></figure><p>ç›®å‰éœ€è¦ <code>ping</code> ä¸€æ¬¡ç„¶åæ¸…ç†ä¸€æ¬¡ç¼“å­˜ï¼Œæ‰èƒ½å®ç°è´Ÿè½½å‡è¡¡çš„è½®è¯¢æ•ˆæœã€‚</p><p>æˆ‘ä»¬å‘ç°ä½¿ç”¨ DNS æ¥å®ç°è½®è¯¢ï¼Œä¸éœ€è¦æŠ•å…¥è¿‡å¤šçš„æˆæœ¬ï¼Œè™½ç„¶ DNS è½®è¯¢æˆæœ¬ä½å»‰ï¼Œä½†æ˜¯ DNS è´Ÿè½½å‡è¡¡å­˜åœ¨æ˜æ˜¾çš„ç¼ºç‚¹ï¼š</p><ol><li><p>å¯é æ€§ä½</p><p>å‡è®¾ä¸€ä¸ªåŸŸå DNS è½®è¯¢å¤šå°æœåŠ¡å™¨ï¼Œå¦‚æœå…¶ä¸­çš„ä¸€å°æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è®¿é—®è¯¥æœåŠ¡å™¨çš„è¯·æ±‚å°†ä¸ä¼šæœ‰æ‰€å›åº”ï¼Œå³ä½¿ä½ å°†è¯¥æœåŠ¡å™¨çš„ IP ä» DNS ä¸­å»æ‰ï¼Œä½†æ˜¯ç”±äºå„å¤§å®½å¸¦æ¥å…¥å•†å°†ä¼—å¤šçš„ DNS å­˜æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œä»¥èŠ‚çœè®¿é—®æ—¶é—´ï¼Œå¯¼è‡´ DNS ä¸ä¼šå®æ—¶æ›´æ–°ã€‚æ‰€ä»¥ DNS è½®æµä¸Šä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è´Ÿè½½å‡è¡¡é—®é¢˜ï¼Œä½†æ˜¯å´å­˜åœ¨å¯é æ€§ä¸é«˜çš„ç¼ºç‚¹ã€‚</p></li><li><p>è´Ÿè½½å‡è¡¡ä¸å‡è¡¡</p><p>DNS è´Ÿè½½å‡è¡¡é‡‡ç”¨çš„æ˜¯ç®€å•çš„è½®è¯¢è´Ÿè½½ç®—æ³•ï¼Œä¸èƒ½åŒºåˆ†æœåŠ¡å™¨çš„å·®å¼‚ï¼Œä¸èƒ½åæ˜ æœåŠ¡å™¨çš„å½“å‰è¿è¡ŒçŠ¶æ€ï¼Œä¸èƒ½åšåˆ°ä¸ºæ€§èƒ½å¥½çš„æœåŠ¡å™¨å¤šåˆ†é…è¯·æ±‚ï¼Œå¦å¤–æœ¬åœ°è®¡ç®—æœºä¹Ÿä¼šç¼“å­˜å·²ç»è§£æçš„åŸŸååˆ° IP åœ°å€çš„æ˜ å°„ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´ä½¿ç”¨è¯¥ DNS æœåŠ¡å™¨çš„ç”¨æˆ·åœ¨ä¸€å®šæ—¶é—´å†…è®¿é—®çš„æ˜¯åŒä¸€å° Web æœåŠ¡å™¨ï¼Œä»è€Œå¼•å‘ Web æœåŠ¡å™¨å‡çš„è´Ÿè½½ä¸å‡è¡¡ã€‚</p><p>è´Ÿè½½ä¸å‡è¡¡åˆ™ä¼šå¯¼è‡´æŸå‡ å°æœåŠ¡å™¨è´Ÿè·å¾ˆä½ï¼Œè€Œå¦å¤–å‡ å°æœåŠ¡å™¨è´Ÿè·ç¡®å¾ˆé«˜ï¼Œå¤„ç†è¯·æ±‚çš„é€Ÿåº¦æ…¢ï¼Œé…ç½®é«˜çš„æœåŠ¡å™¨åˆ†é…åˆ°çš„è¯·æ±‚å°‘ï¼Œè€Œé…ç½®ä½çš„æœåŠ¡å™¨åˆ†é…åˆ°çš„è¯·æ±‚å¤šã€‚</p></li></ol><h3 id="å››-ä¸ƒå±‚è´Ÿè½½å‡è¡¡"><a href="#å››-ä¸ƒå±‚è´Ÿè½½å‡è¡¡" class="headerlink" title="å››/ä¸ƒå±‚è´Ÿè½½å‡è¡¡"></a>å››/ä¸ƒå±‚è´Ÿè½½å‡è¡¡</h3><p>ä»‹ç»å››/ä¸ƒå±‚è´Ÿè½½å‡è¡¡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µï¼ŒOSI(open system interconnection)ï¼Œå«å¼€æ”¾å¼ç³»ç»Ÿäº’è”æ¨¡å‹ï¼Œè¿™ä¸ªæ˜¯ç”±å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ ISO æŒ‡å®šçš„ä¸€ä¸ªä¸åŸºäºå…·ä½“æœºå‹ã€æ“ä½œç³»ç»Ÿæˆ–å…¬å¸çš„ç½‘ç»œä½“ç³»ç»“æ„ã€‚è¯¥æ¨¡å‹å°†ç½‘ç»œé€šä¿¡çš„å·¥ä½œåˆ†ä¸ºä¸ƒå±‚ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220803/image.5g3vvj5xa3g0.webp" alt="image"></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220803/image.6uq265ihol80.webp" alt="image"></p><ul><li>åº”ç”¨å±‚ï¼šä¸ºåº”ç”¨ç¨‹åºæä¾›ç½‘ç»œæœåŠ¡ã€‚</li><li>è¡¨ç¤ºå±‚ï¼šå¯¹æ•°æ®è¿›è¡Œæ ¼å¼åŒ–ã€ç¼–ç ã€åŠ å¯†ã€å‹ç¼©ç­‰æ“ä½œ</li><li>ä¼šè¯å±‚ï¼šå»ºç«‹ã€ç»´æŠ¤ã€ç®¡ç†ä¼šè¯è¿æ¥</li><li>ä¼ è¾“å±‚ï¼šå»ºç«‹ã€ç»´æŠ¤ã€ç®¡ç†ç«¯åˆ°ç«¯çš„è¿æ¥ï¼Œå¸¸è§çš„æœ‰ TCP/UDP</li><li>ç½‘ç»œå±‚ï¼šIP å¯»å€å’Œè·¯ç”±é€‰æ‹©</li><li>æ•°æ®é“¾è·¯å±‚ï¼šæ§åˆ¶ç½‘ç»œå±‚ä¸ç‰©ç†å±‚ä¹‹é—´çš„é€šä¿¡</li><li>ç‰©ç†å±‚ï¼šæ¯”ç‰¹æµä¼ è¾“</li></ul><p><strong>ä»€ä¹ˆæ˜¯å››å±‚è´Ÿè½½å‡è¡¡</strong></p><p>æ‰€è°“å››å±‚è´Ÿè½½å‡è¡¡æŒ‡çš„æ˜¯ OSI ä¸ƒå±‚æ¨¡å‹ä¸­çš„ä¼ è¾“å±‚ï¼Œä¸»è¦æ˜¯åŸºäº IP + PORT çš„è´Ÿè½½å‡è¡¡</p><p>å®ç°å››å±‚è´Ÿè½½å‡è¡¡çš„æ–¹å¼ï¼š</p><ul><li>ç¡¬ä»¶ï¼šF5 BIG-IPã€Radware ç­‰ï¼Œæ€§èƒ½å¥½ï¼Œæˆæœ¬é«˜ã€æ— æ³•æ‰©å±•</li><li>è½¯ä»¶ï¼šLVSã€Nginxã€Hayproxy ç­‰ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œæˆæœ¬ä½ã€å¯ä»¥æ‰©å±•</li></ul><p><strong>ä»€ä¹ˆæ˜¯ä¸ƒå±‚è´Ÿè½½å‡è¡¡</strong></p><p>æ‰€è°“çš„ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡çš„æ˜¯åœ¨åº”ç”¨å±‚ï¼Œä¸»è¦æ˜¯åŸºäºè™šæ‹Ÿçš„ URL æˆ–ä¸»æœº IP çš„è´Ÿè½½å‡è¡¡</p><p>å®ç°ä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„æ–¹å¼ï¼š</p><ul><li>è½¯ä»¶ï¼šNginxã€Hayproxy ç­‰</li></ul><p><strong>å››å±‚å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„åŒºåˆ«</strong></p><ul><li>å››å±‚è´Ÿè½½å‡è¡¡æ•°æ®åŒ…æ˜¯åœ¨åº•å±‚å°±è¿›è¡Œäº†åˆ†å‘ï¼Œè€Œä¸ƒå±‚è´Ÿè½½å‡è¡¡æ•°æ®åŒ…åˆ™åœ¨æœ€é¡¶ç«¯è¿›è¡Œåˆ†å‘ï¼Œæ‰€ä»¥å››å±‚è´Ÿè½½å‡è¡¡çš„æ•ˆç‡æ¯”ä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„è¦é«˜ï¼ˆå››å±‚æ¯”ä¸ƒå±‚å°‘ï¼Œé€Ÿåº¦å—ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯å¯èƒ½è¯·æ±‚ä¸¢å¤±ç­‰ï¼‰</li><li>å››å±‚è´Ÿè½½å‡è¡¡ä¸è¯†åˆ«åŸŸåï¼Œè€Œä¸ƒå±‚è´Ÿè½½å‡è¡¡è¯†åˆ«åŸŸå</li></ul><p>å¤„ç†å››å±‚å’Œä¸ƒå±‚è´Ÿè½½ä»¥å¤–ï¼Œå…¶å®è¿˜æœ‰äºŒå±‚ã€ä¸‰å±‚è´Ÿè½½å‡è¡¡ï¼ŒäºŒå±‚æ˜¯åœ¨æ•°æ®é“¾è·¯å±‚åŸºäº mac åœ°å€æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œä¸‰å±‚æ˜¯åœ¨ç½‘ç»œå±‚ä¸€èˆ¬é‡‡ç”¨è™šæ‹Ÿ IP åœ°å€çš„æ–¹å¼å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p><strong>å®é™…ç¯å¢ƒé‡‡ç”¨çš„æ¨¡å¼ï¼šå››å±‚è´Ÿè½½(LVS) + ä¸ƒå±‚è´Ÿè½½(Nginx)</strong></p><h2 id="ä¸ƒå±‚è´Ÿè½½å‡è¡¡"><a href="#ä¸ƒå±‚è´Ÿè½½å‡è¡¡" class="headerlink" title="ä¸ƒå±‚è´Ÿè½½å‡è¡¡"></a>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</h2><p>Nginx è¦å®ç°ä¸ƒå±‚è´Ÿè½½å‡è¡¡éœ€è¦ç”¨åˆ° proxy_pass ä»£ç†æ¨¡å—é…ç½®ã€‚Nginx é»˜è®¤å®‰è£…æ”¯æŒè¿™ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†åšä»»ä½•å¤„ç†ã€‚Nginx çš„è´Ÿè½½å‡è¡¡æ˜¯åœ¨ Nginx åå‘ä»£ç†çš„åŸºç¡€ä¸ŠæŠŠç”¨æˆ·çš„è¯·æ±‚æ ¹æ®æŒ‡å®šçš„ç®—æ³•åˆ†å‘åˆ°ä¸€ç»„ã€Œupstream è™šæ‹ŸæœåŠ¡æ± ã€ã€‚</p><h3 id="ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤"><a href="#ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤" class="headerlink" title="ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤"></a>ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤</h3><h4 id="upstreamæŒ‡ä»¤"><a href="#upstreamæŒ‡ä»¤" class="headerlink" title="upstreamæŒ‡ä»¤"></a>upstreamæŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥å®šä¹‰ä¸€ç»„æœåŠ¡å™¨ï¼Œå®ƒä»¬å¯ä»¥æ˜¯ç›‘å¬ä¸åŒç«¯å£çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥æ˜¯åŒæ—¶ç›‘å¬ TCP å’Œ Unix socket çš„æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å¯ä»¥æŒ‡å®šä¸åŒçš„æƒé‡ï¼Œé»˜è®¤ä¸º 1ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>upstream &lt;name&gt; {â€¦}</td><td>â€”</td><td>http</td></tr></tbody></table><h4 id="serveræŒ‡ä»¤"><a href="#serveræŒ‡ä»¤" class="headerlink" title="serveræŒ‡ä»¤"></a>serveræŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤ç”¨æ¥æŒ‡å®šåç«¯æœåŠ¡å™¨çš„åç§°å’Œä¸€äº›å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨åŸŸåã€IPã€ç«¯å£æˆ–è€… Unix socketã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>server &lt;name&gt; [paramerters]</td><td>â€”</td><td>upstream</td></tr></tbody></table><p>server åçš„ name å°±æ˜¯ upstream åçš„ nameï¼Œä¸¤è€…ä¿æŒä¸€è‡´ã€‚</p><h3 id="ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤æ¡ˆä¾‹"><a href="#ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤æ¡ˆä¾‹" class="headerlink" title="ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤æ¡ˆä¾‹"></a>ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤æ¡ˆä¾‹</h3><p>å‡†å¤‡å››å°æœåŠ¡å™¨ï¼Œä¸€å°ç”¨æ¥åšè´Ÿè½½å‡è¡¡å™¨ï¼Œä¸‰å°ç”¨æ¥æ¥æ”¶è´Ÿè½½å‡è¡¡å™¨çš„è¯·æ±‚ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220803/image.etsfgkwsxaw.webp" alt="image"></p><p>å› ä¸ºç›®å‰åªæœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¸€å°ç”¨æ¥åšè´Ÿè½½å‡è¡¡å™¨ï¼Œå¦å¤–ä¸€å°ç”¨æ¥æ¥æ”¶è´Ÿè½½å‡è¡¡å™¨çš„è¯·æ±‚ã€‚</p><p>æœåŠ¡å™¨è®¾ç½®ï¼šè¿™é‡Œä»¥ä¸‰ä¸ªç«¯å£ä»£æ›¿ä¸‰ä¸ªæœåŠ¡å™¨ï¼Œåœ¨é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœåŠ¡å™¨ 1</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>   <span class="number">9001</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">default_type</span> text/html;</span><br><span class="line">    <span class="attribute">location</span> /&#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&lt;h1&gt;192.168.200.146:9001&lt;/h1&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æœåŠ¡å™¨ 2</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>   <span class="number">9002</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">default_type</span> text/html;</span><br><span class="line">    <span class="attribute">location</span> /&#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&lt;h1&gt;192.168.200.146:9002&lt;/h1&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æœåŠ¡å™¨ 3</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>   <span class="number">9003</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">default_type</span> text/html;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&lt;h1&gt;192.168.200.146:9003&lt;/h1&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è´Ÿè½½å‡è¡¡å™¨è®¾ç½®ï¼šè¿™æ˜¯ä¸€ä¸ª Nginx ä»£ç†æœåŠ¡å™¨ï¼Œè®©å®ƒå»è´Ÿè½½å‡è¡¡è®¿é—®ä¸‰ä¸ªæœåŠ¡å™¨ï¼Œåœ¨é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9091</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9092</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9093</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;   <span class="comment"># backend è¦å¯¹åº”ä¸Š upstream åçš„å€¼ï¼Œæ ¹æ®éœ€æ±‚ä¿®æ”¹</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®è´Ÿè½½å‡è¡¡å™¨çš„åœ°å€ï¼Œå¦‚ <code>http://192.168.200.133:8083</code>ï¼Œå®ƒä¼šæ‰¾åˆ° <code>proxy_pass</code> åçš„åœ°å€ï¼Œæ¯”å¦‚ä¸Šæ–¹ï¼Œå®ƒä¼šæ ¹æ® backend æ‰¾åˆ°å¯¹åº”çš„ upstream é‡Œå†…åœ°å€ï¼Œæ›¿æ¢æ‰ backendï¼Œå˜æˆï¼š</p><ul><li>proxy_pass <code>http://192.168.200.146:9091</code></li><li>proxy_pass <code>http://192.168.200.146:9092</code></li><li>proxy_pass <code>http://192.168.200.146:9093</code></li></ul><p>ä½†æ˜¯å®ƒä¸ä¼šå…¨éƒ¨è®¿é—®ä¸‰ä¸ªæœåŠ¡å™¨åœ°å€ï¼Œè€Œæ˜¯æ ¹æ®è‡ªå·±çš„ç®—æ³•ï¼ˆè½®è¯¢ï¼‰é€‰æ‹©å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨åœ°å€ã€‚</p><h3 id="ä¸ƒå±‚è´Ÿè½½å‡è¡¡çŠ¶æ€"><a href="#ä¸ƒå±‚è´Ÿè½½å‡è¡¡çŠ¶æ€" class="headerlink" title="ä¸ƒå±‚è´Ÿè½½å‡è¡¡çŠ¶æ€"></a>ä¸ƒå±‚è´Ÿè½½å‡è¡¡çŠ¶æ€</h3><p>ä»£ç†æœåŠ¡å™¨åœ¨è´Ÿè´£å‡è¡¡è°ƒåº¦ä¸­çš„çŠ¶æ€æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><table><thead><tr><th>çŠ¶æ€</th><th>æ¦‚è¿°</th></tr></thead><tbody><tr><td>down</td><td>å½“å‰çš„ server æš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡</td></tr><tr><td>backup</td><td>é¢„ç•™çš„å¤‡ä»½æœåŠ¡å™¨</td></tr><tr><td>max_fails</td><td>å…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°</td></tr><tr><td>fail_timeout</td><td>ç»è¿‡ max_fails å¤±è´¥åï¼ŒæœåŠ¡æš‚åœæ—¶é—´</td></tr><tr><td>max_conns</td><td>é™åˆ¶æœ€å¤§çš„æ¥æ”¶è¿æ¥æ•°</td></tr></tbody></table><h4 id="down"><a href="#down" class="headerlink" title="down"></a>down</h4><p><code>down</code> æŒ‡ä»¤å°†è¯¥æœåŠ¡å™¨æ ‡è®°ä¸ºæ°¸ä¹…ä¸å¯ç”¨ï¼Œé‚£ä¹ˆè´Ÿè½½å‡è¡¡å™¨å°†ä¸å‚ä¸è¯¥æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ã€‚</p><p>å¦‚ä¸‹ï¼Œå¦‚æœä¸å¸Œæœ›è´Ÿè½½å‡è¡¡å™¨ä»¥è´Ÿè½½å‡è¡¡æ¥å¤„ç† <code>192.168.200.146</code> æœåŠ¡å™¨ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span> down;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥çŠ¶æ€ä¸€èˆ¬ä¼šå¯¹éœ€è¦åœæœºç»´æŠ¤çš„æœåŠ¡å™¨è¿›è¡Œè®¾ç½®ã€‚</p><h4 id="backup"><a href="#backup" class="headerlink" title="backup"></a>backup</h4><p><code>backup</code> æŒ‡ä»¤å°†è¯¥æœåŠ¡å™¨æ ‡è®°ä¸ºå¤‡ä»½æœåŠ¡å™¨ï¼Œå½“ä¸»æœåŠ¡å™¨ä¸å¯ç”¨æ—¶ï¼Œæ‰ç”¨å¤‡ä»½æœåŠ¡å™¨æ¥ä¼ é€’è¯·æ±‚ã€‚</p><p>å®ƒä¸åŒäº down æŒ‡ä»¤ï¼Œdown æŒ‡ä»¤å°†æœåŠ¡å™¨æ°¸ä¹…ç¦æ­¢ï¼Œè€Œ backp æŒ‡ä»¤ä»…ä»…ä¸´æ—¶ç¦æ­¢ï¼Œå½“ä¸»æœåŠ¡å™¨ä¸å¯ç”¨åï¼Œä¸´æ—¶ç¦æ­¢çš„æœåŠ¡å™¨å°±ä¼šç«™å‡ºæ¥ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span> down;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span> backup;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šæ–¹ä»£ç ä¸­ 9001 æœåŠ¡å™¨æ°¸ä¹…ç¦æ­¢ï¼Œè€Œ 9002 æœåŠ¡å™¨æ˜¯å¤‡ä»½æœåŠ¡å™¨ï¼Œæ‰€ä»¥ 9003 æœåŠ¡å™¨æ˜¯ä¸»æœåŠ¡å™¨ã€‚</p><p>æ­¤æ—¶éœ€è¦å°† 9003 ç«¯å£çš„è®¿é—®ç¦æ­¢æ‰ï¼Œç”¨å®ƒæ¥æ¨¡æ‹Ÿå½“å”¯ä¸€å¯¹å¤–æä¾›è®¿é—®çš„æœåŠ¡å®•æœºä»¥åï¼Œbackup çš„å¤‡ä»½æœåŠ¡å™¨å°±èƒ½å¼€å§‹å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><p>ä¸ºäº†æµ‹è¯•éªŒè¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨é˜²ç«å¢™æ¥è¿›è¡Œæ‹¦æˆªã€‚</p><p>ä»‹ç»ä¸€ä¸ªå·¥å…· <code>firewall-cmd</code>ï¼Œè¯¥å·¥å…·æ˜¯ Linux æä¾›çš„ä¸“é—¨ç”¨æ¥æ“ä½œ firewall é˜²ç«å¢™çš„ã€‚</p><p>æŸ¥è¯¢é˜²ç«å¢™ä¸­æŒ‡å®šçš„ç«¯å£æ˜¯å¦å¼€æ”¾</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --query-port=9001/tcp</span><br></pre></td></tr></table></figure><p>å¼€æ”¾ä¸€ä¸ªæŒ‡å®šçš„ç«¯å£</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=9002/tcp</span><br></pre></td></tr></table></figure><p>æ‰¹é‡æ·»åŠ å¼€å‘ç«¯å£</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=9001-9003/tcp</span><br></pre></td></tr></table></figure><p>å¦‚ä½•ç§»é™¤ä¸€ä¸ªæŒ‡å®šçš„ç«¯å£</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --remove-port=9003/tcp</span><br></pre></td></tr></table></figure><p>é‡æ–°åŠ è½½</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>å…¶ä¸­</p><ul><li><code>--permanent</code> è¡¨ç¤ºè®¾ç½®ä¸ºæŒä¹…</li><li><code>--add-port</code> è¡¨ç¤ºæ·»åŠ æŒ‡å®šç«¯å£</li><li><code>--remove-port</code> è¡¨ç¤ºç§»é™¤æŒ‡å®šç«¯å£</li></ul><p>ç»è¿‡æµ‹è¯•ï¼Œç¦ç”¨æ‰ 9003 ç«¯å£åï¼Œå†æ¬¡è®¿é—®è´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒåªä¼šè¯·æ±‚ 9002 ç«¯å£çš„æœåŠ¡å™¨(å¤‡ä»½æœåŠ¡å™¨)ï¼Œè€Œæ¢å¤ 9003 ç«¯å£ï¼Œåªä¼šè¯·æ±‚ 9003 ç«¯å£çš„æœåŠ¡å™¨ã€‚</p><h4 id="max-conns"><a href="#max-conns" class="headerlink" title="max_conns"></a>max_conns</h4><p><code>max_conns</code> æŒ‡ä»¤ç”¨æ¥é™åˆ¶åŒæ—¶è¿æ¥åˆ° upstream è´Ÿè½½ä¸Šçš„å•ä¸ªæœåŠ¡å™¨çš„æœ€å¤§è¿æ¥æ•°ã€‚é»˜è®¤ä¸º 0ï¼Œè¡¨ç¤ºä¸é™åˆ¶ï¼Œä½¿ç”¨è¯¥é…ç½®å¯ä»¥æ ¹æ®åç«¯æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„å¹¶å‘é‡æ¥è¿›è¡Œè®¾ç½®ï¼Œé˜²æ­¢åç«¯æœåŠ¡å™¨è¢«å‹å®ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>max_conns=&lt;number&gt;</td><td>0</td><td>upstream</td></tr></tbody></table><ul><li>number æ˜¯å¤§äº 0 çš„æ•°å­—ã€‚</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span> down;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span> backup;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span> max_conns=<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ 4 è¡Œé…ç½®æ ‡è¯† 9003 ç«¯å£çš„æœåŠ¡å™¨æœ€å¤§èƒ½è¢« 2 ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><h4 id="max-failså’Œfail-timeout"><a href="#max-failså’Œfail-timeout" class="headerlink" title="max_failså’Œfail_timeout"></a>max_failså’Œfail_timeout</h4><p><code>max_fails</code> æŒ‡ä»¤è®¾ç½®å…è®¸è¯·æ±‚ä»£ç†æœåŠ¡å™¨å¤±è´¥çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 1ã€‚</p><p><code>fail_timeout</code> æŒ‡ä»¤è®¾ç½®ç»è¿‡ max_fails å¤±è´¥åï¼ŒæœåŠ¡æš‚åœçš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 10 ç§’ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>max_fails=&lt;number&gt;</td><td>1</td><td>upstream</td></tr><tr><td>fail_timeout=&lt;time&gt;</td><td>10 ç§’</td><td>upstream</td></tr></tbody></table><ul><li>number æ˜¯å¤§äº 0 çš„æ•°å­—</li><li>time æ˜¯æ—¶é—´ï¼Œå•ä½ä¸ºç§’</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.133:9001</span> down;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.133:9002</span> backup;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.133:9003</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">15</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸ƒå±‚è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#ä¸ƒå±‚è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="ä¸ƒå±‚è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>ä¸ƒå±‚è´Ÿè½½å‡è¡¡ç­–ç•¥</h3><p>ä»‹ç»å®Œ Nginx è´Ÿè½½å‡è¡¡çš„ç›¸å…³æŒ‡ä»¤åï¼Œæˆ‘ä»¬å·²ç»èƒ½å®ç°å°†ç”¨æˆ·çš„è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆé™¤äº†é‡‡ç”¨é»˜è®¤çš„åˆ†é…æ–¹å¼ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½é‡‡ç”¨ä»€ä¹ˆæ ·çš„è´Ÿè½½ç®—æ³•ï¼Ÿ</p><p>Nginx çš„ upstream æ”¯æŒå¦‚ä¸‹å…­ç§æ–¹å¼çš„åˆ†é…ç®—æ³•ï¼Œåˆ†åˆ«æ˜¯:</p><table><thead><tr><th>ç®—æ³•åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è½®è¯¢</td><td>é»˜è®¤æ–¹å¼</td></tr><tr><td>weight</td><td>æƒé‡æ–¹å¼</td></tr><tr><td>ip_hash</td><td>ä¾æ® IP åˆ†é…æ–¹å¼</td></tr><tr><td>least_conn</td><td>ä¾æ®æœ€å°‘è¿æ¥æ–¹å¼</td></tr><tr><td>url_hash</td><td>ä¾æ® URL åˆ†é…æ–¹å¼</td></tr><tr><td>fair</td><td>ä¾æ®å“åº”æ—¶é—´æ–¹å¼</td></tr></tbody></table><h4 id="è½®è¯¢"><a href="#è½®è¯¢" class="headerlink" title="è½®è¯¢"></a>è½®è¯¢</h4><p>è¿™æ˜¯ <code>upstream</code> æ¨¡å—è´Ÿè½½å‡è¡¡é»˜è®¤çš„ç­–ç•¥ã€‚æ¯ä¸ªè¯·æ±‚ä¼šæŒ‰æ—¶é—´é¡ºåºé€ä¸ªåˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ã€‚è½®è¯¢ä¸éœ€è¦é¢å¤–çš„é…ç½®ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="weightåŠ æƒ-åŠ æƒè½®è¯¢"><a href="#weightåŠ æƒ-åŠ æƒè½®è¯¢" class="headerlink" title="weightåŠ æƒ[åŠ æƒè½®è¯¢]"></a>weightåŠ æƒ[åŠ æƒè½®è¯¢]</h4><p><code>weight</code> æŒ‡ä»¤ç”¨æ¥è®¾ç½®æœåŠ¡å™¨çš„æƒé‡ï¼Œé»˜è®¤ä¸º 1ï¼Œæƒé‡æ•°æ®è¶Šå¤§ï¼Œè¢«åˆ†é…åˆ°è¯·æ±‚çš„å‡ ç‡è¶Šå¤§ï¼›è¯¥æƒé‡å€¼ï¼Œä¸»è¦æ˜¯é’ˆå¯¹å®é™…å·¥ä½œç¯å¢ƒä¸­ä¸åŒçš„åç«¯æœåŠ¡å™¨ç¡¬ä»¶é…ç½®è¿›è¡Œè°ƒæ•´çš„ï¼Œæ‰€æœ‰æ­¤ç­–ç•¥æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨çš„ç¡¬ä»¶é…ç½®å·®åˆ«æ¯”è¾ƒå¤§çš„æƒ…å†µã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>weight=&lt;number&gt;</td><td>1</td><td>upstream</td></tr></tbody></table><ul><li>number æ˜¯å¤§äº 0 çš„æ•°å­—</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span> weight=<span class="number">10</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span> weight=<span class="number">5</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span> weight=<span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ip-hash"><a href="#ip-hash" class="headerlink" title="ip_hash"></a>ip_hash</h4><p>å½“å¯¹åç«¯çš„å¤šå°åŠ¨æ€åº”ç”¨æœåŠ¡å™¨åšè´Ÿè½½å‡è¡¡æ—¶ï¼Œ<code>ip_hash</code> æŒ‡ä»¤èƒ½å¤Ÿå°†æŸä¸ªå®¢æˆ·ç«¯ IP çš„è¯·æ±‚é€šè¿‡å“ˆå¸Œç®—æ³•å®šä½åˆ°åŒä¸€å°åç«¯æœåŠ¡å™¨ä¸Šã€‚</p><p>è¿™æ ·ï¼Œå½“æ¥è‡ªæŸä¸€ä¸ª IP çš„ç”¨æˆ·åœ¨åç«¯ Web æœåŠ¡å™¨ A ä¸Šç™»å½•åï¼Œåœ¨è®¿é—®è¯¥ç«™ç‚¹çš„å…¶ä»– URLï¼Œèƒ½ä¿è¯å…¶è®¿é—®çš„è¿˜æ˜¯åç«¯ Web æœåŠ¡å™¨ A</p><p>æ€»ç»“ï¼šå“ªä¸ªæœåŠ¡å™¨æ›¾ç»å¤„ç†è¿‡è¯·æ±‚ï¼Œæ— è®ºåœ¨å“ªé‡Œï¼Œç›¸åŒçš„è¯·æ±‚ä¾ç„¶è®©è¯¥æœåŠ¡å™¨å¤„ç†</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>ip_hash;</td><td>â€”</td><td>upstream</td></tr></tbody></table><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line">ip_hash;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦é¢å¤–å¤šè¯´ä¸€ç‚¹çš„æ˜¯ä½¿ç”¨ ip_hash æŒ‡ä»¤æ— æ³•ä¿è¯åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œå¯èƒ½å¯¼è‡´æœ‰äº›åç«¯æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚å¤šï¼Œæœ‰äº›åç«¯æœåŠ¡å™¨æ¥æ”¶çš„è¯·æ±‚å°‘ï¼Œè€Œä¸”è®¾ç½®åç«¯æœåŠ¡å™¨æƒé‡ç­‰æ–¹æ³•å°†ä¸èµ·ä½œç”¨ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220804/image.7a0ysgphfxg0.webp" alt="image"></p><h4 id="least-conn"><a href="#least-conn" class="headerlink" title="least_conn"></a>least_conn</h4><p>æœ€å°‘è¿æ¥æ•°ï¼ŒæŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨ã€‚</p><p>è½®è¯¢ç®—æ³•æ˜¯æŠŠè¯·æ±‚å¹³å‡çš„è½¬å‘ç»™å„ä¸ªåç«¯ï¼Œä½¿å®ƒä»¬çš„è´Ÿè½½å¤§è‡´ç›¸åŒï¼›ä½†æ˜¯ï¼Œæœ‰äº›è¯·æ±‚å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œä¼šå¯¼è‡´å…¶æ‰€åœ¨çš„åç«¯è´Ÿè½½è¾ƒé«˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>least_conn</code> è¿™ç§æ–¹å¼å°±å¯ä»¥è¾¾åˆ°æ›´å¥½çš„è´Ÿè½½å‡è¡¡æ•ˆæœã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line">least_conn;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤è´Ÿè½½å‡è¡¡ç­–ç•¥é€‚åˆè¯·æ±‚å¤„ç†æ—¶é—´é•¿çŸ­ä¸ä¸€é€ æˆæœåŠ¡å™¨è¿‡è½½çš„æƒ…å†µã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220804/image.5vug3q9whrc0.webp" alt="image"></p><h4 id="url-hash"><a href="#url-hash" class="headerlink" title="url_hash"></a>url_hash</h4><p>æŒ‰è®¿é—® URL çš„ hash ç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ª URL å®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œè¦é…åˆç¼“å­˜å‘½ä¸­æ¥ä½¿ç”¨ã€‚</p><p>å½“å‡ºç°åŒä¸€ä¸ªèµ„æºå¤šæ¬¡è¯·æ±‚ï¼Œå¯èƒ½ä¼šåˆ°è¾¾ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¯¼è‡´ä¸å¿…è¦çš„å¤šæ¬¡ä¸‹è½½ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸é«˜ï¼Œä»¥åŠä¸€äº›èµ„æºæ—¶é—´çš„æµªè´¹æ—¶ï¼Œä½¿ç”¨ <code>url_hash</code>ï¼Œå¯ä»¥ä½¿å¾—åŒä¸€ä¸ª URLï¼ˆä¹Ÿå°±æ˜¯åŒä¸€ä¸ªèµ„æºè¯·æ±‚ï¼‰ä¼šåˆ°è¾¾åŒä¸€å°æœåŠ¡å™¨ï¼Œä¸€æ—¦ç¼“å­˜ä½äº†èµ„æºï¼Œå†æ­¤æ”¶åˆ°è¯·æ±‚ï¼Œå°±å¯ä»¥ä»ç¼“å­˜ä¸­è¯»å–ã€‚</p><p>æ€»ç»“ï¼šå‘é€ç›¸åŒçš„è¯·æ±‚æ—¶ï¼Œå¸Œæœ›åªæœ‰ä¸€ä¸ªæœåŠ¡å™¨å¤„ç†è¯¥è¯·æ±‚ï¼Œä½¿ç”¨ <code>uri_hash</code>ã€‚å› ä¸º URL ç›¸åŒï¼Œåˆ™å“ˆå¸Œå€¼(hash)ç›¸åŒï¼Œé‚£ä¹ˆå“ˆå¸Œå€¼å¯¹åº”çš„æœåŠ¡å™¨ä¹Ÿç›¸åŒã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">hash</span> &amp;request_uri;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚å›¾ï¼šæ–‡ä»¶ç³»ç»Ÿæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œç›®å‰åªæœ‰ web æœåŠ¡ 1 å’ŒæœåŠ¡ 3 è·å–äº†è¯¥æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³è¦ä¸‹è½½è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œåªèƒ½æ‰¾æœåŠ¡ 1 æˆ–æœåŠ¡ 3ï¼Œè¿™æ—¶å€™å°±å›ºå®šä¸€ä¸ª URLï¼Œè¯¥ URL ä¸å…è®¸æœåŠ¡ 2 è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå¦‚ä½•è§„å®šå“ªä¸ªæœåŠ¡å¤„ç†å‘¢ï¼Ÿå°±ç”¨åˆ° <code>url_hash</code>ã€‚</p><p>å®ƒä¼šæ ¹æ® URL è®¡ç®—å¤„å“ˆå¸Œå€¼ï¼Œç”±å“ˆå¸Œå€¼å¯¹åº”æœåŠ¡ï¼Œæ‰€ä»¥å›ºå®šä¸‹è½½æ–‡ä»¶çš„ URLï¼Œå°±å›ºå®šäº†ä¸€ä¸ªæœåŠ¡å¤„ç†ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220804/image.utb83x535xc.webp" alt="image"></p><h4 id="fair"><a href="#fair" class="headerlink" title="fair"></a>fair</h4><p><code>fair</code> æŒ‡ä»¤é‡‡ç”¨çš„ä¸æ˜¯å†…å»ºè´Ÿè½½å‡è¡¡ä½¿ç”¨çš„è½®æ¢çš„å‡è¡¡ç®—æ³•ï¼Œè€Œæ˜¯å¯ä»¥æ ¹æ®é¡µé¢å¤§å°ã€åŠ è½½æ—¶é—´é•¿çŸ­æ™ºèƒ½çš„è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—çš„ fair è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nupstream</span> backend&#123;</span><br><span class="line">fair;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·ç›´æ¥ä½¿ç”¨ä¼šæŠ¥é”™ï¼Œå› ä¸º fair å±äºç¬¬ä¸‰æ–¹æ¨¡å—å®ç°çš„è´Ÿè½½å‡è¡¡ã€‚éœ€è¦æ·»åŠ  <code>nginx-upstream-fair</code> æ¨¡å—ï¼Œå¦‚ä½•æ·»åŠ å¯¹åº”çš„æ¨¡å—ï¼š</p><ol><li>ä¸‹è½½ <code>nginx-upstream-fair</code> æ¨¡å—ï¼Œä¸‹è½½åœ°å€å¦‚ä¸‹ï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/gnosek/nginx-upstream-fair</span><br></pre></td></tr></table></figure><ol start="2"><li>å°†ä¸‹è½½çš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è¿›è¡Œè§£å‹ç¼©</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥å®‰è£…åŒ…ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line">unzip nginx-upstream-fair-master.zip</span><br></pre></td></tr></table></figure><ol start="3"><li>æˆ‘çš„è§£å‹ç›®å½•åœ¨ <code>/opt</code>ï¼Œæ‰€ä»¥ç¬¬ 6 æ­¥è®°å¾—æŒ‡å®šå¥½æ¨¡å—çš„è·¯å¾„ã€‚</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv nginx-upstream-fair-master fair</span><br></pre></td></tr></table></figure><ol start="4"><li>å°†åŸæœ‰ <code>/usr/local/nginx/sbin/nginx</code> è¿›è¡Œå¤‡ä»½</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/<span class="built_in">local</span>/nginx/sbin/nginx /usr/<span class="built_in">local</span>/nginx/sbin/nginx.backup</span><br></pre></td></tr></table></figure><ol start="5"><li>æŸ¥çœ‹ <code>configure arguments</code> çš„é…ç½®ä¿¡æ¯ï¼Œæ‹·è´å‡ºæ¥</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx -V</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´ configure arguments åé¢çš„æ•°æ®</span></span><br></pre></td></tr></table></figure><ol start="6"><li>è¿›å…¥ Nginx çš„å®‰è£…ç›®å½•ï¼Œæ‰§è¡Œ make clean æ¸…ç©ºä¹‹å‰ç¼–è¯‘çš„å†…å®¹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/nginx/core/nginx-1.21.6</span><br><span class="line"></span><br><span class="line">make clean</span><br></pre></td></tr></table></figure><ol start="7"><li>ä½¿ç”¨ configure æ¥é…ç½®å‚æ•°ï¼Œæ·»åŠ æ¨¡å—ï¼Œè®°å¾—åŠ ä¸Šç¬¬ï¼ˆ4ï¼‰æ­¥æ‹·è´çš„é…ç½®ä¿¡æ¯</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --add-module=/opt/fair  <span class="comment"># è®°å¾—æ·»åŠ  configure arguments åçš„æ•°æ®</span></span><br></pre></td></tr></table></figure><ol start="8"><li>é€šè¿‡ make æ¨¡æ¿è¿›è¡Œç¼–è¯‘</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œ<code>ngx_http_upstream_srv_conf_t</code> ç»“æ„ä¸­ç¼ºå°‘ <code>default_port</code></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220804/image.vj3xrayy84g.webp" alt="image"></p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>åœ¨ Nginx çš„æºç ç›®å½•ï¼ˆå®‰è£…åŒ…ç›®å½•ï¼‰ä¸­ <code>src/http/ngx_http_upstream.h</code>ï¼Œæ‰¾åˆ° <code>ngx_http_upstream_srv_conf_s</code>ï¼Œåœ¨æ¨¡å—ä¸­æ·»åŠ æ·»åŠ  <code>default_port</code> å±æ€§</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/nginx/core/nginx-1.21.6/src/http/ngx_http_upstream.h</span><br></pre></td></tr></table></figure><p>æ·»åŠ å†…å®¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">in_port_t   default_port</span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220804/image.1mcquncem2u8.webp" alt="image"></p><p>ç„¶åå†è¿›è¡Œ makeã€‚</p><ol start="9"><li>å°†å®‰è£…ç›®å½•ä¸‹çš„ objs ä¸­çš„ nginx æ‹·è´åˆ° sbin ç›®å½•</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/nginx/core/nginx-1.21.6/objs</span><br><span class="line">cp nginx /usr/<span class="built_in">local</span>/nginx/sbin</span><br></pre></td></tr></table></figure><p>10 .æ›´æ–°nginx</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/nginx/core/nginx-1.21.6</span><br><span class="line">make upgrade</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»‹ç»äº† Nginx å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œæœ‰äººè¯´æ˜¯ 5 ç§ï¼Œæ˜¯æŠŠè½®è¯¢å’ŒåŠ æƒè½®è¯¢å½’ä¸ºä¸€ç§ï¼Œä¹Ÿæœ‰äººè¯´æ˜¯ 6 ç§ã€‚é‚£ä¹ˆåœ¨å’±ä»¬ä»¥åçš„å¼€å‘ä¸­åˆ°åº•ä½¿ç”¨å“ªç§ï¼Œè¿™ä¸ªéœ€è¦æ ¹æ®å®é™…é¡¹ç›®çš„åº”ç”¨åœºæ™¯æ¥å†³å®šçš„ã€‚</p><h3 id="ä¸ƒå±‚è´Ÿè½½å‡è¡¡æ¡ˆä¾‹"><a href="#ä¸ƒå±‚è´Ÿè½½å‡è¡¡æ¡ˆä¾‹" class="headerlink" title="ä¸ƒå±‚è´Ÿè½½å‡è¡¡æ¡ˆä¾‹"></a>ä¸ƒå±‚è´Ÿè½½å‡è¡¡æ¡ˆä¾‹</h3><h4 id="æ¡ˆä¾‹ä¸€ï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°ä¸€èˆ¬è½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡"><a href="#æ¡ˆä¾‹ä¸€ï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°ä¸€èˆ¬è½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="æ¡ˆä¾‹ä¸€ï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°ä¸€èˆ¬è½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡"></a>æ¡ˆä¾‹ä¸€ï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°ä¸€èˆ¬è½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¡ˆä¾‹äºŒï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°åŠ æƒè½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡"><a href="#æ¡ˆä¾‹äºŒï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°åŠ æƒè½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="æ¡ˆä¾‹äºŒï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°åŠ æƒè½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡"></a>æ¡ˆä¾‹äºŒï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°åŠ æƒè½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span> weight=<span class="number">7</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span> weight=<span class="number">3</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span> weight=<span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤„ç†è¯·æ±‚æ¦‚ç‡ï¼š9001 ç«¯å£ &gt; 9003 ç«¯å£ &gt; 9002 ç«¯å£</p><h4 id="æ¡ˆä¾‹ä¸‰ï¼šå¯¹ç‰¹å®šèµ„æºå®ç°è´Ÿè½½å‡è¡¡"><a href="#æ¡ˆä¾‹ä¸‰ï¼šå¯¹ç‰¹å®šèµ„æºå®ç°è´Ÿè½½å‡è¡¡" class="headerlink" title="æ¡ˆä¾‹ä¸‰ï¼šå¯¹ç‰¹å®šèµ„æºå®ç°è´Ÿè½½å‡è¡¡"></a>æ¡ˆä¾‹ä¸‰ï¼šå¯¹ç‰¹å®šèµ„æºå®ç°è´Ÿè½½å‡è¡¡</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> videobackend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">upstream</span> filebackend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9004</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8084</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /video/ &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://videobackend;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /file/ &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://filebackend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€ <code>/video/</code> è¯·æ±‚ä¼šè¢« 9001 å’Œ 9002 ç«¯å£çš„æœåŠ¡å™¨å¤„ç†ã€‚</p><p>å‘é€ <code>/file/</code> è¯·æ±‚ä¼šè¢« 9003 å’Œ 9004 ç«¯å£çš„æœåŠ¡å™¨å¤„ç†ã€‚</p><h4 id="æ¡ˆä¾‹å››ï¼šå¯¹ä¸åŒåŸŸåå®ç°è´Ÿè½½å‡è¡¡"><a href="#æ¡ˆä¾‹å››ï¼šå¯¹ä¸åŒåŸŸåå®ç°è´Ÿè½½å‡è¡¡" class="headerlink" title="æ¡ˆä¾‹å››ï¼šå¯¹ä¸åŒåŸŸåå®ç°è´Ÿè½½å‡è¡¡"></a>æ¡ˆä¾‹å››ï¼šå¯¹ä¸åŒåŸŸåå®ç°è´Ÿè½½å‡è¡¡</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> frxbackend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">upstream</span> bingbackend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9004</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span><span class="number">8085</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.frx.com;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://frxbackend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span><span class="number">8086</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.bing.com;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://bingbackend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>www.frx.com</code> åœ°å€çš„è¯·æ±‚ç”± 9001 ç«¯å£å’Œ 9002 ç«¯å£å¤„ç†ã€‚</p><p><code>www.bing.com</code> åœ°å€çš„è¯·æ±‚ç”± 9003 ç«¯å£å’Œ 9004 ç«¯å£å¤„ç†ã€‚</p><h4 id="æ¡ˆä¾‹äº”ï¼šå®ç°å¸¦æœ‰URLé‡å†™çš„è´Ÿè½½å‡è¡¡"><a href="#æ¡ˆä¾‹äº”ï¼šå®ç°å¸¦æœ‰URLé‡å†™çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="æ¡ˆä¾‹äº”ï¼šå®ç°å¸¦æœ‰URLé‡å†™çš„è´Ÿè½½å‡è¡¡"></a>æ¡ˆä¾‹äº”ï¼šå®ç°å¸¦æœ‰URLé‡å†™çš„è´Ÿè½½å‡è¡¡</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span><span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /file/ &#123;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^(/file/.*)</span> /server/<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /server &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°† <code>/file/xxx</code> è¯·æ±‚é‡å†™ä¸º <code>/server/xxx</code>ï¼Œç„¶åè§¦å‘ <code>location /server</code>ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>æ­¤æ—¶è¢«è´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨åœ°å€ä¹Ÿä¼šå¸¦æœ‰ <code>/server</code> ä»¥åŠåé¢çš„å‚æ•°ï¼Œå¦‚ <code>192.168.200.146:9001/server/xxx</code></p><h2 id="å››å±‚è´Ÿè½½å‡è¡¡"><a href="#å››å±‚è´Ÿè½½å‡è¡¡" class="headerlink" title="å››å±‚è´Ÿè½½å‡è¡¡"></a>å››å±‚è´Ÿè½½å‡è¡¡</h2><p>Nginx åœ¨ 1.9 ä¹‹åï¼Œå¢åŠ äº†ä¸€ä¸ª stream æ¨¡å—ï¼Œç”¨æ¥å®ç°å››å±‚åè®®çš„è½¬å‘ã€ä»£ç†ã€è´Ÿè½½å‡è¡¡ç­‰ã€‚stream æ¨¡å—çš„ç”¨æ³•è·Ÿ http çš„ç”¨æ³•ç±»ä¼¼ï¼Œå…è®¸æˆ‘ä»¬é…ç½®ä¸€ç»„ TCP æˆ–è€… UDP ç­‰åè®®çš„ç›‘å¬ï¼Œç„¶åé€šè¿‡ proxy_pass æ¥è½¬å‘æˆ‘ä»¬çš„è¯·æ±‚ï¼Œé€šè¿‡ upstream æ·»åŠ å¤šä¸ªåç«¯æœåŠ¡ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>å››å±‚åè®®è´Ÿè½½å‡è¡¡çš„å®ç°ï¼Œä¸€èˆ¬éƒ½ä¼šç”¨åˆ° LVSã€HAProxyã€F5 ç­‰ï¼Œè¦ä¹ˆå¾ˆè´µè¦ä¹ˆé…ç½®å¾ˆéº»çƒ¦ï¼Œè€Œ Nginx çš„é…ç½®ç›¸å¯¹æ¥è¯´æ›´ç®€å•ï¼Œæ›´èƒ½å¿«é€Ÿå®Œæˆå·¥ä½œã€‚</p><h3 id="æ·»åŠ streamæ¨¡å—çš„æ”¯æŒ"><a href="#æ·»åŠ streamæ¨¡å—çš„æ”¯æŒ" class="headerlink" title="æ·»åŠ streamæ¨¡å—çš„æ”¯æŒ"></a>æ·»åŠ streamæ¨¡å—çš„æ”¯æŒ</h3><p>Nginx é»˜è®¤æ˜¯æ²¡æœ‰ç¼–è¯‘è¿™ä¸ªæ¨¡å—çš„ï¼Œéœ€è¦ä½¿ç”¨åˆ° stream æ¨¡å—ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š <code>--with-stream</code>ã€‚</p><p>å®Œæˆæ·»åŠ  <code>--with-stream</code> çš„å®ç°æ­¥éª¤ï¼š</p><ul><li>å°†åŸæœ‰ <code>/usr/local/nginx/sbin/nginx</code> è¿›è¡Œå¤‡ä»½</li><li>æ‹·è´ <code>Nginx -V</code> çš„ configure arguments é…ç½®ä¿¡æ¯</li><li>åœ¨ Nginx çš„å®‰è£…æºç è¿›è¡Œé…ç½®æŒ‡å®šå¯¹åº”æ¨¡å—ï¼š<code>./configure --with-stream åŠ ä¸Šä¸€æ­¥æ‹·è´çš„configure arguments é…ç½®</code></li><li>é€šè¿‡ make æ¨¡æ¿è¿›è¡Œç¼–è¯‘</li><li>å°† objs ä¸‹é¢çš„ nginx ç§»åŠ¨åˆ° <code>/usr/local/nginx/sbin</code> ä¸‹</li><li>åœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œ <code>make upgrade</code> è¿›è¡Œå‡çº§ï¼Œè¿™ä¸ªå¯ä»¥å®ç°ä¸åœæœºæ·»åŠ æ–°æ¨¡å—çš„åŠŸèƒ½</li></ul><p>æ·»åŠ æ¨¡å—çš„è¯¦ç»†æ­¥éª¤æˆ‘å·²ç»åœ¨ <a href>ä¸ƒå±‚è´Ÿè½½å‡è¡¡ç­–ç•¥-fair æŒ‡ä»¤</a>ã€<a href>é™æ€èµ„æºéƒ¨ç½²-Nginx æ¨¡å—æ·»åŠ </a>ã€<a href>åå‘ä»£ç†-æ·»åŠ sslæ”¯æŒ</a> æè¿°è¿‡ï¼Œè€Œä½ åªéœ€è¦æ›¿æ¢æ¨¡å—åå­—ç½¢äº†ã€‚</p><h3 id="å››å±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤"><a href="#å››å±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤" class="headerlink" title="å››å±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤"></a>å››å±‚è´Ÿè½½å‡è¡¡æŒ‡ä»¤</h3><p>å¦‚æœä¸æƒ³åœ¨ http æ¨¡å—ä½¿ç”¨è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥åœ¨ steam æ¨¡å—ä½¿ç”¨ã€‚</p><h4 id="streamæŒ‡ä»¤"><a href="#streamæŒ‡ä»¤" class="headerlink" title="streamæŒ‡ä»¤"></a>streamæŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤æä¾›åœ¨å…¶ä¸­æŒ‡å®šæµæœåŠ¡å™¨æŒ‡ä»¤çš„é…ç½®æ–‡ä»¶ä¸Šä¸‹æ–‡ã€‚å’Œ http æ¨¡å—åŒçº§ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>stream { â€¦ }</td><td>â€”</td><td>main</td></tr></tbody></table><p>å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="comment"># ......</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">stream</span> &#123;</span><br><span class="line">    <span class="attribute">upstream</span> backend&#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.200.146:6379</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.200.146:6378</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">81</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="upstreamæŒ‡ä»¤-1"><a href="#upstreamæŒ‡ä»¤-1" class="headerlink" title="upstreamæŒ‡ä»¤"></a>upstreamæŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„ upstream æŒ‡ä»¤æ˜¯ç±»ä¼¼çš„ã€‚</p><h3 id="å››å±‚è´Ÿè½½å‡è¡¡çš„æ¡ˆä¾‹"><a href="#å››å±‚è´Ÿè½½å‡è¡¡çš„æ¡ˆä¾‹" class="headerlink" title="å››å±‚è´Ÿè½½å‡è¡¡çš„æ¡ˆä¾‹"></a>å››å±‚è´Ÿè½½å‡è¡¡çš„æ¡ˆä¾‹</h3><p>å‡†å¤‡ä¸¤å°æœåŠ¡å™¨ï¼Œè¿™é‡Œç§°ä¸º A å’Œ Bã€‚æœåŠ¡å™¨ A çš„ IP ä¸º <code>192.168.200.146</code>ï¼ŒæœåŠ¡å™¨ B çš„IP ä¸º <code>192.168.200.133</code>ï¼ŒæœåŠ¡å™¨ A å­˜æ”¾ Redis å’Œ Tomcatï¼ŒæœåŠ¡å™¨ B ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œå¯¹æœåŠ¡å™¨ A çš„ç«¯å£è¿›è¡Œè´Ÿè½½å‡è¡¡å¤„ç†ã€‚</p><h4 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220804/image.6yak0csdt880.webp" alt="image"></p><h4 id="Redis-é…ç½®"><a href="#Redis-é…ç½®" class="headerlink" title="Redis é…ç½®"></a>Redis é…ç½®</h4><p>å‡†å¤‡ Redis æœåŠ¡å™¨,åœ¨æœåŠ¡å™¨ A ä¸Šå‡†å¤‡ä¸¤ä¸ª Redisï¼Œç«¯å£åˆ†åˆ«æ˜¯ 6379ã€6378ã€‚</p><ol><li>ä¸Šä¼  redis çš„å®‰è£…åŒ… <code>redis-4.0.14.tar.gz</code>ï¼Œè¿™é‡Œä¸Šä¼ ç›®å½•æ˜¯ <code>/opt</code></li><li>å°†å®‰è£…åŒ…è¿›è¡Œè§£å‹ç¼©</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf redis-4.0.14.tar.gz</span><br></pre></td></tr></table></figure><ol start="3"><li>è¿›å…¥redisçš„å®‰è£…åŒ…</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> redis-4.0.14</span><br></pre></td></tr></table></figure><ol start="4"><li>ä½¿ç”¨ make å’Œ install è¿›è¡Œç¼–è¯‘å’Œå®‰è£…ï¼Œè¿™é‡Œçš„å®‰è£…è·¯å¾„æ˜¯ <code>/usr/local/redis/redis01</code></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make PREFIX=/usr/<span class="built_in">local</span>/redis/redis01 install</span><br></pre></td></tr></table></figure><ol start="5"><li>æ‹·è´ redis é…ç½®æ–‡ä»¶ <code>redis.conf</code> åˆ° <code>/usr/local/redis/redis01/bin</code> ç›®å½•ä¸­ï¼Œå› ä¸ºå®‰è£…åï¼Œç›®å½•å¹¶æ²¡æœ‰ redis.conf</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /opt/redis-4.0.14/redis.conf/usr/<span class="built_in">local</span>/redis/redis01/bin</span><br></pre></td></tr></table></figure><ol start="6"><li>ä¿®æ”¹ redis.conf é…ç½®æ–‡ä»¶ï¼Œæ³¨æ„ï¼šä¸æ˜¯æ·»åŠ å†…å®¹ï¼Œæ˜¯ä¿®æ”¹å†…å®¹ï¼Œè¦è‡ªå·±æœç´¢ bindã€port å’Œ daemonize è¿›è¡Œä¿®æ”¹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0   <span class="comment"># å…è®¸ä»»æ„åœ°å€è®¿é—®</span></span><br><span class="line">port  6379      <span class="comment"># redis çš„ç«¯å£</span></span><br><span class="line">daemonize yes   <span class="comment"># åå°å¯åŠ¨ redis</span></span><br></pre></td></tr></table></figure><ol start="7"><li>å°† redis01 å¤åˆ¶ä¸€ä»½ä¸º redis02</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/redis</span><br><span class="line">cp -r redis01 redis02</span><br></pre></td></tr></table></figure><ol start="8"><li>å°† redis02 æ–‡ä»¶å¤¹ä¸­çš„ redis.conf è¿›è¡Œä¿®æ”¹ï¼Œæ³¨æ„ï¼šä¸æ˜¯æ·»åŠ å†…å®¹ï¼Œæ˜¯ä¿®æ”¹å†…å®¹ï¼Œè¦è‡ªå·±æœç´¢ bindã€port å’Œ daemonize è¿›è¡Œä¿®æ”¹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0   <span class="comment"># å…è®¸ä»»æ„åœ°å€è®¿é—®</span></span><br><span class="line">port  6378      <span class="comment"># redis çš„ç«¯å£</span></span><br><span class="line">daemonize yes   <span class="comment"># åå°å¯åŠ¨ redis</span></span><br></pre></td></tr></table></figure><ol start="9"><li>åˆ†åˆ«å¯åŠ¨ï¼Œå³å¯è·å–ä¸¤ä¸ª Redis å¹¶æŸ¥çœ‹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Nginx å°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„ Redis æœåŠ¡å™¨ä¸Šã€‚</p><p>å®‰è£… Redis å¹¶éªŒè¯èƒ½å¯åŠ¨æˆåŠŸåï¼Œåœ¨å¦ä¸€å°æœåŠ¡å™¨ B <code>192.168.200.133</code> çš„ Nginx é…ç½®æ–‡ä»¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼šï¼ˆç¡®ä¿å®‰è£…äº† steam æ¨¡å—ï¼‰</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">stream</span> &#123;</span><br><span class="line">    <span class="attribute">upstream</span> redisbackend&#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.200.146:6379</span>;   <span class="comment"># æœåŠ¡å™¨ B çš„ 6379 ç«¯å£</span></span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.200.146:6378</span>;   <span class="comment"># æœåŠ¡å™¨ B çš„ 6378 ç«¯å£</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">81</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> redisbackend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åˆ©ç”¨ redis-cli è¿æ¥æµ‹è¯•</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220804/image.cbee2u83yhs.webp" alt="image"></p><p>æœåŠ¡å™¨ B é€šè¿‡è´Ÿè½½å‡è¡¡è¿æ¥åˆ°äº†æœåŠ¡å™¨ A çš„ Redisï¼Œåªæ˜¯ä¸çŸ¥é“è¿æ¥çš„æ˜¯ 6378 è¿˜æ˜¯ 6379 ç«¯å£ï¼Œå¯ä»¥åœ¨ Redis æ·»åŠ ä¸ä¸€æ ·çš„æ•°æ®æ¥æµ‹è¯•ï¼Œè¿™é‡Œä¸æ¼”ç¤ºäº†ã€‚</p><h4 id="Tomcat-é…ç½®"><a href="#Tomcat-é…ç½®" class="headerlink" title="Tomcat é…ç½®"></a>Tomcat é…ç½®</h4><p>å‡†å¤‡ Tomcat æœåŠ¡å™¨ åˆ°æœåŠ¡å™¨ A</p><ol><li>ä¸Šä¼  tomcat çš„å®‰è£…åŒ…ï¼Œ<code>apache-tomcat-8.5.56.tar.gz</code></li><li>å°†å®‰è£…åŒ…è¿›è¡Œè§£å‹ç¼©</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf apache-tomcat-8.5.56.tar.gz</span><br></pre></td></tr></table></figure><ol start="3"><li>è¿›å…¥ tomcat çš„ bin ç›®å½•ï¼Œå¯åŠ¨ tomcat</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> apache-tomcat-8.5.56/bin</span><br><span class="line">./startup</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ B çš„é…ç½®æ–‡ä»¶ nginx.conf é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">stream</span> &#123;</span><br><span class="line">    <span class="attribute">upstream</span> redisbackend &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.200.146:6379</span>;    <span class="comment"># æœåŠ¡å™¨ B çš„ 6379 ç«¯å£</span></span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.200.146:6378</span>;    <span class="comment"># æœåŠ¡å™¨ B çš„ 6378 ç«¯å£</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">upstream</span> tomcatbackend &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.200.146:8080</span>;   <span class="comment"># æœåŠ¡å™¨ B çš„ 8080 ç«¯å£</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>  <span class="number">81</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> redisbackend; <span class="comment"># redis çš„è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span><span class="number">82</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> tomcatbackend;  <span class="comment"># tomcat çš„è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®æœåŠ¡å™¨ B çš„åœ°å€è¿›è¡Œæµ‹è¯•ï¼š<code>192.168.200.133:82</code>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx ç¼“å­˜é›†æˆ</title>
      <link href="/2022/11/14/Nginx_Cache_integration/"/>
      <url>/2022/11/14/Nginx_Cache_integration/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-ç¼“å­˜é›†æˆ"><a href="#Nginx-ç¼“å­˜é›†æˆ" class="headerlink" title="Nginx ç¼“å­˜é›†æˆ"></a>Nginx ç¼“å­˜é›†æˆ</h1><h2 id="ç¼“å­˜çš„æ¦‚å¿µ"><a href="#ç¼“å­˜çš„æ¦‚å¿µ" class="headerlink" title="ç¼“å­˜çš„æ¦‚å¿µ"></a>ç¼“å­˜çš„æ¦‚å¿µ</h2><p>ç¼“å­˜å°±æ˜¯æ•°æ®äº¤æ¢çš„ç¼“å†²åŒºï¼ˆç§°ä½œï¼šCacheï¼‰ï¼Œå½“ç”¨æˆ·è¦è·å–æ•°æ®çš„æ—¶å€™ï¼Œä¼šå…ˆä»ç¼“å­˜ä¸­å»æŸ¥è¯¢è·å–æ•°æ®ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰å°±ä¼šç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™ä¼šå‘è¯·æ±‚ä»æœåŠ¡å™¨é‡æ–°æŸ¥è¯¢æ•°æ®ï¼Œå°†æ•°æ®è¿”å›ç»™ç”¨æˆ·çš„åŒæ—¶å°†æ•°æ®æ”¾å…¥ç¼“å­˜ï¼Œä¸‹æ¬¡ç”¨æˆ·å°±ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220805/image.371wkgon7280.webp" alt="image"></p><p>ç¼“å­˜å…¶å®åœ¨å¾ˆå¤šåœºæ™¯ä¸­éƒ½æœ‰ç”¨åˆ°ï¼Œæ¯”å¦‚ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>æ“ä½œç³»ç»Ÿç£ç›˜ç¼“å­˜</td><td>å‡å°‘ç£ç›˜æœºæ¢°æ“ä½œ</td></tr><tr><td>æ•°æ®åº“ç¼“å­˜</td><td>å‡å°‘æ–‡ä»¶ç³»ç»Ÿçš„IOæ“ä½œ</td></tr><tr><td>åº”ç”¨ç¨‹åºç¼“å­˜</td><td>å‡å°‘å¯¹æ•°æ®åº“çš„æŸ¥è¯¢</td></tr><tr><td>Web æœåŠ¡å™¨ç¼“å­˜</td><td>å‡å°‘å¯¹åº”ç”¨æœåŠ¡å™¨è¯·æ±‚æ¬¡æ•°</td></tr><tr><td>æµè§ˆå™¨ç¼“å­˜</td><td>å‡å°‘ä¸åå°çš„äº¤äº’æ¬¡æ•°</td></tr></tbody></table><p>ç¼“å­˜çš„ä¼˜ç‚¹</p><ul><li>å‡å°‘æ•°æ®ä¼ è¾“ï¼ŒèŠ‚çœç½‘ç»œæµé‡ï¼ŒåŠ å¿«å“åº”é€Ÿåº¦ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li><li>å‡è½»æœåŠ¡å™¨å‹åŠ›</li><li>æä¾›æœåŠ¡ç«¯çš„é«˜å¯ç”¨æ€§</li></ul><p>ç¼“å­˜çš„ç¼ºç‚¹</p><ul><li>æ•°æ®çš„ä¸ä¸€è‡´</li><li>å¢åŠ æˆæœ¬</li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220805/image.2itt4ge9erq0.webp" alt="image"></p><p>åœ¨ <a href="/middleware/Nginx/Nginx_Static_resource_deployment/#é™æ€èµ„æºç¼“å­˜é…ç½®">é™æ€èµ„æºéƒ¨ç½² - ç¼“å­˜é…ç½®</a> çš„æ—¶å€™ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•åœ¨æµè§ˆå™¨è¿›è¡Œç¼“å­˜ï¼Œè€Œæœ¬å†…å®¹å­¦ä¹ çš„æ˜¯ Nginxã€‚</p><p>Nginx ä½œä¸º Web æœåŠ¡å™¨ï¼ŒNginx ä½œä¸º Web ç¼“å­˜æœåŠ¡å™¨ï¼Œå®ƒä»‹äºå®¢æˆ·ç«¯å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´ï¼Œå½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—®ä¸€ä¸ª URL æ—¶ï¼ŒWeb ç¼“å­˜æœåŠ¡å™¨ä¼šå»åº”ç”¨æœåŠ¡å™¨è·å–è¦å±•ç¤ºç»™ç”¨æˆ·çš„å†…å®¹ï¼Œå°†å†…å®¹ç¼“å­˜åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå½“ä¸‹ä¸€æ¬¡è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå¦‚æœè®¿é—®çš„æ˜¯åŒä¸€ä¸ª URLï¼ŒWeb ç¼“å­˜æœåŠ¡å™¨å°±ä¼šç›´æ¥å°†ä¹‹å‰ç¼“å­˜çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯å‘åº”ç”¨æœåŠ¡å™¨å†æ¬¡å‘é€è¯·æ±‚ã€‚Web ç¼“å­˜é™ä½äº†åº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“çš„è´Ÿè½½ï¼Œå‡å°‘äº†ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜äº†ç”¨æˆ·è®¿é—®çš„å“åº”é€Ÿåº¦ï¼Œå¢å¼ºäº†ç”¨æˆ·çš„ä½“éªŒã€‚</p><h2 id="Webç¼“å­˜æœåŠ¡"><a href="#Webç¼“å­˜æœåŠ¡" class="headerlink" title="Webç¼“å­˜æœåŠ¡"></a>Webç¼“å­˜æœåŠ¡</h2><p>Nginx æ˜¯ä» 0.7.48 ç‰ˆå¼€å§‹æä¾›ç¼“å­˜åŠŸèƒ½ã€‚Nginx æ˜¯åŸºäº Proxy Store æ¥å®ç°çš„ï¼Œ<strong>å…¶åŸç†æ˜¯æŠŠ URL åŠç›¸å…³ç»„åˆå½“åš Keyï¼Œåœ¨ä½¿ç”¨ MD5 ç®—æ³•å¯¹ Key è¿›è¡Œå“ˆå¸ŒåŒ–ï¼Œå¾—åˆ°ç¡¬ç›˜ä¸Šå¯¹åº”çš„å“ˆå¸Œç›®å½•è·¯å¾„ï¼Œä»è€Œå°†ç¼“å­˜å†…å®¹ä¿å­˜åœ¨è¯¥ç›®å½•ä¸­</strong>ã€‚å®ƒå¯ä»¥æ”¯æŒä»»æ„ URL è¿æ¥ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ 404/301/302 è¿™æ ·çš„é200 çŠ¶æ€ç ã€‚Nginx å³å¯ä»¥æ”¯æŒå¯¹æŒ‡å®š URL æˆ–è€…çŠ¶æ€ç è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ purge å‘½ä»¤æ¥æ‰‹åŠ¨æ¸…é™¤æŒ‡å®š URL çš„ç¼“å­˜ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220805/image.5rf186zoffg0.webp" alt="image"></p><h2 id="ç¼“å­˜è®¾ç½®ç›¸å…³æŒ‡ä»¤"><a href="#ç¼“å­˜è®¾ç½®ç›¸å…³æŒ‡ä»¤" class="headerlink" title="ç¼“å­˜è®¾ç½®ç›¸å…³æŒ‡ä»¤"></a>ç¼“å­˜è®¾ç½®ç›¸å…³æŒ‡ä»¤</h2><p>Nginx çš„ Web ç¼“å­˜æœåŠ¡ä¸»è¦æ˜¯ä½¿ç”¨ <code>ngx_http_proxy_module</code> æ¨¡å—ç›¸å…³æŒ‡ä»¤é›†æ¥å®Œæˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŠŠå¸¸ç”¨çš„æŒ‡ä»¤æ¥è¿›è¡Œä»‹ç»ä¸‹ã€‚</p><p><a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" rel="noopener">ngx_http_proxy_module æ–‡æ¡£åœ°å€</a></p><h3 id="proxy-cache-path"><a href="#proxy-cache-path" class="headerlink" title="proxy_cache_path"></a>proxy_cache_path</h3><p>è¯¥æŒ‡å®šç”¨äºè®¾ç½®ç¼“å­˜æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_cache_path &lt;path&gt; [levels=number]<br> &lt;keys_zone=zone_name:zone_size&gt; [inactive=time][max_size=size];</td><td>â€”</td><td>http</td></tr></tbody></table><p><code>path</code>ï¼šç¼“å­˜è·¯å¾„åœ°å€ï¼Œå¦‚ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/proxy_cache</span><br></pre></td></tr></table></figure><p><code>levels</code>: æŒ‡å®šè¯¥ç¼“å­˜ç©ºé—´ <code>path</code> åŸºç¡€ä¸Šæ–°å»ºçš„ç›®å½•ï¼Œæœ€å¤šå¯ä»¥è®¾ç½® 3 å±‚ï¼Œæ¯å±‚å– 1 åˆ° 2 ä¸ªå­—æ¯ä½œä¸ºç›®å½•åï¼Œæ ¼å¼ä¸ºï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">levels=num:num:num   # ä¸‰ä¸ª num ä»£è¡¨ä¸‰å±‚ï¼Œæ¯å±‚ç›®å½•ååˆ†åˆ«å– num ä¸ªå­—æ¯</span><br><span class="line">levels=num:num       # ä¸¤ä¸ª num ä»£è¡¨ä¸¤å±‚ï¼Œæ¯å±‚ç›®å½•ååˆ†åˆ«å– num ä¸ªå­—æ¯</span><br><span class="line">levels=num           # ä¸€ä¸ª num ä»£è¡¨ä¸€å±‚ï¼Œæ¯å±‚ç›®å½•ååˆ†åˆ«å– num ä¸ªå­—æ¯</span><br></pre></td></tr></table></figure><p>å¦‚ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">levels=1:2   # ç¼“å­˜ç©ºé—´æœ‰ä¸¤å±‚ç›®å½•ï¼Œç¬¬ä¸€å±‚ç›®å½•åå– 1 ä¸ªå­—æ¯ï¼Œç¬¬äºŒå±‚ç›®å½•åå– 2 ä¸ªå­—æ¯</span><br></pre></td></tr></table></figure><p>å­—æ¯åä» MD5 åŠ å¯†çš„å€¼åé¢å¾€å‰æˆªå–ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾ proxy_cache_key ä¸º keleï¼Œé€šè¿‡ MD5 åŠ å¯†ä»¥åçš„å€¼ä¸º 27ce47ea65c1381dbe5175f7c77d8a3a</span></span><br><span class="line">levels=1:2    # æœ€ç»ˆçš„å­˜å‚¨è·¯å¾„ä¸º /usr/local/proxy_cache/a/a3ï¼Œæ¯å±‚æˆªå–ä¸ªæ•°æ ¹æ® 1:2</span><br><span class="line">levels=2:1:2  # æœ€ç»ˆçš„å­˜å‚¨è·¯å¾„ä¸º /usr/local/proxy_cache/3a/a/d8ï¼Œæ¯å±‚æˆªå–ä¸ªæ•°æ ¹æ® 2:1:2</span><br><span class="line">levels=2:2:2  # æœ€ç»ˆçš„å­˜å‚¨è·¯å¾„ä¸º /usr/local/proxy_cache/3a/8a/7dï¼Œæ¯å±‚æˆªå–ä¸ªæ•°æ ¹æ® 2:2:2</span><br></pre></td></tr></table></figure><p>è¿˜ä¸ç†è§£å—ï¼Ÿå­˜å‚¨è·¯å¾„åœ¨ <code>path</code> ç›®å½•åŸºç¡€ä¸Šå†åˆ›å»ºæ–°çš„ç›®å½•ï¼Œæ–°çš„ç›®å½•åä»åŠ å¯†åçš„å€¼çš„åé¢å¾€å‰é¢æˆªå–ã€‚</p><p><code>keys_zone</code>ï¼šç”¨æ¥ä¸ºè¿™ä¸ªå­˜keyçš„ç¼“å­˜åŒºè®¾ç½®åç§°å’ŒæŒ‡å®šå¤§å°ï¼Œå¦‚ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keys_zone=kele:200m  # ç¼“å­˜åŒºçš„åç§°æ˜¯ keleï¼Œå¤§å°ä¸º 200Mï¼Œ1M å¤§æ¦‚èƒ½å­˜å‚¨ 8000 ä¸ª keys</span><br></pre></td></tr></table></figure><p><code>inactive</code>ï¼šæŒ‡å®šçš„æ—¶é—´å†…æœªè®¿é—®çš„ç¼“å­˜æ•°æ®ä¼šä»ç¼“å­˜ä¸­åˆ é™¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>inactive</code> è®¾ç½®ä¸º 10 åˆ†é’Ÿã€‚å¦‚ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inactive=1d   # ç¼“å­˜æ•°æ®åœ¨ 1 å¤©å†…æ²¡æœ‰è¢«è®¿é—®å°±ä¼šè¢«åˆ é™¤</span><br></pre></td></tr></table></figure><p><code>max_size</code>ï¼šè®¾ç½®æœ€å¤§ç¼“å­˜ç©ºé—´ï¼Œå¦‚æœç¼“å­˜ç©ºé—´å­˜æ»¡ï¼Œé»˜è®¤ä¼šè¦†ç›–ç¼“å­˜æ—¶é—´æœ€é•¿çš„èµ„æºï¼Œé»˜è®¤å•ä½ä¸ºå…†ã€‚å¦‚ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max_size=20g    # æœ€å¤§ç¼“å­˜ç©ºé—´ä¸º 20G</span><br></pre></td></tr></table></figure><p>é…ç½®å®ä¾‹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line"><span class="attribute">proxy_cache_path</span> /usr/local/proxy_cache keys_zone=kele:<span class="number">200m</span> levels=<span class="number">1</span>:<span class="number">2</span>:<span class="number">1</span> inactive=<span class="number">1d</span> max_size=<span class="number">20g</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶é‡å¯ Nginx é…ç½®æ–‡ä»¶ï¼Œå‘ç° <code>/usr/local</code> ç›®å½•é‡Œå¤šå‡ºä¸€ä¸ªç›®å½•ï¼Œåå­—å«åš proxy_cacheã€‚</p><h3 id="proxy-cache"><a href="#proxy-cache" class="headerlink" title="proxy_cache"></a>proxy_cache</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥å¼€å¯æˆ–å…³é—­ä»£ç†ç¼“å­˜ï¼Œå¦‚æœæ˜¯å¼€å¯åˆ™è‡ªå®šä½¿ç”¨å“ªä¸ªç¼“å­˜åŒºæ¥è¿›è¡Œç¼“å­˜ã€‚é»˜è®¤å…³é—­ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_cache &lt;zone_name | off&gt;;</td><td>proxy_cache off;</td><td>httpã€serverã€location</td></tr></tbody></table><p>zone_nameï¼šæŒ‡å®šä½¿ç”¨ç¼“å­˜åŒºçš„åç§°ã€‚</p><p>ç¼“å­˜åŒºçš„åç§°å¿…é¡»æ˜¯ <code>proxy_cache_path</code> é‡Œçš„ <code>keys_zone</code> ç”Ÿæˆçš„ç¼“å­˜åã€‚</p><h3 id="proxy-cache-key"><a href="#proxy-cache-key" class="headerlink" title="proxy_cache_key"></a>proxy_cache_key</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½® Web ç¼“å­˜çš„ key å€¼ï¼ŒNginx ä¼šæ ¹æ® key å€¼åˆ©ç”¨ MD5 è®¡ç®—å¤„å“ˆå¸Œå€¼å¹¶ç¼“å­˜èµ·æ¥ï¼Œä½œä¸ºç¼“å­˜ç›®å½•åçš„å‚è€ƒã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_cache_key &lt;key&gt;;</td><td>proxy_cache_key $scheme$proxy_host$request_uri;</td><td>httpã€serverã€location</td></tr></tbody></table><p>å¦‚ kele ç”± MD5 è®¡ç®—å‡ºæ¥æ˜¯ 27ce47ea65c1381dbe5175f7c77d8a3a</p><p>åœ¨å“ªè®¡ç®—å‡ºæ¥çš„ï¼Ÿ å‰å¾€ <a href="https://md5jiami.bmcx.com/" target="_blank" rel="noopener">MD5 åœ¨çº¿åŠ å¯†ç½‘ç«™</a></p><h3 id="proxy-cache-valid"><a href="#proxy-cache-valid" class="headerlink" title="proxy_cache_valid"></a>proxy_cache_valid</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥å¯¹ä¸åŒè¿”å›çŠ¶æ€ç çš„ URL è®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_cache_valid [code â€¦â€¦ ] &lt;time&gt;;</td><td>â€”</td><td>httpã€serverã€location</td></tr></tbody></table><p>å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_cache_valid</span> <span class="number">200</span> <span class="number">302</span> <span class="number">10m</span>; <span class="comment"># ä¸º 200 å’Œ 302 çš„å“åº” URL è®¾ç½® 10 åˆ†é’Ÿç¼“å­˜æ—¶é—´</span></span><br><span class="line"><span class="attribute">proxy_cache_valid</span> <span class="number">404</span> <span class="number">1m</span>;      <span class="comment"># ä¸º 404 çš„å“åº” URL è®¾ç½® 1 åˆ†é’Ÿç¼“å­˜æ—¶é—´</span></span><br><span class="line"><span class="attribute">proxy_cache_valid</span> any <span class="number">1m</span>;      <span class="comment"># å¯¹æ‰€æœ‰å“åº”çŠ¶æ€ç çš„URLéƒ½è®¾ç½® 1 åˆ†é’Ÿç¼“å­˜æ—¶é—´</span></span><br></pre></td></tr></table></figure><h3 id="proxy-cache-min-uses"><a href="#proxy-cache-min-uses" class="headerlink" title="proxy_cache_min_uses"></a>proxy_cache_min_uses</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®èµ„æºè¢«è®¿é—®å¤šå°‘æ¬¡åæ‰ä¼šè¢«ç¼“å­˜ã€‚é»˜è®¤æ˜¯ 1 æ¬¡ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_cache_min_uses &lt;number&gt;;</td><td>proxy_cache_min_uses 1;</td><td>httpã€serverã€location</td></tr></tbody></table><h3 id="proxy-cache-methods"><a href="#proxy-cache-methods" class="headerlink" title="proxy_cache_methods"></a>proxy_cache_methods</h3><p>è¯¥æŒ‡ä»¤æ˜¯è®¾ç½®ç¼“å­˜å“ªäº› HTTP æ–¹æ³•çš„è¯·æ±‚èµ„æºã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_cache_methods &lt;GET | HEAD | POST&gt;;</td><td>proxy_cache_methods GET HEAD;</td><td>httpã€serverã€location</td></tr></tbody></table><p>é»˜è®¤ç¼“å­˜ HTTP çš„ GET å’Œ HEAD æ–¹æ³•çš„è¯·æ±‚èµ„æºï¼Œä¸ç¼“å­˜ POST æ–¹æ³•çš„è¯·æ±‚èµ„æºã€‚</p><h2 id="ç¼“å­˜è®¾ç½®æ¡ˆä¾‹"><a href="#ç¼“å­˜è®¾ç½®æ¡ˆä¾‹" class="headerlink" title="ç¼“å­˜è®¾ç½®æ¡ˆä¾‹"></a>ç¼“å­˜è®¾ç½®æ¡ˆä¾‹</h2><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220805/image.4ye8ddxwbng0.webp" alt="image"></p><h3 id="æ­¥éª¤å®ç°"><a href="#æ­¥éª¤å®ç°" class="headerlink" title="æ­¥éª¤å®ç°"></a>æ­¥éª¤å®ç°</h3><p><strong>åº”ç”¨æœåŠ¡å™¨çš„ç¯å¢ƒå‡†å¤‡</strong></p><ol><li><p>åœ¨ <code>192.168.200.146</code> æœåŠ¡å™¨ A ä¸Šçš„ tomcat çš„ webapps ä¸‹é¢æ·»åŠ ä¸€ä¸ª js ç›®å½•ï¼Œå¹¶åœ¨ js ç›®å½•ä¸­æ·»åŠ ä¸€ä¸ª jquery.js æ–‡ä»¶</p></li><li><p>å¯åŠ¨ tomcat</p></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/tomcat/bin</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure><ol start="3"><li>è®¿é—®æœåŠ¡å™¨ A è¿›è¡Œæµ‹è¯•</li></ol><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://192.168.200.146:8080/js/jquery.js</span></span><br></pre></td></tr></table></figure><p><strong>Nginx çš„ç¯å¢ƒå‡†å¤‡</strong></p><ol><li>å‡†å¤‡æœåŠ¡å™¨ B å®Œæˆ Nginx çš„åå‘ä»£ç†é…ç½®</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line"><span class="attribute">upstream</span> backend&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:8080</span>;   <span class="comment"># æœåŠ¡å™¨ A åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span>       <span class="number">8080</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://backend/js/;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å®Œæˆ Nginx ç¼“å­˜é…ç½®</li></ol><p><strong>æœ‰æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    <span class="attribute">proxy_cache_path</span> /usr/local/proxy_cache levels=<span class="number">2</span>:<span class="number">1</span> keys_zone=bing:<span class="number">200m</span> inactive=<span class="number">1d</span> max_size=<span class="number">20g</span>;</span><br><span class="line">    <span class="attribute">upstream</span> backend&#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.200.146:8080</span>;   <span class="comment"># æœåŠ¡å™¨ A çš„åœ°å€</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8080</span>;     <span class="comment"># ç›‘å¬ 8080 ç«¯å£</span></span><br><span class="line">        <span class="attribute">server_name</span>  localhost; <span class="comment"># ç›‘å¬ localhost çš„IP</span></span><br><span class="line">        <span class="attribute">location</span> / &#123;<span class="comment"># ç›‘å¬åŒ…å« / çš„è¯·æ±‚</span></span><br><span class="line">            <span class="attribute">proxy_cache</span> bing;    <span class="comment"># å¼€å¯ bing ç¼“å­˜åŒºï¼Œå’Œç¬¬ 2 è¡Œçš„ keys_zone å¯¹åº”</span></span><br><span class="line">            <span class="attribute">proxy_cache_key</span> kele;  <span class="comment"># ç¼“å­˜çš„ key å€¼ï¼Œä¼šè¢« MD5 è§£ææˆå­—ç¬¦ä¸²ç”¨äºç”Ÿæˆç¼“å­˜çš„ç›®å½•</span></span><br><span class="line">            <span class="attribute">proxy_cache_min_uses</span> <span class="number">5</span>; <span class="comment"># èµ„æºè¢«è®¿é—® 5 æ¬¡åæ‰ä¼šè¢«ç¼“å­˜</span></span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> <span class="number">200</span> <span class="number">5d</span>;<span class="comment"># ä¸º 200 å“åº” URL è®¾ç½® 5 å¤©ç¼“å­˜æ—¶é—´</span></span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> <span class="number">404</span> <span class="number">30s</span>;  <span class="comment"># ä¸º 404 çš„å“åº” URL è®¾ç½® 30 ç§’ç¼“å­˜æ—¶é—´</span></span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> any <span class="number">1m</span>;<span class="comment"># ä¸ºé™¤äº†ä¸Šæ–¹çš„ä»»æ„å“åº” URL è®¾ç½® 1 åˆ†é’Ÿç¼“å­˜æ—¶é—´</span></span><br><span class="line">            <span class="attribute">add_header</span> nginx-cache <span class="string">"<span class="variable">$upstream_cache_status</span>"</span>;  <span class="comment"># å°†ç¼“å­˜çš„çŠ¶æ€æ”¾åˆ°è¯·æ±‚å¤´é‡Œ</span></span><br><span class="line">            <span class="attribute">proxy_pass</span> http://backend/js/;  <span class="comment"># ä»£ç† backendï¼Œå°† /js/ è¿½åŠ åˆ° backend æ¨¡å—é‡Œçš„åœ°å€åé¢</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ— æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    <span class="attribute">proxy_cache_path</span> /usr/local/proxy_cache levels=<span class="number">2</span>:<span class="number">1</span> keys_zone=bing:<span class="number">200m</span> inactive=<span class="number">1d</span> max_size=<span class="number">20g</span>;</span><br><span class="line">    <span class="attribute">upstream</span> backend&#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.200.146:8080</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8080</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_cache</span> bing;</span><br><span class="line">            <span class="attribute">proxy_cache_key</span> kele;</span><br><span class="line">            <span class="attribute">proxy_cache_min_uses</span> <span class="number">5</span>;</span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> <span class="number">200</span> <span class="number">5d</span>;</span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> <span class="number">404</span> <span class="number">30s</span>;</span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> any <span class="number">1m</span>;</span><br><span class="line">            <span class="attribute">add_header</span> nginx-cache <span class="string">"<span class="variable">$upstream_cache_status</span>"</span>;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://backend/js/;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>æµ‹è¯•æ˜¯å¦ç¼“å­˜æˆåŠŸ</li></ol><p>åˆ©ç”¨ <code>$upstream_cache_status</code> çš„å€¼åœ¨æ§åˆ¶å°(F12)æŸ¥çœ‹æ˜¯å¦ç¼“å­˜ã€‚</p><p>ç¬¬ä¸€æ¬¡è®¿é—® <code>192.168.200.113:8080/jquery.js</code>ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220805/image.3p1azxp6cdy0.webp" alt="image"></p><p>å› ä¸ºç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œæ­£åœ¨ç¼“å­˜ï¼Œæ‰€ä»¥è¿”å›çš„è¯·æ±‚å¤´ MISS æ˜¯æ²¡æœ‰ç¼“å­˜æˆåŠŸã€‚</p><p>ç¬¬äºŒæ¬¡è®¿é—® <code>192.168.200.113:8080/jquery.js</code>ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220805/image.73w7kaxo8r00.webp" alt="image"></p><p>HIT ä»£è¡¨æˆåŠŸç¼“å­˜ã€‚</p><ol start="4"><li>æµ‹è¯• 404 ç¼“å­˜æ—¶é—´</li></ol><p>æµ‹è¯• 404 ç¼“å­˜æ—¶é—´ï¼Œæˆ‘ä»¬è®¿é—® <code>192.168.200.113:8080/jquery.js111</code>ï¼Œå®ƒä¼šè¿”å› 404 é¡µé¢ï¼Œå¹¶ç¼“å­˜ 404 é¡µé¢ï¼Œå½“æˆ‘ä»¬ç«‹å³è®¿é—®æ­£ç¡®çš„ <code>192.168.200.113:8080/jquery.js</code>ï¼Œå®ƒä¾ç„¶è¿”å› 404 é¡µé¢ï¼Œå› ä¸º <code>/jquery.js</code> è¯·æ±‚ç›®å‰è¢«ç¼“å­˜ä¸º 404ï¼Œè¿˜æ²¡åˆ° 30 ç§’è¿‡æœŸï¼Œç­‰ 30 ç§’åå†è®¿é—®ï¼Œå°±æˆåŠŸäº†ã€‚</p><h2 id="ç¼“å­˜çš„åˆ é™¤"><a href="#ç¼“å­˜çš„åˆ é™¤" class="headerlink" title="ç¼“å­˜çš„åˆ é™¤"></a>ç¼“å­˜çš„åˆ é™¤</h2><p>è¿™é‡Œä»‹ç»ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>åˆ é™¤å¯¹åº”çš„ç¼“å­˜ç›®å½•</li><li>ä½¿ç”¨ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—</li></ul><h3 id="åˆ é™¤ç¼“å­˜ç›®å½•"><a href="#åˆ é™¤ç¼“å­˜ç›®å½•" class="headerlink" title="åˆ é™¤ç¼“å­˜ç›®å½•"></a>åˆ é™¤ç¼“å­˜ç›®å½•</h3><p>å‡è®¾ç¼“å­˜ç›®å½•æ˜¯ <code>/usr/local/proxy_cache/</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /usr/<span class="built_in">local</span>/proxy_cache/......</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³åˆ é™¤æŸä¸ªç¼“å­˜ç›®å½•ï¼Œå°±åœ¨åé¢åŠ ä¸Šç›®å½•åã€‚å¦‚æœæƒ³åˆ é™¤æ•´ä¸ªç¼“å­˜ç›®å½•ï¼Œç›´æ¥åˆ é™¤ <code>/usr/local/proxy_cache/</code> å³å¯ã€‚</p><h3 id="ngx-cache-purgeåˆ é™¤"><a href="#ngx-cache-purgeåˆ é™¤" class="headerlink" title="ngx_cache_purgeåˆ é™¤"></a>ngx_cache_purgeåˆ é™¤</h3><p>ä½¿ç”¨ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å— <code>ngx_cache_purge</code> è¿›è¡Œåˆ é™¤ç¼“å­˜ã€‚</p><ol><li><p>ä¸‹è½½ <code>ngx_cache_purge</code> æ¨¡å—å¯¹åº”çš„èµ„æºåŒ…ï¼Œå¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ <code>/root/nginx/module/</code> ç›®å½•ä¸‹ã€‚</p><p>è¿™é‡Œçš„èµ„æºåŒ…æ˜¯ ngx_cache_purge-2.3.tar.gz</p></li><li><p>å¯¹èµ„æºæ–‡ä»¶è¿›è¡Œè§£å‹ç¼©</p></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf ngx_cache_purge-2.3.tar.gz</span><br></pre></td></tr></table></figure><ol start="3"><li>ä¿®æ”¹æ–‡ä»¶å¤¹åç§°ä¸º <code>purge</code>ï¼Œæ–¹ä¾¿åæœŸé…ç½®</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv ngx_cache_purge-2.3 purge</span><br></pre></td></tr></table></figure><ol start="4"><li>æŸ¥è¯¢ Nginx çš„é…ç½®å‚æ•° <code>configure arguments</code>ï¼Œå¹¶æ‹·è´å‡ºæ¥</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -V</span><br></pre></td></tr></table></figure><ol start="5"><li>è¿›å…¥ Nginx çš„å®‰è£…åŒ…ç›®å½•ï¼Œä½¿ç”¨ ./configure è¿›è¡Œå‚æ•°é…ç½®ï¼Œè®°å¾—åŠ ä¸Š <code>nginx -V</code> æŸ¥è¯¢å‡ºæ¥çš„ <code>configure arguments</code> å‚æ•°</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --add-module=/root/nginx/module/purge  <span class="comment"># åŠ ä¸Šä¹‹å‰çš„ configure arguments å‚æ•°</span></span><br></pre></td></tr></table></figure><ol start="6"><li>ä½¿ç”¨ make è¿›è¡Œç¼–è¯‘</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><ol start="7"><li>å°† Nginx å®‰è£…ç›®å½•çš„ nginx äºŒçº§åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å¤‡ä»½</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/<span class="built_in">local</span>/nginx/sbin/nginx /usr/<span class="built_in">local</span>/nginx/sbin/nginx.backup</span><br></pre></td></tr></table></figure><ol start="8"><li>å°†ç¼–è¯‘åçš„ objs ä¸­çš„ nginx æ‹·è´åˆ° nginx çš„ sbin ç›®å½•ä¸‹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp objs/nginx /usr/<span class="built_in">local</span>/nginx/sbin</span><br></pre></td></tr></table></figure><ol start="9"><li>ä½¿ç”¨ <code>make upgrade</code> è¿›è¡Œå‡çº§ï¼Œè®°å¾—åœ¨å®‰è£…åŒ…ç›®å½•ä¸‹æ‰§è¡Œ</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/nginx/core/nginx-1.20.2</span><br><span class="line"></span><br><span class="line">make upgrade</span><br></pre></td></tr></table></figure><ol start="10"><li>åœ¨ Nginx é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    <span class="attribute">location</span> ~/purge(/.*) &#123;</span><br><span class="line">        <span class="attribute">proxy_cache_purge</span> bing kele;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>proxy_cache_purge</code> æŒ‡ä»¤</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_cache_purge &lt;cache&gt; &lt;key&gt;</td><td>-</td><td>httpã€serverã€location</td></tr></tbody></table><ul><li><code>cache</code> æ˜¯ <code>proxy_cache</code>ï¼Œè¯¦ç»†å†…å®¹çœ‹ <a href="https://notes.youngkbt.cn/nginx/cache-integration/#proxy-cache" target="_blank" rel="noopener">proxy_cache</a></li><li><code>key</code> æ˜¯ <code>proxy_cache_key</code>ï¼Œè¯¦ç»†å†…å®¹çœ‹ <a href="https://notes.youngkbt.cn/nginx/cache-integration/#proxy-cache-key" target="_blank" rel="noopener">proxy_cache_key</a></li></ul><h2 id="èµ„æºä¸ç¼“å­˜"><a href="#èµ„æºä¸ç¼“å­˜" class="headerlink" title="èµ„æºä¸ç¼“å­˜"></a>èµ„æºä¸ç¼“å­˜</h2><p>å‰é¢å’±ä»¬å·²ç»å®Œæˆäº† Nginx ä½œä¸º Web ç¼“å­˜æœåŠ¡å™¨çš„ä½¿ç”¨ã€‚ä½†æ˜¯æˆ‘ä»¬å¾—æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œ<strong>ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½é€‚åˆè¿›è¡Œç¼“å­˜</strong>ã€‚æ¯”å¦‚è¯´å¯¹äºä¸€äº›ç»å¸¸å‘ç”Ÿå˜åŒ–çš„æ•°æ®ã€‚å¦‚æœè¿›è¡Œç¼“å­˜çš„è¯ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°ç”¨æˆ·è®¿é—®åˆ°çš„æ•°æ®ä¸æ˜¯æœåŠ¡å™¨çœŸå®çš„æ•°æ®ã€‚æ‰€ä»¥å¯¹äºè¿™äº›èµ„æºæˆ‘ä»¬åœ¨ç¼“å­˜çš„è¿‡ç¨‹ä¸­å°±éœ€è¦è¿›è¡Œè¿‡æ»¤ï¼Œä¸è¿›è¡Œç¼“å­˜ã€‚</p><p>Nginx ä¹Ÿæä¾›äº†è¿™å—çš„åŠŸèƒ½è®¾ç½®ï¼Œéœ€è¦ä½¿ç”¨åˆ°å¦‚ä¸‹ä¸¤ä¸ªæŒ‡ä»¤ï¼š</p><ul><li>proxy_no_cache</li><li>proxy_cache_bypass</li></ul><h3 id="proxy-no-cache"><a href="#proxy-no-cache" class="headerlink" title="proxy_no_cache"></a>proxy_no_cache</h3><p>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥å®šä¹‰ä¸å°†æ•°æ®è¿›è¡Œç¼“å­˜çš„æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯ä¸ç¼“å­˜æŒ‡å®šçš„æ•°æ®ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_no_cache &lt;string&gt; â€¦â€¦ ;</td><td>â€”</td><td>httpã€serverã€location</td></tr></tbody></table><p>å¯è®¾ç½®å¤šä¸ª stringã€‚</p><p>é…ç½®å®ä¾‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_no_cache</span> <span class="variable">$cookie_nocache</span> <span class="variable">$arg_nocache</span> <span class="variable">$arg_comment</span>;</span><br></pre></td></tr></table></figure><h3 id="proxy-cache-bypass"><a href="#proxy-cache-bypass" class="headerlink" title="proxy_cache_bypass"></a>proxy_cache_bypass</h3><p>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥è®¾ç½®ä¸ä»ç¼“å­˜ä¸­è·å–æ•°æ®çš„æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯è™½ç„¶ç¼“å­˜äº†æŒ‡å®šçš„èµ„æºï¼Œä½†è¯·æ±‚è¿‡æ¥ä¹Ÿä¸ä¼šå»è·å–å®ƒï¼Œè€Œæ˜¯å»æœåŠ¡å™¨é‡Œè·å–èµ„æºã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_cache_bypass &lt;string&gt; â€¦â€¦ ;</td><td>â€”</td><td>httpã€serverã€location</td></tr></tbody></table><p>å¯è®¾ç½®å¤šä¸ª stringã€‚</p><p>é…ç½®å®ä¾‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_cache_bypass</span> <span class="variable">$cookie_nocache</span> <span class="variable">$arg_nocache</span> <span class="variable">$arg_comment</span>;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸¤ä¸ªæŒ‡ä»¤éƒ½æœ‰ä¸€ä¸ªæŒ‡å®šçš„æ¡ä»¶ï¼Œè¿™ä¸ªæ¡ä»¶å¯ä»¥æ˜¯å¤šä¸ªï¼Œ<strong>å¹¶ä¸”å¤šä¸ªæ¡ä»¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸ä¸ºç©ºä¸”ä¸ç­‰äºã€Œ0ã€ï¼Œåˆ™æ¡ä»¶æ»¡è¶³æˆç«‹ã€‚</strong></p><p>ä¸Šé¢ç»™çš„é…ç½®å®ä¾‹æ˜¯ä»å®˜æ–¹ç½‘ç«™è·å–çš„ï¼Œé‡Œé¢ä½¿ç”¨åˆ°äº†ä¸‰ä¸ªå˜é‡ï¼Œåˆ†åˆ«æ˜¯ <code>$cookie_nocache</code>ã€<code>$arg_nocache</code>ã€<code>$arg_comment</code></p><h3 id="å¸¸ç”¨ä¸ç¼“å­˜å˜é‡"><a href="#å¸¸ç”¨ä¸ç¼“å­˜å˜é‡" class="headerlink" title="å¸¸ç”¨ä¸ç¼“å­˜å˜é‡"></a>å¸¸ç”¨ä¸ç¼“å­˜å˜é‡</h3><p>å¸¸ç”¨ä¸ç¼“å­˜çš„ä¸‰ä¸ªå˜é‡åˆ†åˆ«ä¸ºï¼š</p><ul><li><code>$cookie_nocache</code></li><li><code>$arg_nocache</code></li><li><code>$arg_comment</code></li></ul><p>è¿™ä¸‰ä¸ªå˜é‡åˆ†åˆ«ä»£è¡¨çš„å«ä¹‰æ˜¯:</p><ul><li><code>$cookie_nocache</code>ï¼šæŒ‡çš„æ˜¯å½“å‰è¯·æ±‚çš„ cookie ä¸­ key ä¸º nocache çš„ value å€¼</li><li><code>$arg_nocache</code> å’Œ <code>$arg_comment</code>ï¼šæŒ‡çš„æ˜¯å½“å‰è¯·æ±‚çš„å‚æ•°ä¸­å±æ€§åä¸º nocache å’Œ comment å¯¹åº”çš„å±æ€§å€¼</li></ul><p>æ¡ˆä¾‹æ¼”ç¤º:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">log_format</span> params <span class="variable">$cookie_nocache</span> | <span class="variable">$arg_nocache</span> | <span class="variable">$arg_comment</span>ï¼›</span><br><span class="line">server &#123;</span><br><span class="line">    <span class="attribute">listen</span><span class="number">8081</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">access_log</span> logs/access_params.log params;</span><br><span class="line">        <span class="attribute">add_header</span> Set-Cookie <span class="string">'nocache=888'</span>;</span><br><span class="line">        <span class="attribute">root</span> html;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <code>192.168.200.133:8081?nocache=999&amp;comment=777</code>ï¼Œç„¶åå»æ—¥å¿—æŸ¥çœ‹ç»“æœï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220805/image.695kmtpob840.webp" alt="image"></p><p>ä»¥åè®¿é—®çš„æŸä¸€ä¸ªèµ„æºå¦‚æœä¸æƒ³ç¼“å­˜ï¼Œåœ¨ URL åé¢åŠ å…¥ä¸‰ä¸ªå˜é‡ä¸­çš„ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªå³å¯ï¼Œåªè¦å®ƒä»¬ä¸ä¸ºç©ºæˆ– 0ã€‚</p><p>è¿™ä¸‰ä¸ªå˜é‡æ¨èä½œä¸ºä¸ç¼“å­˜èµ„æºçš„æ¡ä»¶ï¼Œä½†å¹¶ä¸æ˜¯åªèƒ½ä½œä¸ºä¸ç¼“å­˜èµ„æºçš„æ¡ä»¶ã€‚</p><h3 id="æ¡ˆä¾‹æ¨¡æ¿"><a href="#æ¡ˆä¾‹æ¨¡æ¿" class="headerlink" title="æ¡ˆä¾‹æ¨¡æ¿"></a>æ¡ˆä¾‹æ¨¡æ¿</h3><p>è®¾ç½®ä¸ç¼“å­˜èµ„æºçš„é…ç½®æ–¹æ¡ˆæ¨¡æ¿ï¼š</p><ul><li>å¦‚æœè®¿é—®çš„æ˜¯ js æ–‡ä»¶ï¼Œåˆ™ä¸ä¼šç¼“å­˜è¯¥ js æ–‡ä»¶</li><li>å¦‚æœ <code>$nocache</code> <code>$cookie_nocache</code> <code>$arg_nocache</code> <code>$arg_comment</code> ä»»æ„ä¸ä¸ºç©ºæˆ– 0ï¼Œåˆ™è®¿é—®çš„èµ„æºä¸è¿›è¡Œç¼“å­˜</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span><span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">if</span> (<span class="variable">$request_uri</span> <span class="regexp">~ /.*\.js$)</span>&#123;</span><br><span class="line">            <span class="attribute">set</span> <span class="variable">$nocache</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">proxy_no_cache</span> <span class="variable">$nocache</span> <span class="variable">$cookie_nocache</span> <span class="variable">$arg_nocache</span> <span class="variable">$arg_comment</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$nocache</span> <span class="variable">$cookie_nocache</span> <span class="variable">$arg_nocache</span> <span class="variable">$arg_comment</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¸ä¼šç¼“å­˜ js æ–‡ä»¶å‘¢ï¼Œçœ‹ç¬¬ 5 - 6 è¡Œä»£ç ã€‚å¦‚æœè®¿é—®çš„æ–‡ä»¶æ˜¯ js æ–‡ä»¶ï¼Œåˆ™è®¾ç½® <code>$nocache</code> ä¸º 1ï¼Œåªè¦å®ƒä¸ä¸º 0ï¼Œåˆ™è§¦å‘ç¬¬ 8 è¡Œä»£ç ï¼Œ<code>proxy_no_cache</code> åé¢çš„å‚æ•°åªè¦æœ‰ä¸€ä¸ªä¸ä¸ºç©ºæˆ– 0ï¼Œåˆ™è®¿é—®çš„èµ„æºä¸è¿›è¡Œç¼“å­˜ã€‚</p><hr><h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><p>proxy_cache_pathè®¾ç½®ç¼“å­˜è·¯å¾„ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªinactiveå‚æ•°è®¾ç½®cacheè®¾ç½®ä¸æ´»è·ƒç¼“å­˜çš„åˆ é™¤æ—¶é—´ã€‚<br>proxy_cache_validè®¾ç½®ä¸åŒå“åº”ç çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ã€‚</p><p><strong>æå‡ºé—®é¢˜</strong></p><p>é‚£ä¹ˆè¿™ä¿©å‚æ•°åŒæ—¶è®¾ç½®ï¼Œå“ªä¸ªç”Ÿæ•ˆå‘¢ï¼Ÿ</p><p>æ ¹æ®ä¸Šé¢Stack Overflowçš„è¯´æ³•ã€‚<strong>inactiveåº”è¯¥éœ€è¦è®¾ç½®çš„æ¯”validä¸­æ—¶é—´é•¿ã€‚</strong></p><p>æ³¨æ„ï¼Œinactiveæ—¶é—´åˆ°äº†ï¼Œæ•°æ®åˆ é™¤ã€‚validè¿‡æœŸäº†æ•°æ®ä¸ä¼šåˆ é™¤ã€‚æœ‰è¯·æ±‚ï¼Œinactiveå°±åˆ·æ–°è®¡æ—¶ï¼Œvalidä¸å˜ã€‚æ²¡è¯·æ±‚ï¼Œinactiveå’Œvalidéƒ½ä¸å˜ã€‚</p><p>åˆ†æå„ç§æƒ…å†µï¼š</p><p><strong>1ã€inactiveè®¾ç½®1mï¼Œvalidè®¾ç½®1h</strong><br>é¦–å…ˆï¼Œè¯·æ±‚è¿›æ¥ï¼Œcacheå‡ºç°ï¼Œä¸¤ä¸ªæ—¶é—´å¼€å§‹å€’è®¡æ—¶ã€‚<br>æƒ…å†µä¸€ï¼šä¸æ–­è¯·æ±‚è¿™ä¸ªcacheï¼Œinactiveä¸æ–­åˆ·æ–°1må€’è®¡æ—¶ï¼Œç›´åˆ°åˆ°è¾¾1hï¼Œvalidè¿‡æœŸã€‚è¿™æ—¶ä½ å»è¯·æ±‚äº†ä¸€æ¬¡ï¼Œnginxé‡æ–°å»è¯»å–æœåŠ¡å™¨æ•°æ®ï¼Œåˆ·æ–°validå€’è®¡æ—¶ã€‚æœŸé—´æ•°æ®ä¸€ç›´åœ¨ç¼“å­˜é‡Œã€‚ä¸è¯·æ±‚ï¼Œå°±å†è¿‡1måˆ æ‰ã€‚<br>æƒ…å†µäºŒï¼šä¸¤æ¬¡è¯·æ±‚é—´éš”è¶…è¿‡äº†1minï¼Œinactiveç”Ÿæ•ˆï¼Œåˆ é™¤äº†è¿™ä¸ªcacheæ•°æ®ï¼Œæ²¡äº†ã€‚ä½ å†è¯·æ±‚ï¼Œç›¸å½“äºé‡æ–°å»æœåŠ¡å™¨æ‹¿äº†ä¸€æ¬¡æ•°æ®ï¼Œinactiveå’Œvalidå€’è®¡æ—¶éƒ½ä¼šé‡æ–°åˆ·æ–°ï¼Œä¸è¯·æ±‚ï¼Œcacheé‡Œå°±æ²¡æœ‰è¿™ä»½æ•°æ®äº†</p><p><strong>2ã€inactiveè®¾ç½®1m,validè®¾ç½®1m</strong><br>é¦–å…ˆï¼Œè¯·æ±‚è¿›æ¥ï¼Œcacheå‡ºç°ï¼Œä¸¤ä¸ªæ—¶é—´å¼€å§‹å€’è®¡æ—¶ã€‚<br>æƒ…å†µä¸€ï¼š1må†…ä¸è¯·æ±‚ï¼Œæœ€åinactiveç”Ÿæ•ˆåˆ æ‰ã€‚ä¸è¯·æ±‚å°±æ²¡ç¼“å­˜äº†ï¼Œè¯·æ±‚äº†ä¸€æ¬¡ï¼Œé‡æ–°ä»æœåŠ¡å™¨è¯»å–ä¸€ä»½ï¼Œä¸¤ä¸ªè®¡æ—¶åˆ·æ–°ã€‚<br>æƒ…å†µäºŒï¼š1må†…è¯·æ±‚äº†ä¸€æ¬¡ï¼Œinactiveæ—¶é—´åˆ·æ–°ï¼Œä½†æ˜¯validè¿˜åœ¨è®¡æ—¶ï¼Œæ‰€ä»¥1måˆ°äº†åï¼Œç¼“å­˜è¿‡æœŸäº†ã€‚ä½ å†è¯·æ±‚å°±é‡æ–°ä»æœåŠ¡å™¨è¯»å–ä¸€ä»½ï¼Œåˆ·æ–°è®¡æ—¶ã€‚ä¸è¯·æ±‚ï¼Œå°±ç­‰å¾…1mï¼Œç”±inactiveç”Ÿæ•ˆåˆ é™¤äº†ç¼“å­˜</p><p><strong>3ã€inactiveè®¾ç½®1hï¼Œvalidè®¾ç½®äº†1m</strong><br>é¦–å…ˆï¼Œè¯·æ±‚è¿›æ¥ï¼Œcacheå‡ºç°ï¼Œä¸¤ä¸ªæ—¶é—´å¼€å§‹å€’è®¡æ—¶ã€‚<br>è¿‡äº†1mï¼Œç¼“å­˜è¿‡æœŸï¼Œæ•°æ®åœ¨æ²¡åˆ æ‰ã€‚ä¸è¯·æ±‚ï¼Œç›´åˆ°1håˆ°ï¼Œinactiveåˆ æ‰ç¼“å­˜ã€‚è¯·æ±‚äº†ä¸€æ¬¡ï¼Œé‡æ–°ä»æœåŠ¡å™¨è¯»å–ï¼Œåˆ·æ–°ä¸¤ä¸ªè®¡æ—¶ã€‚</p><p>æ‰€ä»¥ï¼Œç»“è®ºinactiveåº”è¯¥éœ€è¦è®¾ç½®çš„æ¯”validä¸­æ—¶é—´é•¿ã€‚<br>ç›®çš„æ˜¯é’ˆå¯¹ï¼Œä¸€ä¸ªé•¿æœŸä¸ä½¿ç”¨çš„ç¼“å­˜æ•°æ®ï¼ŒæŠŠä»–åˆ æ‰ä¸å ç”¨å­˜å‚¨ï¼Œæˆ–è€…å¼ºåˆ¶åˆ·æ–°ã€‚</p><ul><li>inactiveæ˜¯é’ˆå¯¹ä¸¤æ¬¡è¯·æ±‚é—´éš”æ—¶é—´ï¼Œåˆ°æ—¶é—´å°±åˆ æ‰ä¸å ç”¨å†…å­˜ã€‚</li><li>validæ˜¯é’ˆå¯¹æŒç»­ä¸æ–­çš„è¯·æ±‚ï¼Œå¯¼è‡´ä¸€ç›´ç¼“å­˜ï¼Œæˆ‘è®¾ç½®æ—¶é—´å¼ºåˆ¶åˆ·æ–°ä¸€ä¸‹ã€‚ä¾‹å¦‚ï¼Œæ”¯ä»˜å®æ¯æ—¶æ¯åˆ»éƒ½æœ‰äººè®¿é—®ï¼Œä¸€ç›´è¯·æ±‚ï¼Œç¼“å­˜å°±ä¸€ç›´ä¸åˆ·æ–°ä¸€ç›´æ˜¯æ—§çš„ã€‚</li></ul><p>inactiveå’Œvalidæ˜¯é…åˆä½¿ç”¨ï¼Œä¸æ˜¯è°æ—¶é—´çŸ­è¦†ç›–è°çš„å…³ç³»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx åå‘ä»£ç†</title>
      <link href="/2022/11/12/Nginx_Reverse_proxy/"/>
      <url>/2022/11/12/Nginx_Reverse_proxy/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-åå‘ä»£ç†"><a href="#Nginx-åå‘ä»£ç†" class="headerlink" title="Nginx åå‘ä»£ç†"></a>Nginx åå‘ä»£ç†</h1><p><strong>å¼•è¨€</strong></p><p>Nginx å¦‚ä½•å˜æˆä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼ŸNginx åˆå¦‚ä½•å°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘ç»™å…¶ä»–çš„æœåŠ¡å™¨ï¼Ÿæœ¬å†…å®¹å°†å­¦ä¹  Nginx çš„åå‘ä»£ç†çŸ¥è¯†ã€‚</p><hr><h2 id="åå‘ä»£ç†æ¦‚è¿°"><a href="#åå‘ä»£ç†æ¦‚è¿°" class="headerlink" title="åå‘ä»£ç†æ¦‚è¿°"></a>åå‘ä»£ç†æ¦‚è¿°</h2><p>å…³äºæ­£å‘ä»£ç†å’Œåå‘ä»£ç†ï¼Œåœ¨ <a href="/pages/9551ee/#åè¯è§£é‡Š">Nginx - ä»‹ç»</a> å·²ç»é€šè¿‡ä¸€å¼ å›¾è¯¦ç»†çš„ä»‹ç»è¿‡äº†ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯æ­£å‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯ï¼Œåå‘ä»£ç†ä»£ç†çš„æ˜¯æœåŠ¡ç«¯ï¼Œè¿™æ˜¯ä¸¤è€…ä¹‹é—´æœ€å¤§çš„åŒºåˆ«ã€‚</p><p>Nginx å³å¯ä»¥å®ç°æ­£å‘ä»£ç†ï¼Œä¹Ÿå¯ä»¥å®ç°åå‘ä»£ç†ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥é€šè¿‡ä¸€ä¸ªå°æ¡ˆä¾‹æ¼”ç¤ºä¸‹ Nginx æ­£å‘ä»£ç†çš„ç®€å•åº”ç”¨ã€‚</p><h3 id="æ­£å‘ä»£ç†"><a href="#æ­£å‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†"></a>æ­£å‘ä»£ç†</h3><p>å…ˆæéœ€æ±‚ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.53oygoz19gc0.webp" alt="image"></p><ol><li>æœåŠ¡ç«¯çš„è®¾ç½®ï¼š</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">log_format</span> main <span class="string">'client send request=&gt;clientIp=<span class="variable">$remote_addr</span> serverIp=<span class="variable">$host</span>'</span>;</span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span>localhost;</span><br><span class="line"><span class="attribute">access_log</span> logs/access.log main;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">root</span> html;</span><br><span class="line"><span class="attribute">index</span> index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯ï¼š<code>http://192.168.200.133</code>ï¼Œæ‰“å¼€æ—¥å¿—æŸ¥çœ‹ç»“æœ</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.16ifxal7swyk.webp" alt="image"></p><ol start="3"><li>ä»£ç†æœåŠ¡å™¨è®¾ç½®ï¼š</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">82</span>;</span><br><span class="line">    <span class="attribute">resolver</span> <span class="number">8.8.8.8</span>;   <span class="comment"># è®¾ç½® DNS çš„ IPï¼Œç”¨æ¥è§£æ proxy_pass ä¸­çš„åŸŸå</span></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://<span class="variable">$host</span><span class="variable">$request_uri</span>;   <span class="comment"># proxy_pass å®ç°æ­£å‘ä»£ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>proxy_pass</code> åé¢æœ‰è®²è§£ã€‚</p><ol start="4"><li>å®¢æˆ·ç«¯é…ç½®ä»£ç†æœåŠ¡å™¨çš„ IP(192.168.200.146)å’Œ Nginx é…ç½®ç›‘å¬çš„ç«¯å£(82)</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.3yx93qbazra0.webp" alt="image"></p><ol start="5"><li>è®¾ç½®å®Œæˆåï¼Œå†æ¬¡é€šè¿‡æµè§ˆå™¨è®¿é—®æœåŠ¡ç«¯</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.6litsat09000.webp" alt="image"></p><p>é€šè¿‡å¯¹æ¯”ï¼Œä¸Šä¸‹ä¸¤æ¬¡çš„æ—¥å¿—è®°å½•ï¼Œä¼šå‘ç°è™½ç„¶æˆ‘ä»¬æ˜¯å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯ï¼Œä½†æ˜¯ä½¿ç”¨äº†ä»£ç†ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯èƒ½çœ‹åˆ°çš„åªæ˜¯ä»£ç†å‘é€è¿‡å»çš„è¯·æ±‚ï¼Œè¿™æ ·å°±ä½¿ç”¨ Nginx å®ç°äº†æ­£å‘ä»£ç†çš„è®¾ç½®ã€‚</p><p>ä½†æ˜¯ Nginx æ­£å‘ä»£ç†ï¼Œåœ¨å®é™…çš„åº”ç”¨ä¸­ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬ç®€å•äº†è§£ä¸‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å­¦ä¹  Nginx çš„åå‘ä»£ç†ï¼Œè¿™æ˜¯ Nginx æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ã€‚</p><h2 id="åå‘ä»£ç†è¯­æ³•é…ç½®"><a href="#åå‘ä»£ç†è¯­æ³•é…ç½®" class="headerlink" title="åå‘ä»£ç†è¯­æ³•é…ç½®"></a>åå‘ä»£ç†è¯­æ³•é…ç½®</h2><p>Nginx åå‘ä»£ç†æ¨¡å—çš„æŒ‡ä»¤æ˜¯ç”± <code>ngx_http_proxy_module</code> æ¨¡å—è¿›è¡Œè§£æï¼Œè¯¥æ¨¡å—åœ¨å®‰è£… Nginx çš„æ—¶å€™å·²ç»è‡ªåŠ¨åŠ è½½åˆ° Nginx ä¸­äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŠŠåå‘ä»£ç†ä¸­çš„å¸¸ç”¨æŒ‡ä»¤ä¸€ä¸€ä»‹ç»ä¸‹ï¼š</p><ul><li>proxy_passï¼šé…ç½®ä»£ç†çš„æœåŠ¡å™¨åœ°å€</li><li>proxy_set_headerï¼šè½¬å‘ç»™è¢«ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œè®¾ç½®ä¸€äº›è¯·æ±‚å¤´ä¿¡æ¯</li><li>proxy_redirectï¼šé˜²æ­¢å®¢æˆ·ç«¯å¯ä»¥çœ‹åˆ°è¢«ä»£ç†æœåŠ¡å™¨çš„åœ°å€</li></ul><p>è¿™é‡Œåªä»‹ç»ä¸‰ä¸ªæŒ‡ä»¤ï¼Œå…³äºåå‘ä»£ç†çš„æŒ‡ä»¤éå¸¸å¤šï¼Œæƒ³è¦äº†è§£æ›´å¤šï¼Œè¯·å‰å¾€ <a href="https://nginx.org/en/docs/stream/ngx_stream_proxy_module.html" target="_blank" rel="noopener">Nginx åå‘ä»£ç†æ–‡æ¡£</a></p><h3 id="proxy-pass"><a href="#proxy-pass" class="headerlink" title="proxy_pass"></a>proxy_pass</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®è¢«ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œå¯ä»¥æ˜¯ä¸»æœºåç§°ã€IP åœ°å€åŠ ç«¯å£å·å½¢å¼ï¼Œæ²¡æœ‰é»˜è®¤å€¼ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_pass &lt;URL&gt;;</td><td>â€”</td><td>location</td></tr></tbody></table><p><code>URL</code>ï¼šä¸ºè¦è®¾ç½®çš„è¢«ä»£ç†æœåŠ¡å™¨åœ°å€ï¼ŒåŒ…å«ä¼ è¾“åè®®(<code>http</code>ã€<code>https://</code>)ã€ä¸»æœºåç§°æˆ– IP åœ°å€åŠ ç«¯å£å·ã€URI ç­‰è¦ç´ ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass</span> http://www.baidu.com;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹å­</span></span><br><span class="line"><span class="attribute">location</span> /server &#123;</span><br><span class="line">    <span class="comment"># ç»“å°¾ä¸åŠ æ–œæ </span></span><br><span class="line">    <span class="attribute">proxy_pass</span> http://192.168.200.146;</span><br><span class="line">    <span class="comment"># è®¿é—®çš„æ˜¯ï¼šhttp://192.168.200.146/server/index.html</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç»“å°¾åŠ æ–œæ </span></span><br><span class="line">    <span class="attribute">proxy_pass</span> http://192.168.200.146/;</span><br><span class="line">    <span class="comment"># è®¿é—®çš„æ˜¯ï¼šhttp://192.168.200.146/index.html</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>å®ä¾‹</strong></p></blockquote><p>å‡†å¤‡ä¸¤å°æœåŠ¡å™¨æˆ–è€…æŒ‰ç…§ Linux ç³»ç»Ÿçš„è™šæ‹Ÿæœºï¼Œè¿™é‡Œæ˜¯ <code>192.168.200.133</code> å’Œ <code>192.168.200.146</code>ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç§°å‰è€…ä¸ºæœåŠ¡å™¨ Aï¼Œåè€…ä¸ºæœåŠ¡å™¨ Bã€‚</p><ol><li>åœ¨æœåŠ¡å™¨ A çš„ Nginx é…ç½®æ–‡ä»¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># ......</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">        <span class="attribute">server_name</span> localhost;</span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://192.168.200.146;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ A <code>http://192.168.200.133</code>ï¼Œå®ƒä¼šè½¬å‘ç»™æœåŠ¡å™¨ Bï¼Œæ­¤æ—¶çš„æœåŠ¡å™¨ A å°±æ˜¯ä¸€ä¸ªä»£ç†çš„è§’è‰²ã€‚</p><p>è®¿é—®æœåŠ¡å™¨ Aï¼Œæˆ‘ä»¬çœ‹åˆ° Nginx çš„æ¬¢è¿ç•Œé¢å…¶å®æ˜¯æœåŠ¡å™¨ B çš„ Nginxï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ B çš„ Nginx æ¬¢è¿é¡µé¢æ·»åŠ æ–°çš„å†…å®¹ï¼š<code>I am 146</code>ï¼Œå†æ¬¡è®¿é—®æœåŠ¡å™¨ Aï¼Œæ•ˆæœå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.4ai1u3uxs940.webp" alt="image"></p><p>æ€»ç»“æ¥è¯´ï¼š</p><ul><li>æ­£å‘ä»£ç†ç›¸å½“äºåœ¨å®¢æˆ·ç«¯æµè§ˆå™¨é‡Œç›´æ¥è®¿é—®ç›®æ ‡åŸŸåï¼Œä½†æ˜¯èƒŒåœ°é‡Œè¯·æ±‚ä¼šä»é…ç½®å¥½çš„ä»£ç†æœåŠ¡å™¨å‘å‡ºå»ï¼Œå¯¹æœåŠ¡ç«¯æ¥è¯´å®ƒåªçŸ¥é“ä»£ç†æœåŠ¡å™¨è¯·æ±‚äº†æå‡ºäº†è¿™æ¬¡è¯·æ±‚ã€‚</li><li>åå‘ä»£ç†æ—¶ç›¸å½“äºåœ¨å®¢æˆ·ç«¯æµè§ˆå™¨é‡Œç›´æ¥è®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åä»£ç†æœåŠ¡å™¨æ ¹æ®å†…éƒ¨é…ç½®å¥½çš„è§„åˆ™é€‰æ‹©ç›¸åº”çš„æœåŠ¡è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¹¶ä¸æ¸…æ¥šæ¯’å“çš„æºå¤´æ˜¯è°ï¼ŒåªçŸ¥é“å®ƒæ˜¯ä»proxyé‚£æ‹¿äº†è´§ã€‚</li></ul><p><strong>åœ¨ç¼–å†™ proxy_pass çš„æ—¶å€™ï¼Œåé¢çš„å€¼è¦ä¸è¦åŠ  /?</strong></p><p>è¿™æ˜¯çœ‹æƒ…å†µçš„ã€‚</p><p>æ¥ä¸‹æ¥é€šè¿‡ä¾‹å­æ¥è¯´æ˜æåˆ°çš„é—®é¢˜ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="comment"># ä¸‹é¢ä¸¤ä¸ªåœ°å€åŠ ä¸åŠ æ–œæ ï¼Œæ•ˆæœéƒ½ä¸€æ ·ï¼Œå› ä¸º location åçš„ / ä¼šæ·»åŠ åœ¨ä»£ç†åœ°å€åé¢</span></span><br><span class="line"><span class="attribute">proxy_pass</span> http://192.168.200.146;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://192.168.200.146/;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /server &#123;</span><br><span class="line">        <span class="comment"># ä¸‹é¢ä¸¤ä¸ªåœ°å€å¿…é¡»åŠ æ–œæ ï¼Œå› ä¸º location åçš„ /server ä¼šæ·»åŠ åœ¨ä»£ç†åœ°å€åé¢ï¼Œç¬¬ä¸€ä¸ªå°†æ²¡æœ‰ / ç»“å°¾</span></span><br><span class="line"><span class="comment">#proxy_pass http://192.168.200.146;</span></span><br><span class="line"><span class="attribute">proxy_pass</span> http://192.168.200.146/;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ä¸Šé¢çš„ locationï¼šå½“å®¢æˆ·ç«¯è®¿é—® http://localhost/server/index.html</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ª proxy_pass å°±å˜æˆäº† http://localhost/server/index.html</span></span><br><span class="line"><span class="comment"># ç¬¬äºŒä¸ª proxy_pass å°±å˜æˆäº† http://localhost/index.html æ•ˆæœå°±ä¸ä¸€æ ·äº†ã€‚</span></span><br></pre></td></tr></table></figure><ul><li><p>ç¬¬ä¸€ä¸ª locationï¼ˆç¬¬ 4 è¡Œä»£ç ï¼‰ï¼šå½“å®¢æˆ·ç«¯è®¿é—® <code>http://localhost/index.html</code>ï¼Œä¸¤ä¸ª <code>proxy_pass</code> æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸º location åçš„ <code>/</code> ä¼šæ·»åŠ åœ¨ä»£ç†åœ°å€åé¢ï¼Œæ‰€ä»¥æœ‰æ²¡æœ‰ <code>/</code>ï¼Œæ•ˆæœéƒ½ä¸€æ ·ã€‚</p></li><li><p>ç¬¬ä¸€ä¸ª locationï¼ˆç¬¬ 14 è¡Œä»£ç ï¼‰ï¼šå½“å®¢æˆ·ç«¯è®¿é—® <code>http://localhost/server/index.html</code>ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œç¬¬ä¸€ä¸ª proxy_pass å°±å˜æˆäº† <code>http://192.168.200.146/server/index.html</code>ï¼Œç¬¬äºŒä¸ª proxy_pass å°±å˜æˆäº† <code>http://192.168.200.146/index.html</code> æ•ˆæœå°±ä¸ä¸€æ ·äº†</p><p>å¦‚æœä¸ä»¥ <code>/</code> ç»“å°¾ï¼Œåˆ™ location åçš„ <code>/server</code> ä¼šæ·»åŠ åœ¨åœ°å€åé¢ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ª proxy_pass å› ä¸ºæ²¡æœ‰ <code>/</code> ç»“å°¾è€Œè¢«åŠ ä¸Š <code>/server</code>ï¼Œè€Œç¬¬äºŒä¸ªè‡ªå¸¦äº† <code>/</code> ï¼Œæ‰€ä»¥ä¸ä¼šæ·»åŠ  <code>/server</code>ã€‚</p></li></ul><p>ä¸Šé¢çš„ä¾‹å­ä»…ä»…é’ˆå¯¹ï¼šè®¿é—®ä»»æ„è¯·æ±‚å¦‚ <code>/server</code> æ—¶ï¼Œæƒ³è¦ä»£ç†åˆ°å…¶ä»–æœåŠ¡å™¨çš„é¦–é¡µï¼Œåˆ™åŠ  <code>/</code>ï¼Œå¦åˆ™ä½ å¦‚æœçœŸçš„æƒ³è®¿é—® <code>/server</code> ä¸‹çš„èµ„æºï¼Œé‚£ä¹ˆä¸è¦åŠ  <code>/</code>ã€‚</p><p>æ‰€ä»¥åŠ äº† <code>/</code> åï¼Œè¯·æ±‚çš„æ˜¯æœåŠ¡å™¨æ ¹ç›®å½•ä¸‹çš„èµ„æºã€‚</p><h3 id="proxy-set-header"><a href="#proxy-set-header" class="headerlink" title="proxy_set_header"></a>proxy_set_header</h3><p>è¯¥æŒ‡ä»¤å¯ä»¥æ›´æ”¹ Nginx æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯è¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯ï¼Œç„¶åå°†æ–°çš„è¯·æ±‚å¤´å‘é€ç»™ä»£ç†çš„æœåŠ¡å™¨ã€‚é»˜è®¤å€¼æ˜¯å‘é€ä»£ç†æœåŠ¡å™¨çš„åœ°å€å’Œ closeã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.4bt7qzhbz1i0.webp" alt="image"></p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_set_header &lt;field&gt; &lt;value&gt;;</td><td>proxy_set_header Host $proxy_host; proxy_set_header Connection close;</td><td>httpã€serverã€location</td></tr></tbody></table><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæƒ³è¦çœ‹åˆ°ç»“æœï¼Œå¿…é¡»åœ¨è¢«ä»£ç†çš„æœåŠ¡å™¨ä¸Šæ¥è·å–æ·»åŠ çš„å¤´ä¿¡æ¯ã€‚</p><blockquote><p><strong>å®ä¾‹</strong></p></blockquote><p>è¢«ä»£ç†æœåŠ¡å™¨ï¼šæœåŠ¡å™¨ B <code>192.168.200.146</code> çš„ Nginx é…ç½®æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="variable">$http_username</span>;    <span class="comment"># è·å–ä»£ç†æœåŠ¡å™¨å‘é€è¿‡æ¥çš„ http è¯·æ±‚å¤´çš„ username å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç†æœåŠ¡å™¨: æœåŠ¡å™¨ A <code>192.168.200.133</code> çš„ Nginx é…ç½®æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">location</span> /server &#123;           <span class="comment"># è®¿é—® /server è§¦å‘ä»£ç†</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://192.168.200.146:8080/;  <span class="comment"># é…ç½®æœåŠ¡å™¨ B çš„åœ°å€</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> username TOM;  <span class="comment"># å‘é€ key ä¸º usernameï¼Œvalue ä¸º TOM çš„è¯·æ±‚å¤´ç»™æœåŠ¡å™¨ B</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®æµ‹è¯•</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.398ksbw6rv20.webp" alt="image"></p><p>å®¢æˆ·ç«¯è®¿é—®çš„æ˜¯æœåŠ¡å™¨ Aï¼ŒæœåŠ¡å™¨ A ä¼šå°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨ Bï¼ŒæœåŠ¡å™¨ B è¿”å›æ‰“å° TOM çš„é¡µé¢ç»™æœåŠ¡å™¨ Aï¼ŒæœåŠ¡å™¨ A æœ€åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><h3 id="proxy-redirect"><a href="#proxy-redirect" class="headerlink" title="proxy_redirect"></a>proxy_redirect</h3><p>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥é‡ç½®å¤´ä¿¡æ¯ä¸­çš„ã€ Location ã€å’Œã€ Refresh ã€çš„å€¼ï¼Œé˜²æ­¢å®¢æˆ·ç«¯å¯ä»¥çœ‹åˆ°è¢«ä»£ç†æœåŠ¡å™¨çš„åœ°å€ã€‚</p><p>å› ä¸ºå®¢æˆ·ç«¯çœ‹åˆ°çš„è¿”å›ç»“æœæ˜¯ã€ Location ã€å’Œã€ Refresh ã€çš„å€¼ï¼Œæ‰€ä»¥åœ¨åˆ°è¾¾ä»£ç†æœåŠ¡å™¨çš„æ—¶ï¼Œå°†ä¸¤ä¸ªå€¼ä¿®æ”¹æ‰ï¼Œé˜²æ­¢å®¢æˆ·ç«¯ç›´æ¥çœ‹åˆ°è¢«ä»£ç†æœåŠ¡å™¨çš„åœ°å€ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_redirect redirect replacement;<br> proxy_redirect default; <br>proxy_redirect off;</td><td>proxy_redirect default;</td><td>httpã€serverã€location</td></tr></tbody></table><blockquote><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨è¯¥æŒ‡ä»¤ï¼Ÿ</strong></p></blockquote><p>é¦–å…ˆè¯´æ˜ä¸€ä¸‹æ€è·¯ï¼šå®¢æˆ·ç«¯é€šè¿‡ä»£ç†æœåŠ¡å™¨ A è®¿é—®æœåŠ¡å™¨ B çš„èµ„æºï¼Œä½†æ˜¯æœåŠ¡å™¨ B ä¸å­˜åœ¨è¯¥èµ„æºï¼Œåˆ™ä¼šæŠ¥é”™ã€‚æ­¤æ—¶æˆ‘ä»¬ä¸å¸Œæœ›å®ƒç›´æ¥è¿”å›æŠ¥é”™é¡µé¢ç»™å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å¸Œæœ›æœåŠ¡å™¨ B è¿”å›çš„æ˜¯å®ƒçš„æ¬¢è¿é¡µé¢ã€‚é‚£ä¹ˆå¦‚ä½•åšå‘¢ï¼Ÿ</p><ul><li>é¦–å…ˆåœ¨æœåŠ¡å™¨ B è¿›è¡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨èµ„æºï¼Œä¸å­˜åœ¨åˆ™è¿”å›è‡ªå·±çš„æ¬¢è¿é¡µé¢ï¼Œå³é‡å®šå‘åˆ°è‡ªå·±çš„æ¬¢è¿é¡µé¢åœ°å€å¹¶è¿”å›ï¼Œæ­¤æ—¶æµè§ˆå™¨çš„åœ°å€å°†ä¼šå‘ç”Ÿæ”¹å˜</li><li>ä»£ç†æœåŠ¡å™¨ A æ”¶åˆ°æœåŠ¡å™¨ B çš„æ¬¢è¿é¡µé¢å’Œåœ°å€ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå› ä¸ºå®ƒä¼šæš´éœ²æœåŠ¡å™¨ B çš„åœ°å€ï¼Œè¿™æ˜¯é‡å®šå‘çš„åŸå› </li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.a4tptcx6lbk.webp" alt="image"></p><ul><li>æ­¤æ—¶ç”¨åˆ° <code>proxy_redirect</code> æŒ‡ä»¤ï¼Œé‡ç½®æœåŠ¡å™¨ B è¿”å›è¿‡æ¥çš„ã€ Location ã€å’Œã€ Refresh ã€å€¼ï¼Œå°†ä¸¤ä¸ªå€¼æ”¹ä¸ºä»£ç†æœåŠ¡å™¨ A çš„æŸä¸ªåœ°å€</li><li>å› ä¸ºæ”¹ä¸ºäº†ä»£ç†æœåŠ¡å™¨ A çš„æŸä¸ªåœ°å€ï¼Œæ‰€ä»¥ä»£ç†æœåŠ¡å™¨ A æ ¹æ®è¿™ä¸ªåœ°å€åˆå»è·å–ç†æœåŠ¡å™¨ B çš„æ¬¢è¿é¡µé¢åœ°å€ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯</li></ul><p>å¾ˆç»•ï¼Œç®€å•æ€»ç»“ä¸‹ï¼šå®¢æˆ·ç«¯é€šè¿‡ A æ‰¾ B ä¸å­˜åœ¨çš„èµ„æºï¼ŒB ä¸æƒ³è¿”å›æŠ¥é”™é¡µé¢ï¼Œäºæ˜¯é‡å®šå‘åˆ°è‡ªå·±çš„æ¬¢è¿é¡µé¢åœ°å€å¹¶è¿”å›ç»™ Aï¼ŒA æ”¶åˆ°äº†é¡µé¢å’Œåœ°å€ï¼ˆæ­£å¸¸æƒ…å†µä¸è¦æ¥æ”¶åœ°å€ï¼Œåªæ¥æ”¶é¡µé¢ï¼‰ï¼Œå‘ç°ä¸èƒ½æš´éœ² B çš„åœ°å€ï¼Œäºæ˜¯ä¿®æ”¹æ¥æ”¶çš„ B çš„åœ°å€ä¸ºè‡ªå·±çš„æŸä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¼šé‡æ–°å‘é€è¯·æ±‚å»è·å– B çš„æ¬¢è¿é¡µé¢åœ°å€ï¼Œç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>è¿™é‡Œè¦æ˜ç™½ B è¿”å›çš„æ˜¯é‡å®šå‘åçš„æ¬¢è¿é¡µé¢ï¼Œé‡å®šå‘åï¼Œæµè§ˆå™¨åœ°å€æ ä¼šå˜æˆé‡å®šå‘çš„åœ°å€ï¼Œæ‰€ä»¥ A æ‰ä¼šä»¥è‡ªå·±çš„åœ°å€è½¬å‘è·å–åˆ° B çš„åœ°å€ï¼Œæ‰€ä»¥æœ€åæµè§ˆå™¨æ˜¾ç¤º A çš„åœ°å€ï¼Œçœ‹åˆ°çš„å´æ˜¯ B çš„æ¬¢è¿é¡µé¢ã€‚</p><p>ä»£ç ï¼š</p><p>æœåŠ¡ç«¯ B <code>192.168.200.146</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">8081</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">if</span> (!-f <span class="variable">$request_filename</span>)&#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">302</span> http://192.168.200.146;   <span class="comment">#  2.å¦‚æœè¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ï¼Œåˆ™é‡å®šå‘åˆ°æœåŠ¡å™¨ B</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç†æœåŠ¡ç«¯ A <code>192.168.200.133</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span>  <span class="number">8081</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://192.168.200.146:8081/;  <span class="comment"># 1.è½¬å‘ç»™æœåŠ¡å™¨ B</span></span><br><span class="line"><span class="attribute">proxy_redirect</span> http://192.168.200.146 http://192.168.200.133; <span class="comment"># 3.ä¿®æ”¹æœåŠ¡å™¨ B çš„åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è¯¥ server å»è¯·æ±‚æœåŠ¡å™¨ B çš„æ¬¢è¿é¡µé¢</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span>  <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> <span class="number">192.168.200.133</span>;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://192.168.200.146;  <span class="comment"># 4.é‡æ–°å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ Bï¼Œè·å–æ¬¢è¿é¡µé¢</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ 6 è¡Œä»£ç ï¼Œå½“æœåŠ¡å™¨ B è¿”å›çš„æ˜¯ <code>http://192.168.200.146</code>ï¼Œä¸ºäº†ä¸è®©å®ƒå‡ºç°åœ¨æµè§ˆå™¨çš„åœ°å€æ ä¸Šï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ <code>proxy_redirect</code> å°†å®ƒä¿®æ”¹ä¸ºä»£ç†æœåŠ¡å™¨ A çš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¼šä»¥è‡ªå·±çš„åœ°å€é‡æ–°è®¿é—®æœåŠ¡å™¨ B çš„æ¬¢è¿é¡µé¢ï¼Œæœ€åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p><strong>è¯¥æŒ‡ä»¤çš„ä¸‰ç»„é€‰é¡¹</strong></p><ul><li><p><code>proxy_redirect redirect replacement;</code></p><ul><li>redirectï¼šè¢«ä»£ç†æœåŠ¡å™¨è¿”å›çš„ Location å€¼</li><li>replacementï¼šè¦æ›¿æ¢ Location çš„å€¼</li></ul></li><li><p><code>proxy_redirect default;</code></p><ul><li><p>defaultï¼šç›¸æ¯”è¾ƒç¬¬ä¸€ç»„é€‰é¡¹ï¼Œdefault ä»…ä»…æä¾›äº† <code>redirect</code> å’Œ <code>replacement</code> çš„é»˜è®¤å€¼</p><p>å°†æœ¬èŒƒå›´ location å—çš„ uri å˜é‡ä½œä¸º replacementã€‚</p><p>å°† proxy_pass å˜é‡ä½œä¸º redwadairect</p></li></ul></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span>  <span class="number">8081</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /server &#123; </span><br><span class="line"><span class="attribute">proxy_pass</span> http://192.168.200.146:8081/;</span><br><span class="line"><span class="attribute">proxy_redirect</span> default;  <span class="comment"># redirect æ˜¯ proxy_pass çš„å€¼ï¼šhttp://192.168.200.146:8081/</span></span><br><span class="line">         <span class="comment"># replacement æ˜¯ location åçš„å€¼ï¼š/server</span></span><br><span class="line">        <span class="comment"># ç­‰ä»·äºï¼šproxy_redirect http://192.168.200.146:8081/ /server</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>proxy_redirect off;</code></p><p>å…³é—­ proxy_redirect çš„åŠŸèƒ½</p></li></ul><h2 id="åå‘ä»£ç†å®æˆ˜"><a href="#åå‘ä»£ç†å®æˆ˜" class="headerlink" title="åå‘ä»£ç†å®æˆ˜"></a>åå‘ä»£ç†å®æˆ˜</h2><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.59ecpsonzxc0.webp" alt="image"></p><p>æœåŠ¡å™¨ 1ï¼Œ2ï¼Œ3 å­˜åœ¨ä¸¤ç§æƒ…å†µ</p><ul><li>ç¬¬ä¸€ç§æƒ…å†µ: ä¸‰å°æœåŠ¡å™¨çš„å†…å®¹ä¸ä¸€æ ·</li><li>ç¬¬äºŒç§æƒ…å†µ: ä¸‰å°æœåŠ¡å™¨çš„å†…å®¹æ˜¯ä¸€æ ·</li></ul><p>ç¬¬ä¸€ç§æƒ…å†µ</p><ul><li><p>å¦‚æœæœåŠ¡å™¨ 1ã€æœåŠ¡å™¨ 2 å’ŒæœåŠ¡å™¨ 3 çš„å†…å®¹ä¸ä¸€æ ·ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æ ¹æ®ç”¨æˆ·è¯·æ±‚æ¥åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚</p><p>æœåŠ¡å™¨æœ‰é™ï¼Œåªèƒ½ä»¥ä¸‰ä¸ªç«¯å£æ¨¡æ‹Ÿä¸‰å°æœåŠ¡å™¨ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ª IP å¯¹åº”ä¸€ä¸ªæœåŠ¡å™¨ã€‚</p><p>ä»£ç†æœåŠ¡å™¨é…ç½®æ–‡ä»¶å†…å®¹ï¼š</p></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»£ç†æœåŠ¡å™¨</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">8082</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost; </span><br><span class="line">    <span class="attribute">location</span> /server1 &#123;    </span><br><span class="line">        <span class="attribute">proxy_pass</span> http://192.168.200.146:9001/;   <span class="comment"># ä»£ç† server1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> /server2 &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://192.168.200.146:9002/;   <span class="comment"># ä»£ç† server2</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> /server3 &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://192.168.200.146:9003/;   <span class="comment"># ä»£ç† server3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨é…ç½®æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment"># server1</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">9001</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="attribute">default_type</span> text/html;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&lt;h1&gt;192.168.200.146:9001&lt;/h1&gt;'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># server2</span></span><br><span class="line">server &#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">9002</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="attribute">default_type</span> text/html;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&lt;h1&gt;192.168.200.146:9002&lt;/h1&gt;'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># server3</span></span><br><span class="line">server &#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">9003</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="attribute">default_type</span> text/html;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&lt;h1&gt;192.168.200.146:9003&lt;/h1&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å¦‚æœæœåŠ¡å™¨ 1ã€æœåŠ¡å™¨ 2 å’ŒæœåŠ¡å™¨ 3 çš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œè¯¥å¦‚ä½•å¤„ç†?</p><p>è¯·çœ‹è´Ÿè½½å‡è¡¡çš„ç›¸å…³å†…å®¹ï¼Œé‡Œé¢å°†è¿›è¡Œè¯¦ç»†çš„ä»‹ç»ã€‚</p></li></ul><h2 id="æ–œæ æ€»ç»“"><a href="#æ–œæ æ€»ç»“" class="headerlink" title="æ–œæ æ€»ç»“"></a>æ–œæ æ€»ç»“</h2><p>è¿™é‡Œå°†å‘é€ <code>http://192.168.199.27/frx/xu</code> è¯·æ±‚ã€‚</p><p><strong>ä¸å¸¦å­—ç¬¦ä¸²æƒ…å†µ</strong></p><table><thead><tr><th>æ¡ˆä¾‹</th><th>localtion</th><th>proxy_pass</th><th>åŒ¹é…</th></tr></thead><tbody><tr><td>1</td><td>/frx</td><td><a href="http://192.168.199.27" target="_blank" rel="noopener">http://192.168.199.27</a></td><td>/frx/xu</td></tr><tr><td>2</td><td>/frx/</td><td><a href="http://192.168.199.27" target="_blank" rel="noopener">http://192.168.199.27</a></td><td>/frx/xu</td></tr><tr><td>3</td><td>/frx</td><td><a href="http://192.168.199.27/" target="_blank" rel="noopener">http://192.168.199.27/</a></td><td>//xu</td></tr><tr><td>4</td><td>/frx/</td><td><a href="http://192.168.199.27/" target="_blank" rel="noopener">http://192.168.199.27/</a></td><td>/xu</td></tr></tbody></table><p>è‹¥ Nginx ä¼šå°†åŸè¯·æ±‚è·¯å¾„åŸå°ä¸åŠ¨åœ°è½¬äº¤ç»™å…¶ä»–åœ°å€ï¼Œå¦‚æ¡ˆä¾‹ 3 å’Œ 4ã€‚</p><p><code>proxy_pass</code> çš„ ip:port ååŠ äº† <code>/</code>ï¼Œä»£è¡¨å»é™¤æ‰è¯·æ±‚å’Œ location çš„åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œä¸åŠ åˆ™è¿½åŠ å…¨éƒ¨è¯·æ±‚åˆ°åœ°å€åé¢ã€‚</p><p><strong>å¸¦å­—ç¬¦ä¸²æƒ…å†µ</strong></p><table><thead><tr><th>æ¡ˆä¾‹</th><th>localtion</th><th>proxy_pass</th><th>åŒ¹é…</th></tr></thead><tbody><tr><td>1</td><td>/frx</td><td><a href="http://192.168.199.27/bing" target="_blank" rel="noopener">http://192.168.199.27/bing</a></td><td>/bing/xu</td></tr><tr><td>2</td><td>/frx/</td><td><a href="http://192.168.199.27/bing" target="_blank" rel="noopener">http://192.168.199.27/bing</a></td><td>/bingxu</td></tr><tr><td>3</td><td>/frx</td><td><a href="http://192.168.199.27/bing/" target="_blank" rel="noopener">http://192.168.199.27/bing/</a></td><td>/bing//xu</td></tr><tr><td>4</td><td>/frx/</td><td><a href="http://192.168.199.27/bing/" target="_blank" rel="noopener">http://192.168.199.27/bing/</a></td><td>/bing/xu</td></tr></tbody></table><p><code>proxy_pass</code> çš„ ip:port ååŠ äº†å­—ç¬¦ä¸²ï¼ŒNginx ä¼šå°†åŒ¹é… location çš„è¯·æ±‚ä»ã€ŒåŸè¯·æ±‚è·¯å¾„ã€ä¸­å‰”é™¤ï¼Œå†ä¸åŒ¹é…çš„å­—ç¬¦ä¸²æ‹¼æ¥åˆ° proxy_pass åç”Ÿæˆã€Œæ–°è¯·æ±‚è·¯å¾„ã€ï¼Œç„¶åå°†ã€Œæ–°è¯·æ±‚è·¯å¾„ã€è½¬äº¤ç»™å…¶ä»–åœ°å€ã€‚</p><p>æ¡ˆä¾‹ 2 ä¸­ï¼Œ<code>proxy_pass</code> çš„ ip:port åæ¥äº†å­—ç¬¦ä¸²ï¼Œå› æ­¤å°† location çš„ <code>/frx/</code> ä»åŸè¯·æ±‚è·¯å¾„ <code>/frx/xu</code> ä¸­å‰”é™¤ï¼Œå˜ä¸º <code>xu</code>ï¼Œç„¶åå°† <code>xu</code> æ‹¼æ¥åˆ° <code>http://192.168.1.48/bing</code> åç”Ÿæˆäº†æ–°è¯·æ±‚ï¼Œå› æ­¤å…¶ä»–åœ°å€æ”¶åˆ°çš„è¯·æ±‚å°±æ˜¯ <code>/bingxu</code>ã€‚</p><h2 id="Nginxå®‰å…¨æ§åˆ¶"><a href="#Nginxå®‰å…¨æ§åˆ¶" class="headerlink" title="Nginxå®‰å…¨æ§åˆ¶"></a>Nginxå®‰å…¨æ§åˆ¶</h2><p>å…³äº Web æœåŠ¡å™¨çš„å®‰å…¨æ˜¯æ¯”è¾ƒå¤§çš„ä¸€ä¸ªè¯é¢˜ï¼Œé‡Œé¢æ‰€æ¶‰åŠçš„å†…å®¹å¾ˆå¤šï¼ŒNginx åå‘ä»£ç†æ˜¯å¦‚ä½•æ¥æå‡ Web æœåŠ¡å™¨çš„å®‰å…¨å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼šå®‰å…¨éš”ç¦»ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯å®‰å…¨éš”ç¦»"><a href="#ä»€ä¹ˆæ˜¯å®‰å…¨éš”ç¦»" class="headerlink" title="ä»€ä¹ˆæ˜¯å®‰å…¨éš”ç¦»"></a>ä»€ä¹ˆæ˜¯å®‰å…¨éš”ç¦»</h3><p>é€šè¿‡ä»£ç†åˆ†å¼€äº†å®¢æˆ·ç«¯åˆ°åº”ç”¨ç¨‹åºæœåŠ¡å™¨ç«¯çš„è¿æ¥ï¼Œå®ç°äº†å®‰å…¨æªæ–½ã€‚åœ¨åå‘ä»£ç†ä¹‹å‰è®¾ç½®é˜²ç«å¢™ï¼Œä»…ç•™ä¸€ä¸ªå…¥å£ä¾›ä»£ç†æœåŠ¡å™¨è®¿é—®ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.3vhdv63nf9q0.webp" alt="image"></p><h3 id="å¦‚ä½•ä½¿ç”¨SSLå¯¹æµé‡åŠ å¯†"><a href="#å¦‚ä½•ä½¿ç”¨SSLå¯¹æµé‡åŠ å¯†" class="headerlink" title="å¦‚ä½•ä½¿ç”¨SSLå¯¹æµé‡åŠ å¯†"></a>å¦‚ä½•ä½¿ç”¨SSLå¯¹æµé‡åŠ å¯†</h3><p>ç¿»è¯‘æˆå¤§å®¶èƒ½ç†Ÿæ‚‰çš„è¯´æ³•å°±æ˜¯å°†æˆ‘ä»¬å¸¸ç”¨çš„ http è¯·æ±‚è½¬å˜æˆ https è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªä¹‹é—´çš„åŒºåˆ«ç®€å•çš„æ¥è¯´ä¸¤ä¸ªéƒ½æ˜¯ HTTP åè®®ï¼Œåªä¸è¿‡ https æ˜¯èº«æŠ« SSL å¤–å£³çš„ http.</p><p>HTTPS æ˜¯ä¸€ç§é€šè¿‡è®¡ç®—æœºç½‘ç»œè¿›è¡Œå®‰å…¨é€šä¿¡çš„ä¼ è¾“åè®®ã€‚å®ƒç»ç”± HTTP è¿›è¡Œé€šä¿¡ï¼Œåˆ©ç”¨ SSL/TLS å»ºç«‹å…¨é€šä¿¡ï¼ŒåŠ å¯†æ•°æ®åŒ…ï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><ul><li>SSL(Secure Sockets Layer)å®‰å…¨å¥—æ¥å±‚</li><li>TLS(Transport Layer Security)ä¼ è¾“å±‚å®‰å…¨</li></ul><p>ä¸Šè¿°è¿™ä¸¤ä¸ªæ˜¯ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®®ï¼ŒTLS å’Œ SSL åœ¨ä¼ è¾“å±‚å’Œåº”ç”¨å±‚å¯¹ç½‘ç»œè¿æ¥è¿›è¡ŒåŠ å¯†ã€‚</p><p>æ€»ç»“æ¥è¯´ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ https:</p><ul><li>http åè®®æ˜¯æ˜æ–‡ä¼ è¾“æ•°æ®ï¼Œå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œè€Œ https æ˜¯åŠ å¯†ä¼ è¾“ï¼Œç›¸å½“äº http + SSLï¼Œå¹¶ä¸”å¯ä»¥é˜²æ­¢æµé‡åŠ«æŒã€‚</li></ul><p>Nginx é»˜è®¤ä¸æ”¯æŒ https å¼€å¤´çš„åè®®ï¼Œå¦‚æœè¦æƒ³ä½¿ç”¨ SSLï¼Œéœ€è¦æ»¡è¶³ä¸€ä¸ªæ¡ä»¶å³éœ€è¦æ·»åŠ ä¸€ä¸ªæ¨¡å— <code>--with-http_ssl_module</code>ï¼Œè€Œè¯¥æ¨¡å—åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­åˆéœ€è¦ OpenSSL çš„æ”¯æŒï¼ŒOpenSSL æˆ‘ä»¬åœ¨ <a href="/middleware/Nginx/Nginx_install/#nginxç¯å¢ƒå®‰è£…">Nginx å®‰è£…</a> å·²ç»å‡†å¤‡å¥½äº†ã€‚</p><h3 id="æ·»åŠ SSLæ”¯æŒ"><a href="#æ·»åŠ SSLæ”¯æŒ" class="headerlink" title="æ·»åŠ SSLæ”¯æŒ"></a>æ·»åŠ SSLæ”¯æŒ</h3><p>å®Œæˆ <code>--with-http_ssl_module</code> æ¨¡å—çš„å¢é‡æ·»åŠ ã€‚</p><ol><li>å°†åŸæœ‰ <code>/usr/local/nginx/sbin/nginx</code> è¿›è¡Œå¤‡ä»½</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx/sbin</span><br><span class="line">mv nginx nginx.backup</span><br></pre></td></tr></table></figure><ol start="2"><li>æŸ¥çœ‹ <code>configure arguments</code> çš„é…ç½®ä¿¡æ¯ï¼Œæ‹·è´å‡ºæ¥</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx -V</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´ configure arguments åé¢çš„æ•°æ®</span></span><br></pre></td></tr></table></figure><ol start="3"><li>è¿›å…¥ Nginx çš„å®‰è£…ç›®å½•ï¼Œæ‰§è¡Œ make clean æ¸…ç©ºä¹‹å‰ç¼–è¯‘çš„å†…å®¹</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cd</span> /root/nginx/core/nginx-<span class="number">1</span>.<span class="number">20</span>.<span class="number">2</span></span><br><span class="line"></span><br><span class="line">make clean</span><br></pre></td></tr></table></figure><ol start="4"><li>ä½¿ç”¨ configure æ¥é…ç½®å‚æ•°ï¼Œæ·»åŠ  <code>ngx_http_ssl_module</code> æ¨¡å—ï¼Œè®°å¾—åŠ ä¸Šç¬¬ï¼ˆ2ï¼‰æ­¥æ‹·è´çš„é…ç½®ä¿¡æ¯</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --with-http_ssl_module <span class="comment"># è®°å¾—æ·»åŠ  configure arguments åçš„æ•°æ®</span></span><br></pre></td></tr></table></figure><ol start="5"><li>é€šè¿‡ make æ¨¡æ¿è¿›è¡Œç¼–è¯‘</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><ol start="6"><li>å°† objs ä¸‹é¢çš„ nginx å¯æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ° <code>/usr/local/nginx/sbin</code> ä¸‹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /opt/nginx/core/nginx-1.20.2/objs/nginx /usr/<span class="built_in">local</span>/nginx/sbin</span><br></pre></td></tr></table></figure><ol start="7"><li>åœ¨æºç ç›®å½•ï¼ˆå®‰è£…åŒ…ç›®å½•ï¼‰ä¸‹æ‰§è¡Œ <code>make upgrade</code> è¿›è¡Œå‡çº§ï¼Œè¿™ä¸ªå¯ä»¥å®ç°ä¸åœæœºæ·»åŠ æ–°æ¨¡å—çš„åŠŸèƒ½</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/nginx/core/nginx-1.20.2</span><br><span class="line">make upgrade</span><br></pre></td></tr></table></figure><h3 id="SSLç›¸å…³æŒ‡ä»¤"><a href="#SSLç›¸å…³æŒ‡ä»¤" class="headerlink" title="SSLç›¸å…³æŒ‡ä»¤"></a>SSLç›¸å…³æŒ‡ä»¤</h3><p>è¯¥æ¨¡å—çš„æŒ‡ä»¤éƒ½æ˜¯é€šè¿‡ <code>ngx_http_ssl_module</code> æ¨¡å—æ¥è§£æçš„ï¼Œæˆ‘ä»¬ä¸Šä¸€æ­¥å·²ç»æ·»åŠ äº†ã€‚</p><p>è¿™é‡Œåªä»‹ç»å¸¸ç”¨çš„å‡ ä¸ªæŒ‡ä»¤ï¼Œäº†è§£æ›´å¤šæŒ‡ä»¤è¯·å‰å¾€ <a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html" target="_blank" rel="noopener">ngx_http_ssl_module æ¨¡å—æ–‡æ¡£</a>ã€‚</p><p><code>ssl</code> æŒ‡ä»¤ç”¨æ¥åœ¨æŒ‡å®šçš„æœåŠ¡å™¨å¼€å¯ HTTPSï¼Œé»˜è®¤å…³é—­ã€‚å¯ä»¥ä½¿ç”¨ listen 443 sslï¼Œè¿™ç§æ–¹å¼æ›´é€šç”¨äº›ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>ssl &lt;on |off&gt;;</td><td>ssl off;</td><td>httpã€server</td></tr></tbody></table><p>ssl é»˜è®¤ç›‘å¬çš„æ˜¯ 443 ç«¯å£ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤å’Œ <code>ssl on</code> æ•ˆæœä¸€è‡´ï¼Œå› ä¸ºä¸‹é¢çš„æŒ‡ä»¤èƒ½çªå‡º sll çš„ç›‘å¬ç«¯å£ï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨å®ƒã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ssl_certificate</code> æŒ‡ä»¤æ˜¯ä¸ºå½“å‰è¿™ä¸ªè™šæ‹Ÿä¸»æœºæŒ‡å®šä¸€ä¸ªå¸¦æœ‰ PEM æ ¼å¼è¯ä¹¦çš„è¯ä¹¦ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>ssl_certificate &lt;file&gt;;</td><td>â€”</td><td>httpã€server</td></tr></tbody></table><p><code>ssl_certificate_key</code> æŒ‡ä»¤ç”¨æ¥æŒ‡å®š PEM secret key æ–‡ä»¶çš„è·¯å¾„</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>ssl_ceritificate_key &lt;file&gt;;</td><td>â€”</td><td>httpã€server</td></tr></tbody></table><p><code>ssl_session_cache</code> æŒ‡ä»¤ç”¨æ¥é…ç½®ç”¨äº SSL ä¼šè¯çš„ç¼“å­˜</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>ssl_sesion_cache &lt;off | none | [builtin[:size]] [shared:name:size]&gt;</td><td>ssl_session_cache none;</td><td>httpã€server</td></tr></tbody></table><p>é€‰é¡¹ä»‹ç»ï¼š</p><ul><li><p><code>off</code>ï¼šä¸¥æ ¼ç¦æ­¢ä½¿ç”¨ä¼šè¯ç¼“å­˜ï¼šNginx æ˜ç¡®å‘Šè¯‰å®¢æˆ·ç«¯ä¼šè¯ä¸èƒ½è¢«é‡ç”¨</p></li><li><p><code>none</code>ï¼šç¦æ­¢ä½¿ç”¨ä¼šè¯ç¼“å­˜ï¼ŒNginx å‘Šè¯‰å®¢æˆ·ç«¯ä¼šè¯å¯ä»¥è¢«é‡ç”¨ï¼Œä½†å®é™…ä¸Šå¹¶ä¸åœ¨ç¼“å­˜ä¸­å­˜å‚¨ä¼šè¯å‚æ•°ï¼ˆä»»æ€§ï¼Œè¨€è¯­åŒæ„ç”¨ï¼Œè¡Œä¸ºå–æ¶ˆç”¨ï¼‰</p></li><li><p><code>builtin</code>ï¼šå†…ç½® OpenSSL ç¼“å­˜ï¼Œä»…åœ¨ä¸€ä¸ªå·¥ä½œè¿›ç¨‹ä¸­ä½¿ç”¨ã€‚ç¼“å­˜å¤§å°åœ¨ä¼šè¯ä¸­æŒ‡å®šã€‚å¦‚æœæœªç»™å‡ºå¤§å°ï¼Œåˆ™ç­‰äº 20480 ä¸ªä¼šè¯ã€‚ä½¿ç”¨å†…ç½®ç¼“å­˜å¯èƒ½ä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡</p></li><li><p><code>shared</code>ï¼šæ‰€æœ‰å·¥ä½œè¿›ç¨‹ä¹‹é—´å…±äº«ç¼“å­˜ï¼Œç¼“å­˜çš„ç›¸å…³ä¿¡æ¯ç”¨ name å’Œ size æ¥æŒ‡å®šï¼ŒåŒ name çš„ç¼“å­˜å¯ç”¨äºå¤šä¸ªè™šæ‹ŸæœåŠ¡å™¨</p><p>name æ˜¯å…è®¸ç¼“å­˜çš„æ•°æ®åï¼Œsize æ˜¯å…è®¸ç¼“å­˜çš„æ•°æ®å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½</p></li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssl_session_cache</span> builtin:<span class="number">1000</span> shared:SSL:<span class="number">10m</span>;</span><br></pre></td></tr></table></figure><p>10m çš„ m æ˜¯å…†ã€‚</p><p><code>ssl_session_timeout</code> æŒ‡ä»¤ç”¨äºå¼€å¯ SSL ä¼šè¯åŠŸèƒ½åï¼Œè®¾ç½®å®¢æˆ·ç«¯èƒ½å¤Ÿåå¤ä½¿ç”¨å‚¨å­˜åœ¨ç¼“å­˜ä¸­çš„ä¼šè¯å‚æ•°æ—¶é—´ï¼Œé»˜è®¤å€¼è¶…æ—¶æ—¶é—´æ˜¯ 5 ç§’</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>ssl_session_timeout &lt;time&gt;;</td><td>ssl_session_timeout 5m;</td><td>httpã€server</td></tr></tbody></table><p><code>ssl_ciphers</code> æŒ‡ä»¤æŒ‡å‡ºå…è®¸çš„å¯†ç ï¼Œå¯†ç æŒ‡å®šä¸º OpenSSL æ”¯æŒçš„æ ¼å¼</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>ssl_ciphers &lt;ciphers&gt;;</td><td>ssl_ciphers HIGH:!aNULL:!MD5;</td><td>httpã€server</td></tr></tbody></table><p>å¯ä»¥ç›´æ¥åœ¨ Linux ç³»ç»Ÿä¸Šä½¿ç”¨ <code>openssl ciphers</code> æŸ¥çœ‹ OpenSSl æ”¯æŒçš„æ ¼å¼</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl ciphers</span><br></pre></td></tr></table></figure><p><code>ssl_prefer_server_ciphers</code> æŒ‡ä»¤æŒ‡å®šæ˜¯å¦æœåŠ¡å™¨å¯†ç ä¼˜å…ˆå®¢æˆ·ç«¯å¯†ç ï¼Œé»˜è®¤å…³é—­ï¼Œå»ºè®®å¼€å¯ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>ssl_perfer_server_ciphers &lt;on | off&gt;;</td><td>ssl_perfer_server_ciphers off;</td><td>httpã€server</td></tr></tbody></table><h3 id="SSLè¯ä¹¦ç”Ÿæˆ"><a href="#SSLè¯ä¹¦ç”Ÿæˆ" class="headerlink" title="SSLè¯ä¹¦ç”Ÿæˆ"></a>SSLè¯ä¹¦ç”Ÿæˆ</h3><p><strong>æ–¹å¼ä¸€ï¼šä½¿ç”¨é˜¿é‡Œäº‘/è…¾è®¯äº‘ç­‰ç¬¬ä¸‰æ–¹æœåŠ¡è¿›è¡Œè´­ä¹°å…è´¹ç‰ˆ</strong></p><p>éœ€è¦è´­ä¹°åŸŸåè¿›è¡Œè¯ä¹¦çš„ç»‘å®šï¼Œå¦åˆ™è¯ä¹¦æ— æ³•ä½¿ç”¨ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.5p2qyl61ozc0.webp" alt="image"></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.5l7iqyudol00.webp" alt="image"></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.6ci6w9wu24g0.webp" alt="image"></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.4k9v2b9n6tm0.webp" alt="image"></p><p>æ¥ç€åœ¨å³è¾¹å¼¹çª—è¿›è¡ŒåŸŸåç»‘å®šï¼Œå¡«å®Œå†™åŸŸåå’Œä¸ªäººä¿¡æ¯ï¼Œè¿›å…¥åˆ°éªŒè¯ä¿¡æ¯</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.11wx9z7jit3k.webp" alt="image"></p><p>ç‚¹å‡»éªŒè¯ï¼Œä¸æˆåŠŸåˆ™å»è‡ªå·±çš„åŸŸåè§£æåˆ—è¡¨æŸ¥çœ‹ï¼Œå¦‚ä¸‹ï¼Œç‚¹å‡»æ·»åŠ è®°å½•ï¼Œè¿›è¡Œé…ç½®ï¼Œæˆ–è€…å·²ç»çœ‹åˆ°è®°å½•ç±»å‹æ˜¯ TXTï¼Œè®°å½•å€¼å’Œä¸Šå›¾ä¸€æ ·çš„ï¼Œåˆ™è¯´æ˜æˆåŠŸã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.6qcpqete8ic0.webp" alt="image"></p><p>æäº¤å®¡æ ¸åï¼Œç‚¹å‡»ä¸‹è½½</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.28m5753glfy8.webp" alt="image"></p><p>ä¸‹è½½ Nginx æœåŠ¡å™¨çš„è¯ä¹¦</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.6kmq7nhonys0.webp" alt="image"></p><p>ä¸‹è½½å‹ç¼©åŒ…è¿›è¡ŒåŠ å‹åï¼Œå¾—åˆ° .pem è¯ä¹¦å’Œ .key è¯ä¹¦ï¼ŒæŠŠä¸¤ä¸ªè¯ä¹¦ä¸Šä¼ åˆ° Linuxï¼Œè¿›è¡Œé…ç½®ï¼Œå¾€ä¸‹çœ‹ã€‚</p><p><strong>æ–¹å¼äºŒï¼šä½¿ç”¨ OpenSSL ç”Ÿæˆè¯ä¹¦</strong></p><p>è¿™ä¸ªæ–¹å¼é€‚ç”¨äºå­¦ä¹ é˜¶æ®µï¼Œå®é™…å¼€å‘é˜¶æ®µä½¿ç”¨æ–¹å¼ä¸€</p><ol><li>å…ˆè¦ç¡®è®¤å½“å‰ç³»ç»Ÿæ˜¯å¦æœ‰å®‰è£… OpenSSL</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl version</span><br></pre></td></tr></table></figure><p>å®‰è£…ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œç”Ÿæˆï¼ˆä¸€æ­¥ä¸€æ­¥æ¥ï¼‰</p><ol start="2"><li>åˆ›å»º <code>/root/cerr</code> ç›®å½•å¹¶è¿›å…¥</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/cert</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/cert</span><br></pre></td></tr></table></figure><ol start="3"><li>æŒ‡å®šåŠ å¯†ç®—æ³•å’ŒåŠ å¯†æ–¹å¼ï¼Œç”Ÿæˆ <code>server.key</code></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># genrsa æ˜¯åŠ å¯†ç®—æ³•ï¼Œdes3 æ˜¯åŠ å¯†æ–¹å¼ï¼Œ-out ä»£è¡¨è¾“å…¥é•¿åº¦ä¸º 2048 çš„ server.key</span></span><br><span class="line">openssl genrsa -des3 -out server.key 2048</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åå®ƒä¼šè®©ä½ æ³¨å†Œ server.key çš„å¯†ç </span></span><br><span class="line"><span class="comment"># è¾“å…¥å¯†ç  ......</span></span><br></pre></td></tr></table></figure><ol start="4"><li>æ ¹æ®ä½ æ³¨å†Œçš„ server.key å¯†ç ï¼Œç”Ÿæˆ server.csr æ–‡ä»¶ï¼Œç”Ÿæˆåå®ƒä¼šè®©ä½ æ³¨å†Œä½ çš„åŸºæœ¬ä¿¡æ¯ï¼Œå› ä¸ºæ˜¯ä¸ªäººçš„ï¼Œæ‰€ä»¥ä¿¡æ¯éšä¾¿å¡«å†™</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key server.key -out server.csr</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæ³¨å†Œä½ çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¿¡æ¯éšä¾¿å¡«å†™</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.2b4bgtawqb4.webp" alt="image"></p><ol start="5"><li>å¤‡ä»½ server.key</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp server.key server.key.org</span><br></pre></td></tr></table></figure><ol start="6"><li>é‡æ–°ç”Ÿæˆ server.key æ–‡ä»¶ï¼Œå¹¶è¾“å…¥åˆšæ‰æ³¨å†Œçš„å¯†ç </li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -<span class="keyword">in</span> server.key.org -out server.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼šè®©ä½ é‡æ–°è¾“å…¥æ³¨å†Œå¯†ç </span></span><br></pre></td></tr></table></figure><ol start="7"><li>ç”Ÿæˆ server.crt æ–‡ä»¶</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 365 -<span class="keyword">in</span> server.csr -signkey server.key -out server.crt</span><br></pre></td></tr></table></figure><ol start="8"><li>æœ€åä½¿ç”¨ <code>ll</code> æŸ¥çœ‹ç›®å½•ä¸‹æ˜¯å¦ç”Ÿæˆç›¸åº”çš„æ–‡ä»¶ï¼š</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.3yl8ne2bkre0.webp" alt="image"></p><h3 id="SSLå®ä¾‹æ¨¡æ¿-é€šç”¨"><a href="#SSLå®ä¾‹æ¨¡æ¿-é€šç”¨" class="headerlink" title="SSLå®ä¾‹æ¨¡æ¿(é€šç”¨)"></a>SSLå®ä¾‹æ¨¡æ¿(é€šç”¨)</h3><p>Nginx çš„ç½®æ–‡ä»¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="comment"># ......</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">443</span> ssl;<span class="comment"># å¼€å¯ SSL åŠŸèƒ½</span></span><br><span class="line">    <span class="attribute">server_name</span>  localhost;     <span class="comment"># å¦‚æœæ˜¯è´­ä¹°çš„åŸŸåï¼Œè¿™é‡ŒåŠ ä¸Šè¯¥åŸŸå</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span>      /root/cert/server.cert; <span class="comment"># ç”Ÿæˆçš„ cert æˆ–è€… pem è¯ä¹¦è·¯å¾„ï¼Œæ ¹æ®éœ€æ±‚ä¿®æ”¹</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span>  /root/cert/server.key; <span class="comment"># ç”Ÿæˆçš„ key è¯ä¹¦è·¯å¾„ï¼Œæ ¹æ®éœ€æ±‚ä¿®æ”¹</span></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>; </span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; <span class="comment"># è¡¨ç¤ºä½¿ç”¨çš„åŠ å¯†å¥—ä»¶çš„ç±»å‹</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;  <span class="comment"># è¡¨ç¤ºä½¿ç”¨çš„TLSåè®®çš„ç±»å‹</span></span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   html;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸ªæ¨¡æ¿å°±æ˜¯ Nginx è§£å‹ç›®å½•çš„ conf ç›®å½•ä¸‹çš„ nginx.conf å†…å®¹ã€‚</p><p><strong>å»ºè®®</strong></p><p>é…ç½® SSL è¯ä¹¦æ—¶å€™ï¼Œä¸è¦ä¿®æ”¹åŸæ¥çš„ server æ¨¡å—ï¼ˆ<code>listen 80</code> æ¨¡å—ï¼‰ï¼Œåº”è¯¥æ–°å»ºä¸€ä¸ª server æ¨¡å—ã€‚</p><p><strong>è§£å†³é»˜è®¤ http é—®é¢˜ã€‚</strong></p><p>é…ç½®å®Œ SSL è¯ä¹¦è¿˜è¿œè¿œä¸å®‰å…¨ã€‚å¦‚æœç›´æ¥è¾“å…¥ <code>www.frx.com</code>ï¼Œä¼šé»˜è®¤åŠ ä¸Šã€ http:// ã€ è€Œä¸æ˜¯ã€ https:// ã€ï¼Œå¦‚ä½•ä¿®æ”¹ä¸ºã€ https:// ã€å‘¢ï¼Œæˆ‘ä»¬åˆ©ç”¨ Rewrite åŠŸèƒ½</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> www.frx.com;   <span class="comment"># å¦‚æœæ˜¯ www.frx.com å‘é€è¯·æ±‚</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="comment"># ......</span></span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://www.frx.com<span class="variable">$1</span>;  <span class="comment"># åˆ™æ”¹ä¸º https æ–¹å¼</span></span><br><span class="line">        <span class="comment"># ......</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment"># ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åå‘ä»£ç†ç³»ç»Ÿè°ƒä¼˜"><a href="#åå‘ä»£ç†ç³»ç»Ÿè°ƒä¼˜" class="headerlink" title="åå‘ä»£ç†ç³»ç»Ÿè°ƒä¼˜"></a>åå‘ä»£ç†ç³»ç»Ÿè°ƒä¼˜</h2><p>åå‘ä»£ç†å€¼ Buffer å’Œ Cacheã€‚</p><p>Buffer ç¿»è¯‘è¿‡æ¥æ˜¯ã€Œç¼“å†²ã€ï¼ŒCache ç¿»è¯‘è¿‡æ¥æ˜¯ã€Œç¼“å­˜ã€ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.6p7uoj5ab0k0.webp" alt="image"></p><p>å®¢æˆ·ç«¯é€šè¿‡ä»£ç†æœåŠ¡å™¨å‘è¢«ä»£ç†æœåŠ¡å™¨è·å–æ•°æ®åï¼Œä»£ç†æœåŠ¡å™¨åœ¨è·å–çš„æ•°æ®å­˜å‚¨åœ¨ç¼“å­˜ã€Œç“¶å­ã€é‡Œï¼Œå®¢æˆ·ç«¯å†æ¬¡è·å–ç›¸åŒèµ„æºæ—¶ï¼Œç›´æ¥ä»ç¼“å­˜ã€Œç“¶å­ã€é‡Œè·å–æ•°æ®ï¼Œä¸éœ€è¦å‘è¢«ä»£ç†æœåŠ¡å™¨è·å–æ•°æ®ï¼Œå‡è½»å‹åŠ›ã€‚</p><p>ç›¸åŒç‚¹:</p><ul><li>ä¸¤ç§æ–¹å¼éƒ½æ˜¯ç”¨æ¥æä¾› IO ååæ•ˆç‡ï¼Œéƒ½æ˜¯ç”¨æ¥æå‡ Nginx ä»£ç†çš„æ€§èƒ½ã€‚</li></ul><p>ä¸åŒç‚¹:</p><ul><li>ç¼“å†²ä¸»è¦ç”¨æ¥è§£å†³ä¸åŒè®¾å¤‡ä¹‹é—´æ•°æ®ä¼ é€’é€Ÿåº¦ä¸ä¸€è‡´å¯¼è‡´çš„æ€§èƒ½ä½çš„é—®é¢˜ï¼Œç¼“å†²ä¸­çš„æ•°æ®ä¸€æ—¦æ­¤æ¬¡æ“ä½œå®Œæˆåï¼Œå°±å¯ä»¥åˆ é™¤</li><li>ç¼“å­˜ä¸»è¦æ˜¯å¤‡ä»½ï¼Œå°†è¢«ä»£ç†æœåŠ¡å™¨çš„æ•°æ®ç¼“å­˜ä¸€ä»½åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œè¿™æ ·çš„è¯ï¼Œå®¢æˆ·ç«¯å†æ¬¡è·å–ç›¸åŒæ•°æ®çš„æ—¶å€™ï¼Œå°±åªéœ€è¦ä»ä»£ç†æœåŠ¡å™¨ä¸Šè·å–ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œç¼“å­˜ä¸­çš„æ•°æ®å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œåªæœ‰æ»¡è¶³ç‰¹å®šæ¡ä»¶æ‰ä¼šåˆ é™¤</li></ul><h3 id="Proxy-Buffer-ç›¸å…³æŒ‡ä»¤"><a href="#Proxy-Buffer-ç›¸å…³æŒ‡ä»¤" class="headerlink" title="Proxy Buffer ç›¸å…³æŒ‡ä»¤"></a>Proxy Buffer ç›¸å…³æŒ‡ä»¤</h3><ul><li><p><code>proxy_buffering</code> æŒ‡ä»¤ç”¨æ¥å¼€å¯æˆ–è€…å…³é—­ä»£ç†æœåŠ¡å™¨çš„ç¼“å†²åŒºï¼Œé»˜è®¤å¼€å¯ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_buffering &lt;on | off&gt;;</td><td>proxy_buffering on;</td><td>httpã€serverã€location</td></tr></tbody></table></li><li><p><code>proxy_buffers</code> æŒ‡ä»¤ç”¨æ¥æŒ‡å®šå•ä¸ªè¿æ¥ä»ä»£ç†æœåŠ¡å™¨è¯»å–å“åº”çš„ç¼“å­˜åŒºçš„ä¸ªæ•°å’Œå¤§å°ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_buffers &lt;number&gt; &lt;size&gt;;</td><td>proxy_buffers 8 4k | 8K;(ä¸ç³»ç»Ÿå¹³å°æœ‰å…³)</td><td>httpã€serverã€location</td></tr></tbody></table><ul><li>numberï¼šç¼“å†²åŒºçš„ä¸ªæ•°</li><li>sizeï¼šæ¯ä¸ªç¼“å†²åŒºçš„å¤§å°ï¼Œç¼“å†²åŒºçš„æ€»å¤§å°å°±æ˜¯ number * size</li></ul></li><li><p><code>proxy_buffer_size</code> æŒ‡ä»¤ç”¨æ¥è®¾ç½®ä»è¢«ä»£ç†æœåŠ¡å™¨è·å–çš„ç¬¬ä¸€éƒ¨åˆ†å“åº”æ•°æ®çš„å¤§å°ã€‚ä¿æŒä¸ proxy_buffers ä¸­çš„ size ä¸€è‡´å³å¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ›´å°ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_buffer_size &lt;size&gt;;</td><td>proxy_buffer_size 4k | 8k;(ä¸ç³»ç»Ÿå¹³å°æœ‰å…³)</td><td>httpã€serverã€location</td></tr></tbody></table></li><li><p><code>proxy_busy_buffers_size</code> æŒ‡ä»¤ç”¨æ¥é™åˆ¶åŒæ—¶å¤„äº BUSY çŠ¶æ€çš„ç¼“å†²æ€»å¤§å°ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_busy_buffers_size &lt;size&gt;;</td><td>proxy_busy_buffers_size 8k | 16K;</td><td>httpã€serverã€location</td></tr></tbody></table></li><li><p><code>proxy_temp_path</code> æŒ‡ä»¤ç”¨äºå½“ç¼“å†²åŒºå­˜æ»¡åï¼Œä»æœªè¢« Nginx æœåŠ¡å™¨å®Œå…¨æ¥å—ï¼Œå“åº”æ•°æ®å°±ä¼šè¢«ä¸´æ—¶å­˜æ”¾åœ¨ç£ç›˜æ–‡ä»¶ä¸Šçš„è¯¥æŒ‡ä»¤è®¾ç½®çš„æ–‡ä»¶è·¯å¾„ä¸‹</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_temp_path &lt;path&gt;;</td><td>proxy_temp_path proxy_temp;</td><td>httpã€serverã€location</td></tr></tbody></table><p>æ³¨æ„ path æœ€å¤šè®¾ç½®ä¸‰å±‚ã€‚</p></li><li><p><code>proxy_temp_file_write_size</code> æŒ‡ä»¤ç”¨æ¥è®¾ç½®ç£ç›˜ä¸Šç¼“å†²æ–‡ä»¶çš„å¤§å°ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>proxy_temp_file_write_size &lt;size&gt;;</td><td>proxy_temp_file_write_size 8K | 16K;</td><td>httpã€serverã€location</td></tr></tbody></table></li></ul><h3 id="ç½‘ç«™è°ƒä¼˜æ¨¡æ¿-é€šç”¨"><a href="#ç½‘ç«™è°ƒä¼˜æ¨¡æ¿-é€šç”¨" class="headerlink" title="ç½‘ç«™è°ƒä¼˜æ¨¡æ¿(é€šç”¨)"></a>ç½‘ç«™è°ƒä¼˜æ¨¡æ¿(é€šç”¨)</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_buffering</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">proxy_buffers</span> <span class="number">4</span> <span class="number">64k</span>;</span><br><span class="line"><span class="attribute">proxy_buffer_size</span> <span class="number">64k</span>;</span><br><span class="line"><span class="attribute">proxy_busy_buffers_size</span> <span class="number">128k</span>;</span><br><span class="line"><span class="attribute">proxy_temp_file_write_size</span> <span class="number">128k</span>;</span><br></pre></td></tr></table></figure><h2 id="åå‘ä»£ç†é—®é¢˜"><a href="#åå‘ä»£ç†é—®é¢˜" class="headerlink" title="åå‘ä»£ç†é—®é¢˜"></a>åå‘ä»£ç†é—®é¢˜</h2><p>åå‘ä»£ç†æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯åå‘ä»£ç†çš„ç½‘ç«™éœ€è¦çš„ cssã€jsã€png ç­‰é™æ€æ–‡ä»¶é»˜è®¤æ˜¯ä» Nginx é‡Œè·å–ï¼Œæ˜¾ç„¶ä¸€ä¸ªä½ çš„æœåŠ¡å™¨çš„ä»£ç†äº†å¦‚æ·˜å®ã€äº¬ä¸œç­‰ç½‘ç«™ï¼Œé‚£ä¹ˆæ·˜å®ã€äº¬ä¸œç­‰ç½‘ç«™çš„é™æ€æ–‡ä»¶æ˜¯ä»ä½ çš„æœåŠ¡å™¨é‡Œè·å–ï¼Œä½†æ˜¯æœåŠ¡å™¨æ ¹æœ¬æ²¡æœ‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è®©ä»£ç†çš„ç½‘ç«™ä»¥åŠç½‘ç«™éœ€è¦çš„ cssã€jsã€png ç­‰é™æ€æ–‡ä»¶ä¸€åŒè·å–å‘¢ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ .*</span> &#123;<span class="comment"># å¦‚æœä¸æ˜¯ä»£ç†ç½‘ç«™çš„æ ¹è·¯å¾„ï¼Œè¯·è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8081;   <span class="comment"># ä»£ç†çš„ç½‘ç«™åœ°å€</span></span><br><span class="line">        <span class="comment"># å°†ç½‘ç«™çš„é™æ€æ–‡ä»¶ä¹Ÿä»£ç†è¿‡æ¥</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx é™æ€èµ„æºè®¿é—®</title>
      <link href="/2022/11/11/NginxStatic_resource_access/"/>
      <url>/2022/11/11/NginxStatic_resource_access/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-é™æ€èµ„æºè®¿é—®"><a href="#Nginx-é™æ€èµ„æºè®¿é—®" class="headerlink" title="Nginx é™æ€èµ„æºè®¿é—®"></a>Nginx é™æ€èµ„æºè®¿é—®</h1><p><strong>å¼•è¨€</strong></p><p>å¦‚ä½•è®¿é—® Nginx çš„é™æ€èµ„æºï¼Ÿè¿™å…¶ä¸­æ¶‰åŠåˆ°äº† Nginx çš„æ ¸å¿ƒåŠŸèƒ½ Rewrite é‡å†™æŠ€æœ¯ï¼Œæœ¬å†…å®¹å°†è®²è§£å¤„ç†è®¿é—®é™æ€èµ„æºçš„ç›¸å…³çŸ¥è¯†ã€‚</p><hr><h2 id="Nginxçš„è·¨åŸŸé—®é¢˜"><a href="#Nginxçš„è·¨åŸŸé—®é¢˜" class="headerlink" title="Nginxçš„è·¨åŸŸé—®é¢˜"></a>Nginxçš„è·¨åŸŸé—®é¢˜</h2><p>è·¨åŸŸé—®é¢˜ï¼Œæˆ‘ä»¬ä¸»è¦ä»ä»¥ä¸‹æ–¹é¢è¿›è¡Œè§£å†³ï¼š</p><ul><li>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°è·¨åŸŸé—®é¢˜</li><li>å®ä¾‹æ¼”ç¤ºè·¨åŸŸé—®é¢˜</li><li>å…·ä½“çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ</li></ul><h3 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h3><p>æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼šæ˜¯ä¸€ç§çº¦å®šï¼Œæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæ˜¯æœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœæµè§ˆå™¨å°‘äº†åŒæºç­–ç•¥ï¼Œåˆ™æµè§ˆå™¨çš„æ­£å¸¸åŠŸèƒ½å¯èƒ½éƒ½ä¼šå—åˆ°å½±å“ã€‚</p><p>åŒæºï¼šåè®®ã€åŸŸå(IP)ã€ç«¯å£ç›¸åŒå³ä¸ºåŒæº</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.200.131/user/1</span><br><span class="line">https://192.168.200.131/user/1</span><br><span class="line"><span class="comment"># ä¸æ»¡è¶³åŒæº</span></span><br><span class="line"></span><br><span class="line">http://192.168.200.131/user/1</span><br><span class="line">http://192.168.200.132/user/1</span><br><span class="line"><span class="comment"># ä¸æ»¡è¶³åŒæº</span></span><br><span class="line"></span><br><span class="line">http://192.168.200.131/user/1</span><br><span class="line">http://192.168.200.131:8080/user/1</span><br><span class="line"><span class="comment"># ä¸æ»¡è¶³åŒæº</span></span><br><span class="line"></span><br><span class="line">http://www.nginx.com/user/1</span><br><span class="line">http://www.nginx.org/user/1</span><br><span class="line"><span class="comment"># ä¸æ»¡è¶³åŒæº</span></span><br><span class="line"></span><br><span class="line">http://192.168.200.131/user/1</span><br><span class="line">http://192.168.200.131:8080/user/1</span><br><span class="line"><span class="comment"># ä¸æ»¡è¶³åŒæº</span></span><br><span class="line"></span><br><span class="line">http://www.nginx.org:80/user/1</span><br><span class="line">http://www.nginx.org/user/1</span><br><span class="line"><span class="comment"># æ»¡è¶³åŒæº</span></span><br></pre></td></tr></table></figure><h3 id="è·¨åŸŸé—®é¢˜"><a href="#è·¨åŸŸé—®é¢˜" class="headerlink" title="è·¨åŸŸé—®é¢˜"></a>è·¨åŸŸé—®é¢˜</h3><p>ç®€å•æè¿°ä¸‹ï¼š</p><p>æœ‰ä¸¤å°æœåŠ¡å™¨åˆ†åˆ«ä¸º Aã€Bï¼Œå¦‚æœä»æœåŠ¡å™¨ A çš„é¡µé¢å‘é€å¼‚æ­¥è¯·æ±‚åˆ°æœåŠ¡å™¨ B è·å–æ•°æ®ï¼Œå¦‚æœæœåŠ¡å™¨ A å’ŒæœåŠ¡å™¨ B ä¸æ»¡è¶³åŒæºç­–ç•¥ï¼Œåˆ™å°±ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ã€‚</p><h3 id="è·¨åŸŸæ¡ˆä¾‹"><a href="#è·¨åŸŸæ¡ˆä¾‹" class="headerlink" title="è·¨åŸŸæ¡ˆä¾‹"></a>è·¨åŸŸæ¡ˆä¾‹</h3><p>å‡ºç°è·¨åŸŸé—®é¢˜ä¼šæœ‰ä»€ä¹ˆæ•ˆæœï¼Ÿæ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªéœ€æ±‚æ¥ç»™å¤§å®¶æ¼”ç¤ºä¸‹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220801/image.vlv6telsbb4.webp" alt="image"></p><ol><li>Nginx çš„ html ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª a.html</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/nginx/html/a.htm</span><br></pre></td></tr></table></figure><p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>è·¨åŸŸé—®é¢˜æ¼”ç¤º<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">            $(function()&#123;</span><br><span class="line">                $("#btn").click(function()&#123;</span><br><span class="line">                        $.get('http://192.168.200.133:8080/getUser',function(data)&#123;</span><br><span class="line">                                alert(JSON.stringify(data));</span><br><span class="line">                        &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"è·å–æ•°æ®"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨ nginx.conf é…ç½®å¦‚ä¸‹å†…å®¹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">location</span> /getUser&#123;</span><br><span class="line">        <span class="attribute">default_type</span> application/json;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&#123;"id":1,"name":"TOM","age":18&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line"><span class="attribute">root</span> html;</span><br><span class="line"><span class="attribute">index</span> index.html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>é€šè¿‡æµè§ˆå™¨æµ‹è¯•è®¿é—®</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220801/image.4md37urjzug0.webp" alt="image"></p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ä½¿ç”¨ <code>add_header</code> æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤å¯ä»¥ç”¨æ¥æ·»åŠ ä¸€äº›å¤´ä¿¡æ¯ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>add_header &lt;name&gt; &lt;value&gt; â€¦â€¦</td><td>â€”</td><td>httpã€serverã€location</td></tr></tbody></table><p>æ­¤å¤„ç”¨æ¥è§£å†³è·¨åŸŸé—®é¢˜ï¼Œéœ€è¦æ·»åŠ ä¸¤ä¸ªå¤´ä¿¡æ¯ï¼Œåˆ†åˆ«æ˜¯</p><ul><li><code>Access-Control-Allow-Origin</code></li><li><code>Access-Control-Allow-Methods</code></li></ul><p><code>Access-Control-Allow-Origin</code>ï¼šç›´è¯‘è¿‡æ¥æ˜¯å…è®¸è·¨åŸŸè®¿é—®çš„æºåœ°å€ä¿¡æ¯ï¼Œå¯ä»¥é…ç½®å¤šä¸ª(å¤šä¸ªç”¨é€—å·åˆ†éš”)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>*</code> ä»£è¡¨æ‰€æœ‰æºã€‚</p><p><code>Access-Control-Allow-Methods</code>ï¼šç›´è¯‘è¿‡æ¥æ˜¯å…è®¸è·¨åŸŸè®¿é—®çš„è¯·æ±‚æ–¹å¼ï¼Œå€¼å¯ä»¥ä¸º GETã€POSTã€PUTã€DELETE â€¦â€¦ï¼Œå¯ä»¥å…¨éƒ¨è®¾ç½®ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ã€‚</p><p>å…·ä½“é…ç½®æ–¹å¼ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /getUser &#123;</span><br><span class="line">    <span class="attribute">add_header</span> Access-Control-Allow-Origin *;</span><br><span class="line">    <span class="attribute">add_header</span> Access-Control-Allow-Methods GET,POST,PUT,DELETE;</span><br><span class="line">    <span class="attribute">default_type</span> application/json;   <span class="comment"># return çš„æ ¼å¼æ˜¯ json</span></span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&#123;"id":1,"name":"TOM","age":18&#125;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é™æ€èµ„æºé˜²ç›—é“¾"><a href="#é™æ€èµ„æºé˜²ç›—é“¾" class="headerlink" title="é™æ€èµ„æºé˜²ç›—é“¾"></a>é™æ€èµ„æºé˜²ç›—é“¾</h2><h3 id="ä»€ä¹ˆæ˜¯èµ„æºç›—é“¾"><a href="#ä»€ä¹ˆæ˜¯èµ„æºç›—é“¾" class="headerlink" title="ä»€ä¹ˆæ˜¯èµ„æºç›—é“¾"></a>ä»€ä¹ˆæ˜¯èµ„æºç›—é“¾</h3><p>èµ„æºç›—é“¾æŒ‡çš„æ˜¯æ­¤å†…å®¹ä¸åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šï¼Œè€Œæ˜¯é€šè¿‡æŠ€æœ¯æ‰‹æ®µï¼Œç»•è¿‡åˆ«äººçš„é™åˆ¶å°†åˆ«äººçš„å†…å®¹æ”¾åˆ°è‡ªå·±é¡µé¢ä¸Šæœ€ç»ˆå±•ç¤ºç»™ç”¨æˆ·ã€‚ä»¥æ­¤æ¥ç›—å–å¤§ç½‘ç«™çš„ç©ºé—´å’Œæµé‡ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯ç”¨åˆ«äººçš„ä¸œè¥¿æˆå°±è‡ªå·±çš„ç½‘ç«™ã€‚</p><p>æä¾›ä¸¤ç§å›¾ç‰‡è¿›è¡Œæ¼”ç¤ºï¼š</p><ul><li>äº¬ä¸œï¼š<code>https://img14.360buyimg.com/n7/jfs/t1/101062/37/2153/254169/5dcbd410E6d10ba22/4ddbd212be225fcd.jpg</code></li><li>ç™¾åº¦ï¼š<code>https://pics7.baidu.com/feed/cf1b9d16fdfaaf516f7e2011a7cda1e8f11f7a1a.jpeg?token=551979a23a0995e5e5279b8fa1a48b34&amp;s=BD385394D2E963072FD48543030030BB</code></li></ul><p>æˆ‘ä»¬åœ¨ html ç›®å½•ä¸‹å‡†å¤‡ä¸€ä¸ªé¡µé¢ a.htmlï¼Œåœ¨é¡µé¢ä¸Šåˆ©ç”¨ img æ ‡ç­¾å¼•å…¥è¿™ä¸¤ä¸ªå›¾ç‰‡:</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220801/image.614vk7i0kx80.webp" alt="image"></p><p>è®¿é—®ï¼š<code>http://192.168.200.133/a.html</code> æ¥æŸ¥çœ‹æ•ˆæœ</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220801/image.2m5u48xesf60.webp" alt="image"></p><p>ä»ä¸Šé¢çš„æ•ˆæœï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸‹é¢çš„å›¾ç‰‡åœ°å€æ·»åŠ äº†é˜²æ­¢ç›—é“¾çš„åŠŸèƒ½ï¼Œäº¬ä¸œè¿™è¾¹æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å…¶å›¾ç‰‡ã€‚</p><h3 id="é˜²ç›—é“¾å®ç°åŸç†"><a href="#é˜²ç›—é“¾å®ç°åŸç†" class="headerlink" title="é˜²ç›—é“¾å®ç°åŸç†"></a>é˜²ç›—é“¾å®ç°åŸç†</h3><p>äº†è§£é˜²ç›—é“¾çš„åŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆå­¦ä¹ ä¸€ä¸ª HTTP çš„å¤´ä¿¡æ¯ Refererï¼Œå½“æµè§ˆå™¨å‘ Web æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½ä¼šå¸¦ä¸Š Refererï¼Œæ¥å‘Šè¯‰æµè§ˆå™¨è¯¥ç½‘é¡µæ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220801/image.64vdmkvdywk0.webp" alt="image"></p><p>åå°æœåŠ¡å™¨å¯ä»¥æ ¹æ®è·å–åˆ°çš„è¿™ä¸ª Referer ä¿¡æ¯æ¥åˆ¤æ–­æ˜¯å¦ä¸ºè‡ªå·±ä¿¡ä»»çš„ç½‘ç«™åœ°å€ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œç»§ç»­è®¿é—®ï¼Œå¦‚æœä¸æ˜¯åˆ™å¯ä»¥è¿”å› 403ï¼ˆæœåŠ¡ç«¯æ‹’ç»è®¿é—®ï¼‰çš„çŠ¶æ€ä¿¡æ¯ã€‚</p><h3 id="é˜²ç›—é“¾å®ç°å®ä¾‹"><a href="#é˜²ç›—é“¾å®ç°å®ä¾‹" class="headerlink" title="é˜²ç›—é“¾å®ç°å®ä¾‹"></a>é˜²ç›—é“¾å®ç°å®ä¾‹</h3><p>åœ¨æœ¬åœ°æ¨¡æ‹Ÿä¸Šè¿°çš„æœåŠ¡å™¨æ•ˆæœå›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220801/image.4hr6e3mrf440.webp" alt="image"></p><p>Nginx é˜²ç›—é“¾çš„å…·ä½“å®ç°ï¼š</p><p>valid_referers æŒ‡ä»¤ï¼šNginx ä¼šé€šè¿‡æŸ¥çœ‹ Referer è‡ªåŠ¨å’Œ valid_referers çš„å†…å®¹è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ°äº†å°±å°† <code>$invalid_referer</code> å˜é‡ç½® 0ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œåˆ™å°† <code>$invalid_referer</code> å˜é‡ç½®ä¸º 1ï¼ŒåŒ¹é…çš„è¿‡ç¨‹ä¸­ä¸åŒºåˆ†å¤§å°å†™ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶åˆ¤æ–­ <code>$invalid_referer</code> æ˜¯å¦ç­‰äº 1ï¼ˆtrueï¼‰ï¼Œå³æ²¡æœ‰åŒ¹é…åˆ° ï¼Œç­‰äºåˆ™è¿”å› 403ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>valid_referers &lt;none | blocked | server_names | string&gt; â€¦â€¦</td><td>â€”</td><td>serverã€location</td></tr></tbody></table><ul><li>noneï¼šå¦‚æœ Header ä¸­çš„ Referer ä¸ºç©ºï¼Œå…è®¸è®¿é—®</li><li>blockedï¼šåœ¨ Header ä¸­çš„ Referer ä¸ä¸ºç©ºï¼Œä½†æ˜¯è¯¥å€¼è¢«é˜²ç«å¢™æˆ–ä»£ç†è¿›è¡Œä¼ªè£…è¿‡ï¼Œå¦‚ä¸å¸¦ã€ http:// ã€ ã€ã€ https:// ã€ç­‰åè®®å¤´çš„èµ„æºæ‰å…è®¸è®¿é—®ã€‚</li><li>server_namesï¼šæŒ‡å®šå…·ä½“çš„åŸŸåæˆ–è€… IP</li><li>stringï¼šå¯ä»¥æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼å’Œ <code>*</code> çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œéœ€è¦ä»¥ <code>~</code> å¼€å¤´è¡¨ç¤º</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ *\.(png|jpg|gif)</span>&#123;</span><br><span class="line">    <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> www.baidu.com <span class="number">192.168.91.200</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># valid_referers none blocked *.example.com example.*  www.example.org  ~\.google\.;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$invalid_referer</span>)&#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">403</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">root</span> /usr/local/nginx/html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šæ–¹ä»£ç å¦‚æœæ²¡æœ‰åŒ¹é…ä¸Š <code>www.baidu.com</code> å’Œ <code>192.168.91.200</code>ï¼Œåˆ™ <code>$invalid_referer</code> ä¸º 1ï¼ˆtrueï¼‰ï¼Œè¿”å› 403ï¼Œä»£è¡¨ä¸å…è®¸è·å–èµ„æºã€‚</p><p>Nginx é…ç½®æ–‡ä»¶æ”¯æŒ if åˆ¤æ–­ï¼Œä½†æ˜¯ if åé¢å¿…é¡»æœ‰ç©ºæ ¼ã€‚</p><p><strong>é—®é¢˜ï¼šå¦‚æœå›¾ç‰‡æœ‰å¾ˆå¤šï¼Œè¯¥å¦‚ä½•æ‰¹é‡è¿›è¡Œé˜²ç›—é“¾ï¼Ÿå¯ä»¥é’ˆå¯¹ç›®å½•è¿›è¡Œé˜²ç›—é“¾ã€‚</strong></p><h3 id="é’ˆå¯¹ç›®å½•é˜²ç›—é“¾"><a href="#é’ˆå¯¹ç›®å½•é˜²ç›—é“¾" class="headerlink" title="é’ˆå¯¹ç›®å½•é˜²ç›—é“¾"></a>é’ˆå¯¹ç›®å½•é˜²ç›—é“¾</h3><p>å‡è®¾ html ç›®å½•ä¸‹æœ‰ä¸€ä¸ª images ç›®å½•ï¼Œé‡Œé¢ä¸“é—¨æ”¾é˜²ç›—é“¾çš„å›¾ç‰‡ã€‚</p><p>é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /images &#123;</span><br><span class="line">    <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> www.baidu.com <span class="number">192.168.199.27</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># valid_referers none blocked *.example.com example.*  www.example.org  ~\.google\.;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$invalid_referer</span>)&#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">403</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">root</span> /usr/local/nginx/html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªéœ€å°† location çš„åœ°å€æ”¹æˆä¸€ä¸ªç›®å½•ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¯¹ä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰èµ„æºè¿›è¡Œé˜²ç›—é“¾æ“ä½œã€‚</p><p><strong>é—®é¢˜ï¼šReferer çš„é™åˆ¶æ¯”è¾ƒç²—ï¼Œæ¯”å¦‚æµè§ˆå™¨å‘é€è¯·æ±‚æ—¶æ¶æ„åŠ ä¸€ä¸ª Refererï¼Œä¸Šé¢çš„æ–¹å¼æ˜¯æ— æ³•è¿›è¡Œé™åˆ¶çš„ã€‚é‚£ä¹ˆè¿™ä¸ªé—®é¢˜æ”¹å¦‚ä½•è§£å†³ï¼Ÿ</strong></p><p>æ­¤æ—¶æˆ‘ä»¬éœ€è¦ç”¨åˆ° Nginx çš„ç¬¬ä¸‰æ–¹æ¨¡å— <code>ngx_http_accesskey_module</code>ï¼Œç¬¬ä¸‰æ–¹æ¨¡å—å¦‚ä½•å®ç°ç›—é“¾ï¼Œå¦‚ä½•åœ¨ Nginx ä¸­ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—çš„åŠŸèƒ½ï¼Œåœ¨åé¢æœ‰è®²è§£ã€‚</p><h2 id="RewriteåŠŸèƒ½é…ç½®"><a href="#RewriteåŠŸèƒ½é…ç½®" class="headerlink" title="RewriteåŠŸèƒ½é…ç½®"></a>RewriteåŠŸèƒ½é…ç½®</h2><p>Rewrite æ˜¯ Nginx æœåŠ¡å™¨æä¾›çš„ä¸€ä¸ªé‡è¦åŸºæœ¬åŠŸèƒ½ï¼Œæ˜¯ Web æœåŠ¡å™¨äº§å“ä¸­å‡ ä¹å¿…å¤‡çš„åŠŸèƒ½ã€‚ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç° URL çš„é‡å†™ã€‚</p><p>*<em>warning *</em></p><p>Nginx æœåŠ¡å™¨çš„ Rewrite åŠŸèƒ½çš„å®ç°ä¾èµ–äº PCRE çš„æ”¯æŒï¼Œå› æ­¤åœ¨ç¼–è¯‘å®‰è£… Nginx æœåŠ¡å™¨ä¹‹å‰ï¼Œéœ€è¦å®‰è£… PCRE åº“ã€‚Nginx ä½¿ç”¨çš„æ˜¯<code>ngx_http_rewrite_module</code> æ¨¡å—æ¥è§£æå’Œå¤„ç† Rewrite åŠŸèƒ½çš„ç›¸å…³é…ç½®ã€‚</p><h3 id="åœ°å€é‡å†™ä¸åœ°å€è½¬å‘"><a href="#åœ°å€é‡å†™ä¸åœ°å€è½¬å‘" class="headerlink" title="åœ°å€é‡å†™ä¸åœ°å€è½¬å‘"></a>åœ°å€é‡å†™ä¸åœ°å€è½¬å‘</h3><p>é‡å†™å’Œè½¬å‘çš„åŒºåˆ«:</p><ul><li>åœ°å€é‡å†™æµè§ˆå™¨åœ°å€ä¼šå‘ç”Ÿå˜åŒ–è€Œåœ°å€è½¬å‘åˆ™ä¸å˜</li><li>ä¸€æ¬¡åœ°å€é‡å†™ä¼šäº§ç”Ÿä¸¤æ¬¡è¯·æ±‚è€Œä¸€æ¬¡åœ°å€è½¬å‘åªä¼šäº§ç”Ÿä¸€æ¬¡è¯·æ±‚</li><li>åœ°å€é‡å†™åˆ°çš„é¡µé¢å¿…é¡»æ˜¯ä¸€ä¸ªå®Œæ•´çš„è·¯å¾„è€Œåœ°å€è½¬å‘åˆ™ä¸éœ€è¦</li><li>åœ°å€é‡å†™å› ä¸ºæ˜¯ä¸¤æ¬¡è¯·æ±‚ï¼Œæ‰€ä»¥ request èŒƒå›´å†…å±æ€§ä¸èƒ½ä¼ é€’ç»™æ–°é¡µé¢ï¼Œè€Œåœ°å€è½¬å‘å› ä¸ºæ˜¯ä¸€æ¬¡è¯·æ±‚æ‰€ä»¥å¯ä»¥ä¼ é€’å€¼</li><li>åœ°å€è½¬å‘é€Ÿåº¦å¿«äºåœ°å€é‡å†™</li></ul><h3 id="setæŒ‡ä»¤"><a href="#setæŒ‡ä»¤" class="headerlink" title="setæŒ‡ä»¤"></a>setæŒ‡ä»¤</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®ä¸€ä¸ªæ–°çš„å˜é‡ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>set &lt;$key&gt; &lt;value&gt;;</td><td>â€”</td><td>serverã€locationã€if</td></tr></tbody></table><ul><li>variableï¼šå˜é‡çš„åç§°ï¼Œè¯¥å˜é‡åç§°è¦ç”¨ <code>$</code> ä½œä¸ºå˜é‡çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä¸”ä¸èƒ½ä¸ Nginx æœåŠ¡å™¨å†…ç½®çš„å…¨å±€å˜é‡åŒåã€‚</li><li>valueï¼šå˜é‡çš„å€¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å…¶ä»–å˜é‡æˆ–è€…å˜é‡çš„ç»„åˆç­‰ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">location</span> /server &#123;</span><br><span class="line">        <span class="attribute">set</span> <span class="variable">$name</span> TOM;</span><br><span class="line">        <span class="attribute">set</span> <span class="variable">$age</span> <span class="number">18</span>;</span><br><span class="line">        <span class="attribute">default_type</span> text/plain;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="variable">$name</span>=<span class="variable">$age</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <code>https://192.168.200.133:8081:server</code>ï¼Œè¿”å›ç»“æœå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220801/image.6t618fip2fo0.webp" alt="image"></p><h3 id="Rewriteå¸¸ç”¨å…¨å±€å˜é‡"><a href="#Rewriteå¸¸ç”¨å…¨å±€å˜é‡" class="headerlink" title="Rewriteå¸¸ç”¨å…¨å±€å˜é‡"></a>Rewriteå¸¸ç”¨å…¨å±€å˜é‡</h3><table><thead><tr><th>å˜é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>$args</td><td>å˜é‡ä¸­å­˜æ”¾äº†è¯·æ±‚ URL ä¸­çš„è¯·æ±‚æŒ‡ä»¤ã€‚æ¯”å¦‚ <code>http://192.168.200.133:8080?arg1=value1&amp;args2=value2</code> ä¸­çš„ã€ arg1=value1&amp;arg2=value2 ã€ï¼ŒåŠŸèƒ½å’Œ $query_string ä¸€æ ·</td></tr><tr><td>$http_user_agent</td><td>å˜é‡å­˜å‚¨çš„æ˜¯ç”¨æˆ·è®¿é—®æœåŠ¡çš„ä»£ç†ä¿¡æ¯ï¼ˆå¦‚æœé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè®°å½•çš„æ˜¯æµè§ˆå™¨çš„ç›¸å…³ç‰ˆæœ¬ä¿¡æ¯ï¼‰</td></tr><tr><td>$host</td><td>å˜é‡å­˜å‚¨çš„æ˜¯è®¿é—®æœåŠ¡å™¨çš„ server_name å€¼</td></tr><tr><td>$document_uri</td><td>å˜é‡å­˜å‚¨çš„æ˜¯å½“å‰è®¿é—®åœ°å€çš„URIã€‚æ¯”å¦‚ <code>http://192.168.200.133/server?id=10&amp;name=zhangsan</code>ä¸­çš„ã€ /server ã€ï¼ŒåŠŸèƒ½å’Œ $uri ä¸€æ ·</td></tr><tr><td>$document_root</td><td>å˜é‡å­˜å‚¨çš„æ˜¯å½“å‰è¯·æ±‚å¯¹åº” location çš„ root å€¼ï¼Œå¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤æŒ‡å‘ Nginx è‡ªå¸¦ html ç›®å½•æ‰€åœ¨ä½ç½®</td></tr><tr><td>$content_length</td><td>å˜é‡å­˜å‚¨çš„æ˜¯è¯·æ±‚å¤´ä¸­çš„ Content-Length çš„å€¼</td></tr><tr><td>$content_type</td><td>å˜é‡å­˜å‚¨çš„æ˜¯è¯·æ±‚å¤´ä¸­çš„ Content-Type çš„å€¼</td></tr><tr><td>$http_cookie</td><td>å˜é‡å­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯çš„ cookie ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ <code>add_header Set-Cookie &#39;cookieName=cookieValue&#39;</code> æ¥æ·»åŠ  cookie æ•°æ®</td></tr><tr><td>$limit_rate</td><td>å˜é‡ä¸­å­˜å‚¨çš„æ˜¯ Nginx æœåŠ¡å™¨å¯¹ç½‘ç»œè¿æ¥é€Ÿç‡çš„é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯ Nginx é…ç½®ä¸­å¯¹ limit_rate æŒ‡ä»¤è®¾ç½®çš„å€¼ï¼Œé»˜è®¤æ˜¯ 0ï¼Œä¸é™åˆ¶ã€‚</td></tr><tr><td>$remote_addr</td><td>å˜é‡ä¸­å­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯çš„ IP åœ°å€</td></tr><tr><td>$remote_port</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„ç«¯å£å·</td></tr><tr><td>$remote_user</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯çš„ç”¨æˆ·åï¼Œéœ€è¦æœ‰è®¤è¯æ¨¡å—æ‰èƒ½è·å–</td></tr><tr><td>$scheme</td><td>å˜é‡ä¸­å­˜å‚¨äº†è®¿é—®åè®®</td></tr><tr><td>$server_addr</td><td>å˜é‡ä¸­å­˜å‚¨äº†æœåŠ¡ç«¯çš„åœ°å€</td></tr><tr><td>$server_name</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾çš„æœåŠ¡å™¨çš„åç§°</td></tr><tr><td>$server_port</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·</td></tr><tr><td>$server_protocol</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åè®®çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ ã€ HTTP/1.1 ã€</td></tr><tr><td>$request_body_file</td><td>å˜é‡ä¸­å­˜å‚¨äº†å‘ç»™åç«¯æœåŠ¡å™¨çš„æœ¬åœ°æ–‡ä»¶èµ„æºçš„åç§°</td></tr><tr><td>$request_method</td><td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯çš„è¯·æ±‚æ–¹å¼ï¼Œæ¯”å¦‚ã€ GET ã€,ã€ POST ã€ç­‰</td></tr><tr><td>$request_filename</td><td>å˜é‡ä¸­å­˜å‚¨äº†å½“å‰è¯·æ±‚çš„èµ„æºæ–‡ä»¶çš„è·¯å¾„å</td></tr><tr><td>$request_uri</td><td>å˜é‡ä¸­å­˜å‚¨äº†å½“å‰è¯·æ±‚çš„ URIï¼Œå¹¶ä¸”æºå¸¦è¯·æ±‚å‚æ•°ï¼Œæ¯”å¦‚ <code>http://192.168.200.133/server?id=10&amp;name=zhangsan</code> ä¸­çš„ ã€ /server?id=10&amp;name=zhangsan ã€</td></tr></tbody></table><blockquote><p><strong>ä¾‹å¦‚</strong></p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">location</span> /server &#123;</span><br><span class="line">        <span class="attribute">root</span> /usr/local/nginx/abc;</span><br><span class="line">        <span class="attribute">set</span> <span class="variable">$name</span> TOM;</span><br><span class="line">        <span class="attribute">set</span> <span class="variable">$age</span> <span class="number">18</span>;</span><br><span class="line">        <span class="attribute">default_type</span> text/plain;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="variable">$name</span>=<span class="variable">$age</span>=<span class="variable">$args</span>=<span class="variable">$http_user_agent</span>=<span class="variable">$host</span>=<span class="variable">$document_root</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®ï¼š<code>http://192.168.200.133:8081/server?username=JERRY&amp;gender=1</code></p><p>æ•ˆæœå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220801/image.6s6hlgez73g0.webp" alt="image"></p><blockquote><p><strong>å¯ä»¥æŠŠè®¿é—®çš„ä¿¡æ¯è®°å½•åœ¨æ—¥å¿—ä¸­</strong></p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="attribute">log_format</span> main <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$request</span> - <span class="variable">$status</span> - <span class="variable">$request_uri</span> - <span class="variable">$http_user_agent</span>'</span>;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line">        <span class="attribute">server_name</span> localhost;</span><br><span class="line">        <span class="attribute">location</span> /server &#123;</span><br><span class="line">        <span class="attribute">access_log</span> logs/access.log main;</span><br><span class="line">            <span class="attribute">root</span> /usr/local/nginx/abc;</span><br><span class="line">            <span class="attribute">set</span> <span class="variable">$name</span> TOM;</span><br><span class="line">            <span class="attribute">set</span> <span class="variable">$age</span> <span class="number">18</span>;</span><br><span class="line">            <span class="attribute">default_type</span> text/plain;</span><br><span class="line">            <span class="attribute">return</span> <span class="number">200</span> <span class="variable">$name</span>=<span class="variable">$age</span>=<span class="variable">$args</span>=<span class="variable">$http_user_agent</span>=<span class="variable">$host</span>=<span class="variable">$document_root</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®ï¼š<code>http://192.168.200.133:8081/server?username=JERRY&amp;gender=1</code></p><p>ç„¶åæŸ¥çœ‹æ—¥å¿—ï¼Œæ•ˆæœå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220801/image.23y9h76w29b4.webp" alt="image"></p><h3 id="ifæŒ‡ä»¤"><a href="#ifæŒ‡ä»¤" class="headerlink" title="ifæŒ‡ä»¤"></a>ifæŒ‡ä»¤</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥æ”¯æŒæ¡ä»¶åˆ¤æ–­ï¼Œå¹¶æ ¹æ®æ¡ä»¶åˆ¤æ–­ç»“æœé€‰æ‹©ä¸åŒçš„ Nginx é…ç½®ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>if (condition) { â€¦ }</td><td>â€”</td><td>serverã€location</td></tr></tbody></table><p>if å’Œæ‹¬å·ä¹‹é—´è¦æœ‰ç©ºæ ¼ï¼Œcondition ä¸ºåˆ¤å®šæ¡ä»¶ï¼Œå¯ä»¥æ”¯æŒä»¥ä¸‹å†™æ³•ï¼š</p><ul><li>å˜é‡åã€‚å¦‚æœå˜é‡åå¯¹åº”çš„å€¼ä¸ºç©ºæˆ–è€…æ˜¯ 0ï¼Œif éƒ½åˆ¤æ–­ä¸º falseï¼Œå…¶ä»–æ¡ä»¶ä¸º trueã€‚</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> (<span class="variable">$param</span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ã€ = ã€å’Œã€ != ã€æ¯”è¾ƒå˜é‡å’Œå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œæ»¡è¶³æ¡ä»¶ä¸º trueï¼Œä¸æ»¡è¶³ä¸º false</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> (<span class="variable">$request_method</span> = POST)&#123;</span><br><span class="line"><span class="attribute">return</span> <span class="number">405</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šPOST å’Œ Java ä¸å¤ªä¸€æ ·çš„åœ°æ–¹æ˜¯å­—ç¬¦ä¸²ä¸éœ€è¦æ·»åŠ å¼•å·ã€‚</p><ul><li>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯¹å˜é‡è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸè¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚å˜é‡ä¸æ­£åˆ™è¡¨è¾¾å¼ä¹‹é—´ä½¿ç”¨ã€ ~ ã€ï¼Œã€ <del>* ã€ï¼Œã€ !</del> ã€ï¼Œã€ !~* ã€æ¥è¿æ¥ã€‚<ul><li>ã€ ~ ã€ä»£è¡¨åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­åŒºåˆ†å¤§å°å†™ï¼Œè¿›è¡Œæ¨¡ç³ŠåŒ¹é…</li><li>ã€ ~* ã€ä»£è¡¨åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­ä¸åŒºåˆ†å¤§å°å†™ï¼Œè¿›è¡Œæ¨¡ç³ŠåŒ¹é…</li><li>ã€ !~ ã€å’Œã€ !~* ã€åˆšå¥½å’Œä¸Šé¢å–ç›¸åå€¼ï¼Œå¦‚æœåŒ¹é…ä¸Šè¿”å› falseï¼ŒåŒ¹é…ä¸ä¸Šè¿”å› trueï¼Œè¿›è¡Œæ¨¡ç³ŠåŒ¹é…</li></ul></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> (<span class="variable">$http_user_agent</span> <span class="regexp">~ MSIE)</span>&#123;</span><br><span class="line"><span class="comment"># $http_user_agent çš„å€¼ä¸­æ˜¯å¦åŒ…å« MSIE å­—ç¬¦ä¸²ï¼Œå¦‚æœåŒ…å«è¿”å› true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨ã€ -f ã€å’Œã€ !-f ã€<ul><li>å½“ä½¿ç”¨ã€ -f ã€æ—¶ï¼Œå¦‚æœè¯·æ±‚çš„æ–‡ä»¶å­˜åœ¨è¿”å› trueï¼Œä¸å­˜åœ¨è¿”å› falseã€‚</li><li>å½“ä½¿ç”¨ã€ !-f ã€æ—¶ï¼Œå¦‚æœè¯·æ±‚æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½†è¯¥æ–‡ä»¶æ‰€åœ¨ç›®å½•å­˜åœ¨è¿”å› trueï¼Œæ–‡ä»¶å’Œç›®å½•éƒ½ä¸å­˜åœ¨è¿”å› falseï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨è¿”å› falseã€‚</li></ul></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> (-f <span class="variable">$request_filename</span>)&#123;</span><br><span class="line"><span class="comment"># åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">if</span> (!-f <span class="variable">$request_filename</span>)&#123;</span><br><span class="line"><span class="comment"># åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦ä¸å­˜åœ¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼šç”¨æˆ·è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ä¸€ä¸ªå‹å¥½çš„æç¤º</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">root</span> html;</span><br><span class="line">    <span class="attribute">default_type</span> text/html;</span><br><span class="line">    <span class="comment"># åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦ä¸å­˜åœ¨</span></span><br><span class="line">    <span class="attribute">if</span> (!-f <span class="variable">$request_filename</span>)&#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&lt;h1&gt;ä¸å¥½æ„æ€ï¼Œæ–‡ä»¶èµ„æºæ‰¾ä¸åˆ°ï¼&lt;/h1&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>åˆ¤æ–­è¯·æ±‚çš„ç›®å½•æ˜¯å¦å­˜åœ¨ä½¿ç”¨ã€ -d ã€å’Œã€ !-d ã€</p><p>å½“ä½¿ç”¨ã€ -d ã€æ—¶ï¼Œå¦‚æœè¯·æ±‚çš„ç›®å½•å­˜åœ¨ï¼Œè¿”å› trueï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨åˆ™è¿”å› falseã€‚</p><p>å½“ä½¿ç”¨ã€ !-d ã€æ—¶ï¼Œå¦‚æœè¯·æ±‚çš„ç›®å½•ä¸å­˜åœ¨ä½†è¯¥ç›®å½•çš„ä¸Šçº§ç›®å½•å­˜åœ¨åˆ™è¿”å› trueï¼Œè¯¥ç›®å½•å’Œå®ƒä¸Šçº§ç›®å½•éƒ½ä¸å­˜åœ¨åˆ™è¿”å› falseï¼Œå¦‚æœè¯·æ±‚ç›®å½•å­˜åœ¨ä¹Ÿè¿”å›falseã€‚</p></li></ul><h3 id="breakæŒ‡ä»¤"><a href="#breakæŒ‡ä»¤" class="headerlink" title="breakæŒ‡ä»¤"></a>breakæŒ‡ä»¤</h3><p>è¯¥æŒ‡ä»¤ç”¨äºä¸­æ–­å½“å‰ç›¸åŒä½œç”¨åŸŸä¸­çš„å…¶ä»– Nginx é…ç½®ã€‚ä¸è¯¥æŒ‡ä»¤å¤„äºåŒä¸€ä½œç”¨åŸŸçš„ Nginx é…ç½®ä¸­ï¼Œä½äºå®ƒå‰é¢çš„æŒ‡ä»¤é…ç½®ç”Ÿæ•ˆï¼Œä½äºåé¢çš„æŒ‡ä»¤é…ç½®æ— æ•ˆã€‚å¹¶ä¸”breakè¿˜æœ‰å¦å¤–ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯ç»ˆæ­¢å½“å‰çš„åŒ¹é…å¹¶æŠŠå½“å‰çš„URIåœ¨æœ¬locationè¿›è¡Œé‡å®šå‘è®¿é—®å¤„ç†ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>break;</td><td>â€”</td><td>serverã€locationã€if</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /testbreak &#123;</span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$username</span> TOM;</span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$args</span>)&#123;</span><br><span class="line"><span class="attribute">set</span> <span class="variable">$username</span> JERRY;</span><br><span class="line">break;</span><br><span class="line"><span class="attribute">set</span> <span class="variable">$username</span> ROSE;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="attribute">add_header</span> username <span class="variable">$username</span>;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="variable">$username</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å¸¦å‚æ•°è®¿é—®ï¼š<code>http://192.168.200.133:8081/testbreak</code></p><p>æ•ˆæœå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.2ok6tnbtnx20.webp" alt="image"></p><p>å¸¦å‚æ•°è®¿é—®ï¼š<code>http://192.168.200.133:8081/testbreak/1</code></p><p>æ•ˆæœå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220802/image.1f6a03pxv4ow.webp" alt="image"></p><h3 id="returnæŒ‡ä»¤"><a href="#returnæŒ‡ä»¤" class="headerlink" title="returnæŒ‡ä»¤"></a>returnæŒ‡ä»¤</h3><p>è¯¥æŒ‡ä»¤ç”¨äºå®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯è¿”å›å“åº”çŠ¶æ€ä»£ç ã€‚åœ¨ return åçš„æ‰€æœ‰ Nginx é…ç½®éƒ½æ˜¯æ— æ•ˆçš„ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>return &lt;code&gt; [text];<br> return &lt;code&gt; &lt;URL&gt;; <br>return &lt;URL&gt;;</td><td>â€”</td><td>serverã€locationã€if</td></tr></tbody></table><ul><li>codeï¼šè¿”å›ç»™å®¢æˆ·ç«¯çš„ HTTP çŠ¶æ€ä»£ç†ã€‚å¯ä»¥è¿”å›çš„çŠ¶æ€ä»£ç ä¸º 0 ~ 999 çš„ä»»æ„ HTTP çŠ¶æ€ä»£ç†</li><li>textï¼šè¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”ä½“å†…å®¹ï¼Œæ”¯æŒå˜é‡çš„ä½¿ç”¨å’Œ JSON å­—ç¬¦ä¸²</li><li>URLï¼šè·³è½¬ç»™å®¢æˆ·ç«¯çš„ URL åœ°å€ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">"æ¬¢è¿ä½¿ç”¨ Nginx"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /baidu &#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">302</span> https://www.baidu.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è®¿é—® Nginxï¼Œå°±ä¼šåœ¨é¡µé¢çœ‹åˆ°è¿™å¥è¯ï¼šæ¬¢è¿ä½¿ç”¨ Nginxã€‚</p><p>å¦‚æœè®¿é—® <code>/baidu</code>ï¼Œåˆ™è·³è½¬åˆ° <code>https://www.baidu.com</code>ã€‚</p><h3 id="rewriteæŒ‡ä»¤"><a href="#rewriteæŒ‡ä»¤" class="headerlink" title="rewriteæŒ‡ä»¤"></a>rewriteæŒ‡ä»¤</h3><p>è¯¥æŒ‡ä»¤é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨æ¥æ”¹å˜ URIã€‚å¯ä»¥åŒæ—¶å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŒ‡ä»¤ï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡å¯¹ URL è¿›è¡ŒåŒ¹é…å’Œå¤„ç†ã€‚</p><p>URL å’Œ URI çš„åŒºåˆ«ï¼š</p><ul><li>URIï¼šç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦</li><li>URLï¼šç»Ÿä¸€èµ„æºå®šä½ç¬¦</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>rewrite regex replacement [flag];</td><td>â€”</td><td>serverã€locationã€if</td></tr></tbody></table><ul><li><p>regexï¼šç”¨æ¥åŒ¹é… URI çš„æ­£åˆ™è¡¨è¾¾å¼</p></li><li><p>replacementï¼šåŒ¹é…æˆåŠŸåï¼Œç”¨äºæ›¿æ¢ URI ä¸­è¢«æˆªå–å†…å®¹çš„å­—ç¬¦ä¸²ã€‚å¦‚æœè¯¥å­—ç¬¦ä¸²æ˜¯ä»¥ ã€ http:// ã€æˆ–è€…ã€ https:// ã€å¼€å¤´çš„ï¼Œåˆ™ä¸ä¼šç»§ç»­å‘ä¸‹å¯¹URI è¿›è¡Œå…¶ä»–å¤„ç†ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é‡å†™åçš„ URI ç»™å®¢æˆ·ç«¯ã€‚</p><p>ä¾‹å¦‚ï¼šï¼ˆæ‹¬å·çš„å€¼ä¼šä½œä¸º $1 çš„å€¼ï¼‰^ ä»£è¡¨åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®</p></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line"><span class="attribute">location</span> /rewrite &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/url\w*$</span> https://www.baidu.com;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/(test)\w*$</span> /<span class="variable">$1</span>;   <span class="comment"># å¦‚æœæ˜¯ /rewrite/testxxxï¼Œåˆ™é‡å†™ url ä¸º test</span></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/(demo)\w*$</span> /<span class="variable">$1</span>;    <span class="comment"># å¦‚æœæ˜¯ /rewrite/demoxxxï¼Œåˆ™é‡å†™ url ä¸º demo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /test &#123;   <span class="comment"># é‡å†™åçš„ url å¦‚æœä¸º testï¼Œè§¦å‘ location</span></span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> test_sucess;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /demo &#123;   <span class="comment"># é‡å†™åçš„ url å¦‚æœä¸º demoï¼Œè§¦å‘ location</span></span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> demo_sucess;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <code>http://192.168.200.113/8081/rewrite/urlxxx</code>ï¼Œè·³è½¬åˆ° <code>https://www.baidu.com</code>ã€‚</p><p>è®¿é—® <code>http://192.168.200.113/8081/rewrite/testxxx</code>ï¼Œè¿”å› test_sucessã€‚</p><p>è®¿é—® <code>http://192.168.200.113/8081/rewrite/demoxxx</code>ï¼Œè¿”å› demo_sucessã€‚</p><p>flagï¼šç”¨æ¥è®¾ç½® Rewrite å¯¹ URI çš„å¤„ç†è¡Œä¸ºï¼Œå¯é€‰å€¼æœ‰å¦‚ä¸‹ï¼š</p><ul><li><code>last</code>ï¼šç»ˆæ­¢ç»§ç»­åœ¨æœ¬ location å—ä¸­å¤„ç†æ¥æ”¶åˆ°çš„åç»­ URIï¼Œå¹¶å°†æ­¤å¤„é‡å†™çš„ URl ä½œä¸ºä¸€ä¸ªæ–°çš„ URIï¼Œä½¿ç”¨å„ location å—è¿›è¡Œå¤„ç†ã€‚è¯¥æ ‡å¿—å°†é‡å†™åçš„ URI é‡å†™åœ¨ server å—ä¸­æ‰§è¡Œï¼Œä¸ºé‡å†™åçš„ URI æä¾›äº†è½¬å…¥åˆ°å…¶ä»– location å—çš„æœºä¼šã€‚<strong>é‡å†™åœ°å€åè®¿é—®å…¶ä»–çš„ location å—ï¼Œæµè§ˆå™¨åœ°å€æ  URL åœ°å€ä¸å˜</strong></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line"><span class="attribute">location</span> /rewrite &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/(test)\w*$</span> /<span class="variable">$1</span> <span class="literal">last</span>;   <span class="comment"># å¦‚æœæ˜¯ /rewrite/testxxxï¼Œåˆ™é‡å†™ url ä¸º test</span></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/(demo)\w*$</span> <span class="variable">$1</span> <span class="literal">last</span>;    <span class="comment"># å¦‚æœæ˜¯ /rewrite/demoxxxï¼Œåˆ™é‡å†™ url ä¸º demo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /test &#123;   <span class="comment"># é‡å†™åçš„ url å¦‚æœä¸º testï¼Œè§¦å‘ location</span></span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> test_sucess;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /demo &#123;   <span class="comment"># é‡å†™åçš„ url å¦‚æœä¸º demoï¼Œè§¦å‘ location</span></span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> demo_sucess;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <code>http://192.168.200.113/8081/rewrite/testxxx</code>ï¼Œè¿”å› test_sucessã€‚</p><p>è®¿é—® <code>http://192.168.200.113/8081/rewrite/demoxxx</code>ï¼Œè¿”å› demo_sucessã€‚</p><p>å•æ¬¡è®¿é—®ä¸æ˜æ˜¾ï¼Œå¤šæ¬¡è®¿é—®ï¼Œlast åªå¤„ç†ç¬¬ä¸€ä¸ªã€‚</p><ul><li><code>break</code>ï¼šå°†æ­¤å¤„é‡å†™çš„ URl ä½œä¸ºä¸€ä¸ªæ–°çš„ URIï¼Œåœ¨æœ¬å—ä¸­ç»§ç»­è¿›è¡Œå¤„ç†ã€‚è¯¥æ ‡å¿—å°†é‡å†™åçš„åœ°å€åœ¨å½“å‰çš„ location å—ä¸­æ‰§è¡Œï¼Œä¸ä¼šå°†æ–°çš„ URI è½¬å‘å…¶ä»–çš„ location å—ã€‚<strong>ä»…ä»…é‡å†™åœ°å€ï¼Œä¸ä¼šè§¦å‘å…¶ä»– location å—ï¼Œæµè§ˆå™¨åœ°å€æ  URL åœ°å€ä¸å˜</strong></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line"><span class="attribute">location</span> /rewrite &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/(test)\w*$</span> /<span class="variable">$1</span> <span class="literal">break</span>;   <span class="comment"># å¦‚æœæ˜¯ /rewrite/testxxxï¼Œåˆ™é‡å†™ url ä¸º test</span></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/(demo)\w*$</span> <span class="variable">$1</span> <span class="literal">break</span>;    <span class="comment"># å¦‚æœæ˜¯ /rewrite/demoxxxï¼Œåˆ™é‡å†™ url ä¸º demo</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># /test å’Œ /demo å°±åœ¨å½“å‰å—è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥ä¼šåœ¨å½“å‰çš„ location å—æ‰¾åˆ°å¦‚ä¸‹ html é¡µé¢ï¼š</span></span><br><span class="line">    <span class="comment"># /usr/local/nginx/html/test/index.html</span></span><br><span class="line">    <span class="comment"># /usr/local/nginx/html/demo/index.html</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /test &#123;   <span class="comment"># é‡å†™åçš„ url å¦‚æœä¸º testï¼Œè§¦å‘ location</span></span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> test_sucess;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /demo &#123;   <span class="comment"># é‡å†™åçš„ url å¦‚æœä¸º demoï¼Œè§¦å‘ location</span></span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> demo_sucess;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œ break æŒ‡ä»¤ç±»ä¼¼ã€‚å‡è®¾è®¿é—®çš„æ˜¯ /testï¼Œåˆ™å°† /test æ”¾åœ¨å½“å‰çš„ location å—è¿›è¡Œå¤„ç†ï¼Œå“ªæ€•ç¬¬äºŒä¸ª location å—å°±æ˜¯å¤„ç† /test çš„ï¼Œå®ƒä¹Ÿä¸ä¼šå»æ‰¾ç¬¬äºŒä¸ª location å—ï¼Œåªåœ¨å½“å‰å—è¿›è¡Œå¤„ç†ã€‚æ‰€ä»¥ä»–ä¼šè¯·æ±‚ <code>/usr/local/nginx/html/test/index.html</code>ã€‚</p><ul><li><code>redirect</code>ï¼šå°†é‡å†™åçš„ URI è¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒçŠ¶æ€ç ä¸º 302ï¼ŒæŒ‡æ˜æ˜¯ä¸´æ—¶é‡å®šå‘ URLï¼Œä¸»è¦ç”¨åœ¨ replacement å˜é‡ä¸æ˜¯ä»¥ã€ http:// ã€æˆ–è€…ã€ https:// ã€å¼€å¤´çš„æƒ…å†µ</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line"><span class="attribute">location</span> /rewrite &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/(test)\w*$</span> /<span class="variable">$1</span> <span class="literal">redirect</span>;   <span class="comment"># å¦‚æœæ˜¯ /rewrite/testxxxï¼Œåˆ™é‡å†™ url ä¸º test</span></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/(demo)\w*$</span> <span class="variable">$1</span> <span class="literal">redirect</span>;    <span class="comment"># å¦‚æœæ˜¯ /rewrite/demoxxxï¼Œåˆ™é‡å†™ url ä¸º demo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /test &#123;   <span class="comment"># é‡å†™åçš„ url å¦‚æœä¸º testï¼Œè§¦å‘ location</span></span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> test_sucess;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /demo &#123;   <span class="comment"># é‡å†™åçš„ url å¦‚æœä¸º demoï¼Œè§¦å‘ location</span></span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> demo_sucess;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‰¹ç‚¹æ˜¯é‡å®šå‘ï¼Œå°±æ˜¯<strong>æµè§ˆçš„åœ°å€æ ä¼šå‘é€æ”¹å˜</strong>ã€‚å¦‚å‘é€è¯·æ±‚ <code>/testxxx</code>ï¼Œå®ƒä¼šé‡å®šå‘åˆ° <code>/test</code>ï¼Œè§¦å‘ç¬¬äºŒä¸ª location å—ï¼Œæµè§ˆçš„åœ°å€æ ä¹Ÿä¼šç”± <code>/testxxx</code> å˜æˆ <code>/test</code>ã€‚</p><ul><li><code>permanent</code>ï¼šå°†é‡å†™åçš„ URI è¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒçŠ¶æ€ç ä¸º 301ï¼ŒæŒ‡æ˜æ˜¯æ°¸ä¹…é‡å®šå‘ URLï¼Œä¸»è¦ç”¨åœ¨ replacement å˜é‡ä¸æ˜¯ä»¥ã€ http:// ã€æˆ–è€…ã€ https:// ã€å¼€å¤´çš„æƒ…å†µ</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line"><span class="attribute">location</span> /rewrite &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/(test)\w*$</span> /<span class="variable">$1</span> <span class="literal">permanent</span>;   <span class="comment"># å¦‚æœæ˜¯ /rewrite/testxxxï¼Œåˆ™é‡å†™ url ä¸º test</span></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/rewrite/(demo)\w*$</span> <span class="variable">$1</span> <span class="literal">permanent</span>;    <span class="comment"># å¦‚æœæ˜¯ /rewrite/demoxxxï¼Œåˆ™é‡å†™ url ä¸º demo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /test &#123;   <span class="comment"># é‡å†™åçš„ url å¦‚æœä¸º testï¼Œè§¦å‘ location</span></span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> test_sucess;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /demo &#123;   <span class="comment"># é‡å†™åçš„ url å¦‚æœä¸º demoï¼Œè§¦å‘ location</span></span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> demo_sucess;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œ <code>redirect</code> çš„åŒºåˆ«å°±æ˜¯çŠ¶æ€ç ä¸º 301ï¼Œå¹¶ä¸”æ˜¯æ°¸ä¹…é‡å®šå‘ã€‚</p><h3 id="flag-æ€»ç»“"><a href="#flag-æ€»ç»“" class="headerlink" title="flag æ€»ç»“"></a>flag æ€»ç»“</h3><table><thead><tr><th>æ ‡è®°ç¬¦å·</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>last</td><td>æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåç»§ç»­å‘ä¸‹åŒ¹é…æ–°çš„ location URI è§„åˆ™</td></tr><tr><td>break</td><td>æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåç»ˆæ­¢ï¼Œä¸åœ¨åŒ¹é…ä»»ä½•è§„åˆ™</td></tr><tr><td>redirect</td><td>è¿”å› 302 ä¸´æ—¶é‡å®šå‘</td></tr><tr><td>permanent</td><td>è¿”å› 301 æ°¸ä¹…é‡å®šå‘</td></tr></tbody></table><ul><li>break ä¸ last éƒ½åœæ­¢å¤„ç†åç»­é‡å†™è§„åˆ™ï¼Œåªä¸è¿‡ last ä¼šé‡æ–°å‘èµ·æ–°çš„è¯·æ±‚å¹¶ä½¿ç”¨æ–°çš„è¯·æ±‚è·¯ç”±åŒ¹é…locationï¼Œä½† break ä¸ä¼šã€‚æ‰€ä»¥å½“è¯·æ±‚ break æ—¶ï¼Œå¦‚åŒ¹é…æˆåŠŸï¼Œåˆ™è¯·æ±‚æˆåŠŸï¼Œè¿”å› 200ï¼›å¦‚æœåŒ¹é…å¤±è´¥ï¼Œåˆ™è¿”å› 404</li><li>æœåŠ¡å™¨é…ç½®å¥½ redirect å’Œ permanent ä¹‹åï¼Œæ‰“å¼€æµè§ˆå™¨åˆ†åˆ«è®¿é—®è¿™ä¸¤ä¸ªè¯·æ±‚åœ°å€ï¼Œç„¶ååœæ­¢ Nginx æœåŠ¡ã€‚è¿™æ—¶å†è®¿é—® redirect è¯·æ±‚ä¼šç›´æ¥æŠ¥å‡ºæ— æ³•è¿æ¥çš„é”™è¯¯ã€‚ä½†æ˜¯ permanent è¯·æ±‚æ˜¯æ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨ä¼šå¿½ç•¥åŸå§‹åœ°å€ç›´æ¥è®¿é—®æ°¸ä¹…é‡å®šå‘ä¹‹åçš„åœ°å€ï¼Œæ‰€ä»¥è¯·æ±‚ä»ç„¶æˆåŠŸã€‚ï¼ˆè¿™ä¸ªéªŒè¯ä¸èƒ½ç¦ç”¨æµè§ˆå™¨çš„ç¼“å­˜ï¼Œå¦åˆ™å³ä½¿æ˜¯ permanent é‡å®šå‘ï¼Œæµè§ˆå™¨ä»ç„¶ä¼šå‘åŸå§‹åœ°å€å‘å‡ºè¯·æ±‚éªŒè¯ä¹‹å‰çš„æ°¸ä¹…é‡å®šå‘æ˜¯å¦æœ‰æ•ˆï¼‰</li><li>å¯¹äºæœç´¢å¼•æ“æ¥è¯´ï¼Œæœç´¢å¼•æ“åœ¨æŠ“å–åˆ° 301 æ°¸ä¹…é‡å®šå‘è¯·æ±‚å“åº”å†…å®¹çš„åŒæ—¶ä¹Ÿä¼šå°†åŸå§‹çš„ç½‘å€æ›¿æ¢ä¸ºé‡å®šå‘ä¹‹åçš„ç½‘å€ï¼Œè€Œå¯¹äº 302 ä¸´æ—¶é‡å®šå‘è¯·æ±‚åˆ™ä»ç„¶ä¼šä½¿ç”¨åŸå§‹çš„ç½‘å€å¹¶ä¸”å¯èƒ½ä¼šè¢«æœç´¢å¼•æ“è®¤ä¸ºæœ‰ä½œå¼Šçš„å«Œç–‘ã€‚æ‰€ä»¥å¯¹äºçº¿ä¸Šæ­£å¼ç¯å¢ƒæ¥è®²ï¼Œå°½é‡é¿å…ä½¿ç”¨ 302 è·³è½¬</li><li>å¦‚æœ replacement ä»¥ ã€Œ http:// ã€æˆ–ã€Œ https:// ã€æˆ–ã€Œ $scheme ã€å¼€å§‹ï¼Œå¤„ç†è¿‡ç¨‹å°†ç»ˆæ­¢ï¼Œå¹¶å°†è¿™ä¸ªé‡å®šå‘ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯</li></ul><h3 id="rewrite-logæŒ‡ä»¤"><a href="#rewrite-logæŒ‡ä»¤" class="headerlink" title="rewrite_logæŒ‡ä»¤"></a>rewrite_logæŒ‡ä»¤</h3><p>è¯¥æŒ‡ä»¤é…ç½®æ˜¯å¦å¼€å¯ URL é‡å†™æ—¥å¿—çš„è¾“å‡ºåŠŸèƒ½ï¼Œé»˜è®¤å…³é—­ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>rewrite_log &lt;on | off&gt;;</td><td>rewrite_log off;</td><td>httpã€serverã€locationã€if</td></tr></tbody></table><p>å¼€å¯åï¼ŒURL é‡å†™çš„ç›¸å…³æ—¥å¿—å°†ä»¥ notice çº§åˆ«è¾“å‡ºåˆ° error_log æŒ‡ä»¤é…ç½®çš„æ—¥å¿—æ–‡ä»¶æ±‡æ€»ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /rewrite_log &#123;</span><br><span class="line">    <span class="attribute">rewrite_log</span> <span class="literal">on</span>;    <span class="comment"># å¼€å¯é‡å†™æ—¥å¿—</span></span><br><span class="line"><span class="attribute">error_log</span> logs /error.log <span class="literal">notice</span>;   <span class="comment"># åˆ‡æ¢ä¸º notice æ¨¡å¼ï¼Œå› ä¸ºåªæ”¯æŒè¿™ä¸ªæ¨¡å¼</span></span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">'å¼€å¯äº†é‡å†™æ—¥å¿—'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Rewriteçš„æ¡ˆä¾‹"><a href="#Rewriteçš„æ¡ˆä¾‹" class="headerlink" title="Rewriteçš„æ¡ˆä¾‹"></a>Rewriteçš„æ¡ˆä¾‹</h2><h3 id="åŸŸåè·³è½¬"><a href="#åŸŸåè·³è½¬" class="headerlink" title="åŸŸåè·³è½¬"></a>åŸŸåè·³è½¬</h3><p>é—®é¢˜åˆ†æ</p><p>å…ˆæ¥çœ‹ä¸€ä¸ªæ•ˆæœï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®¿é—®äº¬ä¸œç½‘ç«™ï¼Œå¤§å®¶éƒ½çŸ¥é“æˆ‘ä»¬å¯ä»¥è¾“å…¥ <code>www.jd.com</code>ï¼Œä½†æ˜¯åŒæ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥è¾“å…¥ <code>www.360buy.com</code> åŒæ ·ä¹Ÿéƒ½èƒ½è®¿é—®åˆ°äº¬ä¸œç½‘ç«™ã€‚è¿™ä¸ªå…¶å®æ˜¯å› ä¸ºäº¬ä¸œåˆšå¼€å§‹çš„æ—¶å€™åŸŸåå°±æ˜¯ <code>www.360buy.com</code>ï¼Œåé¢ç”±äºå„ç§åŸå› æŠŠè‡ªå·±çš„åŸŸåæ¢æˆäº† <code>www.jd.com</code>ï¼Œè™½ç„¶è¯´åŸŸåæ”¹å˜äº†ï¼Œä½†æ˜¯å¯¹äºä»¥å‰åªè®°ä½äº† <code>www.360buy.com</code> çš„ç”¨æˆ·æ¥è¯´ï¼Œæˆ‘ä»¬å¦‚ä½•æŠŠè¿™éƒ¨åˆ†ç”¨æˆ·ä¹Ÿè¿ç§»åˆ°æˆ‘ä»¬æ–°åŸŸåçš„è®¿é—®ä¸Šæ¥ï¼Œé’ˆå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Nginx ä¸­ Rewrite çš„åŸŸåè·³è½¬æ¥è§£å†³ã€‚</p><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><ul><li>å‡†å¤‡ä¸¤ä¸ªåŸŸå <a href="http://www.360buy.com" target="_blank" rel="noopener">www.360buy.com</a> | <a href="http://www.jd.com" target="_blank" rel="noopener">www.jd.com</a></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br></pre></td></tr></table></figure><p>æ·»åŠ å†…å®¹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.200.133 www.360buy.com</span><br><span class="line">192.168.200.133 www.jd.com</span><br></pre></td></tr></table></figure><ul><li>åœ¨ <code>/usr/local/nginx/html/test</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè®¿é—®é¡µé¢ frx.html</li></ul><p>æ·»åŠ å†…å®¹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ°æˆ‘çš„ç½‘ç«™<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ Nginx å®ç°å½“è®¿é—® <code>www.frx.com</code> è®¿é—®åˆ° frx.html é¡µé¢</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.frx.com;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">root</span> /usr/local/nginx/html/;</span><br><span class="line"><span class="attribute">index</span> frx.html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ Rewrite å®Œæˆå°† <code>www.360buy.com</code> çš„è¯·æ±‚è·³è½¬åˆ° <code>www.jd.com</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.360buy.com;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/</span> http://www.jd.com <span class="literal">permanent</span>;   <span class="comment"># æ°¸ä¹…é‡å®šå‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜æè¿°ï¼šå¦‚ä½•åœ¨åŸŸåè·³è½¬çš„è¿‡ç¨‹ä¸­æºå¸¦è¯·æ±‚çš„ URIï¼Ÿ</strong></p><p>æ¯”å¦‚ <code>www.360buy.com?part=æ˜¾ç¤ºå™¨</code> å˜æˆ <code>www.jd.com?part=æ˜¾ç¤ºå™¨</code></p><ul><li>ä¿®æ”¹é…ç½®ä¿¡æ¯</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.itheima.com;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> http://www.hm.com<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹¬å·é‡Œæ˜¯ <code>www.itheima.com</code> åé¢å‡ºç° 0 æ¬¡æˆ– å¤šæ¬¡ä¸ä»¥ \nï¼ˆæ¢è¡Œï¼‰ç»“å°¾çš„å€¼ï¼Œè¯¥å€¼èµ‹ç»™ $1ã€‚</p><p><strong>é—®é¢˜æè¿°ï¼šæˆ‘ä»¬é™¤äº†ä¸Šè¿°è¯´çš„åªæœ‰ <a href="http://www.jd.comã€www.360buy.comï¼Œå…¶å®è¿˜æœ‰æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡" target="_blank" rel="noopener">www.jd.comã€www.360buy.comï¼Œå…¶å®è¿˜æœ‰æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡</a> <a href="http://www.jingdong.com" target="_blank" rel="noopener">www.jingdong.com</a> æ¥è®¿é—®ï¼Œé‚£ä¹ˆå¦‚ä½•é€šè¿‡ Rewrite æ¥å®ç°å¤šä¸ªåŸŸåçš„è·³è½¬?</strong></p><ul><li>æ·»åŠ åŸŸå</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰“å¼€ hosts æ–‡ä»¶</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ åŸŸå</span></span><br><span class="line">192.168.200.133 www.jingdong.com</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹é…ç½®ä¿¡æ¯</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.360buy.com www.jingdong.com;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> http://www.jd.com<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤šä¸ª server_name ç”¨ç©ºæ ¼éš”å¼€ã€‚</p><h3 id="åŸŸåé•œåƒ"><a href="#åŸŸåé•œåƒ" class="headerlink" title="åŸŸåé•œåƒ"></a>åŸŸåé•œåƒ</h3><p>ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œå°† <code>www.360buy.com</code> å’Œ <code>www.jingdong.com</code> éƒ½èƒ½è·³è½¬åˆ° <code>www.jd.com</code>ï¼Œé‚£ä¹ˆ <code>www.jd.com</code> æˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒèµ·åå«ä¸»åŸŸåï¼Œå…¶ä»–ä¸¤ä¸ªå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é•œåƒåŸŸåï¼Œå½“ç„¶å¦‚æœæˆ‘ä»¬ä¸æƒ³æŠŠæ•´ä¸ªç½‘ç«™åšé•œåƒï¼Œåªæƒ³ä¸ºå…¶ä¸­æŸä¸€ä¸ªå­ç›®å½•ä¸‹çš„èµ„æºåšé•œåƒï¼Œæ¯”å¦‚ç”¨æˆ·å¯ä»¥è·³åˆ°é¦–é¡µ Webä¸‹ï¼Œè€Œç®¡ç†å‘˜è·³è½¬åˆ°åå° Webï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ location å—ä¸­é…ç½® Rewrite åŠŸèƒ½ã€‚</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> rewrite.myweb.com;</span><br><span class="line"><span class="attribute">location</span><span class="regexp"> ^~</span> /user &#123;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/user(.*)</span> http://www.myweb.com/index<span class="variable">$1</span> <span class="literal">last</span>;  <span class="comment"># ç”¨æˆ·è·³åˆ°é¦–é¡µ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span><span class="regexp"> ^~</span> /manage &#123;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/manage(.*)</span> http://www.myweb.com/manage<span class="variable">$1</span> <span class="literal">last</span>;  <span class="comment"># ç®¡ç†å‘˜è·³åˆ°åå°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç‹¬ç«‹åŸŸå"><a href="#ç‹¬ç«‹åŸŸå" class="headerlink" title="ç‹¬ç«‹åŸŸå"></a>ç‹¬ç«‹åŸŸå</h3><p>ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®åŒ…å«å¤šä¸ªæ¨¡å—ï¼Œæ¯”å¦‚è´­ç‰©ç½‘ç«™æœ‰å•†å“å•†å“æœç´¢æ¨¡å—ã€å•†å“è¯¦æƒ…æ¨¡å—å·²ç»è´­ç‰©è½¦æ¨¡å—ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä¸ºæ¯ä¸€ä¸ªæ¨¡å—è®¾ç½®ç‹¬ç«‹çš„åŸŸåã€‚</p><p>éœ€æ±‚ï¼š</p><ul><li><code>http://search.product.com</code>ï¼šè®¿é—®å•†å“æœç´¢æ¨¡å—</li><li><code>http://item.product.com</code>ï¼šè®¿é—®å•†å“è¯¦æƒ…æ¨¡å—</li><li><code>http://cart.product.com</code>ï¼šè®¿é—®å•†å“è´­ç‰©è½¦æ¨¡å—</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> search.product.com;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> http://www.shop.com/search<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">81</span>;</span><br><span class="line"><span class="attribute">server_name</span> item.product.com;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> http://www.shop.com/item<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">82</span>;</span><br><span class="line"><span class="attribute">server_name</span> cart.product.com;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> http://www.shop.com/cart<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªåŠ¨åŠ ã€-ã€"><a href="#è‡ªåŠ¨åŠ ã€-ã€" class="headerlink" title="è‡ªåŠ¨åŠ ã€/ã€"></a>è‡ªåŠ¨åŠ ã€/ã€</h3><p>æœ‰æ—¶å€™è®¿é—®çš„åœ°å€è¦æ±‚åé¢ä»¥ <code>/</code> ç»“å°¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è§£å†³å¦‚æœç”¨æˆ·å¿˜è®°è¾“å…¥ <code>/</code>ï¼ŒNginx å°±ä¼šè‡ªåŠ¨åŠ ä¸Š <code>/</code>ã€‚</p><p>é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºé—®é¢˜ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span><span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">root</span> html;</span><br><span class="line"><span class="attribute">index</span> index.html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æƒ³è®¿é—®ä¸Šè¿°èµ„æºï¼Œå¾ˆç®€å•ï¼Œåªéœ€è¦é€šè¿‡ <code>http://192.168.200.133</code> ç›´æ¥å°±èƒ½è®¿é—®ï¼Œåœ°å€åé¢ä¸éœ€è¦åŠ  /ï¼Œä½†æ˜¯å¦‚æœå°†ä¸Šè¿°çš„é…ç½®ä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span><span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> /frx &#123;</span><br><span class="line"><span class="attribute">root</span> html;</span><br><span class="line"><span class="attribute">index</span> index.html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ï¼Œè¦æƒ³è®¿é—®ä¸Šè¿°èµ„æºï¼ŒæŒ‰ç…§ä¸Šè¿°çš„è®¿é—®æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>http://192.168.200.133/frx/</code> æ¥è®¿é—®ï¼Œä½†æ˜¯å¦‚æœåœ°å€åé¢ä¸åŠ æ–œæ ï¼Œå¦‚ <code>http://192.168.200.133/frx</code>ï¼Œé¡µé¢å°±ä¼šå‡ºé—®é¢˜ã€‚å¦‚æœä¸åŠ æ–œæ ï¼ŒNginx æœåŠ¡å™¨å†…éƒ¨ä¼šè‡ªåŠ¨åšä¸€ä¸ª 301 çš„é‡å®šå‘ï¼Œé‡å®šå‘çš„åœ°å€ä¼šæœ‰ä¸€ä¸ªæŒ‡ä»¤å« <code>server_name_in_redirect</code> æ¥å†³å®šé‡å®šå‘çš„åœ°å€ï¼š</p><ul><li><p>å¦‚æœè¯¥æŒ‡ä»¤ä¸º on</p><p>é‡å®šå‘çš„åœ°å€ä¸ºï¼š<code>http://server_name/ç›®å½•å/</code></p></li><li><p>å¦‚æœè¯¥æŒ‡ä»¤ä¸º off</p><p>é‡å®šå‘çš„åœ°å€ä¸ºï¼š<code>http://åŸURLä¸­çš„åŸŸå/ç›®å½•å/</code></p></li></ul><p>æ‰€ä»¥å°±æ‹¿åˆšæ‰çš„åœ°å€æ¥è¯´ï¼Œè®¿é—® <code>http://192.168.200.133/frx</code> å¦‚æœä¸åŠ æ–œæ ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šè¿°è§„åˆ™ï¼š</p><ul><li>å¦‚æœæŒ‡ä»¤ <code>server_name_in_redirect</code> ä¸º onï¼Œåˆ™ 301 é‡å®šå‘åœ°å€å˜ä¸º <code>http://localhost/frx/</code>ï¼ŒIP å‘ç”Ÿæ”¹å˜ï¼Œåœ°å€å‡ºç°äº†é—®é¢˜</li><li>å¦‚æœæŒ‡ä»¤ <code>server_name_in_redirect</code> ä¸º offï¼Œåˆ™ 301 é‡å®šå‘åœ°å€å˜ä¸º <code>http://192.168.200.133/frx/</code>ã€‚è¿™ä¸ªç¬¦åˆæˆ‘ä»¬çš„æœŸæœ›</li></ul><p>æ³¨æ„ <code>server_name_in_redirect</code> æŒ‡ä»¤åœ¨ Nginx çš„ 0.8.48 ç‰ˆæœ¬ä¹‹å‰é»˜è®¤éƒ½æ˜¯ onï¼Œä¹‹åæ”¹æˆäº† offï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬è¿™ä¸ªç‰ˆæœ¬ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯ 0.8.48 ä»¥å‰çš„ç‰ˆæœ¬å¹¶ä¸” server_name_in_redirect è®¾ç½®ä¸º onï¼Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡ Rewrite æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p><p>è§£å†³æ–¹æ¡ˆ</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Rewrite åŠŸèƒ½ä¸ºæœ«å°¾æ²¡æœ‰æ–œæ çš„ URL è‡ªåŠ¨æ·»åŠ ä¸€ä¸ªæ–œæ </p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span><span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">server_name_in_redirect</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">location</span> /frx &#123;</span><br><span class="line"><span class="attribute">if</span> (-d <span class="variable">$request_filename</span>)&#123;   <span class="comment"># å¦‚æœè¯·æ±‚çš„èµ„æºç›®å½•å­˜åœ¨</span></span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/(.*)([^/])$</span> http://<span class="variable">$host</span>/<span class="variable">$1</span><span class="variable">$2</span>/ <span class="literal">permanent</span>; <span class="comment"># $2 è·å–ç¬¬äºŒä¸ªæ‹¬å·çš„å€¼ï¼š/</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>$1 æ˜¯ç¬¬ä¸€ä¸ªæ‹¬å·çš„å€¼ï¼Œ$2 æ˜¯ç¬¬äºŒä¸ªæ‹¬å·çš„å€¼ã€‚</p><h3 id="åˆå¹¶ç›®å½•"><a href="#åˆå¹¶ç›®å½•" class="headerlink" title="åˆå¹¶ç›®å½•"></a>åˆå¹¶ç›®å½•</h3><p>æœç´¢å¼•æ“ä¼˜åŒ–(SEO)æ˜¯ä¸€ç§åˆ©ç”¨æœç´¢å¼•æ“çš„æœç´¢è§„åˆ™æ¥æä¾›ç›®çš„ç½‘ç«™çš„æœ‰å…³æœç´¢å¼•æ“å†…æ’åçš„æ–¹å¼ã€‚æˆ‘ä»¬åœ¨åˆ›å»ºè‡ªå·±çš„ç«™ç‚¹æ—¶ï¼Œå¯ä»¥é€šè¿‡å¾ˆå¤šä¸­æ–¹å¼æ¥æœ‰æ•ˆçš„æä¾›æœç´¢å¼•æ“ä¼˜åŒ–çš„ç¨‹åº¦ã€‚å…¶ä¸­æœ‰ä¸€é¡¹å°±åŒ…å« URL çš„ç›®å½•å±‚çº§ï¼Œä¸€èˆ¬ä¸è¦è¶…è¿‡ä¸‰å±‚ï¼Œå¦åˆ™çš„è¯ä¸åˆ©äºæœç´¢å¼•æ“çš„æœç´¢ï¼Œä¹Ÿç»™å®¢æˆ·ç«¯çš„è¾“å…¥å¸¦æ¥äº†è´Ÿæ‹…ï¼Œä½†æ˜¯å°†æ‰€æœ‰çš„æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œåˆä¼šå¯¼è‡´æ–‡ä»¶èµ„æºç®¡ç†æ··ä¹±ï¼Œå¹¶ä¸”è®¿é—®æ–‡ä»¶çš„é€Ÿåº¦ä¹Ÿä¼šéšç€æ–‡ä»¶å¢å¤šè€Œæ…¢ä¸‹æ¥ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜æ˜¯ç›¸äº’çŸ›ç›¾çš„ï¼Œé‚£ä¹ˆä½¿ç”¨ Rewrite å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜å‘¢ï¼Ÿ</p><p>ä¸¾ä¾‹ï¼Œç½‘ç«™ä¸­æœ‰ä¸€ä¸ªèµ„æºæ–‡ä»¶çš„è®¿é—®è·¯å¾„ <code>/server/11/22/33/44/20.html</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ 20.html å­˜åœ¨äºç¬¬ 5 çº§ç›®å½•ä¸‹ï¼Œå¦‚æœæƒ³è¦è®¿é—®è¯¥èµ„æºæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„ URL åœ°å€å°±è¦å†™æˆ <code>http://www.web.com/server/11/22/33/44/20.html</code>ï¼Œå¹¶ä¸”åœ¨é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.web.com;</span><br><span class="line"><span class="attribute">location</span> /server &#123;</span><br><span class="line"><span class="attribute">root</span> html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªæ˜¯éå¸¸ä¸åˆ©äº SEO æœç´¢å¼•æ“ä¼˜åŒ–çš„ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¸å¥½è®°ã€‚ä½¿ç”¨ Rewrite çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.web.com;</span><br><span class="line">    <span class="attribute">location</span> /server &#123;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/server-([0-9]+)-([0-9]+)-([0-9]+)-([0-9]+)\.html$</span>  /server/<span class="variable">$1</span>/<span class="variable">$2</span>/<span class="variable">$3</span>/<span class="variable">$4</span>/<span class="variable">$5</span>.html <span class="literal">last</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·é…ç½®åï¼Œå®¢æˆ·ç«¯åªéœ€è¦è¾“å…¥ <code>http://www.web.com/server-11-22-33-44-20.html</code> å°±å¯ä»¥è®¿é—®åˆ° 20.html é¡µé¢äº†ã€‚è¿™é‡Œä¹Ÿå……åˆ†åˆ©ç”¨äº† Rewrite æŒ‡ä»¤æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼çš„ç‰¹æ€§ã€‚</p><h3 id="å¤šçº§åŸŸå"><a href="#å¤šçº§åŸŸå" class="headerlink" title="å¤šçº§åŸŸå"></a>å¤šçº§åŸŸå</h3><p>å½“ä½ é…ç½®äº†å¤šçº§åŸŸåï¼Œå¦‚äºŒçº§åŸŸå <code>xxx.frxcat.fun</code>ï¼Œå¹¶ä¸”é™æ€èµ„æºç›®å½•æ°å¥½å’ŒäºŒçº§åŸŸåçš„ <code>xxx</code> å¯ä»¥åŒ¹é…ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œæ—¥åï¼Œå¦‚æœåˆå¤šä¸ª <code>xxx</code>ï¼Œåˆ™å†åˆ›å»ºå¯¹åº”çš„è¯¥ç›®å½•å³å¯ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> ~^(.+)?.frxcat.fun$;</span><br><span class="line">    <span class="attribute">index</span> idnex.html;</span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$host</span> = frxcat.fun)&#123;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://www.frxcat.fun<span class="variable">$2</span> <span class="literal">permanent</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">root</span> /data/html/<span class="variable">$1</span>/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·è®¿é—® <code>docs.frxcat.fun</code>ï¼Œè‡ªåŠ¨å» <code>/data/html/docs/</code> ç›®å½•ä¸‹æ‰¾åˆ° index.htmlï¼Œå¦‚æœæ˜¯ <code>bing.youngkbt.cn</code>ï¼Œåˆ™ä¼šå» <code>/data/html/bing/</code> ç›®å½•ä¸‹æ‰¾åˆ° idnex.htmlï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>if è¯­å¥çš„ä½œç”¨æ˜¯å°† <code>frxcat.fun</code> é‡å®šå‘åˆ° <code>www.frxcat.fun</code>ï¼Œè¿™æ ·æ—¢è§£å†³äº†ç½‘ç«™çš„ä¸»ç›®å½•è®¿é—®ï¼Œåˆå¯ä»¥å¢åŠ  SEO ä¸­å¯¹ <code>www.frxcat.fun</code> çš„åŸŸåæƒé‡ã€‚</p><h3 id="é˜²ç›—é“¾"><a href="#é˜²ç›—é“¾" class="headerlink" title="é˜²ç›—é“¾"></a>é˜²ç›—é“¾</h3><p>é˜²ç›—é“¾ä¹‹å‰æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ç›¸å…³çš„çŸ¥è¯†ï¼Œåœ¨ Rewrite ä¸­çš„é˜²ç›—é“¾å’Œä¹‹å‰å°†çš„åŸç†å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡é€šè¿‡ Rewrite å¯ä»¥å°†é˜²ç›—é“¾çš„åŠŸèƒ½è¿›è¡Œå®Œå–„ä¸‹ï¼Œå½“å‡ºç°é˜²ç›—é“¾çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Rewrite å°†è¯·æ±‚è½¬å‘åˆ°è‡ªå®šä¹‰çš„ä¸€å¼ å›¾ç‰‡å’Œé¡µé¢ï¼Œç»™ç”¨æˆ·æ¯”è¾ƒå¥½çš„æç¤ºä¿¡æ¯ã€‚</p><p>ä¸‹é¢æœ‰ä¸¤ä¸ªé…ç½®å®ä¾‹ï¼š</p><ul><li>æ ¹æ®æ–‡ä»¶ç±»å‹å®ç°é˜²ç›—é“¾é…ç½®ï¼š</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.web.com;</span><br><span class="line"><span class="attribute">locatin</span> <span class="regexp">~* ^.+\.(gif|jpg|png|swf|flv|rar|zip)$</span> &#123;</span><br><span class="line"><span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> server_names <span class="regexp">*.web.com</span>; <span class="comment"># server_names åæŒ‡å®šå…·ä½“çš„åŸŸåæˆ–è€… IP</span></span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$invalid_referer</span>)&#123;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/</span> http://www.web.com/images/forbidden.png;  <span class="comment"># è·³è½¬åˆ°é»˜è®¤åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ ¹æ®ç›®å½•å®ç°é˜²ç›—é“¾é…ç½®ï¼š</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.web.com;</span><br><span class="line"><span class="attribute">location</span> /file &#123;</span><br><span class="line"><span class="attribute">root</span> /server/file;  <span class="comment"># èµ„æºåœ¨ server ç›®å½•ä¸‹çš„ file ç›®å½•é‡Œ</span></span><br><span class="line"><span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> server_names <span class="regexp">*.web.com</span>; <span class="comment"># server_names åæŒ‡å®šå…·ä½“çš„åŸŸåæˆ–è€… IP</span></span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$invalid_referer</span>)&#123;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/</span> http://www.web.com/images/forbidden.png;  <span class="comment"># è·³è½¬åˆ° file ç›®å½•ä¸‹çš„å›¾ç‰‡</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®é™æµ"><a href="#è®¿é—®é™æµ" class="headerlink" title="è®¿é—®é™æµ"></a>è®¿é—®é™æµ</h2><p>æˆ‘ä»¬æ„å»ºç½‘ç«™æ˜¯ä¸ºäº†è®©ç”¨æˆ·è®¿é—®å®ƒä»¬ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨äºåˆæ³•è®¿é—®ã€‚æ‰€ä»¥ä¸å¾—ä¸é‡‡å–ä¸€äº›æªæ–½é™åˆ¶æ»¥ç”¨è®¿é—®çš„ç”¨æˆ·ã€‚è¿™ç§æ»¥ç”¨æŒ‡çš„æ˜¯ä»åŒä¸€ IP æ¯ç§’åˆ°æœåŠ¡å™¨è¯·æ±‚çš„è¿æ¥æ•°ã€‚å› ä¸ºè¿™å¯èƒ½æ˜¯åœ¨åŒä¸€æ—¶é—´å†…ï¼Œä¸–ç•Œå„åœ°çš„å¤šå°æœºå™¨ä¸Šçš„çˆ¬è™«æœºå™¨äººå¤šæ¬¡å°è¯•çˆ¬å–ç½‘ç«™çš„å†…å®¹ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é™åˆ¶ç”¨æˆ·è¿æ¥æ•°æ¥é¢„é˜² DOS æ”»å‡»</span></span><br><span class="line"><span class="attribute">limit_conn_zone</span> <span class="variable">$binary_remote_addr</span> zone=perip:<span class="number">10m</span>;</span><br><span class="line"><span class="attribute">limit_conn_zone</span> <span class="variable">$server_name</span> zone=perserver:<span class="number">10m</span>;</span><br><span class="line"><span class="comment"># é™åˆ¶åŒä¸€å®¢æˆ·ç«¯ ip æœ€å¤§å¹¶å‘è¿æ¥æ•°</span></span><br><span class="line"><span class="attribute">limit_conn</span> perip <span class="number">2</span>;</span><br><span class="line"><span class="comment"># é™åˆ¶åŒä¸€serveræœ€å¤§å¹¶å‘è¿æ¥æ•°</span></span><br><span class="line"><span class="attribute">limit_conn</span> perserver <span class="number">20</span>;</span><br><span class="line"><span class="comment"># é™åˆ¶ä¸‹è½½é€Ÿåº¦ï¼Œæ ¹æ®è‡ªèº«æœåŠ¡å™¨å¸¦å®½é…ç½®</span></span><br><span class="line"><span class="attribute">limit_rate</span> <span class="number">300k</span>;</span><br></pre></td></tr></table></figure><h2 id="é“¾æ¥è¶…æ—¶"><a href="#é“¾æ¥è¶…æ—¶" class="headerlink" title="é“¾æ¥è¶…æ—¶"></a>é“¾æ¥è¶…æ—¶</h2><p>é•¿æ—¶é—´å ç€è¿æ¥èµ„æºä¸é‡Šæ”¾ï¼Œæœ€ç»ˆä¼šå¯¼è‡´è¯·æ±‚çš„å †ç§¯ï¼ŒNginx å¤„ç†è¯·æ±‚æ•ˆç‡å¤§å¤§é™ä½ã€‚æ‰€ä»¥æˆ‘ä»¬å¯¹è¿æ¥çš„æ§åˆ¶éƒ½è¦æ³¨æ„è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé€šè¿‡è¶…æ—¶æœºåˆ¶è‡ªåŠ¨å›æ”¶èµ„æºã€é¿å…èµ„æºæµªè´¹ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯è®¾ç½®</span></span><br><span class="line"><span class="attribute">server_names_hash_bucket_size</span> <span class="number">128</span>;</span><br><span class="line"><span class="attribute">server_names_hash_max_size</span> <span class="number">512</span>;</span><br><span class="line"><span class="comment"># é•¿è¿æ¥è¶…æ—¶é…ç½®</span></span><br><span class="line"><span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"><span class="attribute">client_header_timeout</span> <span class="number">15s</span>;</span><br><span class="line"><span class="attribute">client_body_timeout</span> <span class="number">15s</span>;</span><br><span class="line"><span class="attribute">send_timeout</span> <span class="number">60s</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»£ç†è®¾ç½®</span></span><br><span class="line"><span class="comment"># ä¸åç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚æ³¨æ„è¿™ä¸ªä¸€èˆ¬ä¸èƒ½å¤§äº 75 ç§’</span></span><br><span class="line"><span class="attribute">proxy_connect_timeout</span> <span class="number">30s</span>;</span><br><span class="line"><span class="attribute">proxy_send_timeout</span> <span class="number">120s</span>;</span><br><span class="line"><span class="comment"># ä»åç«¯æœåŠ¡å™¨è¯»å–å“åº”çš„è¶…æ—¶</span></span><br><span class="line"><span class="attribute">proxy_read_timeout</span> <span class="number">120s</span>;</span><br></pre></td></tr></table></figure><h2 id="HTMLå¼•å…¥"><a href="#HTMLå¼•å…¥" class="headerlink" title="HTMLå¼•å…¥"></a>HTMLå¼•å…¥</h2><p>æˆ‘ä»¬ç¼–å†™ .html æ–‡ä»¶çš„æ—¶å€™ï¼Œéš¾å…éœ€è¦å¼•å…¥ css å’Œ js æ–‡ä»¶ï¼Œå¦‚æœæ˜¯åœ¨æœ¬åœ°ï¼Œé‚£ä¹ˆå¼•å…¥éå¸¸ç®€å•ï¼Œç›´æ¥ç›¸å¯¹è·¯å¾„å³å¯ï¼Œä½†æ˜¯éƒ¨ç½²åˆ° Nginx æ—¶ï¼Œç›¸å¯¹è·¯å¾„ä¸å†æ˜¯ç›¸å¯¹ html æ–‡ä»¶çš„ç›®å½•ï¼Œæ‰€ä»¥ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒçš„å¼•å…¥æ ¼å¼ä¸ä¸€æ ·ã€‚</p><p>åœ¨ Nginx ä¸­çš„ .html æ–‡ä»¶ï¼Œå¼•å…¥ css å’Œ jsï¼Œè¦åŠ ä¸Š <code>/</code> ä½œä¸ºå¼€å¤´ï¼Œ<code>/</code> ä»£è¡¨ Nginx çš„æ ¹ç›®å½•ï¼Œå³é…ç½®æ–‡ä»¶ <code>location /</code> çš„æŒ‡å®šçš„ root è·¯å¾„ã€‚</p><p>æ¯”å¦‚ Nginx çš„é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span> /usr/local/nginx/html; <span class="comment"># é™æ€æ–‡ä»¶æ ¹ç›®å½•</span></span><br><span class="line">        <span class="attribute">index</span> idnex.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ª aa.html åœ¨ <code>/usr/local/nginx/html/test</code> ç›®å½•ä¸‹ï¼Œå¹¶ä¸” aa.html å¼•å…¥äº† aa.css å’Œ aa.jsï¼Œä¸¤ä¸ªé™æ€æ–‡ä»¶åœ¨ aa.html æ‰€åœ¨ç›®å½•çš„ static æ–‡ä»¶å¤¹é‡Œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/nginx/html/<span class="built_in">test</span> ç›®å½•</span><br><span class="line">â”œâ”€â”€ a.html</span><br><span class="line">â”œâ”€â”€ static</span><br><span class="line">â”‚â”œâ”€â”€ a.css</span><br><span class="line">â”‚â”œâ”€â”€ a.js</span><br></pre></td></tr></table></figure><p>åœ¨æœ¬åœ°ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"static/aa.css"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"static/aa.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯éƒ¨ç½²åˆ° Nginx åï¼Œè¿™æ ·å†™ä¼šæ‰¾ä¸åˆ°è¿™ä¸¤ä¸ªèµ„æºï¼Œå› ä¸º <code>/</code> è§¦å‘ <code>location /</code>ï¼Œè¿›å…¥ <code>/usr/local/nginx/html</code> ç›®å½•ï¼Œè€Œè¿™ä¸¤ä¸ªæ–‡ä»¶åœ¨ <code>/usr/local/nginx/html/test/static</code> ç›®å½•ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éƒ¨ç½²åˆ° Nginx åï¼Œéœ€è¦ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/test/static/aa.css"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/test/static/aa.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx åŸºç¡€é…ç½®å®ä¾‹</title>
      <link href="/2022/11/10/Nginx_Basic_case_configuration/"/>
      <url>/2022/11/10/Nginx_Basic_case_configuration/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-åŸºç¡€é…ç½®å®ä¾‹"><a href="#Nginx-åŸºç¡€é…ç½®å®ä¾‹" class="headerlink" title="Nginx åŸºç¡€é…ç½®å®ä¾‹"></a>Nginx åŸºç¡€é…ç½®å®ä¾‹</h1><p><strong>å¼•è¨€</strong></p><p>å­¦ä¹ äº†æ ¸å¿ƒé…ç½®æ–‡ä»¶çš„å†…å®¹ï¼Œä¹Ÿä»…ä»…æ˜¯å­¦ä¹ ï¼Œæ²¡æœ‰å®é™…ä¾‹å­æ¥å·©å›ºçš„çŸ¥è¯†å®¹æ˜“æµå¤±ï¼Œæœ¬å†…å®¹å¸¦ä½ å†™ä¸€ä¸ªç®€å•çš„ demo å®ä¾‹ã€‚</p><p>æ¯æ¬¡å¼€æœºéƒ½æ‰‹åŠ¨å¯åŠ¨ Nginx æœåŠ¡ï¼Ÿæ¯æ¬¡ä½¿ç”¨ Nginx çš„æŒ‡ä»¤æ€»æ˜¯è¦è¿›å…¥ sbin ç›®å½•ä¸‹ï¼Ÿæœ¬æ–‡å¸¦ä½ é…ç½® Naginx æœåŠ¡è‡ªå¯å’Œå…¨å±€ nginx æŒ‡ä»¤ã€‚</p><h2 id="åŸºç¡€é…ç½®å®ä¾‹"><a href="#åŸºç¡€é…ç½®å®ä¾‹" class="headerlink" title="åŸºç¡€é…ç½®å®ä¾‹"></a>åŸºç¡€é…ç½®å®ä¾‹</h2><p>å‰é¢æˆ‘ä»¬å·²ç»å¯¹ Nginx æœåŠ¡å™¨é»˜è®¤é…ç½®æ–‡ä»¶çš„ç»“æ„å’Œæ¶‰åŠçš„åŸºæœ¬æŒ‡ä»¤åšäº†è¯¦ç»†çš„é˜è¿°ã€‚é€šè¿‡è¿™äº›æŒ‡ä»¤çš„åˆç†é…ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©ä¸€å° Nginx æœåŠ¡å™¨æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”æä¾›åŸºæœ¬çš„ Web æœåŠ¡å™¨åŠŸèƒ½ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´å’Œæœ€ç®€å•çš„åŸºç¡€é…ç½®å®ä¾‹ï¼Œæ¥å·©å›ºä¸‹å‰é¢æ‰€å­¦ä¹ çš„æŒ‡ä»¤åŠå…¶é…ç½®ã€‚</p><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><ul><li><p>æœ‰å¦‚ä¸‹è®¿é—®ï¼š</p><p><code>http://192.168.199.27:8081/server1/location1</code> è®¿é—®çš„æ˜¯ï¼šindex_sr1_location1.html <code>http://192.168.199.27:8081/server1/location2</code> è®¿é—®çš„æ˜¯ï¼šindex_sr1_location2.html <code>http://192.168.199.27:8082/server2/location1</code> è®¿é—®çš„æ˜¯ï¼šindex_sr2_location1.html <code>http://192.168.199.27:8082/server2/location2</code> è®¿é—®çš„æ˜¯ï¼šindex_sr2_location2.html</p></li><li><p>å¦‚æœè®¿é—®çš„èµ„æºä¸å­˜åœ¨ï¼Œè¿”å›è‡ªå®šä¹‰çš„ 404 é¡µé¢</p></li><li><p>å°† /server1 å’Œ /server2 çš„é…ç½®ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶åˆ†å‰²ï¼Œå°†ä¸¤ä¸ªæ–‡ä»¶æ–‡ä»¶æ”¾åˆ° /home/www/conf.d ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ Nginx çš„é…ç½®æ–‡ä»¶ä½¿ç”¨ include åˆå¹¶ä¸¤ä¸ªæ–‡ä»¶</p></li><li><p>ä¸º /server1 å’Œ /server2 å„è‡ªåˆ›å»ºä¸€ä¸ªè®¿é—®æ—¥å¿—æ–‡ä»¶</p></li></ul><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º 404 é¡µé¢</span></span><br><span class="line">touch /home/www/404.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º conf.d ç›®å½•</span></span><br><span class="line">mkdir /home/www/conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸¤ä¸ªé…ç½®æ–‡ä»¶</span></span><br><span class="line">touch /home/www/conf/server1.conf</span><br><span class="line">touch /home/www/conf/server2.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º myweb ç›®å½•</span></span><br><span class="line">mkdir /home/www/myweb</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º server1 ç›®å½•å’Œå…¶å­ç›®å½•ä»¥åŠ index.html æ–‡ä»¶</span></span><br><span class="line">mkdir -p /home/www/myweb/server1/location1</span><br><span class="line">mkdir -p /home/www/myweb/server1/location2</span><br><span class="line"></span><br><span class="line">touch /home/www/myweb/server1/location1/index.html</span><br><span class="line">touch /home/www/myweb/server1/location2/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ—¥å¿—ç›®å½•å’Œæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">mkdir -p /home/www/myweb/server1/logs</span><br><span class="line">touch /home/www/myweb/server1/logs/access.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º server2 ç›®å½•å’Œå…¶å­ç›®å½•ä»¥åŠ index.html æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># å’Œåˆ›å»º server1 æ­¥éª¤ä¸€æ ·ï¼ŒæŠŠ 1 æ”¹ä¸º 2 å³å¯</span></span><br></pre></td></tr></table></figure><p>å‡†å¤‡ç›¸å…³æ–‡ä»¶ï¼Œ/homw/www ç›®å½•å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220729/image.2fjy4216srrw.webp" alt="image"></p><p>å› ä¸º Nginx è‡ªå¸¦é…ç½®æ–‡ä»¶çš„å¤‡ä»½ï¼Œå³ nginx.conf.defaultï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯å¦‚æœä½ çš„é…ç½®æ–‡ä»¶æ›¾ç»ä¿®æ”¹è¿‡ï¼Œé‚£ä¹ˆè¯·è¿›è¡Œå¤‡ä»½ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf.backup</span><br></pre></td></tr></table></figure><p>å¤‡ä»½åï¼Œè¿›å…¥ <code>/usr/local/nginx/conf/nginx.conf</code> é…ç½®æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p>å…ˆæ¸…ç©ºæ–‡ä»¶ï¼Œç„¶åæ·»åŠ å¦‚ä¸‹å†…å®¹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cache-lifetime=&quot;5&quot; :options=&quot;&#123; useUrlFragment: false &#125;&quot;</span><br></pre></td></tr></table></figure><p><strong>æœ‰æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span> www; <span class="comment"># é…ç½®å…è®¸è¿è¡Œ Nginx å·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„</span></span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">2</span>;  <span class="comment"># é…ç½®è¿è¡Œ Nginx è¿›ç¨‹ç”Ÿæˆçš„ worker è¿›ç¨‹æ•°</span></span><br><span class="line"><span class="attribute">error_log</span> logs/error.log;  <span class="comment"># é…ç½® Nginx æœåŠ¡å™¨è¿è¡Œå¯¹é”™è¯¯æ—¥å¿—å­˜æ”¾çš„è·¯å¾„</span></span><br><span class="line"><span class="attribute">pid</span> logs/nginx.pid;   <span class="comment"># é…ç½® Nginx æœåŠ¡å™¨å…è®¸æ—¶è®°å½• Nginx çš„ master è¿›ç¨‹çš„ PID æ–‡ä»¶è·¯å¾„å’Œåç§°</span></span><br><span class="line"><span class="attribute">daemon</span> <span class="literal">on</span>;   <span class="comment"># é…ç½® Nginx æœåŠ¡æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹æ³•å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">events&#123;</span><br><span class="line"><span class="attribute">accept_mutex</span> <span class="literal">on</span>;   <span class="comment"># è®¾ç½® Nginx ç½‘ç»œè¿æ¥åºåˆ—åŒ–,è§£å†³æƒŠç¾¤</span></span><br><span class="line"><span class="attribute">multi_accept</span> <span class="literal">on</span>;   <span class="comment"># è®¾ç½® Nginx çš„ worker è¿›ç¨‹æ˜¯å¦å¯ä»¥åŒæ—¶æ¥æ”¶å¤šä¸ªè¯·æ±‚</span></span><br><span class="line"><span class="attribute">worker_connections</span> <span class="number">1024</span>;   <span class="comment"># è®¾ç½® Nginx çš„ worker è¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•°</span></span><br><span class="line"><span class="attribute">use</span> <span class="literal">epoll</span>;   <span class="comment"># è®¾ç½® Nginx ä½¿ç”¨çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http&#123;</span><br><span class="line"></span><br><span class="line"><span class="attribute">include</span> mime.types;   <span class="comment"># å®šä¹‰ MIME-Type</span></span><br><span class="line"><span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line"><span class="attribute">sendfile</span> <span class="literal">on</span>;   <span class="comment"># é…ç½®å…è®¸ä½¿ç”¨ sendfile æ–¹å¼è¿è¾“</span></span><br><span class="line"><span class="attribute">keepalive_timeout</span> <span class="number">65</span>;   <span class="comment"># é…ç½®è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—æ ¼å¼</span></span><br><span class="line"><span class="attribute">log_format</span> server1 <span class="string">'===&gt;server1 access log'</span>;</span><br><span class="line"><span class="attribute">log_format</span> server2 <span class="string">'===&gt;server2 access log'</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">include</span> /home/www/conf/<span class="regexp">*.conf</span>;  <span class="comment"># å¼•ç”¨å…¶ä»– conf æ–‡ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ— æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span> www;</span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">2</span>;</span><br><span class="line"><span class="attribute">error_log</span> logs/error.log;</span><br><span class="line"><span class="attribute">pid</span> logs/nginx.pid;</span><br><span class="line"><span class="attribute">daemon</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">events&#123;</span><br><span class="line"><span class="attribute">accept_mutex</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">multi_accept</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line"><span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http&#123;</span><br><span class="line"></span><br><span class="line"><span class="attribute">include</span> mime.types;</span><br><span class="line"><span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line"><span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">keepalive_timeout</span> <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attribute">log_format</span> server1 <span class="string">'===&gt;this is server1 access log'</span>;</span><br><span class="line"><span class="attribute">log_format</span> server2 <span class="string">'===&gt;this is server2 access log'</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">include</span> /home/www/conf/<span class="regexp">*.conf</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ 25 è¡Œä»£ç ä½¿ç”¨ include å°† service1 å’Œservice2 çš„é…ç½®æ–‡ä»¶è¿›è¡Œå¼•ç”¨ã€‚ä»¥åæ— éœ€ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ï¼Œåªéœ€è¦å¼•å…¥å­é…ç½®æ–‡ä»¶å³å¯ï¼Œä¸»é…ç½®æ–‡ä»¶ä½œä¸ºé»˜è®¤å€¼ï¼Œå­é…ç½®æ–‡ä»¶çš„å†…å®¹ä¼šè¦†ç›–å’Œä¸»é…ç½®æ–‡ä»¶ç›¸åŒçš„å†…å®¹ã€‚</p><p>è¿›å…¥ server1.conf æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/www/conf/server1.conf</span><br></pre></td></tr></table></figure><p>server1.conf æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cache-lifetime=&quot;5&quot; :options=&quot;&#123; useUrlFragment: false &#125;&quot;</span><br></pre></td></tr></table></figure><p><strong>æœ‰æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">8081</span>;   <span class="comment"># é…ç½®ç›‘å¬ç«¯å£å’Œä¸»æœºåç§°</span></span><br><span class="line">  <span class="attribute">server_name</span> localhost;</span><br><span class="line">  <span class="attribute">access_log</span> /home/www/myweb/server1/logs/access.log server1;   <span class="comment"># é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—å­˜æ”¾è·¯å¾„</span></span><br><span class="line">  <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;   <span class="comment"># é…ç½®é”™è¯¯é¡µé¢</span></span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> /server1/location1&#123;   <span class="comment"># é…ç½®å¤„ç† /server1/location1 è¯·æ±‚çš„ location</span></span><br><span class="line">      <span class="attribute">root</span> /home/www/myweb;</span><br><span class="line">      <span class="attribute">index</span> index.html;       <span class="comment"># è¿™æ˜¯ server1 ä¸‹çš„ location1 çš„ index.html</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> /server1/location2&#123;   <span class="comment"># é…ç½®å¤„ç† /server1/location2 è¯·æ±‚çš„ location</span></span><br><span class="line">      <span class="attribute">root</span> /home/www/myweb;</span><br><span class="line">      <span class="attribute">index</span> index.html;    <span class="comment"># è¿™æ˜¯ server1 ä¸‹çš„ location2 çš„ index.html</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> = /<span class="number">404</span>.html &#123;   <span class="comment"># é…ç½®é”™è¯¯é¡µé¢è½¬å‘</span></span><br><span class="line">      <span class="attribute">root</span> /home/www;</span><br><span class="line">      <span class="attribute">index</span> <span class="number">404</span>.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ— æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line">  <span class="attribute">server_name</span> localhost;</span><br><span class="line">  <span class="attribute">access_log</span> /home/www/myweb/server1/logs/access.log server1;</span><br><span class="line">  <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">location</span> /server1/location1&#123;</span><br><span class="line">      <span class="attribute">root</span> /home/www/myweb;</span><br><span class="line">      <span class="attribute">index</span> index.html;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">location</span> /server1/location2&#123;</span><br><span class="line">      <span class="attribute">root</span> /home/www/myweb;</span><br><span class="line">      <span class="attribute">index</span> index.html;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">location</span> = /<span class="number">404</span>.html &#123;</span><br><span class="line">      <span class="attribute">root</span> /home/www;</span><br><span class="line">      <span class="attribute">index</span> <span class="number">404</span>.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>server2.conf æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cache-lifetime=&quot;5&quot; :options=&quot;&#123; useUrlFragment: false &#125;&quot;</span><br></pre></td></tr></table></figure><p><strong>æœ‰æ³¨é‡Šç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">8082</span>;   <span class="comment"># é…ç½®ç›‘å¬ç«¯å£å’Œä¸»æœºåç§°</span></span><br><span class="line">  <span class="attribute">server_name</span> localhost;</span><br><span class="line">  <span class="attribute">access_log</span> /home/www/myweb/server2/logs/access.log server2;   <span class="comment"># é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—å­˜æ”¾è·¯å¾„</span></span><br><span class="line">  <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;   <span class="comment"># é…ç½®é”™è¯¯é¡µé¢,å¯¹404.htmlåšäº†å®šå‘é…ç½®</span></span><br><span class="line">  </span><br><span class="line">  <span class="attribute">location</span> /server2/location1&#123;   <span class="comment"># é…ç½®å¤„ç† /server1/location1 è¯·æ±‚çš„ location</span></span><br><span class="line">      <span class="attribute">root</span> /home/www/myweb;</span><br><span class="line">      <span class="attribute">index</span> index.html;   <span class="comment"># è¿™æ˜¯ server2 ä¸‹çš„ location1 çš„ index.html</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="attribute">location</span> /server2/location2&#123;   <span class="comment"># é…ç½®å¤„ç† /server2/location2 è¯·æ±‚çš„ location</span></span><br><span class="line">      <span class="attribute">root</span> /home/www/myweb;</span><br><span class="line">      <span class="attribute">index</span> index.html;    <span class="comment"># è¿™æ˜¯ server2 ä¸‹çš„ location2 çš„ index.html</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">location</span> = /<span class="number">404</span>.html &#123;   <span class="comment"># é…ç½®é”™è¯¯é¡µé¢è½¬å‘</span></span><br><span class="line">      <span class="attribute">root</span> /home/www;</span><br><span class="line">      <span class="attribute">index</span> <span class="number">404</span>.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ— æ³¨è§£ç‰ˆ</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">8082</span>;</span><br><span class="line">  <span class="attribute">server_name</span> localhost;</span><br><span class="line">  <span class="attribute">access_log</span> /home/www/myweb/server2/logs/access.log server2;</span><br><span class="line">  <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">location</span> /server2/location1&#123;</span><br><span class="line">      <span class="attribute">root</span> /home/www/myweb;</span><br><span class="line">      <span class="attribute">index</span> index.html;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">location</span> /server2/location2&#123;</span><br><span class="line">      <span class="attribute">root</span> /home/www/myweb;</span><br><span class="line">      <span class="attribute">index</span> index.html;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">location</span> = /<span class="number">404</span>.html &#123;</span><br><span class="line">      <span class="attribute">root</span> /home/www;</span><br><span class="line">      <span class="attribute">index</span> <span class="number">404</span>.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>server1ä¸‹é¢çš„location1ä¸‹é¢çš„index.htmlçš„å†…å®¹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>server1ä¸‹é¢çš„loaction1ä¸‹é¢çš„index.html<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„ä¸‰ä¸ªé¡µé¢æŠŠæ•°å­—æ”¹äº†å°±å¯ä»¥</p><p>404.htmlå†…å®¹;</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>ä¸å¥½æ„æ€ï¼Œç¨‹åºå°å“¥æ­£åœ¨åŠ ç´§ç»´ä¿®ä¸­ ...... <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é‡å¯ Nginx ï¼Œä½¿å¾—é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å¦‚æœæ²¡æœ‰å…³é—­é˜²ç«å¢™ï¼Œè®°å¾—å¼€æ”¾ 8081 å’Œ 8082 ç«¯å£ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€æ”¾ 8081 å’Œ 8082 ç«¯å£</span></span><br><span class="line">firewall-cmd --zone=public --add-port=8081/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=8082/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯é˜²ç«å¢™</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨åˆ†åˆ«è®¿é—®ï¼Œæ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š</p><p>8081 çš„ server1 çš„ location1ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220729/image.8hg9dg1p4z0.webp" alt="image"></p><p>8081 çš„ server1 çš„ location2ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220729/image.2dphfquey6v4.webp" alt="image"></p><p>8082 çš„ server2 çš„ location1ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220729/image.rfbc49fqpmo.webp" alt="image"></p><p>8082 çš„ server2 çš„ location2ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220729/image.1m80pe5hx1q8.webp" alt="image"></p><p>å¦‚æœè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„ 404 è¯·æ±‚ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220729/image.3fccke6ob8c0.webp" alt="image"></p><p>æ—¥å¿—ä¹Ÿä¼šæ‰“å°ï¼Œè¿™é‡Œæ¼”ç¤ºä¸€ä¸ªï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master www]<span class="comment"># tail /home/www/myweb/server1/logs/access.log</span></span><br><span class="line">===&gt;this is server1 access <span class="built_in">log</span></span><br><span class="line">===&gt;this is server1 access <span class="built_in">log</span></span><br><span class="line">===&gt;this is server1 access <span class="built_in">log</span></span><br><span class="line">===&gt;this is server1 access <span class="built_in">log</span></span><br><span class="line">===&gt;this is server1 access <span class="built_in">log</span></span><br><span class="line">===&gt;this is server1 access <span class="built_in">log</span></span><br><span class="line">===&gt;this is server1 access <span class="built_in">log</span></span><br><span class="line">===&gt;this is server1 access <span class="built_in">log</span></span><br><span class="line">===&gt;this is server1 access <span class="built_in">log</span></span><br><span class="line">===&gt;this is server1 access <span class="built_in">log</span></span><br></pre></td></tr></table></figure><h2 id="æ“ä½œçš„é—®é¢˜"><a href="#æ“ä½œçš„é—®é¢˜" class="headerlink" title="æ“ä½œçš„é—®é¢˜"></a>æ“ä½œçš„é—®é¢˜</h2><p>ç»è¿‡å‰é¢çš„æ“ä½œï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œå¦‚æœæƒ³è¦å¯åŠ¨ã€å…³é—­æˆ–é‡æ–°åŠ è½½ Nginx é…ç½®æ–‡ä»¶ï¼Œéƒ½éœ€è¦å…ˆè¿›å…¥åˆ° Nginx çš„å®‰è£…ç›®å½•çš„ sbin ç›®å½•ï¼Œç„¶åä½¿ç”¨ Nginx çš„äºŒçº§åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ nginx æ¥æ“ä½œï¼Œç›¸å¯¹æ¥è¯´æ“ä½œæ¯”è¾ƒç¹çï¼Œè¿™å—è¯¥å¦‚ä½•ä¼˜åŒ–ï¼Ÿå¦å¤–å¦‚æœæˆ‘ä»¬æƒ³æŠŠ Nginx è®¾ç½®æˆéšç€æœåŠ¡å™¨å¯åŠ¨å°±è‡ªåŠ¨å®Œæˆå¯åŠ¨æ“ä½œï¼Œåˆè¯¥å¦‚ä½•æ¥å®ç°ï¼Ÿ</p><p>è¿™å°±éœ€è¦ç”¨åˆ°æ¥ä¸‹æ¥æˆ‘ä»¬è¦è®²è§£çš„ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><ul><li>Nginx æœåŠ¡å¯åœé…ç½®</li><li>Nginx å…¨å±€å‘½ä»¤é…ç½®</li></ul><h2 id="æœåŠ¡å¯åœé…ç½®"><a href="#æœåŠ¡å¯åœé…ç½®" class="headerlink" title="æœåŠ¡å¯åœé…ç½®"></a>æœåŠ¡å¯åœé…ç½®</h2><p>æŠŠ Nginx åº”ç”¨æœåŠ¡è®¾ç½®æˆä¸ºç³»ç»ŸæœåŠ¡ï¼Œæ–¹ä¾¿å¯¹ Nginx æœåŠ¡çš„å¯åŠ¨å’Œåœæ­¢ç­‰ç›¸å…³æ“ä½œï¼Œå…·ä½“å®ç°æ­¥éª¤:</p><ul><li>åœ¨ <code>/usr/lib/systemd/system</code> ç›®å½•ä¸‹åˆ›å»º nginx.service æ–‡ä»¶</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/nginx.service</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx web service</span><br><span class="line">Documentation=http://nginx.org/en/docs/</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/usr/<span class="built_in">local</span>/nginx/logs/nginx.pid</span><br><span class="line">ExecStartPre=/usr/<span class="built_in">local</span>/nginx/sbin/nginx -t -c /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/nginx/sbin/nginx</span><br><span class="line">ExecReload=/usr/<span class="built_in">local</span>/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/<span class="built_in">local</span>/nginx/sbin/nginx -s stop</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå¯æ‰§è¡Œæ–‡ä»¶ nginx æ ¹æ®è‡ªå·±çš„è·¯å¾„è¿›è¡Œä¿®æ”¹ï¼Œä»¥åŠ .conf é…ç½®æ–‡ä»¶å’Œ .pid æ–‡ä»¶çš„è·¯å¾„ã€‚è¿™ä»½å†…å®¹æ˜¯åŸºäºé»˜è®¤å®‰è£…ç›®å½•çš„ã€‚</p><ul><li>æ·»åŠ å®Œæˆåï¼Œå¦‚æœæƒé™æœ‰é—®é¢˜éœ€è¦è¿›è¡Œæƒé™è®¾ç½®ï¼Œæ²¡æœ‰åˆ™å¿½ç•¥è¿™ä¸€æ­¥</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 /usr/lib/systemd/system/nginx.service</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤æ¥æ“ä½œ Nginx æœåŠ¡</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ Nginx</span></span><br><span class="line">systemctl start nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢ Nginx</span></span><br><span class="line">systemctl stop nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ Nginx</span></span><br><span class="line">systemctl restart nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line">systemctl reload nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ Nginx çŠ¶æ€</span></span><br><span class="line">systemctl status nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€æœºå¯åŠ¨</span></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­å¼€å¯å¯åŠ¨</span></span><br><span class="line">systemctl <span class="built_in">disable</span> nginx</span><br></pre></td></tr></table></figure><h2 id="å…¨å±€å‘½ä»¤é…ç½®"><a href="#å…¨å±€å‘½ä»¤é…ç½®" class="headerlink" title="å…¨å±€å‘½ä»¤é…ç½®"></a>å…¨å±€å‘½ä»¤é…ç½®</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ Nginx å®‰è£…ç›®å½•ä¸‹çš„äºŒçº§åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ <code>nginx</code> çš„å¾ˆå¤šå‘½ä»¤ï¼Œè¦æƒ³ä½¿ç”¨è¿™äº›å‘½ä»¤å‰ææ˜¯éœ€è¦è¿›å…¥ sbin ç›®å½•ä¸‹æ‰èƒ½ä½¿ç”¨ï¼Œå¾ˆä¸æ–¹ä¾¿ï¼Œå¦‚ä½•å»ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯¥äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶åŠ å…¥åˆ°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·çš„è¯åœ¨ä»»ä½•ç›®å½•éƒ½å¯ä»¥ä½¿ç”¨ nginx å¯¹åº”çš„ç›¸å…³å‘½ä»¤ã€‚å…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹:</p><p>æ–¹æ³•ä¸€ï¼š</p><ul><li>ä¿®æ”¹ <code>/etc/profile</code> æ–‡ä»¶</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æœ€åä¸€è¡Œæ·»åŠ </span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/nginx/sbin</span><br></pre></td></tr></table></figure><p>å¯æ‰§è¡Œæ–‡ä»¶ nginx çš„è·¯å¾„æ ¹æ®è‡ªå·±çš„è·¯å¾„ä¿®æ”¹ï¼Œè¿™é‡Œæ˜¯é»˜è®¤è·¯å¾„ã€‚</p><ul><li>ä½¿ä¹‹ç«‹å³ç”Ÿæ•ˆ</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><ul><li>ä»»æ„ä½ç½®æ‰§è¡Œ nginx å‘½ä»¤ï¼Œæµ‹è¯•æˆåŠŸ</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># nginx -v</span></span><br><span class="line">nginx version: nginx/1.21.6</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š</p><ul><li>å°†å¯æ‰§è¡Œæ–‡ä»¶ nginx æ‹·è´ä¸€ä»½åˆ° /usr/bin ç›®å½•ä¸‹</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/nginx/sbin/nginx /usr/bin</span><br></pre></td></tr></table></figure><ul><li>ä»»æ„ä½ç½®æ‰§è¡Œ nginx å‘½ä»¤ï¼Œæµ‹è¯•æˆåŠŸ</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># nginx -v</span></span><br><span class="line">nginx version: nginx/1.21.6</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx æ ¸å¿ƒé…ç½®æ–‡ä»¶</title>
      <link href="/2022/11/10/Nginx_Configuration_file/"/>
      <url>/2022/11/10/Nginx_Configuration_file/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-æ ¸å¿ƒé…ç½®æ–‡ä»¶"><a href="#Nginx-æ ¸å¿ƒé…ç½®æ–‡ä»¶" class="headerlink" title="Nginx æ ¸å¿ƒé…ç½®æ–‡ä»¶"></a>Nginx æ ¸å¿ƒé…ç½®æ–‡ä»¶</h1><p>ä»å‰é¢çš„å†…å®¹å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ Nginx çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶é»˜è®¤æ˜¯æ”¾åœ¨ <code>/usr/local/nginx/conf/nginx.conf</code>ï¼Œæœ¬æ¬¡æˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸‹ nginx.conf çš„å†…å®¹å’ŒåŸºæœ¬é…ç½®æ–¹æ³•ã€‚</p><hr><h2 id="é…ç½®æ–‡ä»¶å†…å®¹"><a href="#é…ç½®æ–‡ä»¶å†…å®¹" class="headerlink" title="é…ç½®æ–‡ä»¶å†…å®¹"></a>é…ç½®æ–‡ä»¶å†…å®¹</h2><p>è¯»å– Nginx è‡ªå¸¦çš„ Nginx é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶å†…å®¹å¾ˆå¤šï¼Œæˆ‘ä»¬å…ˆå°†å…¶ä¸­çš„æ³¨é‡Šéƒ¨åˆ†ã€å­¦ä¹ ä¸€ä¸ªæŠ€æœ¯ç‚¹å°±æ˜¯åœ¨ Nginx çš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨ <code>#</code> æ¥æ³¨é‡Šã€‘åˆ é™¤æ‰åï¼Œå°±å‰©ä¸‹å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;   <span class="comment"># ä½¿ç”¨æŒ‡ä»¤ 1 </span></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;    <span class="comment"># è¿™æ˜¯ events å—</span></span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;    <span class="comment"># è¿™æ˜¯ http å—</span></span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;   <span class="comment"># ç›‘å¬ 80 ç«¯å£</span></span><br><span class="line">        <span class="attribute">server_name</span>  localhost;   <span class="comment"># ç›‘å¬è¯·æ±‚è¿‡æ¥çš„ IP</span></span><br><span class="line">        <span class="attribute">location</span> / &#123;   <span class="comment"># è¯·æ±‚çš„åœ°å€æ˜¯ /ï¼Œåˆ™è¿›å…¥è¿™ä¸ªé…ç½®ï¼Œè®¿é—® idnex.html</span></span><br><span class="line">            <span class="attribute">root</span>   html;      <span class="comment"># è¿›å…¥ html ç›®å½•æ‰¾åˆ°è®¿é—®çš„é¡µé¢</span></span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># å¦‚æœè®¿é—®çš„é¡µé¢æ˜¯ 500 502 503 504ï¼Œåˆ™å‘é€ /50x.html è¯·æ±‚</span></span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;  </span><br><span class="line">        <span class="attribute">location</span> = /50x.html &#123;      <span class="comment"># å¦‚æœåŒ¹é…ä¸Š /50x.html è¯·æ±‚</span></span><br><span class="line">            <span class="attribute">root</span>   html;     <span class="comment"># åˆ™è¿›å…¥ html ç›®å½•æ‰¾åˆ° /50x.html</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹ä¸Šé¢æ–‡ä»¶å†…å®¹çš„è§£é‡Šï¼Œä¸€ä¸€å¯¹åº”æ¯”è¾ƒè§£é‡Šï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">æŒ‡ä»¤åæŒ‡ä»¤å€¼;  # å…¨å±€å—ï¼Œä¸»è¦è®¾ç½® Nginx æœåŠ¡å™¨æ•´ä½“è¿è¡Œçš„é…ç½®æŒ‡ä»¤</span><br><span class="line"></span><br><span class="line"><span class="comment"># events å—ï¼Œä¸»è¦è®¾ç½® Nginx æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥,è¿™ä¸€éƒ¨åˆ†å¯¹ Nginx æœåŠ¡å™¨çš„æ€§èƒ½å½±å“è¾ƒå¤§</span></span><br><span class="line"><span class="section">events</span> &#123; </span><br><span class="line">    æŒ‡ä»¤åæŒ‡ä»¤å€¼;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># http å—ï¼Œæ˜¯ Nginx æœåŠ¡å™¨é…ç½®ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—è®°å½•ã€ç¬¬ä¸‰æ–¹æ¨¡å—é…ç½®...             </span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    æŒ‡ä»¤åæŒ‡ä»¤å€¼;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123; <span class="comment"># server å—ï¼Œæ˜¯ Nginx é…ç½®å’Œè™šæ‹Ÿä¸»æœºç›¸å…³çš„å†…å®¹</span></span><br><span class="line">        æŒ‡ä»¤åæŒ‡ä»¤å€¼;</span><br><span class="line">        <span class="attribute">location</span> / &#123;      <span class="comment"># location å—ï¼ŒåŸºäº Nginx æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å­—ç¬¦ä¸²ä¸ location åé¢çš„å€¼è¿›è¡ŒåŒ¹é…ï¼Œå¯¹ç‰¹å®šè¯·æ±‚è¿›è¡Œå¤„ç†</span></span><br><span class="line">            æŒ‡ä»¤åæŒ‡ä»¤å€¼;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>nginx.conf é…ç½®æ–‡ä»¶ä¸­é»˜è®¤æœ‰ä¸‰å¤§å—ï¼šå…¨å±€å—ã€events å—ã€http å—</p><p>http å—ä¸­å¯ä»¥é…ç½®å¤šä¸ª server å—ï¼Œæ¯ä¸ª server å—åˆå¯ä»¥é…ç½®å¤šä¸ª location å—ã€‚</p><h2 id="å…¨å±€å—"><a href="#å…¨å±€å—" class="headerlink" title="å…¨å±€å—"></a>å…¨å±€å—</h2><p>å…¨å±€å—çš„é…ç½®å½±å“ Nginx çš„å…¨å±€è®¾ç½®ã€‚å¦‚ç”¨æˆ·æƒé™ï¼Œå¯åŠ¨çš„è¿›ç¨‹æ•°ç­‰ã€‚</p><h3 id="useræŒ‡ä»¤"><a href="#useræŒ‡ä»¤" class="headerlink" title="useræŒ‡ä»¤"></a>useræŒ‡ä»¤</h3><ol><li>userï¼šç”¨äºé…ç½®è¿è¡Œ Nginx æœåŠ¡å™¨çš„ worker è¿›ç¨‹çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>user &lt;user&gt; [group]</td><td>nobody</td><td>å…¨å±€å—</td></tr></tbody></table><p>è¯¥å±æ€§ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šï¼Œè¯­æ³•å¦‚ä¸‹ <code>./configure --user=user --group=group</code>ï¼Œå¦‚æœä¸¤ä¸ªåœ°æ–¹éƒ½è¿›è¡Œäº†è®¾ç½®ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ã€‚</p><p>è¯¥æŒ‡ä»¤çš„ä½¿ç”¨æ­¥éª¤:</p><ol><li>è¿›å…¥é…ç½®æ–‡ä»¶æ·»åŠ ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ ã€ www ã€</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user www</span><br></pre></td></tr></table></figure><p>æµ‹è¯•è¿›è¡Œæµ‹è¯•é…ç½®æ–‡ä»¶ä¼šæŠ¥é”™ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master conf]<span class="comment"># nginx -t</span></span><br><span class="line">nginx: [emerg] getpwnam(<span class="string">"www"</span>) failed <span class="keyword">in</span> /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf:1</span><br><span class="line">nginx: configuration file /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf <span class="built_in">test</span> failed</span><br></pre></td></tr></table></figure><p>åŸå› åœ¨äº Linux ç³»ç»Ÿä¸å­˜åœ¨ www ç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå®ƒã€‚</p><ol start="2"><li>åˆ›å»ºä¸€ä¸ªç”¨æˆ·</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd www</span><br></pre></td></tr></table></figure><ol start="3"><li>é‡å¯ Nginx çš„é…ç½®æ–‡ä»¶</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é‡å¯æ˜¯å¦ç”Ÿæ•ˆ</span></span><br><span class="line">ps -ef | grep nginx</span><br></pre></td></tr></table></figure><p>æœ€åè¿”å›çš„ç»“æœç”± root ç”¨æˆ·æ”¹ä¸º www ç”¨æˆ·ï¼Œä»£è¡¨é…ç½®æˆåŠŸã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master conf]<span class="comment"># ps -ef | grep nginx</span></span><br><span class="line">root       8960      1  0 16:13 ?        00:00:00 nginx: master process ./nginx</span><br><span class="line">www       11975   8960  0 20:44 ?        00:00:00 nginx: worker process</span><br><span class="line">root      11978  10615  0 20:44 pts/1    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure><ol start="4"><li>åœ¨ Linux çš„ <code>/root</code> ä¸‹åˆ›å»ºä¸€ä¸ª html ç›®å½•ï¼Œå¹¶ä¸”è¿›å…¥ html ç›®å½•ï¼Œåˆ›å»º index.html æ–‡ä»¶</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/html</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/html</span><br><span class="line"></span><br><span class="line">vim index.html</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ <code>/root/html/index.html</code> æ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.org/"</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Commercial support is available at</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://nginx.com/"</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>I am WWW<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™äº›å†…å®¹å…¶å®å°±æ˜¯åœ¨ Nginx çš„æ¬¢è¿é¡µé¢ä¸Šå¤šåŠ åˆ« <code>I am WWW</code> å†…å®¹ã€‚</p><ol start="5"><li>ä¿®æ”¹ nginx.conf</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="comment"># root   html;  # åŸå§‹çš„ä»£ç æ³¨é‡Šæ‰</span></span><br><span class="line"><span class="attribute">root</span>   /root/html;    <span class="comment"># ä¸å†æ˜¯ html ç›®å½•ï¼Œè€Œæ˜¯ root ä¸‹çš„ html ç›®å½•</span></span><br><span class="line"><span class="attribute">index</span>  index.html index.htm;  <span class="comment"># å°±æ˜¯ä¸Šæ–¹åˆ›å»ºçš„ index.html</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li><code>nginx -s reload</code>é‡æ–°åŠ è½½åï¼Œæµ‹è¯•å¯åŠ¨è®¿é—®</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220728/image.6dtnfz58zpo0.webp" alt="image"></p><p> é¡µé¢ä¼šæŠ¥ 403 æ‹’ç»è®¿é—®çš„é”™è¯¯ã€‚</p><ol start="7"><li>åˆ†æåŸå› ï¼šå› ä¸ºå½“å‰ç”¨æˆ·ï¼ˆwww ç”¨æˆ·ï¼‰æ²¡æœ‰è®¿é—® <code>/root/html</code> ç›®å½•çš„æƒé™ï¼Œè¿™ä¸ªç›®å½•åªæœ‰ root æ‰èƒ½è®¿é—®ã€‚</li></ol><p>é‚£ä¹ˆ www å¦‚ä½•è®¿é—®æˆ‘ä»¬å†™çš„ index.html é¡µé¢å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œæ¯æ–°å»ºä¸€ä¸ªç”¨æˆ·ï¼Œ<code>/home</code> ä¸‹éƒ½ä¼šç”Ÿæˆè¯¥ç”¨æˆ·æƒé™çš„ç›®å½•ã€‚</p><ol start="8"><li>å°†æ–‡ä»¶ç§»åŠ¨åˆ° <code>/home/www/html/index.html</code></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /root/html /home/www</span><br></pre></td></tr></table></figure><ol start="9"><li>è®°å¾—ä¿®æ”¹é…ç½®æ–‡ä»¶çš„èµ„æºå†…å®¹</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="comment"># root   html;  # åŸå§‹çš„ä»£ç æ³¨é‡Šæ‰</span></span><br><span class="line"><span class="comment"># root   /root/html;   # è¿™å±äº root æƒé™çš„é¡µé¢ï¼Œæ³¨é‡Šæˆ–è€…åˆ é™¤æ‰</span></span><br><span class="line"><span class="attribute">root</span>   /home/www/html;  <span class="comment"># è¿™æ˜¯ www ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„ç›®å½•</span></span><br><span class="line"><span class="attribute">index</span>  index.html index.htm;   <span class="comment"># è®¿é—®äº† html ç›®å½•ï¼Œç„¶åè®¿é—® index.html æ–‡ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="10"><li>å†æ¬¡æµ‹è¯•å¯åŠ¨è®¿é—®ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®ã€‚</li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨ user æŒ‡ä»¤å¯ä»¥æŒ‡å®šå¯åŠ¨è¿è¡Œå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·åŠç”¨æˆ·ç»„ï¼Œè¿™æ ·å¯¹äºç³»ç»Ÿçš„æƒé™è®¿é—®æ§åˆ¶çš„æ›´åŠ ç²¾ç»†ï¼Œä¹Ÿæ›´åŠ å®‰å…¨ã€‚</p><p>æˆ‘ä»¬ä¹Ÿèƒ½ç†è§£äº†é…ç½®æ–‡ä»¶çš„ <code>locaotion</code> å—çš„åŸºæœ¬ä½¿ç”¨ï¼Œroot å¯¹åº”ç€è®¿é—®ç›®å½•ï¼Œindex å¯¹åº”ç€è®¿é—®ç›®å½•ä¸‹çš„é»˜è®¤é¡µé¢ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220728/image.6igjptnd6eo0.webp" alt="image"></p><h3 id="work-processæŒ‡ä»¤"><a href="#work-processæŒ‡ä»¤" class="headerlink" title="work processæŒ‡ä»¤"></a>work processæŒ‡ä»¤</h3><ol><li><code>master_process</code> æŒ‡ä»¤ç”¨æ¥æŒ‡å®šæ˜¯å¦å¼€å¯ worker å·¥ä½œè¿›ç¨‹ã€‚</li></ol><p>å¦‚æœä¸º offï¼Œåˆ™ä»£è¡¨å…³é—­äº† worker è¿›ç¨‹ï¼Œè¿™æ—¶å€™å¯åŠ¨ Nginxï¼Œåªæœ‰ master è¿›ç¨‹å¯åŠ¨ï¼Œæ²¡æœ‰ worker è¿›ç¨‹ã€‚é»˜è®¤å¼€å¯ worker å·¥ä½œè¿›ç¨‹ã€‚(<mark>éœ€è¦é‡å¯nginxæœåŠ¡ç”Ÿæ•ˆ</mark>)</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>master_process &lt;on | off&gt;;</td><td>master_process on;</td><td>å…¨å±€å—</td></tr></tbody></table><ol start="2"><li><p><code>worker_processes</code> æŒ‡ä»¤ç”¨äºé…ç½® Nginx ç”Ÿæˆ worker å·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œè¿™ä¸ªæ˜¯ Nginx æœåŠ¡å™¨å®ç°å¹¶å‘å¤„ç†</p><p>æœåŠ¡çš„å…³é”®æ‰€åœ¨ã€‚</p></li></ol><p>ç†è®ºä¸Šæ¥è¯´ <code>workder process</code> çš„å€¼è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒçš„å¹¶å‘å¤„ç†é‡ä¹Ÿè¶Šå¤šï¼Œä½†äº‹å®ä¸Šè¿™ä¸ªå€¼çš„è®¾å®šæ˜¯éœ€è¦å—åˆ°æ¥è‡ªæœåŠ¡å™¨è‡ªèº«çš„é™åˆ¶ï¼Œå»ºè®®å°†è¯¥å€¼å’ŒæœåŠ¡å™¨ CPU çš„å†…æ ¸æ•°ä¿å­˜ä¸€è‡´ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>worker_processes &lt;num | auto&gt;;</td><td>1</td><td>å…¨å±€å—</td></tr></tbody></table><p>å¦‚æœå°† <code>worker_processes</code> è®¾ç½®æˆ 2ï¼Œåˆ™ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master conf]<span class="comment"># ps -ef | grep nginx</span></span><br><span class="line">root       8960      1  0 16:13 ?        00:00:00 nginx: master process ./nginx</span><br><span class="line">www       12299   8960  0 21:14 ?        00:00:00 nginx: worker process</span><br><span class="line">www       12300   8960  0 21:14 ?        00:00:00 nginx: worker process</span><br><span class="line">root      12302  10615  0 21:14 pts/1    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure><p>å‡ºç°ä¸¤ä¸ª worker å·¥ä½œè¿›ç¨‹ã€‚</p><h3 id="å…¶ä»–æŒ‡ä»¤"><a href="#å…¶ä»–æŒ‡ä»¤" class="headerlink" title="å…¶ä»–æŒ‡ä»¤"></a>å…¶ä»–æŒ‡ä»¤</h3><ol><li><code>daemon</code> æŒ‡ä»¤è®¾ç½® Nginx æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼å¯åŠ¨ã€‚on ä»£è¡¨å¼€å¯å®ˆæŠ¤è¿›ç¨‹ï¼Œoff ä»£è¡¨å…³é—­å®ˆæŠ¤è¿›ç¨‹ï¼Œé»˜è®¤å¼€å¯ã€‚(<mark>éœ€è¦é‡å¯nginxç”Ÿæ•ˆ</mark>)</li></ol><p>å®ˆæŠ¤å¼è¿›ç¨‹æ˜¯ Linux åå°æ‰§è¡Œçš„ä¸€ç§æœåŠ¡è¿›ç¨‹ï¼Œç‰¹ç‚¹æ˜¯ <strong>ç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯ï¼Œä¸ä¼šéšç€ç»ˆç«¯å…³é—­è€Œåœæ­¢</strong>ï¼Œä¹Ÿå°±æ˜¯åå°å¯åŠ¨ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>daemon &lt;on | off&gt;;</td><td>daemon on;</td><td>å…¨å±€å—</td></tr></tbody></table><ol start="2"><li><code>pid</code> æŒ‡ä»¤ç”¨æ¥é…ç½® Nginx å½“å‰ master è¿›ç¨‹çš„è¿›ç¨‹å· ID å­˜å‚¨çš„æ–‡ä»¶è·¯å¾„ã€‚é»˜è®¤è·¯å¾„æ˜¯ <code>/usr/local/nginx/logs/nginx.pid</code>ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>pid &lt;file&gt;;</td><td>/usr/local/nginx/logs/nginx.pid</td><td>å…¨å±€å—</td></tr></tbody></table><p>è¯¥å±æ€§ä¹Ÿå¯ä»¥é€šè¿‡ <code>./configure --pid-path=PATH</code> åœ¨ç¼–è¯‘æ—¶æ¥æŒ‡å®šã€‚</p><ol start="3"><li><code>error_log</code> æŒ‡ä»¤ç”¨æ¥é…ç½® Nginx çš„é”™è¯¯æ—¥å¿—å­˜æ”¾è·¯å¾„ã€‚é»˜è®¤è·¯å¾„æ˜¯ <code>/usr/local/nginx/logs/error.log</code>ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>error_log &lt;file&gt; [æ—¥å¿—çº§åˆ«];</td><td>error_log logs/error.log error;</td><td>å…¨å±€å—ã€httpã€serverã€location</td></tr></tbody></table><p>è¯¥å±æ€§ä¹Ÿå¯ä»¥é€šè¿‡ <code>./configure --error-log-path=PATH</code> åœ¨ç¼–è¯‘æ—¶æ¥æŒ‡å®šã€‚</p><p>å…¶ä¸­æ—¥å¿—çº§åˆ«çš„å€¼æœ‰ã€ debug | info | notice | warn | error | crit | alert | emerg ã€ï¼Œç¿»è¯‘è¿‡æ¥ä¸ºã€Œè°ƒè¯• | ä¿¡æ¯ | é€šçŸ¥ | è­¦å‘Š | é”™è¯¯ | ä¸´ç•Œ | è­¦æŠ¥ | ç´§æ€¥ã€ï¼Œè¿™å—å»ºè®®å¤§å®¶è®¾ç½®çš„æ—¶å€™ä¸è¦è®¾ç½®æˆ info ä»¥ä¸‹çš„ç­‰çº§ï¼Œå› ä¸ºä¼šå¸¦æ¥å¤§é‡çš„ç£ç›˜ I/O æ¶ˆè€—ï¼Œå½±å“ Nginx çš„æ€§èƒ½ã€‚</p><ol start="4"><li><code>include</code> æŒ‡ä»¤ç”¨æ¥å¼•å…¥å…¶ä»–çš„é…ç½®æ–‡ä»¶ï¼Œä½¿ Nginx çš„é…ç½®æ›´åŠ çµæ´»ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>include &lt;file&gt;;</td><td>æ— </td><td>any</td></tr></tbody></table><h2 id="eventså—"><a href="#eventså—" class="headerlink" title="eventså—"></a>eventså—</h2><h3 id="eventsæŒ‡ä»¤"><a href="#eventsæŒ‡ä»¤" class="headerlink" title="eventsæŒ‡ä»¤"></a>eventsæŒ‡ä»¤</h3><ol><li><code>accept_mutex</code> æŒ‡ä»¤ç”¨æ¥è®¾ç½®æ˜¯å¦å¼€å¯ Nginx ç½‘ç»œè¿æ¥åºåˆ—åŒ–ã€‚é»˜è®¤å¼€å¯ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>accept_mutex &lt;on | off&gt;;</td><td>accept_mutex on;</td><td>events</td></tr></tbody></table><p>è¿™ä¸ªé…ç½®ä¸»è¦å¯ä»¥ç”¨æ¥è§£å†³å¸¸è¯´çš„ã€ŒæƒŠç¾¤ã€é—®é¢˜ã€‚å¤§è‡´æ„æ€æ˜¯åœ¨æŸä¸€ä¸ªæ—¶åˆ»ï¼Œå®¢æˆ·ç«¯å‘æ¥ä¸€ä¸ªè¯·æ±‚è¿æ¥ï¼ŒNginx åå°æ˜¯ä»¥å¤šè¿›ç¨‹çš„å·¥ä½œæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰å¤šä¸ª worker è¿›ç¨‹ä¼šè¢«åŒæ—¶å”¤é†’ï¼Œä½†æ˜¯æœ€ç»ˆåªä¼šæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è·å–åˆ°è¿æ¥ï¼Œå¦‚æœæ¯æ¬¡å”¤é†’çš„è¿›ç¨‹æ•°ç›®å¤ªå¤šï¼Œå°±ä¼šå½±å“ Nginx çš„æ•´ä½“æ€§èƒ½ã€‚å¦‚æœå°†ä¸Šè¿°å€¼è®¾ç½®ä¸º on (å¼€å¯çŠ¶æ€)ï¼Œå°†ä¼šå¯¹å¤šä¸ª Nginx è¿›ç¨‹æ¥æ”¶è¿æ¥è¿›è¡Œåºåˆ—å·ï¼Œä¸€ä¸ªä¸ªæ¥å”¤é†’æ¥æ”¶ï¼Œå°±é˜²æ­¢äº†å¤šä¸ªè¿›ç¨‹å¯¹è¿æ¥çš„äº‰æŠ¢ã€‚</p><p>å¦‚å›¾çš„å°ç‹—ï¼Œå¦‚æœåªæ˜¯ä¸€å—ã€Œéª¨å¤´ã€å‡ºç°ï¼Œåˆ™åªéœ€è¦å”¤é†’ä¸€ä¸ªå°ç‹—å³å¯ï¼ˆå¼€å¯ onï¼‰ï¼Œå¦‚æœå¤šä¸ªã€Œéª¨å¤´ã€å¦‚ä¸‰ä¸ªåŒæ—¶å‡ºç°ï¼Œé‚£ä¹ˆå”¤é†’ä¸‰ä¸ªå°ç‹—æ•ˆç‡æ›´é«˜ï¼ˆæ­¤æ—¶éœ€è¦è®¾ç½® offï¼‰</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220728/image.118zwwf8v268.webp" alt="image"></p><ol start="2"><li><code>multi_accept</code> æŒ‡ä»¤ç”¨æ¥è®¾ç½®æ˜¯å¦å¼€å¯åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥ã€‚é»˜è®¤å¼€å¯ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>multi_accept &lt;on | off&gt;;</td><td>multi_accept off;</td><td>events</td></tr></tbody></table><p>å¦‚æœ multi_accept è¢«ç¦æ­¢äº†ï¼ŒNginx çš„ä¸€ä¸ªå·¥ä½œè¿›ç¨‹åªèƒ½åŒæ—¶æ¥å—ä¸€ä¸ªæ–°çš„è¿æ¥ã€‚å¦‚æœå¼€å¯ï¼Œä¸€ä¸ªå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶æ¥å—æ‰€æœ‰çš„æ–°è¿æ¥ã€‚<strong>å»ºè®®å¼€å¯ã€‚</strong></p><ol start="3"><li><code>worker_connections</code> æŒ‡ä»¤ç”¨æ¥é…ç½®å•ä¸ª worker è¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•°ã€‚é»˜è®¤ 512 ä¸ªè¿æ¥æ•°ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>worker_connections &lt;number&gt;;</td><td>worker_commections 512;</td><td>events</td></tr></tbody></table><p>è¿™é‡Œçš„è¿æ¥æ•°ä¸ä»…ä»…åŒ…æ‹¬å’Œå‰ç«¯ç”¨æˆ·å»ºç«‹çš„è¿æ¥æ•°ï¼Œè€Œæ˜¯åŒ…æ‹¬æ‰€æœ‰å¯èƒ½çš„è¿æ¥æ•°ã€‚å¦å¤–ï¼Œnumber å€¼ä¸èƒ½å¤§äºæ“ä½œç³»ç»Ÿæ”¯æŒæ‰“å¼€çš„æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°é‡ã€‚</p><ol start="4"><li><code>use</code> æŒ‡ä»¤ç”¨æ¥è®¾ç½® Nginx æœåŠ¡å™¨é€‰æ‹©å“ªç§äº‹ä»¶é©±åŠ¨æ¥å¤„ç†ç½‘ç»œæ¶ˆæ¯ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>use &lt;method&gt;;</td><td>æ ¹æ®æ“ä½œç³»ç»Ÿè§„å®š</td><td>events</td></tr></tbody></table><p>æ³¨æ„ï¼šæ­¤å¤„æ‰€é€‰æ‹©äº‹ä»¶å¤„ç†æ¨¡å‹æ˜¯ Nginx ä¼˜åŒ–éƒ¨åˆ†çš„ä¸€ä¸ªé‡è¦å†…å®¹ï¼Œmethod çš„å¯é€‰å€¼æœ‰ã€ select | poll | epoll | kqueue ã€ç­‰ï¼Œä¹‹å‰åœ¨å‡†å¤‡ Centos ç¯å¢ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¼ºè°ƒè¿‡è¦ä½¿ç”¨ Linux å†…æ ¸åœ¨ 2.6 ä»¥ä¸Šï¼Œå°±æ˜¯ä¸ºäº†èƒ½ä½¿ç”¨ epoll å‡½æ•°æ¥ä¼˜åŒ– Nginxã€‚</p><p>å¦å¤–è¿™äº›å€¼çš„é€‰æ‹©ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨ <code>--with-select_module</code>ã€<code>--without-select_module</code>ã€<code>--with-poll_module</code>ã€<code>--without-poll_module</code> æ¥è®¾ç½®æ˜¯å¦éœ€è¦å°†å¯¹åº”çš„äº‹ä»¶é©±åŠ¨æ¨¡å—ç¼–è¯‘åˆ° Nginx çš„å†…æ ¸ã€‚</p><h3 id="eventsæŒ‡ä»¤é…ç½®æ¨¡æ¿"><a href="#eventsæŒ‡ä»¤é…ç½®æ¨¡æ¿" class="headerlink" title="eventsæŒ‡ä»¤é…ç½®æ¨¡æ¿"></a>eventsæŒ‡ä»¤é…ç½®æ¨¡æ¿</h3><p>æ‰“å¼€ Nginx çš„é…ç½®æ–‡ä»¶ nginx.confï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">events&#123;</span><br><span class="line"><span class="attribute">accept_mutex</span> <span class="literal">on</span>;    <span class="comment"># å¼€å¯ Nginx ç½‘ç»œè¿æ¥åºåˆ—åŒ–</span></span><br><span class="line"><span class="attribute">multi_accept</span> <span class="literal">on</span>;    <span class="comment"># å¼€å¯åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥</span></span><br><span class="line"><span class="attribute">worker_commections</span> <span class="number">1024</span>;   <span class="comment"># å•ä¸ª worker è¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•°</span></span><br><span class="line"><span class="attribute">use</span> <span class="literal">epoll</span>;   <span class="comment"># ä½¿ç”¨ epoll å‡½æ•°æ¥ä¼˜åŒ– Nginx</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æµ‹è¯•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æµ‹è¯•é…ç½®æ˜¯å¦è¯­æ³•å‡ºé”™</span></span><br><span class="line">nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½ Nginx</span></span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h2 id="httpå—"><a href="#httpå—" class="headerlink" title="httpå—"></a>httpå—</h2><h3 id="å®šä¹‰MIME-Type"><a href="#å®šä¹‰MIME-Type" class="headerlink" title="å®šä¹‰MIME-Type"></a>å®šä¹‰MIME-Type</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“æµè§ˆå™¨ä¸­å¯ä»¥æ˜¾ç¤ºçš„å†…å®¹æœ‰ HTMLã€XMLã€GIF ç­‰ç§ç±»ç¹å¤šçš„æ–‡ä»¶ã€åª’ä½“ç­‰èµ„æºï¼Œæµè§ˆå™¨ä¸ºäº†åŒºåˆ†è¿™äº›èµ„æºï¼Œå°±éœ€è¦ä½¿ç”¨ MIME Typeã€‚æ‰€ä»¥è¯´ MIME Type æ˜¯ç½‘ç»œèµ„æºçš„åª’ä½“ç±»å‹ã€‚Nginx ä½œä¸º Web æœåŠ¡å™¨ï¼Œä¹Ÿéœ€è¦èƒ½å¤Ÿè¯†åˆ«å‰ç«¯è¯·æ±‚çš„èµ„æºç±»å‹ã€‚</p><p>åœ¨ Nginx çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé»˜è®¤æœ‰ä¸¤è¡Œé…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include mime.types;      <span class="comment"># å¼•å…¥ mime.types æ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line">default_type application/octet-stream;     <span class="comment"># é»˜è®¤çš„ MIME ç±»å‹</span></span><br></pre></td></tr></table></figure><ol><li><code>default_type</code> æŒ‡ä»¤ç”¨æ¥é…ç½® Nginx å“åº”å‰ç«¯è¯·æ±‚é»˜è®¤çš„ MIME ç±»å‹ã€‚é»˜è®¤æ˜¯ text æ–‡æœ¬ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>default_type &lt;mime-type&gt;;</td><td>default_type text/plain;</td><td>httpã€serverã€location</td></tr></tbody></table><p>åœ¨ <code>default_type</code> å‰é¢è¿˜æœ‰ä¸€å¥ <code>include mime.types</code>ï¼Œinclude ä¹‹å‰æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ï¼Œç›¸å½“äºæŠŠ mime.types æ–‡ä»¶ä¸­ MIMT ç±»å‹ä¸ç›¸å…³ç±»å‹æ–‡ä»¶çš„æ–‡ä»¶åç¼€åçš„å¯¹åº”å…³ç³»åŠ å…¥åˆ°å½“å‰çš„é…ç½®æ–‡ä»¶ä¸­ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´æ˜ï¼š</p><p>æœ‰äº›æ—¶å€™è¯·æ±‚æŸäº›æ¥å£çš„æ—¶å€™éœ€è¦è¿”å›æŒ‡å®šçš„æ–‡æœ¬å­—ç¬¦ä¸²æˆ–è€… json å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯é¡µé¢ï¼Œå¦‚æœé€»è¾‘éå¸¸ç®€å•æˆ–è€…å¹²è„†æ˜¯å›ºå®šçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ Nginx å¿«é€Ÿå®ç°ï¼Œè¿™æ ·å°±ä¸ç”¨ç¼–å†™ç¨‹åºå“åº”è¯·æ±‚äº†ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨èµ„æºå ç”¨å¹¶ä¸”å“åº”æ€§èƒ½éå¸¸å¿«ã€‚</p><p>å¦‚ä½•å®ç°ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /get_text &#123;</span><br><span class="line">    <span class="attribute">default_type</span> text/html;      <span class="comment"># ç­‰ä»·äº text/plainï¼Œè¿”å›æ–‡æœ¬ç±»å‹</span></span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">"&lt;h1&gt;This is nginx's text&lt;/h1&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /get_json&#123;</span><br><span class="line">    <span class="attribute">default_type</span> application/json;   <span class="comment"># è¿”å› json å­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&#123;"name": "xiaoming", "age": 21&#125;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220728/image.1joqriwre9j4.webp" alt="image"></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220728/image.47ty7dkhzmi0.webp" alt="image"></p><h3 id="è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—"><a href="#è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—" class="headerlink" title="è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—"></a>è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—</h3><p>Nginx ä¸­æ—¥å¿—çš„ç±»å‹åˆ† access.logã€error.logã€‚</p><p><code>access.log</code> æ—¥å¿—ç”¨æ¥è®°å½•ç”¨æˆ·æ‰€æœ‰çš„è®¿é—®è¯·æ±‚ã€‚</p><p><code>error.log</code> æ—¥å¿—è®°å½• Nginx æœ¬èº«è¿è¡Œæ—¶çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šè®°å½•ç”¨æˆ·çš„è®¿é—®è¯·æ±‚ã€‚</p><p>Nginx æœåŠ¡å™¨æ”¯æŒå¯¹æœåŠ¡æ—¥å¿—çš„æ ¼å¼ã€å¤§å°ã€è¾“å‡ºç­‰è¿›è¡Œè®¾ç½®ï¼Œéœ€è¦ä½¿ç”¨åˆ°ä¸¤ä¸ªæŒ‡ä»¤ï¼Œåˆ†åˆ«æ˜¯ <code>access_log</code> å’Œ <code>log_format</code> æŒ‡ä»¤ã€‚</p><ol><li><code>access_log</code> æŒ‡ä»¤ç”¨æ¥è®¾ç½®ç”¨æˆ·è®¿é—®æ—¥å¿—çš„ç›¸å…³å±æ€§ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>access_log &lt;path&gt; [format[buffer=size]];</td><td>access_log logs/access.log combined;</td><td>httpã€serverã€location</td></tr></tbody></table><p>format å¯¹åº”ç€ <code>log_format</code> çš„ nameï¼Œå¿…é¡»ä¿æŒä¸€è‡´ã€‚</p><ol start="2"><li><code>log_format</code> æŒ‡ä»¤ç”¨æ¥æŒ‡å®šæ—¥å¿—çš„è¾“å‡ºæ ¼å¼ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>log_format &lt;name&gt; [escape=default | json | none] &lt;string&gt; â€¦â€¦ ;</td><td>log_format combined â€œâ€¦â€;</td><td>http</td></tr></tbody></table><p>name å¯¹ç”¨ <code>access_log</code> çš„ formatï¼Œå¿…é¡»ä¿æŒä¸€è‡´ã€‚</p><blockquote><p><strong>ä¾‹å­ 1ï¼šè‡ªå®šä¹‰æ—¥å¿—è·¯å¾„å’Œè¾“å‡ºæ ¼å¼</strong></p></blockquote><ul><li>åœ¨ <code>/usr/local/nginx/logs</code> ä¸‹åˆ›å»º my.log æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä½œä¸ºæ—¥å¿—ã€‚</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/<span class="built_in">local</span>/nginx/logs/my.log</span><br></pre></td></tr></table></figure><ul><li>è‡ªå®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š<code>==========&gt;This is My format</code></li><li>åœ¨é…ç½®æ–‡ä»¶é…ç½®ç›¸å…³æŒ‡ä»¤</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">log_format</span> myformat <span class="string">'=========&gt;This is My format'</span>;</span><br><span class="line"><span class="attribute">access_log</span> logs/my.log myformat;</span><br></pre></td></tr></table></figure><ul><li>é‡å¯æœåŠ¡å¹¶è¿›è¡Œæµ‹è¯•</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å¯ Nginx æœåŠ¡</span></span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›‘å¬æ—¥å¿—</span></span><br><span class="line">tail -f /usr/<span class="built_in">local</span>/nginx/logs/my.log</span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—®ä¸€æ¬¡ Nginx çš„æ¬¢è¿é¡µé¢ï¼Œå›æ¥çœ‹æ—¥å¿—çš„è¾“å‡ºï¼Œç»“æœå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220728/image.5t1f8j2rclc0.webp" alt="image"></p><blockquote><p><strong>ä¾‹å­ 2ï¼šè¾“å‡ºå†…å®¹åŠ ä¸Šè®¿é—®æœºå™¨çš„ä¿¡æ¯</strong></p></blockquote><ul><li>è¿›å…¥é…ç½®æ–‡ä»¶ï¼Œåœ¨è¾“å‡ºæ ¼å¼ä¸ŠåŠ ä¸Š Nginx çš„å†…ç½®å‚æ•°</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">log_format</span> myformat <span class="string">'=========&gt;This is My format:<span class="variable">$http_user_agent</span>'</span>;</span><br><span class="line"><span class="attribute">access_log</span> logs/my.log myformat;</span><br></pre></td></tr></table></figure><ul><li>é‡å¯æµ‹è¯•</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å¯ Nginx æœåŠ¡</span></span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›‘å¬æ—¥å¿—</span></span><br><span class="line">tail -f /usr/<span class="built_in">local</span>/nginx/logs/my.log</span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—®ä¸€æ¬¡ Nginx çš„æ¬¢è¿é¡µé¢ï¼Œå›æ¥çœ‹æ—¥å¿—çš„è¾“å‡ºï¼Œç»“æœå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220728/image.2rkljjc3tlk0.webp" alt="image"></p><h3 id="å…¶ä»–é…ç½®æŒ‡ä»¤"><a href="#å…¶ä»–é…ç½®æŒ‡ä»¤" class="headerlink" title="å…¶ä»–é…ç½®æŒ‡ä»¤"></a>å…¶ä»–é…ç½®æŒ‡ä»¤</h3><ol><li><code>sendfile</code>ï¼šç”¨æ¥è®¾ç½® Nginx æœåŠ¡å™¨æ˜¯å¦ä½¿ç”¨ sendfile ä¼ è¾“æ–‡ä»¶ï¼Œè¯¥å±æ€§å¯ä»¥å¤§å¤§æé«˜ Nginx å¤„ç†é™æ€èµ„æºçš„æ€§èƒ½ã€‚é»˜è®¤å…³é—­ï¼Œå»ºè®®å¼€å¯ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>sendfile &lt;on | off&gt;;</td><td>sendfile off;</td><td>httpã€serverã€location</td></tr></tbody></table><ol start="2"><li><code>keepalive_timeout</code>ï¼šç”¨æ¥è®¾ç½®é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯ 75 ç§’ã€‚</li></ol><p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ keepaliveï¼Ÿ</strong></p><p>æˆ‘ä»¬éƒ½çŸ¥é“ HTTP æ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ª TCP è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å“åº”å®Œæ¯•åæ–­å¼€è¿æ¥ã€‚</p><p>å¦‚ä½•å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¤šä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦é‡æ–°åˆ›å»ºä¸€æ¬¡è¿æ¥ï¼Œæ•ˆç‡ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤šï¼Œä½¿ç”¨ keepalive æ¨¡å¼ï¼Œå¯ä»¥å‘Šè¯‰æœåŠ¡å™¨ç«¯åœ¨å¤„ç†å®Œä¸€ä¸ªè¯·æ±‚åä¿æŒè¿™ä¸ª TCP è¿æ¥çš„æ‰“å¼€çŠ¶æ€ï¼Œè‹¥æ¥æ”¶åˆ°æ¥è‡ªè¿™ä¸ªå®¢æˆ·ç«¯çš„å…¶ä»–è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å°±ä¼šåˆ©ç”¨è¿™ä¸ªæœªè¢«å…³é—­çš„è¿æ¥ï¼Œè€Œä¸éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°è¿æ¥ï¼Œæå‡æ•ˆç‡ï¼Œä½†æ˜¯è¿™ä¸ªè¿æ¥ä¹Ÿä¸èƒ½ä¸€ç›´ä¿æŒï¼Œè¿™æ ·çš„è¯ï¼Œè¿æ¥å¦‚æœè¿‡å¤šï¼Œä¹Ÿä¼šæ˜¯æœåŠ¡ç«¯çš„æ€§èƒ½ä¸‹é™ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬è¿›è¡Œè®¾ç½®å…¶çš„è¶…æ—¶æ—¶é—´ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>keepalive_timeout &lt;time&gt;;</td><td>keepalive_timeout 75s;</td><td>httpã€serverã€location</td></tr></tbody></table><ol start="3"><li><code>keepalive_requests</code>ï¼šç”¨æ¥è®¾ç½®ä¸€ä¸ª keep-alive è¿æ¥ä½¿ç”¨çš„æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯ 100 æ¬¡ã€‚</li></ol><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>keepalive_requests &lt;number&gt;;</td><td>keepalive_requests 100;</td><td>httpã€serverã€location</td></tr></tbody></table><h2 id="serverå—å’Œlocationå—"><a href="#serverå—å’Œlocationå—" class="headerlink" title="serverå—å’Œlocationå—"></a>serverå—å’Œlocationå—</h2><p>server å—å’Œ location å—éƒ½æ˜¯æˆ‘ä»¬è¦é‡ç‚¹å­¦ä¹ çš„å†…å®¹ï¼Œå› ä¸ºæˆ‘ä»¬åé¢ä¼šå¯¹ Nginx çš„åŠŸèƒ½è¿›è¡Œè¯¦ç»†è®²è§£ï¼Œæ‰€ä»¥è¯¥å†…å®¹åœ¨<strong>é™æ€èµ„æºéƒ¨ç½²</strong>å’Œ<strong>é™æ€èµ„æºè®¿é—®</strong>è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚</p><p>æœ¬æ¬¡æˆ‘ä»¬è¿™æ˜¯è®¤è¯†ä¸‹ Nginx é»˜è®¤ç»™çš„ nginx.conf ä¸­çš„ç›¸å…³å†…å®¹ï¼Œä»¥åŠ server å—ä¸ location å—åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„çš„ä¸€äº›å†…å®¹ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span>       <span class="number">80</span>;     <span class="comment"># ç›‘å¬ 80 ç«¯å£ï¼Œå¦‚æœæ›´æ”¹ç«¯å£ï¼Œåˆ™å¤–ç•Œè®¿é—®çš„æ—¶å€™å¸¦ä¸Šå¯¹åº”çš„ç«¯å£å·ï¼Œå¦‚ 8080</span></span><br><span class="line"><span class="attribute">server_name</span>  localhost;  <span class="comment"># æŒ‡å®šå¯ä»¥è®¿é—® Nginx çš„ IP åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> / &#123;      </span><br><span class="line"><span class="attribute">root</span>   html;    <span class="comment"># è®¿é—®èµ„æºæ‰€å¯¹åº”çš„ç›®å½•ï¼Œè¿™é‡Œæ˜¯ html ç›®å½•</span></span><br><span class="line"><span class="attribute">index</span>  index.html index.htm;    <span class="comment"># è®¿é—®èµ„æºæ‰€å¯¹åº”ç›®å½•ä¸‹çš„é»˜è®¤é¡µé¢ï¼Œä¼˜å…ˆçº§é€’å¢</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> <span class="number">404</span>  /50x.html;  <span class="comment"># è®¿é—®é”™è¯¯ï¼Œè·³è½¬è®¿é—® /50x.html è¯·æ±‚</span></span><br><span class="line"><span class="attribute">location</span> = /50x.html &#123;   <span class="comment"># è®¿é—® /50x.html è¯·æ±‚çš„å¤„ç†</span></span><br><span class="line"><span class="attribute">root</span>   html;    <span class="comment"># è®¿é—®èµ„æºæ‰€å¯¹åº”çš„ç›®å½•ï¼Œè¿™é‡Œæ˜¯ html ç›®å½•çš„ 50x.html</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>listen å’Œ server_name æ˜¯æˆ‘ä»¬çš„ <code>http://server_name:listen</code>ï¼Œå¦‚ <code>http://localhost:80</code></li><li>location / å°±æ˜¯è®¿é—® <code>http://server_name:listen/</code>ï¼Œé‡Œé¢çš„é…ç½®å¯¹åº”ç€ <code>http://server_name:listen/html/index.html</code></li><li>é¡µé¢äº§ç”Ÿ 500 502 503 504 404ï¼Œå°±ä¼šå‘é€ <code>http://server_name:listen/50x.html</code></li><li>location = /50x.html å°±æ˜¯ <code>http://server_name:listen/50x.html</code>ï¼Œå®ƒä¼šè‡ªåŠ¨è®¿é—® <code>http://server_name:listen/html/50x.html</code></li><li>root ä»£è¡¨èµ„æºç›®å½•æŒ‡ä»¤</li><li>index ä»£è¡¨é»˜è®¤è®¿é—®ç½‘é¡µæŒ‡ä»¤</li></ul>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx é™æ€èµ„æºéƒ¨ç½²</title>
      <link href="/2022/11/10/Nginx_Static_resource_deployment/"/>
      <url>/2022/11/10/Nginx_Static_resource_deployment/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-é™æ€èµ„æºéƒ¨ç½²"><a href="#Nginx-é™æ€èµ„æºéƒ¨ç½²" class="headerlink" title="Nginx é™æ€èµ„æºéƒ¨ç½²"></a>Nginx é™æ€èµ„æºéƒ¨ç½²</h1><p><strong>å¼•è¨€</strong></p><p>é™æ€èµ„æºå¦‚ä½•éƒ¨ç½²ï¼Ÿæœ¬å†…å®¹å¸¦ä½ äº†è§£é™æ€èµ„æºç›¸å…³çš„æ“ä½œå’Œå†…å®¹ã€‚</p><p>é™æ€èµ„æºæŒ‡ä»¤é…ç½®ã€é™æ€èµ„æºä¼˜åŒ–é…ç½®ã€é™æ€èµ„æºå‹ç¼©é…ç½®ã€é™æ€èµ„æºç¼“å­˜é…ç½®ã€‚</p><h2 id="Nginxé™æ€èµ„æºæ¦‚è¿°"><a href="#Nginxé™æ€èµ„æºæ¦‚è¿°" class="headerlink" title="Nginxé™æ€èµ„æºæ¦‚è¿°"></a>Nginxé™æ€èµ„æºæ¦‚è¿°</h2><p>ä¸Šç½‘å»æœç´¢è®¿é—®èµ„æºå¯¹äºæˆ‘ä»¬æ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œé€šè¿‡æµè§ˆå™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚å®ç°ä»å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯è·å–æ‰€éœ€è¦å†…å®¹åå¹¶æŠŠå†…å®¹å›æ˜¾å±•ç¤ºåœ¨é¡µé¢çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ‰€è¯·æ±‚çš„å†…å®¹å°±åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¸€ç±»æ˜¯é™æ€èµ„æºã€ä¸€ç±»æ˜¯åŠ¨æ€èµ„æºã€‚</p><p>é™æ€èµ„æºå³æŒ‡åœ¨æœåŠ¡å™¨ç«¯çœŸå®å­˜åœ¨å¹¶ä¸”èƒ½ç›´æ¥æ‹¿æ¥å±•ç¤ºçš„ä¸€äº›æ–‡ä»¶ï¼Œæ¯”å¦‚å¸¸è§çš„ html é¡µé¢ã€css æ–‡ä»¶ã€js æ–‡ä»¶ã€å›¾ç‰‡ã€è§†é¢‘ç­‰èµ„æºï¼›</p><p>åŠ¨æ€èµ„æºå³æŒ‡åœ¨æœåŠ¡å™¨ç«¯çœŸå®å­˜åœ¨ä½†æ˜¯è¦æƒ³è·å–éœ€è¦ç»è¿‡ä¸€å®šçš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶å±•ç¤ºåœ¨é¡µé¢ä¸åŒè¿™ ä¸€éƒ¨åˆ†å†…å®¹ï¼Œæ¯”å¦‚è¯´æŠ¥è¡¨æ•°æ®å±•ç¤ºã€æ ¹æ®å½“å‰ç™»å½•ç”¨æˆ·å±•ç¤ºç›¸å…³å…·ä½“æ•°æ®ç­‰èµ„æºï¼›</p><p>Nginx å¤„ç†é™æ€èµ„æºçš„å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸‹é¢è¿™å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>é™æ€èµ„æºçš„é…ç½®æŒ‡ä»¤</li><li>é™æ€èµ„æºçš„é…ç½®ä¼˜åŒ–</li><li>é™æ€èµ„æºçš„å‹ç¼©é…ç½®æŒ‡ä»¤</li><li>é™æ€èµ„æºçš„ç¼“å­˜å¤„ç†</li><li>é™æ€èµ„æºçš„è®¿é—®æ§åˆ¶ï¼ŒåŒ…æ‹¬è·¨åŸŸé—®é¢˜å’Œé˜²ç›—é“¾é—®é¢˜</li></ul><h2 id="é™æ€èµ„æºæŒ‡ä»¤é…ç½®"><a href="#é™æ€èµ„æºæŒ‡ä»¤é…ç½®" class="headerlink" title="é™æ€èµ„æºæŒ‡ä»¤é…ç½®"></a>é™æ€èµ„æºæŒ‡ä»¤é…ç½®</h2><h3 id="listenæŒ‡ä»¤"><a href="#listenæŒ‡ä»¤" class="headerlink" title="listenæŒ‡ä»¤"></a>listenæŒ‡ä»¤</h3><p>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥é…ç½®ç›‘å¬ç«¯å£ã€‚é»˜è®¤ç›‘å¬ 80ï¼ˆroot å¯åŠ¨ Nginxï¼‰ å’Œ 8000ï¼ˆé root å¯åŠ¨ Nginxï¼‰ ç«¯å£ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>listen &lt;address&gt;[:port] [default_server] â€¦â€¦ ;<br> listen &lt;port&gt; [default_server] â€¦â€¦ ;</td><td>listen *:80 | *:8000</td><td>server</td></tr></tbody></table><p><code>listen</code> æŒ‡ä»¤çš„è®¾ç½®æ¯”è¾ƒçµæ´»ï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥æŠŠå¸¸ç”¨çš„è®¾ç½®æ–¹å¼ç†Ÿæ‚‰ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">listen 127.0.0.1:8000; <span class="comment"># listen localhost:8000 ç›‘å¬æŒ‡å®šçš„IPå’Œç«¯å£</span></span><br><span class="line">listen 127.0.0.1;<span class="comment"># ç›‘å¬æŒ‡å®šIPçš„æ‰€æœ‰ç«¯å£</span></span><br><span class="line">listen 8000;<span class="comment"># ç›‘å¬æŒ‡å®šç«¯å£ä¸Šçš„è¿æ¥</span></span><br><span class="line">listen *:8000;<span class="comment"># ç›‘å¬æŒ‡å®šç«¯å£ä¸Šçš„è¿æ¥</span></span><br></pre></td></tr></table></figure><p><code>default_server</code> å±æ€§æ˜¯æ ‡è¯†ç¬¦ï¼Œç”¨æ¥å°†æ­¤è™šæ‹Ÿä¸»æœºè®¾ç½®æˆé»˜è®¤ä¸»æœºã€‚æ‰€è°“çš„é»˜è®¤ä¸»æœºæŒ‡çš„æ˜¯å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°å¯¹åº”çš„ <code>address:port</code>ï¼Œåˆ™ä¼šæ‰§è¡Œé»˜è®¤çš„ serverã€‚å¦‚æœä¸æŒ‡å®šè¯¥æ ‡è¯†ç¬¦ï¼Œåˆæ²¡æœ‰åŒ¹é…åˆ°å¯¹åº”çš„ <code>address:port</code> æ—¶ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ç¬¬ä¸€ä¸ª serverï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ª server è¦å¥½å¥½è®¾ç½®ï¼Œå»ºè®®ç¬¬ä¸€ä¸ª server å°±åŠ ä¸Š <code>default_server</code>ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line"><span class="attribute">server_name</span> <span class="number">127.0.0.1</span>;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">root</span> html;</span><br><span class="line"><span class="attribute">index</span> index.html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8080</span> default_server;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">444</span> <span class="string">'This is a error request'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è®¿é—® 8080 ç«¯å£ï¼Œå®ƒä¼šè®¿é—®ç¬¬äºŒä¸ª serverï¼Œå¦‚æœç¬¬äºŒä¸ª server å»æ‰ <code>default_server</code> ï¼Œåˆ™é»˜è®¤è®¿é—®ç¬¬ä¸€ä¸ª serverã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220730/image.2e5c4uo1ghlw.webp" alt="image"></p><h3 id="server-nameæŒ‡ä»¤"><a href="#server-nameæŒ‡ä»¤" class="headerlink" title="server_nameæŒ‡ä»¤"></a>server_nameæŒ‡ä»¤</h3><p>è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®è™šæ‹Ÿä¸»æœºæœåŠ¡åç§°ã€‚é»˜è®¤ä¸ºç©ºã€‚</p><p>æ¯”å¦‚ 127.0.0.1ã€localhostã€åŸŸå[<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> | <a href="http://www.jd.com]ã€‚" target="_blank" rel="noopener">www.jd.com]ã€‚</a></p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>server_name &lt;name&gt; â€¦â€¦ ;</td><td>server_name â€œâ€;</td><td>server</td></tr></tbody></table><ul><li>name å¯ä»¥æä¾›å¤šä¸ªä¸­é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚</li></ul><p>å…³äº server_name çš„é…ç½®æ–¹å¼æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>ç²¾ç¡®åŒ¹é…</li><li>é€šé…ç¬¦åŒ¹é…</li><li>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</li></ul><blockquote><p><strong>é…ç½®æ–¹å¼ä¸€ï¼šç²¾ç¡®åŒ¹é…</strong></p></blockquote><p>å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.frx.com www.bing.com;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä»¥ <code>www.frx.com</code> æˆ–è€… <code>www.bing.com</code> åŸŸåè¿›è¡Œè®¿é—®ï¼Œå°±ä¼šè·³è½¬åˆ° Nginx çš„æ¬¢è¿é¡µé¢ï¼Œå‰ææ˜¯ä½ éœ€è¦æ‹¥æœ‰è¯¥åŸŸåï¼Œå¹¶ä¸”è¯¥åŸŸåå’Œ Nginx æ‰€åœ¨çš„ç³»ç»Ÿ IP è¿›è¡Œç»‘å®šã€‚</p><p>æ‰€ä»¥æˆ‘å¯ä»¥åˆ©ç”¨ hosts æ–‡ä»¶è¿›è¡Œã€Œæ¨¡æ‹Ÿã€åŸŸåã€‚</p><blockquote><p>è¡¥å……å°çŸ¥è¯†ç‚¹</p></blockquote><p>hosts æ˜¯ä¸€ä¸ªæ²¡æœ‰æ‰©å±•åçš„ç³»ç»Ÿæ–‡ä»¶ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬ç­‰å·¥å…·æ‰“å¼€ï¼Œå…¶ä½œç”¨å°±æ˜¯å°†ä¸€äº›å¸¸ç”¨çš„ç½‘å€åŸŸåä¸å…¶å¯¹åº”çš„IPåœ°å€å»ºç«‹ä¸€ä¸ªå…³è”ã€Œæ•°æ®åº“ã€ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªéœ€è¦ç™»å½•çš„ç½‘å€æ—¶ï¼Œç³»ç»Ÿä¼šé¦–å…ˆè‡ªåŠ¨ä» hosts æ–‡ä»¶ä¸­å¯»æ‰¾å¯¹åº”çš„IPåœ°å€ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œç³»ç»Ÿä¼šç«‹å³æ‰“å¼€å¯¹åº”ç½‘é¡µï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç³»ç»Ÿä¼šå†å°†ç½‘å€æäº¤ DNS åŸŸåè§£ææœåŠ¡å™¨è¿›è¡Œ IP åœ°å€çš„è§£æã€‚</p><p>hosts æ–‡ä»¶ä¸åŒç³»ç»Ÿçš„ä½ç½®ï¼š</p><ul><li>åœ¨ windows çš„ä½ç½®ï¼šC:\Windows\System32\drivers\etc</li><li>åœ¨ centos çš„ä½ç½®ï¼š/etc/hosts</li></ul><p>å› ä¸ºåŸŸåæ˜¯è¦æ”¶å–ä¸€å®šçš„è´¹ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¿®æ”¹ hosts æ–‡ä»¶æ¥åˆ¶ä½œä¸€äº›è™šæ‹ŸåŸŸåæ¥ä½¿ç”¨ã€‚éœ€è¦ä¿®æ”¹ <code>/etc/hosts</code> æ–‡ä»¶æ¥æ·»åŠ </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ hosts æ–‡ä»¶</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å†…å®¹</span></span><br><span class="line">127.0.0.1 www.frx.com</span><br><span class="line">127.0.0.1 www.bing.com</span><br></pre></td></tr></table></figure><ul><li>è®¿é—®æµ‹è¯•</li></ul><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220730/image.3nbv3p1703y0.webp" alt="image"></p><blockquote><p> <strong>é…ç½®æ–¹å¼äºŒï¼šä½¿ç”¨é€šé…ç¬¦é…ç½®</strong></p></blockquote><p>server_name æŒ‡ä»¤æ”¯æŒé€šé…ç¬¦ *ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯é€šé…ç¬¦ä¸èƒ½å‡ºç°åœ¨åŸŸåçš„ä¸­é—´ï¼Œåªèƒ½å‡ºç°åœ¨é¦–æ®µæˆ–å°¾æ®µï¼Œå¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span>  <span class="regexp">*.frx.com</span><span class="regexp">www.frx.*</span>;</span><br><span class="line"><span class="comment"># www.frx.cn abc.frx.cn www.bing.cn www.frx.com</span></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„é…ç½®å°±ä¼šæŠ¥é”™ï¼Œå› ä¸º * ä¸èƒ½å‡ºç°åœ¨åŸŸåçš„ä¸­é—´å’Œä¸å…¶ä»–å­—ç¬¦ä¸²è”ä½¿ç”¨</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span>  <span class="regexp">www.*</span>.cn www.frx.c*</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span>  .frx.com</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>.frx.com</code> ç›¸å½“äº <code>*..frx.com</code> + <code>frx.com</code></p><blockquote><p><strong>é…ç½®ä¸‰ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼é…ç½®</strong></p></blockquote><p>server_name æŒ‡ä»¤å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”ä½¿ç”¨ <code>~</code> ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²çš„å¼€å§‹æ ‡è®°ã€‚</p><p>å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><table><thead><tr><th>ä»£ç </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>^</td><td>åŒ¹é…æœç´¢å­—ç¬¦ä¸²å¼€å§‹ä½ç½®</td></tr><tr><td>$</td><td>åŒ¹é…æœç´¢å­—ç¬¦ä¸²ç»“æŸä½ç½®</td></tr><tr><td>.</td><td>åŒ¹é…é™¤æ¢è¡Œç¬¦ \n ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦</td></tr><tr><td>\</td><td>è½¬ä¹‰å­—ç¬¦ï¼Œå°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºç‰¹æ®Šå­—ç¬¦</td></tr><tr><td>[xyz]</td><td>å­—ç¬¦é›†ï¼Œä¸ä»»æ„ä¸€ä¸ªæŒ‡å®šå­—ç¬¦åŒ¹é…</td></tr><tr><td>[a-z]</td><td>å­—ç¬¦èŒƒå›´ï¼ŒåŒ¹é…æŒ‡å®šèŒƒå›´å†…çš„ä»»ä½•å­—ç¬¦</td></tr><tr><td>\w</td><td>ä¸ä»¥ä¸‹ä»»æ„å­—ç¬¦åŒ¹é… A-Z a-z 0-9 å’Œä¸‹åˆ’çº¿,ç­‰æ•ˆäº[A-Za-z0-9_]</td></tr><tr><td>\d</td><td>æ•°å­—å­—ç¬¦åŒ¹é…ï¼Œç­‰æ•ˆäº[0-9]</td></tr><tr><td>{n}</td><td>æ­£å¥½åŒ¹é… n æ¬¡</td></tr><tr><td>{n,}</td><td>è‡³å°‘åŒ¹é… n æ¬¡</td></tr><tr><td>{n,m}</td><td>åŒ¹é…è‡³å°‘ n æ¬¡è‡³å¤š m æ¬¡</td></tr><tr><td>*</td><td>é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œç­‰æ•ˆäº{0,}</td></tr><tr><td>+</td><td>ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œç­‰æ•ˆäº{1,}</td></tr><tr><td>?</td><td>é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œç­‰æ•ˆäº{0,1}</td></tr></tbody></table><p>é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> ~^www\.(\w+)\.com$;</span><br><span class="line">    <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="variable">$1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ ~ åé¢ä¸èƒ½åŠ ç©ºæ ¼</strong>ã€‚æ‹¬å·ä»£è¡¨å¯ä»¥åœ¨ Ngxin é…ç½®æ–‡ä»¶å†…è·å–å…¶ä¸­çš„å€¼ï¼Œå¦‚ä¸Šæ–¹çš„ (\w+) çš„å†…å®¹å¯ä»¥ç”¨ $1 è·å–åˆ°å‚æ•°ï¼Œå¦‚æœæœ‰å¤šä¸ªæ‹¬å·ï¼Œä¾æ¬¡ä½¿ç”¨ $2 $3 â€¦â€¦ è·å–ã€‚</p><p>æ¯”å¦‚ç°åœ¨è®¿é—® <code>http://www.frx.com</code>ï¼Œåˆ™è¿”å› frx åˆ°é¡µé¢ä¸Šï¼Œå› ä¸ºfrx è¢«æ”¾åœ¨ $1 å¤„ï¼š<code>return 200 frx</code>ã€‚</p><p>âš  è¿™é‡Œè¿›è¡Œè¯´æ˜ï¼šserver_name é…ç½®äº† localhost å’Œé…ç½® IP æˆ–è€…åŸŸåçš„åŒºåˆ«</p><p>localhost æ˜¯ã€Œè™šæ‹Ÿ IPã€ï¼Œå¦‚æœä¸æ˜¯æœ¬æœºè®¿é—®ï¼Œè€Œæ˜¯å¤–ç•Œè®¿é—®ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æ˜¯æ— æ•ˆçš„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå­¦ä¹ é˜¶æ®µçš„æ—¶å€™éƒ½ä¸æ”¹å‘¢ï¼Œå› ä¸ºå½“ Nginx æ²¡æœ‰åŒ¹é…åˆ°æŒ‡å®šçš„ <code>server_name</code>ï¼Œé»˜è®¤æ‰¾åˆ°ç¬¬ä¸€ä¸ª server å—ï¼Œè€Œ Nginx é»˜è®¤çš„ç¬¬ä¸€ä¸ª server å—å°±æ˜¯ localhostï¼Œå“ªæ€•ä½ æŠŠ localhost æ”¹ä¸ºå…¶ä»–çš„ï¼Œå¦‚ helloï¼Œå®ƒä¹Ÿèƒ½è®¿é—®ã€‚åªæ˜¯å› ä¸ºåœ¨åŒ¹é…ä¸åˆ°çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æ˜¯ç¬¬ä¸€ä¸ª service å—ï¼Œå“ªæ€•å®ƒç¡®å®å’Œè®¿é—®çš„ IP ä¸åŒ¹é…ã€‚</p><p>IP å¦‚æœå’ŒåŸŸåè¿›è¡Œäº†ç»‘å®šï¼Œé‚£ä¹ˆåœ¨ <code>server_name</code> ä¸­ï¼Œä¸¤è€…éƒ½å¯ä»¥å¡«å†™ï¼Œå¡«äº†åŸŸåï¼Œæœ€åä¹Ÿæ˜¯æ‰¾åˆ° IPï¼Œåªæ˜¯å› ä¸ºåŸŸåå¥½è®°ä½ã€‚</p><p>çŸ¥é“äº†åŒºåˆ«ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸Šï¼Œå¯ä»¥ç»™ä¸ªæŒ‡å®šçš„é”™è¯¯é¡µé¢ã€‚å¦‚æœåŒ¹é…ä¸ä¸Šï¼Œåˆ™è¿”å›å‹å¥½çš„æç¤ºï¼Œå¦‚ç¬¬ä¸€ä¸ª server å—ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">server_name</span> _;    <span class="comment"># åŒ¹é…ä¸ä¸Šçš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥å¡«å†™ localhost</span></span><br><span class="line">    <span class="attribute">return</span> <span class="string">"&lt;h1&gt;ä¸å¥½æ„æ€ï¼ŒåŒ¹é…ä¸åˆ°ï¼"</span>;</span><br><span class="line">    <span class="comment"># return 403;   # ä¹Ÿå¯ä»¥ç›´æ¥è¿”å›é”™è¯¯ç </span></span><br><span class="line">    <span class="comment"># </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> www.frxcat.fun;    <span class="comment"># åŒ¹é…åŸŸåè®¿é—®</span></span><br><span class="line">    <span class="comment"># ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å—åªå…è®¸åŸŸåè®¿é—®ï¼Œè€Œä¸å…è®¸ IP è®¿é—®ï¼Œé¿å…å…¶ä»–äººæŠŠæœªå¤‡æ¡ˆçš„åŸŸåè§£æåˆ°è‡ªå·±çš„æœåŠ¡å™¨ IPã€‚</p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸è®¾ç½®é”™è¯¯é¡µé¢ã€‚å› ä¸º Nginx åŒ¹é…ä¸ä¸Šæ—¶ï¼Œç›´æ¥è¿”å›å®ƒçš„æ¬¢è¿ç•Œé¢ã€‚</p><h3 id="åŒ¹é…æ‰§è¡Œé¡ºåº"><a href="#åŒ¹é…æ‰§è¡Œé¡ºåº" class="headerlink" title="åŒ¹é…æ‰§è¡Œé¡ºåº"></a>åŒ¹é…æ‰§è¡Œé¡ºåº</h3><p>ç”±äº server_name æŒ‡ä»¤æ”¯æŒé€šé…ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œå› æ­¤åœ¨åŒ…å«å¤šä¸ªè™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåç§°è¢«å¤šä¸ªè™šæ‹Ÿä¸»æœºçš„ server_name åŒ¹é…æˆåŠŸï¼Œå½“é‡åˆ°è¿™ç§æƒ…å†µï¼Œå½“å‰çš„è¯·æ±‚äº¤ç»™è°æ¥å¤„ç†å‘¢ï¼Ÿå¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> ~^www\.\w+\.com$;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">'regex_success'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> <span class="regexp">www.frx.*</span>;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">'wildcard_after_success'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> <span class="regexp">*.frx.com</span>;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">'wildcard_before_success'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> www.frx.com;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">'exact_success'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line"><span class="attribute">server_name</span> _;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">444</span> <span class="string">'default_server not found server'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <code>http://www.kele.com</code> çš„ä¼˜å…ˆçº§ï¼šï¼ˆè®¿é—®å®Œåè¯·æ³¨é‡Šæ‰å¤„ç†è¿™ä¸ªè¯·æ±‚çš„ serverï¼‰</p><ul><li>exact_successï¼ˆç¬¬ä¸€ä¸ªæ˜¯ç²¾ç¡®åŒ¹é…ï¼Œç„¶åæ³¨é‡Šæ‰è¯¥ serverï¼‰</li><li>wildcard_before_successï¼ˆç¬¬äºŒä¸ªæ˜¯å¼€å§‹åŒ¹é…ç¬¦ï¼Œç„¶åæ³¨é‡Šæ‰è¯¥ serverï¼‰</li><li>wildcard_after_successï¼ˆç¬¬ä¸‰ä¸ªæ˜¯ç»“å°¾åŒ¹é…ç¬¦ï¼Œç„¶åæ³¨é‡Šæ‰è¯¥ serverï¼‰</li><li>regex_successï¼ˆç¬¬å››ä¸ªæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œç„¶åæ³¨é‡Šæ‰è¯¥ serverï¼‰</li><li>default_server not found server!!ï¼ˆç¬¬äº”ä¸ªæ˜¯é»˜è®¤ serverï¼Œå› ä¸ºå‰å››ä¸ªéƒ½æ³¨é‡Šäº†ï¼Œæ‰€ä»¥åªèƒ½èµ°é»˜è®¤çš„ serverï¼‰</li></ul><p><strong>ç»“è®º</strong></p><ul><li><p>No1ï¼šå‡†ç¡®åŒ¹é… server_name</p></li><li><p>No2ï¼šé€šé…ç¬¦åœ¨å¼€å§‹æ—¶åŒ¹é… server_name æˆåŠŸ</p></li><li><p>No3ï¼šé€šé…ç¬¦åœ¨ç»“æŸæ—¶åŒ¹é… server_name æˆåŠŸ</p></li><li><p>No4ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é… server_name æˆåŠŸ</p></li><li><p>No5ï¼šè¢«é»˜è®¤çš„ default_server å¤„ç†ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šé»˜è®¤æ‰¾ç¬¬ä¸€ä¸ª server</p></li></ul><h3 id="locationæŒ‡ä»¤"><a href="#locationæŒ‡ä»¤" class="headerlink" title="locationæŒ‡ä»¤"></a>locationæŒ‡ä»¤</h3><p><code>location</code> æŒ‡ä»¤æ˜¯ç”¨æ¥è®¾ç½®è¯·æ±‚çš„ URIã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /abc &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>location [ = | ~ | <del>* | ^</del> | @ ] &lt;uri&gt;{â€¦}</td><td>â€”</td><td>serverã€location</td></tr></tbody></table><p>uri å˜é‡æ˜¯å¾…åŒ¹é…çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆ Nginx æœåŠ¡å™¨åœ¨æœç´¢åŒ¹é… location çš„æ—¶å€™ï¼Œæ˜¯å…ˆä½¿ç”¨ä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°ä¸€ä¸ªåŒ¹é…åº¦æœ€é«˜çš„ä¸€ä¸ªï¼Œç„¶ååœ¨é€šè¿‡åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„è¿›è¡ŒåŒ¹é…ï¼Œ<strong>å¦‚æœèƒ½åŒ¹é…åˆ°ç›´æ¥è®¿é—®æ­£åˆ™è¡¨è¾¾å¼çš„ï¼ŒåŒ¹é…ä¸åˆ°ï¼Œå°±ä½¿ç”¨åˆšæ‰åŒ¹é…åº¦æœ€é«˜ï¼ˆå‰ç¼€æœ€é•¿çš„ï¼‰çš„é‚£ä¸ª location æ¥å¤„ç†è¯·æ±‚</strong>ã€‚</p><p>å±æ€§ä»‹ç»:</p><p>ä¸å¸¦ç¬¦å·ï¼Œè¦æ±‚å¿…é¡»ä»¥æŒ‡å®šæ¨¡å¼å¼€å¤´ï¼Œä½†æ˜¯ä¸è¦æ±‚ç²¾ç¡®åŒ¹é…</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> <span class="number">127.0.0.1</span>;</span><br><span class="line"><span class="attribute">location</span> /abc &#123;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">"access success"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹è®¿é—®éƒ½æ˜¯æ­£ç¡®çš„</span></span><br><span class="line">http://192.168.91.200/abc</span><br><span class="line">http://192.168.91.200/abc?p1=kele</span><br><span class="line">http://192.168.91.200/abc/</span><br><span class="line">http://192.168.91.200/abcdef</span><br></pre></td></tr></table></figure><p><code>=</code> æ˜¯ç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„ uriï¼Œå¿…é¡»ä¸æŒ‡å®šçš„æ¨¡å¼ç²¾ç¡®åŒ¹é…</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> <span class="number">127.0.0.1</span>;</span><br><span class="line"><span class="attribute">location</span> =/abc &#123;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">"access success"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># åŒ¹é…æˆåŠŸ</span></span><br><span class="line">http://192.168.91.200/abc</span><br><span class="line">http://192.168.91.200/abc?p1=TOM</span><br><span class="line"><span class="comment"># åŒ¹é…å¤±è´¥</span></span><br><span class="line">http://192.168.91.200/abc/</span><br><span class="line">http://192.168.91.200/abcdef</span><br></pre></td></tr></table></figure><p><code>~</code> æ˜¯ç”¨äºè¡¨ç¤ºå½“å‰ uri ä¸­åŒ…å«äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åŒºåˆ†å¤§å°å†™</p><p><code>~*</code> æ˜¯ç”¨äºè¡¨ç¤ºå½“å‰ uri ä¸­åŒ…å«äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†æ˜¯æ˜¯ä¸åŒºåˆ†å¤§å°å†™</p><p>æ¢å¥è¯è¯´ï¼Œ<strong>å¦‚æœ uri åŒ…å«äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œéœ€è¦ç”¨ä¸Šè¿°ä¸¤ä¸ªç¬¦å·æ¥æ ‡è¯†</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒºåˆ†å¤§å°å†™</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> <span class="number">127.0.0.1</span>;</span><br><span class="line"><span class="attribute">location</span> ~^/abc\w$ &#123;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">"access success"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸åŒºåˆ†å¤§å°å†™</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> <span class="number">127.0.0.1</span>;</span><br><span class="line"><span class="attribute">location</span> ~*^/abc\w$ &#123;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">"access success"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>^~</code> æ˜¯ç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„ uriï¼ŒåŠŸèƒ½å’Œä¸åŠ ç¬¦å·çš„ä¸€è‡´ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œå¦‚æœè¯·æ±‚åŒ¹é…ä¸Šäº†ï¼Œé‚£ä¹ˆå°±åœæ­¢æœç´¢å…¶ä»–æ¨¡å¼äº†ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> <span class="number">127.0.0.1</span>;</span><br><span class="line"><span class="attribute">location</span><span class="regexp"> ^~/abc</span> &#123;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">200</span> <span class="string">"access success"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@</code> å‰ç¼€å¯ä»¥ç”¨æ¥å®šä¹‰ä¸€ä¸ªå‘½åçš„ location,è¯¥ location ä¸å¤„ç†æ­£å¸¸çš„å¤–éƒ¨è¯·æ±‚,ä¸€èˆ¬ç”¨æ¥å½“ä½œæ ‡è¯†ä¾›å†…éƒ¨é‡å®šå‘ä½¿ç”¨ã€‚å®ƒä»¬ä¸èƒ½åµŒå¥—,ä¹Ÿä¸èƒ½åŒ…å«åµŒå¥—çš„ locationã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /try &#123;</span><br><span class="line">    <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ <span class="variable">@name</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /error &#123;</span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> = <span class="variable">@name</span>;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">404</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> <span class="variable">@name</span> &#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">"<span class="variable">@name</span>"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶è®¿é—® <code>/try</code> æˆ–è€… <code>/error</code> éƒ½ä¼šè¿”å› <code>@name</code>ã€‚</p><h3 id="root-aliasæŒ‡ä»¤"><a href="#root-aliasæŒ‡ä»¤" class="headerlink" title="root/aliasæŒ‡ä»¤"></a>root/aliasæŒ‡ä»¤</h3><ul><li><code>root</code> æŒ‡ä»¤æ˜¯è®¾ç½®è¯·æ±‚èµ„æºçš„æ ¹ç›®å½•ã€‚é»˜è®¤å€¼æ˜¯ htmlã€‚</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>root &lt;path&gt;;</td><td>root html;</td><td>httpã€serverã€location</td></tr></tbody></table><p>path æ˜¯ Nginx æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ä»¥åæŸ¥æ‰¾èµ„æºçš„æ ¹ç›®å½•è·¯å¾„ã€‚</p><ul><li><code>alias</code> æŒ‡ä»¤æ˜¯ç”¨æ¥æ›´æ”¹ location çš„ URIã€‚</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>alias &lt;path&gt;;</td><td>â€”</td><td>location</td></tr></tbody></table><ul><li>path æ˜¯ä¿®æ”¹åçš„æ ¹è·¯å¾„ã€‚</li></ul><p><strong>ä»¥ä¸Šä¸¤ä¸ªæŒ‡ä»¤éƒ½å¯ä»¥æ¥æŒ‡å®šè®¿é—®èµ„æºçš„è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><blockquote><p><strong>ä¸¾ä¾‹è¯´æ˜</strong></p></blockquote><ol><li><p>åœ¨ <code>/usr/local/nginx/html</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª images ç›®å½•,å¹¶åœ¨ç›®å½•ä¸‹æ”¾å…¥ä¸€å¼ å›¾ç‰‡ <code>mv.png</code> å›¾ç‰‡ã€‚</p><p>ç„¶åè¿›å…¥é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p></li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /images &#123;</span><br><span class="line">    <span class="attribute">root</span> /usr/local/nginx/html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®å›¾ç‰‡çš„è·¯å¾„ä¸ºï¼š<code>http://192.168.91.200/images/mv.png</code></p><ol start="2"><li>å¦‚æœæŠŠrootæ”¹ä¸ºalias</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /images &#123;</span><br><span class="line">    <span class="attribute">alias</span> /usr/local/nginx/html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡è®¿é—®ä¸Šè¿°åœ°å€ï¼Œé¡µé¢ä¼šå‡ºç° 404 çš„é”™è¯¯ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¼šå‘ç°æ˜¯å› ä¸ºåœ°å€ä¸å¯¹ï¼Œæ‰€ä»¥éªŒè¯äº†ï¼š</p><ul><li><p>root çš„å¤„ç†ç»“æœæ˜¯ï¼š<strong>root è·¯å¾„ + location è·¯å¾„</strong>ï¼Œlocation è·¯å¾„åŒ…æ‹¬åŒ¹é…åé¢çš„è¯·æ±‚ï¼Œå³åŒ…æ‹¬ /mv.png</p><p><code>/usr/local/nginx/html/images/mv.png</code></p></li></ul><ul><li>alias çš„å¤„ç†ç»“æœæ˜¯ï¼š<strong>ä½¿ç”¨ alias è·¯å¾„æ›¿æ¢ location è·¯å¾„</strong>ï¼Œä½†æ˜¯ä¸ä¼šæ›¿æ¢åŒ¹é…åé¢çš„è¯·æ±‚ï¼Œå³ä¸ä¼šæ›¿æ¢ /mv.png</li></ul><p>éœ€è¦åœ¨ alias åé¢è·¯å¾„æ”¹ä¸ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /images &#123;</span><br><span class="line">    <span class="attribute">alias</span> /usr/local/nginx/html/images;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>å¦‚æœ location è·¯å¾„æ˜¯ä»¥ / ç»“å°¾,åˆ™ alias ä¹Ÿå¿…é¡»æ˜¯ä»¥ / ç»“å°¾ï¼Œroot æ²¡æœ‰è¦æ±‚ã€‚</li></ol><p>å°†ä¸Šè¿°é…ç½®ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /images/ &#123;</span><br><span class="line">    <span class="attribute">alias</span> /usr/local/nginx/html/images;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®å°±ä¼šå‡ºé—®é¢˜ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—è¿˜æ˜¯è·¯å¾„ä¸å¯¹ï¼Œæ‰€ä»¥éœ€è¦æŠŠ alias åé¢åŠ ä¸Š /</p><p>å°ç»“ï¼š</p><ul><li>root çš„å¤„ç†ç»“æœæ˜¯: root è·¯å¾„ + location è·¯å¾„</li><li>alias çš„å¤„ç†ç»“æœæ˜¯:ä½¿ç”¨ alias è·¯å¾„æ›¿æ¢ location è·¯å¾„</li><li>alias æ˜¯ä¸€ä¸ªç›®å½•åˆ«åçš„å®šä¹‰ï¼Œroot åˆ™æ˜¯æœ€ä¸Šå±‚ç›®å½•çš„å«ä¹‰</li><li>å¦‚æœ location è·¯å¾„æ˜¯ä»¥ / ç»“å°¾,åˆ™ alias ä¹Ÿå¿…é¡»æ˜¯ä»¥ / ç»“å°¾ï¼Œroot æ²¡æœ‰è¦æ±‚<ul><li><strong>alias ä¸æ”¯æŒ location çš„ =</strong></li></ul></li></ul><p>è¿™é‡Œå†å¤šè¨€å‡ å¥ï¼Œalias åæŒ‡å®šçš„èµ„æºè·¯å¾„ï¼ŒNginx å°±ä¼šå»è¿™ä¸ªè·¯å¾„ä¸‹æ‰¾èµ„æºï¼Œã€Œå¿½ç•¥ã€location æœ¬èº«çš„çš„è¯·æ±‚ï¼Œä»…æ‹¼æ¥ location åé¢çš„è¯·æ±‚ã€‚å¦‚æœä½ æƒ³å»æ‹¼æ¥ location æœ¬èº«ï¼Œå°±ç”¨ç»å¯¹è·¯å¾„ï¼ˆåŒ…æ‹¬ locationï¼‰çš„aliasã€‚</p><h3 id="indexæŒ‡ä»¤"><a href="#indexæŒ‡ä»¤" class="headerlink" title="indexæŒ‡ä»¤"></a>indexæŒ‡ä»¤</h3><p><code>index</code> æŒ‡ä»¤æ˜¯è®¾ç½®ç½‘ç«™çš„é»˜è®¤é¦–é¡µã€‚é»˜è®¤æ˜¯ index.htmlã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>index &lt;file&gt; â€¦;</td><td>index index.html;</td><td>httpã€serverã€location</td></tr></tbody></table><p><code>index</code> åé¢å¯ä»¥è·Ÿå¤šä¸ªè®¾ç½®ï¼Œå¦‚æœè®¿é—®çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šå…·ä½“è®¿é—®çš„èµ„æºï¼Œåˆ™ä¼šä»å·¦å¾€å³ä¾æ¬¡è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸ºæ­¢ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"><span class="attribute">root</span> /usr/local/nginx/html;</span><br><span class="line"><span class="attribute">index</span> index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®è¯¥ location çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ <code>http://ip:port/</code> è®¿é—®ï¼Œåœ°å€åé¢å¦‚æœä¸æ·»åŠ ä»»ä½•å†…å®¹ï¼Œåˆ™é»˜è®¤ä¾æ¬¡è®¿é—® index.html å’Œ index.htmï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¥è¿›è¡Œè¿”å›ã€‚</p><h3 id="error-pageæŒ‡ä»¤"><a href="#error-pageæŒ‡ä»¤" class="headerlink" title="error_pageæŒ‡ä»¤"></a>error_pageæŒ‡ä»¤</h3><p>error_page æŒ‡ä»¤æ˜¯è®¾ç½®ç½‘ç«™çš„é”™è¯¯é¡µé¢ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>error_page &lt;code&gt; â€¦â€¦ [=[response]] &lt;uri&gt;;</td><td>â€”</td><td>httpã€serverã€location â€¦â€¦</td></tr></tbody></table><p>code æ˜¯å“åº”ç ã€‚</p><p><strong>å½“å‡ºç°å¯¹åº”çš„å“åº” code åï¼Œå¦‚ä½•æ¥å¤„ç†ï¼Ÿ</strong></p><blockquote><p><strong>ä¸¾ä¾‹è¯´æ˜</strong></p></blockquote><ol><li>å¯ä»¥æŒ‡å®šå…·ä½“è·³è½¬çš„åœ°å€</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">error_page</span> <span class="number">404</span> http://www.frx.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“é¡µé¢äº§ç”Ÿ 404 æ—¶ï¼Œè‡ªåŠ¨è·³è½¬åˆ° <code>http://www.frx.com</code></p><ol start="2"><li>å¯ä»¥æŒ‡å®šé‡å®šå‘åœ°å€</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">error_page</span> <span class="number">404</span> /50x.html;</span><br><span class="line"><span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line"><span class="attribute">location</span> =/50x.html &#123;</span><br><span class="line"><span class="attribute">root</span> html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº§ç”Ÿé”™è¯¯é¡µé¢æ—¶ï¼Œé‡å®šå‘åˆ° /50x.htmlï¼Œç„¶åè§¦å‘ locationï¼Œæœ€ç»ˆè®¿é—®çš„æ˜¯ html ç›®å½•ä¸‹çš„ 50x.html é¡µé¢</p><ol start="3"><li>ä½¿ç”¨ location çš„ @ ç¬¦åˆå®Œæˆé”™è¯¯ä¿¡æ¯å±•ç¤º</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">error_page</span> <span class="number">404</span> <span class="variable">@jump_to_error</span>;</span><br><span class="line"><span class="attribute">location</span> <span class="variable">@jump_to_error</span> &#123;</span><br><span class="line"><span class="attribute">default_type</span> text/plain;</span><br><span class="line"><span class="attribute">return</span> <span class="number">404</span> <span class="string">'Not Found Page...'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯é€‰é¡¹ <code>=[response]</code> çš„ä½œç”¨æ˜¯ç”¨æ¥å°†ç›¸åº”ä»£ç æ›´æ”¹ä¸ºå¦å¤–ä¸€ä¸ªï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"><span class="attribute">error_page</span> <span class="number">404</span> =<span class="number">200</span> /50x.html;</span><br><span class="line"><span class="attribute">location</span> =/50x.html &#123;</span><br><span class="line"><span class="attribute">root</span> html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œå½“è¿”å› 404 æ‰¾ä¸åˆ°å¯¹åº”çš„èµ„æºçš„æ—¶å€™ï¼Œåœ¨æµè§ˆå™¨ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆè¿”å›çš„çŠ¶æ€ç æ˜¯ 200 è€Œä¸æ˜¯ 404ï¼Œè¿™å—éœ€è¦æ³¨æ„ä¸‹ï¼Œç¼–å†™ error_page åé¢çš„å†…å®¹ï¼Œ404 åé¢éœ€è¦åŠ ç©ºæ ¼ï¼Œ200 å‰é¢ä¸èƒ½åŠ ç©ºæ ¼ã€‚</p><h2 id="é™æ€èµ„æºä¼˜åŒ–é…ç½®"><a href="#é™æ€èµ„æºä¼˜åŒ–é…ç½®" class="headerlink" title="é™æ€èµ„æºä¼˜åŒ–é…ç½®"></a>é™æ€èµ„æºä¼˜åŒ–é…ç½®</h2><p>Nginx å¯¹é™æ€èµ„æºå¦‚ä½•è¿›è¡Œä¼˜åŒ–é…ç½®ã€‚è¿™é‡Œä»ä¸‰ä¸ªå±æ€§é…ç½®è¿›è¡Œä¼˜åŒ–ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">tcp_nopush</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">tcp_nodeplay</span> <span class="literal">on</span>;</span><br></pre></td></tr></table></figure><p>å»ºè®®ä¸‰ä¸ªéƒ½å¼€å¯ã€‚å¦‚æœæƒ³çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè¯·å¾€ä¸‹çœ‹ã€‚</p><h3 id="sendï¬le"><a href="#sendï¬le" class="headerlink" title="sendï¬le"></a>sendï¬le</h3><p>è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥å¼€å¯é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“æ¨¡å¼ã€‚é»˜è®¤å…³é—­ï¼Œå»ºè®®å¼€å¯ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>sendï¬le &lt;on | off&gt;;</td><td>sendï¬le oï¬€;</td><td>httpã€serverã€location â€¦â€¦</td></tr></tbody></table><p>è¯·æ±‚é™æ€èµ„æºçš„è¿‡ç¨‹ï¼šå®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œæ¥å£å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œæ“ä½œç³»ç»Ÿå°†è¿™äº›å®¢æˆ·ç«¯çš„è¯·æ±‚ä¼ é€’ç»™æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºï¼ŒæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºä¼šå¤„ç†è¿™äº›è¯·æ±‚ï¼Œè¯·æ±‚å¤„ç†å®Œæˆä»¥åï¼Œæ“ä½œç³»ç»Ÿè¿˜éœ€è¦å°†å¤„ç†å¾—åˆ°çš„ç»“æœé€šè¿‡ç½‘ç»œé€‚é…å™¨ä¼ é€’å›å»ã€‚</p><p>å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhostï¼›</span><br><span class="line">location / &#123;</span><br><span class="line"><span class="attribute">root</span> html;</span><br><span class="line"><span class="attribute">index</span> index.html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾åœ¨ html ç›®å½•ä¸‹æœ‰ä¸€ä¸ª welcome.html é¡µé¢ï¼Œè®¿é—®åœ°å€ï¼š<code>http://192.168.91.200/welcome.html</code>ã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220731/image.24hrbukvg0lc.webp" alt="image"></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220731/image.5l2efa1uqlo0.webp" alt="image"></p><h3 id="tcp-nopush"><a href="#tcp-nopush" class="headerlink" title="tcp_nopush"></a>tcp_nopush</h3><p>è¯¥æŒ‡ä»¤å¿…é¡»åœ¨ sendfile æ‰“å¼€çš„çŠ¶æ€ä¸‹æ‰ä¼šç”Ÿæ•ˆï¼Œä¸»è¦æ˜¯ç”¨æ¥æå‡ç½‘ç»œåŒ…çš„ä¼ è¾“ã€Œæ•ˆç‡ã€ã€‚é»˜è®¤å…³é—­ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>tcp_nopush &lt;on | off&gt;;</td><td>tcp_nopush oï¬€;</td><td>httpã€serverã€location</td></tr></tbody></table><h3 id="tcp-nodelay"><a href="#tcp-nodelay" class="headerlink" title="tcp_nodelay"></a>tcp_nodelay</h3><p>è¯¥æŒ‡ä»¤å¿…é¡»åœ¨ keep-alive è¿æ¥å¼€å¯çš„æƒ…å†µä¸‹æ‰ç”Ÿæ•ˆï¼Œæ¥æé«˜ç½‘ç»œåŒ…ä¼ è¾“çš„ã€Œå®æ—¶æ€§ã€ã€‚é»˜è®¤å¼€å¯ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>tcp_nodelay &lt;on | off&gt;;</td><td>tcp_nodelay on;</td><td>httpã€serverã€location</td></tr></tbody></table><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220731/image.1iu7wmocw0ao.webp" alt="image"></p><p><code>tcp_nopush</code> å°±åƒå¤§å·´è½¦ï¼Œç­‰æ‰€æœ‰æ—…å®¢å æ»¡äº†åº§ä½ï¼Œæ‰å¼€å§‹å‘è½¦åˆ°æ™¯ç‚¹ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼Œè€Œ <code>tcp_nodelay</code>ï¼Œä¸Šæ¥ä¸€ä¸ªæ—…å®¢ï¼Œå°±é©¬ä¸Šå‘è½¦åˆ°æ™¯ç‚¹å®¢æˆ·ç«¯ï¼‰ã€‚</p><h3 id="ä¼˜åŒ–æ€»ç»“"><a href="#ä¼˜åŒ–æ€»ç»“" class="headerlink" title="ä¼˜åŒ–æ€»ç»“"></a>ä¼˜åŒ–æ€»ç»“</h3><p>ç»è¿‡åˆ†æï¼Œã€ tcp_nopush ã€å’Œã€ tcp_nodelay ã€çœ‹èµ·æ¥æ˜¯ã€Œäº’æ–¥çš„ã€ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦å°†è¿™ä¸¤ä¸ªå€¼éƒ½æ‰“å¼€ï¼Œè¿™ä¸ªå¤§å®¶éœ€è¦çŸ¥é“çš„æ˜¯åœ¨ Linux2.5.9 ä»¥åçš„ç‰ˆæœ¬ä¸­ä¸¤è€…æ˜¯å¯ä»¥å…¼å®¹çš„ï¼Œä¸‰ä¸ªæŒ‡ä»¤éƒ½å¼€å¯çš„å¥½å¤„æ˜¯ï¼Œsendfile å¯ä»¥å¼€å¯é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œã€ tcp_nopush ã€å¼€å¯å¯ä»¥ç¡®ä¿åœ¨å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰æ•°æ®åŒ…å·²ç»å……åˆ†ã€Œå¡«æ»¡ã€ï¼Œè¿™å¤§å¤§å‡å°‘äº†ç½‘ç»œå¼€é”€ï¼Œå¹¶åŠ å¿«äº†æ–‡ä»¶å‘é€çš„é€Ÿåº¦ã€‚ç„¶åï¼Œå½“å®ƒåˆ°è¾¾æœ€åä¸€ä¸ªå¯èƒ½å› ä¸ºæ²¡æœ‰ã€Œå¡«æ»¡ã€è€Œæš‚åœçš„æ•°æ®åŒ…æ—¶ï¼ŒNginx ä¼šå¿½ç•¥ã€ tcp_nopush ã€å‚æ•°ï¼Œ ç„¶åï¼Œã€ tcp_nodelay ã€å¼ºåˆ¶å¥—æ¥å­—å‘é€æ•°æ®ã€‚ç”±æ­¤å¯çŸ¥ï¼Œã€ tcp_nopush ã€å¯ä»¥ä¸ã€ tcp_nodelay ã€ä¸€èµ·è®¾ç½®ï¼Œå®ƒæ¯”å•ç‹¬é…ç½®ã€ tcp_nodelay ã€å…·æœ‰æ›´å¼ºçš„æ€§èƒ½ã€‚</p><p>æ‰€ä»¥å›å½’å¼€å¤´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹é…ç½®æ¥ä¼˜åŒ– Nginx é™æ€èµ„æºçš„å¤„ç†ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‰ä¸ªéƒ½å¼€å¯</span></span><br><span class="line"><span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">tcp_nopush</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">tcp_nodelay</span> <span class="literal">on</span>;</span><br></pre></td></tr></table></figure><h2 id="é™æ€èµ„æºå‹ç¼©é…ç½®"><a href="#é™æ€èµ„æºå‹ç¼©é…ç½®" class="headerlink" title="é™æ€èµ„æºå‹ç¼©é…ç½®"></a>é™æ€èµ„æºå‹ç¼©é…ç½®</h2><p>ç»è¿‡ä¸Šè¿°å†…å®¹çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å†æ¬¡æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚åœ¨æ»¡è¶³ä¸Šè¿°ä¼˜åŒ–çš„å‰æä¸‹ï¼Œæˆ‘ä»¬ä¼ é€ä¸€ä¸ª 1M çš„æ•°æ®å’Œä¸€ä¸ª 10M çš„æ•°æ®é‚£ä¸ªæ•ˆç‡é«˜ï¼Ÿç­”æ¡ˆæ˜¾è€Œæ˜“è§ï¼Œ<strong>ä¼ è¾“å†…å®¹å°ï¼Œé€Ÿåº¦å°±ä¼šå¿«</strong>ã€‚é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼ŒåŒæ ·çš„å†…å®¹ï¼Œå¦‚æœæŠŠå¤§å°é™ä¸‹æ¥ï¼Œæˆ‘ä»¬è„‘è¢‹é‡Œé¢è¦è¹¦å‡ºä¸€ä¸ªè¯å°±æ˜¯ã€Œå‹ç¼©ã€ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å­¦ä¹  Nginx çš„é™æ€èµ„æºå‹ç¼©æ¨¡å—ã€‚</p><p>åœ¨ Nginx çš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡é…ç½® gzip æ¥å¯¹é™æ€èµ„æºè¿›è¡Œå‹ç¼©ï¼Œç›¸å…³çš„æŒ‡ä»¤å¯ä»¥é…ç½®åœ¨ http å—ã€server å—å’Œ location å—ä¸­ï¼ŒNginx å¯ä»¥é€šè¿‡å¯¹è¿™äº›æŒ‡ä»¤è¿›è¡Œè§£æå’Œå¤„ç†ï¼š</p><ul><li><code>ngx_http_gzip_module</code> æ¨¡å—</li><li><code>ngx_http_gzip_static_module</code> æ¨¡å—</li><li><code>ngx_http_gunzip_module</code> æ¨¡å—</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»ä»¥ä¸‹å†…å®¹è¿›è¡Œå­¦ä¹ ï¼š</p><ul><li>Gzip å„æ¨¡å—æ”¯æŒçš„é…ç½®æŒ‡ä»¤</li><li>Gzip å‹ç¼©åŠŸèƒ½çš„é…ç½®</li><li>Gzip å’Œ sendfile çš„å†²çªè§£å†³</li><li>æµè§ˆå™¨ä¸æ”¯æŒ Gzip çš„è§£å†³æ–¹æ¡ˆ</li></ul><h3 id="Gzipæ¨¡å—é…ç½®æŒ‡ä»¤"><a href="#Gzipæ¨¡å—é…ç½®æŒ‡ä»¤" class="headerlink" title="Gzipæ¨¡å—é…ç½®æŒ‡ä»¤"></a>Gzipæ¨¡å—é…ç½®æŒ‡ä»¤</h3><p>æ¥ä¸‹æ¥æ‰€å­¦ä¹ çš„æŒ‡ä»¤éƒ½æ¥è‡ª <code>ngx_http_gzip_module</code> æ¨¡å—ï¼Œè¯¥æ¨¡å—ä¼šåœ¨ Nginx å®‰è£…çš„æ—¶å€™å†…ç½®åˆ° Nginx çš„å®‰è£…ç¯å¢ƒä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æŒ‡ä»¤ã€‚</p><ul><li><code>gzip</code> æŒ‡ä»¤æ˜¯ç”¨äºå¼€å¯æˆ–è€…å…³é—­ Gzip åŠŸèƒ½ã€‚é»˜è®¤å…³é—­</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>gzip &lt;on | off&gt;;</td><td>gzip off;</td><td>httpã€serverã€location â€¦â€¦</td></tr></tbody></table><p>æ³¨æ„ï¼šåªæœ‰è¯¥æŒ‡ä»¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä¸‹é¢çš„æŒ‡ä»¤æ‰æœ‰æ•ˆæœ</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>gzip_types</code> æŒ‡ä»¤å¯ä»¥æ ¹æ®å“åº”é¡µçš„ MIME ç±»å‹é€‰æ‹©æ€§åœ°å¼€å¯ Gzip å‹ç¼©åŠŸèƒ½ã€‚é»˜è®¤æ˜¯ text/html</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>gzip_types &lt;mime-type&gt; â€¦â€¦ ;</td><td>gzip_types text/html;</td><td>httpã€serverã€location</td></tr></tbody></table><p>æ‰€é€‰æ‹©çš„å€¼å¯ä»¥ä» mime.types æ–‡ä»¶ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ * ä»£è¡¨æ‰€æœ‰ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line"><span class="attribute">gzip_types</span> application/javascript;</span><br><span class="line"><span class="comment"># * ä»£è¡¨æ‰€æœ‰</span></span><br><span class="line"><span class="attribute">gzip_types</span> *</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>gzip_comp_level</code> æŒ‡ä»¤æ˜¯ç”¨äºè®¾ç½® Gzip å‹ç¼©ç¨‹åº¦ï¼Œçº§åˆ«ä» 1-9ï¼Œ1 è¡¨ç¤ºè¦æ˜¯ç¨‹åº¦æœ€ä½ï¼Œè¦æ˜¯æ•ˆç‡æœ€é«˜ï¼Œ9 åˆšå¥½ç›¸åï¼Œå‹ç¼©ç¨‹åº¦æœ€é«˜ï¼Œä½†æ˜¯æ•ˆç‡æœ€ä½ã€æœ€è´¹æ—¶é—´ã€‚é»˜è®¤å€¼æ˜¯ 1</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>gzip_comp_level &lt;level&gt;;</td><td>gzip_comp_level 1;</td><td>httpã€serverã€location</td></tr></tbody></table><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line"><span class="attribute">gzip_comp_level</span> <span class="number">6</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>gzip_vary</code> æŒ‡ä»¤æ˜¯ç”¨äºè®¾ç½®ä½¿ç”¨ Gzip è¿›è¡Œå‹ç¼©å‘é€æ˜¯å¦æºå¸¦ã€Vary:Accept-Encodingã€å¤´åŸŸçš„å“åº”å¤´éƒ¨ã€‚ä¸»è¦æ˜¯å‘Šè¯‰æ¥æ”¶æ–¹ï¼Œæ‰€å‘é€çš„æ•°æ®ç»è¿‡äº† Gzip å‹ç¼©å¤„ç†ã€‚é»˜è®¤å…³é—­</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>gzip_vary &lt;on | off&gt;;</td><td>gzip_vary off;</td><td>httpã€serverã€location</td></tr></tbody></table><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220731/image.4bsq0xpu9s20.webp" alt="image"></p><ul><li><code>gzip_buffers</code> æŒ‡ä»¤æ˜¯ç”¨äºå¤„ç†è¯·æ±‚å‹ç¼©çš„ç¼“å†²åŒºæ•°é‡å’Œå¤§å°</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>gzip_buffers &lt;number&gt; &lt;size&gt;;</td><td>gzip_buffers 32 4k | 16 8k;</td><td>httpã€serverã€location</td></tr></tbody></table><p>å…¶ä¸­ number æ˜¯æŒ‡å®š Nginx æœåŠ¡å™¨å‘ç³»ç»Ÿç”³è¯·ç¼“å­˜ç©ºé—´ä¸ªæ•°ï¼Œsize æŒ‡çš„æ˜¯æ¯ä¸ªç¼“å­˜ç©ºé—´çš„å¤§å°ã€‚ä¸»è¦å®ç°çš„æ˜¯ç”³è¯· number ä¸ªæ¯ä¸ªå¤§å°ä¸º size çš„å†…å­˜ç©ºé—´ã€‚è¿™ä¸ªå€¼çš„è®¾å®šä¸€èˆ¬ä¼šå’ŒæœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œæ‰€ä»¥å»ºè®®æ­¤é¡¹ä¸è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip_buffers</span> <span class="number">4</span> <span class="number">16K</span>;  <span class="comment"># ç¼“å­˜ç©ºé—´å¤§å°</span></span><br></pre></td></tr></table></figure><ul><li><code>gzip_disable</code> æŒ‡ä»¤æ˜¯é’ˆå¯¹ä¸åŒç§ç±»å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å¼€å¯å’Œå…³é—­ Gzip åŠŸèƒ½</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>gzip_disable &lt;regex&gt; â€¦â€¦ ;</td><td>â€”</td><td>httpã€serverã€location</td></tr></tbody></table><p>regex æ˜¯æ ¹æ®å®¢æˆ·ç«¯çš„æµè§ˆå™¨æ ‡å¿—(user-agent)æ¥è®¾ç½®ï¼Œæ”¯æŒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚æŒ‡å®šçš„æµè§ˆå™¨æ ‡å¿—ä¸ä½¿ç”¨ Gzip.è¯¥æŒ‡ä»¤ä¸€èˆ¬æ˜¯ç”¨æ¥æ’é™¤ä¸€äº›æ˜æ˜¾ä¸æ”¯æŒ Gzip çš„æµè§ˆå™¨ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip_disable</span> <span class="string">"MSIE [1-6]\."</span>;</span><br></pre></td></tr></table></figure><p><code>gzip_http_version</code> æŒ‡ä»¤æ˜¯é’ˆå¯¹ä¸åŒçš„ HTTP åè®®ç‰ˆæœ¬ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å¼€å¯å’Œå…³é—­ Gzip åŠŸèƒ½ã€‚é»˜è®¤æ˜¯ 1.1 ç‰ˆæœ¬</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>gzip_http_version &lt;1.0 | 1.1&gt;;</td><td>gzip_http_version 1.1;</td><td>httpã€serverã€location</td></tr></tbody></table><p>è¯¥æŒ‡ä»¤æ˜¯æŒ‡å®šä½¿ç”¨ Gzip çš„ HTTP æœ€ä½ç‰ˆæœ¬ï¼Œè¯¥æŒ‡ä»¤ä¸€èˆ¬é‡‡ç”¨é»˜è®¤å€¼å³å¯ã€‚</p><ul><li><code>gzip_min_length</code> æŒ‡ä»¤æ˜¯é’ˆå¯¹ä¼ è¾“æ•°æ®çš„å¤§å°ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å¼€å¯å’Œå…³é—­ Gzip åŠŸèƒ½</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>gzip_min_length &lt;length&gt;;</td><td>gzip_min_length 20;</td><td>httpã€serverã€location</td></tr></tbody></table><p>Nignx è®¡é‡å¤§å°çš„å•ä½ï¼šbytes [å­—èŠ‚] / kb [åƒå­—èŠ‚] / M [å…†]</p><p>ä¾‹å¦‚: 1024 / 10k | K / 10m | M</p><p>Gzip å‹ç¼©åŠŸèƒ½å¯¹å¤§æ•°æ®çš„å‹ç¼©æ•ˆæœæ˜æ˜¾ï¼Œä½†æ˜¯å¦‚æœè¦å‹ç¼©çš„æ•°æ®æ¯”è¾ƒå°çš„è¯ï¼Œå¯èƒ½å‡ºç°è¶Šå‹ç¼©æ•°æ®é‡è¶Šå¤§çš„æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ ¹æ®å“åº”å†…å®¹çš„å¤§å°æ¥å†³å®šæ˜¯å¦ä½¿ç”¨ Gzip åŠŸèƒ½ï¼Œå“åº”é¡µé¢çš„å¤§å°å¯ä»¥é€šè¿‡å¤´ä¿¡æ¯ä¸­çš„ <code>Content-Length</code> æ¥è·å–ã€‚ä½†æ˜¯å¦‚ä½•ä½¿ç”¨äº† Chunk ç¼–ç åŠ¨æ€å‹ç¼©ï¼Œè¯¥æŒ‡ä»¤å°†è¢«å¿½ç•¥ã€‚å»ºè®®è®¾ç½®ä¸º 1K æˆ–ä»¥ä¸Šã€‚</p><ul><li><code>gzip_proxied</code> æŒ‡ä»¤è®¾ç½®æ˜¯å¦å¯¹æœåŠ¡ç«¯è¿”å›çš„ç»“æœè¿›è¡Œ Gzip å‹ç¼©</li></ul><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>gzip_proxied &lt;off | expired | no-cache | no-store | private | no_last_modified | no_etag | auth | any&gt;;</td><td>gzip_proxied off;</td><td>httpã€serverã€location</td></tr></tbody></table><ul><li>offï¼šå…³é—­ Nginx æœåŠ¡å™¨å¯¹åå°æœåŠ¡å™¨è¿”å›ç»“æœçš„ Gzip å‹ç¼©</li><li>expiredï¼šå¦‚æœ header å¤´ä¸­åŒ…å« ã€Expiresã€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</li><li>no-cacheï¼šå¦‚æœ header å¤´ä¸­åŒ…å« ã€Cache-Control:no-cacheã€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</li><li>no-storeï¼šå¦‚æœ header å¤´ä¸­åŒ…å« ã€Cache-Control:no-storeã€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</li><li>privateï¼šå¦‚æœ header å¤´ä¸­åŒ…å« ã€Cache-Control:privateã€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</li><li>no_last_modifiedï¼šå¦‚æœ header å¤´ä¸­ä¸åŒ…å« ã€Last-Modifiedã€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</li><li>no_etagï¼šå¦‚æœ header å¤´ä¸­ä¸åŒ…å« ã€ETagã€ å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</li><li>authï¼šå¦‚æœ header å¤´ä¸­åŒ…å« ã€Authorizationã€ å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</li><li>anyï¼šæ— æ¡ä»¶å¯ç”¨å‹ç¼©</li></ul><h3 id="Gzipå‹ç¼©åŠŸèƒ½é…ç½®æ¨¡æ¿"><a href="#Gzipå‹ç¼©åŠŸèƒ½é…ç½®æ¨¡æ¿" class="headerlink" title="Gzipå‹ç¼©åŠŸèƒ½é…ç½®æ¨¡æ¿"></a>Gzipå‹ç¼©åŠŸèƒ½é…ç½®æ¨¡æ¿</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>;      <span class="comment"># å¼€å¯ Gzip åŠŸèƒ½</span></span><br><span class="line"><span class="attribute">gzip_types</span> *;     <span class="comment"># å‹ç¼©æºæ–‡ä»¶ç±»å‹,æ ¹æ®å…·ä½“çš„è®¿é—®èµ„æºç±»å‹è®¾å®š</span></span><br><span class="line"><span class="attribute">gzip_comp_level</span> <span class="number">6</span>;    <span class="comment"># Gzip å‹ç¼©çº§åˆ«</span></span><br><span class="line"><span class="attribute">gzip_min_length</span> <span class="number">1k</span>;          <span class="comment"># è¿›è¡Œå‹ç¼©å“åº”é¡µé¢çš„æœ€å°é•¿åº¦ï¼Œcontent-length</span></span><br><span class="line"><span class="attribute">gzip_buffers</span> <span class="number">4</span> <span class="number">16K</span>;         <span class="comment"># ç¼“å­˜ç©ºé—´å¤§å°</span></span><br><span class="line"><span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">1</span>;       <span class="comment"># æŒ‡å®šå‹ç¼©å“åº”æ‰€éœ€è¦çš„æœ€ä½ HTTP è¯·æ±‚ç‰ˆæœ¬</span></span><br><span class="line"><span class="attribute">gzip_vary</span>  <span class="literal">on</span>;         <span class="comment"># å¾€å¤´ä¿¡æ¯ä¸­æ·»åŠ å‹ç¼©æ ‡è¯†</span></span><br><span class="line"><span class="attribute">gzip_disable</span> <span class="string">"MSIE [1-6]\."</span>; <span class="comment"># å¯¹ IE6 ä»¥ä¸‹çš„ç‰ˆæœ¬éƒ½ä¸è¿›è¡Œå‹ç¼©</span></span><br><span class="line"><span class="attribute">gzip_proxied</span>  <span class="literal">off</span>;           <span class="comment"># Nginx ä½œä¸ºåå‘ä»£ç†å‹ç¼©æœåŠ¡ç«¯è¿”å›æ•°æ®çš„æ¡ä»¶</span></span><br></pre></td></tr></table></figure><p>è¿™äº›é…ç½®åœ¨å¾ˆå¤šåœ°æ–¹å¯èƒ½éƒ½ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†è¿™äº›å†…å®¹æŠ½å–åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡ include æŒ‡ä»¤æŠŠé…ç½®æ–‡ä»¶å†æ¬¡åŠ è½½åˆ° nginx.conf é…ç½®æ–‡ä»¶ä¸­ï¼Œæ–¹æ³•ä½¿ç”¨ã€‚</p><p>åˆ›å»ºå‹ç¼©é…ç½®æ–‡ä»¶ï¼š<code>nginx_gzip.conf</code>ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip_types</span> *;</span><br><span class="line"><span class="attribute">gzip_comp_level</span> <span class="number">6</span>;</span><br><span class="line"><span class="attribute">gzip_min_length</span> <span class="number">1k</span>;</span><br><span class="line"><span class="attribute">gzip_buffers</span> <span class="number">4</span> <span class="number">16K</span>;</span><br><span class="line"><span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line"><span class="attribute">gzip_vary</span>  <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip_disable</span> <span class="string">"MSIE [1-6]\."</span>;</span><br><span class="line"><span class="attribute">gzip_proxied</span>  <span class="literal">off</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ Nginx æ ¸å¿ƒé…ç½®æ–‡ä»¶ <code>nginx.conf</code> è¿›è¡Œå¼•å…¥ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">include</span> nginx_gzip.conf</span><br></pre></td></tr></table></figure><h3 id="Gzipå’Œsendfileå…±å­˜é—®é¢˜"><a href="#Gzipå’Œsendfileå…±å­˜é—®é¢˜" class="headerlink" title="Gzipå’Œsendfileå…±å­˜é—®é¢˜"></a>Gzipå’Œsendfileå…±å­˜é—®é¢˜</h3><p>å‰é¢åœ¨è®²è§£ sendfile çš„æ—¶å€™ï¼Œæåˆ°è¿‡ï¼Œå¼€å¯ sendfile ä»¥åï¼Œåœ¨è¯»å–ç£ç›˜ä¸Šçš„é™æ€èµ„æºæ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥å‡å°‘æ‹·è´çš„æ¬¡æ•°ï¼Œå¯ä»¥ä¸ç»è¿‡ç”¨æˆ·è¿›ç¨‹å°†é™æ€æ–‡ä»¶é€šè¿‡ç½‘ç»œè®¾å¤‡å‘é€å‡ºå»ï¼Œä½†æ˜¯ Gzip è¦æƒ³å¯¹èµ„æºå‹ç¼©ï¼Œæ˜¯éœ€è¦ç»è¿‡ç”¨æˆ·è¿›ç¨‹è¿›è¡Œæ“ä½œçš„ã€‚Nginx è®¾ç½®äº†Gzip ä¹‹åï¼Œé™æ€æ–‡ä»¶çš„ sendfile å°±ä¸èµ·ä½œç”¨äº†ã€‚æ‰€ä»¥è¦è€ƒè™‘å¦‚ä½•è§£å†³ä¸¤ä¸ªè®¾ç½®çš„å…±å­˜é—®é¢˜ã€‚</p><p>å¯ä»¥ä½¿ç”¨ <code>ngx_http_gzip_static_module</code> æ¨¡å—çš„ <code>gzip_static</code> æŒ‡ä»¤æ¥è§£å†³ã€‚</p><h3 id="gzip-staticæŒ‡ä»¤"><a href="#gzip-staticæŒ‡ä»¤" class="headerlink" title="gzip_staticæŒ‡ä»¤"></a>gzip_staticæŒ‡ä»¤</h3><p><code>gzip_static</code> æŒ‡ä»¤ç”¨äºåœ¨æ£€æŸ¥ä¸è®¿é—®èµ„æºåŒåçš„ .gz æ–‡ä»¶æ—¶ï¼Œresponse ä¸­ä»¥ Gzip ç›¸å…³çš„ header è¿”å› .gz æ–‡ä»¶çš„å†…å®¹ã€‚é»˜è®¤å…³é—­ã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>gzip_static &lt;on | off | always&gt;;</td><td>gzip_static off;</td><td>httpã€serverã€location</td></tr></tbody></table><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip_static</span> <span class="literal">on</span>;</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶æ·»åŠ ä¸Šè¿°å‘½ä»¤åï¼Œä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ï¼š<code>unknown directive &quot;gzip_static&quot;</code>ï¼Œä¸»è¦çš„åŸå› æ˜¯ Nginx é»˜è®¤æ˜¯æ²¡æœ‰æ·»åŠ  ngx_http_gzip_static_module æ¨¡å—ã€‚å¦‚ä½•æ¥æ·»åŠ ï¼Ÿ</p><h3 id="Nginxæ¨¡å—æ·»åŠ "><a href="#Nginxæ¨¡å—æ·»åŠ " class="headerlink" title="Nginxæ¨¡å—æ·»åŠ "></a>Nginxæ¨¡å—æ·»åŠ </h3><ol><li>æŸ¥è¯¢å½“å‰ Nginx çš„é…ç½®å‚æ•°ï¼Œå³æŸ¥çœ‹ <code>configure arguments</code> çš„é…ç½®ä¿¡æ¯ï¼Œæ‹·è´å‡ºæ¥</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx -V</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´ configure arguments åé¢çš„æ•°æ®</span></span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--prefix=/usr/local/nginx</span><br></pre></td></tr></table></figure><ol start="2"><li>å°† Nginx å®‰è£…ç›®å½•ä¸‹ sbin ç›®å½•ä¸­çš„ nginx äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ›´åå¤‡ä»½</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx/sbin</span><br><span class="line">mv nginx nginx.backup</span><br></pre></td></tr></table></figure><ol start="3"><li>è¿›å…¥ Nginx çš„å®‰è£…ç›®å½•</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/nginx/core/nginx-1.21.6</span><br></pre></td></tr></table></figure><ol start="4"><li>æ‰§è¡Œ make clean æ¸…ç©ºä¹‹å‰ç¼–è¯‘çš„å†…å®¹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure><ol start="5"><li>ä½¿ç”¨ configure æ¥é…ç½®å‚æ•°ï¼Œæ·»åŠ  <code>ngx_http_gzip_static_module</code> æ¨¡å—ï¼Œè®°å¾—åŠ ä¸Šç¬¬1æ­¥æ‹·è´çš„é…ç½®ä¿¡æ¯</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --with-http_gzip_static_module  <span class="comment"># è®°å¾—æ·»åŠ  configure arguments åçš„æ•°æ®</span></span><br></pre></td></tr></table></figure><ol start="6"><li>ä½¿ç”¨ make å‘½ä»¤è¿›è¡Œç¼–è¯‘</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><ol start="7"><li>å°† objs ç›®å½•ä¸‹çš„ nginx äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ° nginx å®‰è£…ç›®å½•ä¸‹çš„ sbin ç›®å½•ä¸­</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /opt/nginx/core/nginx-1.21.6/objs/nginx /usr/<span class="built_in">local</span>/nginx/sbin</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æ‰§è¡Œç¬¬ï¼ˆ2ï¼‰æ­¥è¿›è¡Œå¤‡ä»½ï¼Œåˆ™è¯¥æ­¥éª¤ä¼šè¦†ç›–åŸæ¥çš„ nginx å¯æ‰§è¡Œæ–‡ä»¶</p><ol start="8"><li>åœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œæ›´æ–°å‘½ä»¤</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/nginx/core/nginx-1.21.6</span><br><span class="line">make upgrade</span><br></pre></td></tr></table></figure><h3 id="gzip-staticæµ‹è¯•"><a href="#gzip-staticæµ‹è¯•" class="headerlink" title="gzip_staticæµ‹è¯•"></a>gzip_staticæµ‹è¯•</h3><p>å‡†å¤‡å¥½ä¸€ä¸ª jquery.js æ–‡ä»¶ï¼Œæ”¾åœ¨ html ç›®å½•ä¸‹</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220731/image.576ef03x00c0.webp" alt="image"></p><ol><li>ç›´æ¥è®¿é—® <code>http://192.168.91.200/jquery.js</code></li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220731/image.2b8dhabn0cbo.webp" alt="image"></p><ol start="2"><li>ä½¿ç”¨ Gzip å‘½ä»¤è¿›è¡Œå‹ç¼©</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ html ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx/html</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‹ç¼© js æ–‡ä»¶</span></span><br><span class="line">gzip jquery.js</span><br></pre></td></tr></table></figure><ol start="3"><li>å†æ¬¡è®¿é—® <code>http://192.168.91.200/jquery.js</code></li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220731/image.4ivj1d091pg.webp" alt="image"></p><p>å¯ä»¥çœ‹å‡º <code>Content-Length</code> çš„å¤§å°å·²ç»å˜å¾—éå¸¸å°ã€‚</p><h2 id="é™æ€èµ„æºç¼“å­˜é…ç½®"><a href="#é™æ€èµ„æºç¼“å­˜é…ç½®" class="headerlink" title="é™æ€èµ„æºç¼“å­˜é…ç½®"></a>é™æ€èµ„æºç¼“å­˜é…ç½®</h2><p>å½“æµè§ˆå™¨è¯·æ±‚ Nginx æœåŠ¡å™¨çš„èµ„æºåï¼Œæˆ‘ä»¬å¯ä»¥è®©è¿™äº›èµ„æºç¼“å­˜åœ¨æµè§ˆå™¨é‡Œï¼Œè¿™æ ·å†ä¸€æ¬¡è¯·æ±‚ç›¸åŒçš„èµ„æºæ—¶ï¼Œæ— éœ€è¯·æ±‚ Nginx æœåŠ¡å™¨ï¼Œç›´æ¥ä»æµè§ˆå™¨çš„ç¼“å­˜é‡Œè·å–ï¼Œå‡å°‘ Nginx æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯ç¼“å­˜å’ŒWebç¼“å­˜"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜å’ŒWebç¼“å­˜" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜å’ŒWebç¼“å­˜"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜å’ŒWebç¼“å­˜</h3><p>ç¼“å­˜ï¼ˆcacheï¼‰ï¼ŒåŸå§‹æ„ä¹‰æ˜¯æŒ‡è®¿é—®é€Ÿåº¦æ¯”ä¸€èˆ¬éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆRAMï¼‰å¿«çš„ä¸€ç§é«˜é€Ÿå­˜å‚¨å™¨ï¼Œé€šå¸¸å®ƒä¸åƒç³»ç»Ÿä¸»å­˜é‚£æ ·ä½¿ç”¨ DRAM æŠ€æœ¯ï¼Œè€Œä½¿ç”¨æ˜‚è´µä½†è¾ƒå¿«é€Ÿçš„ SRAM æŠ€æœ¯ã€‚ç¼“å­˜çš„è®¾ç½®æ˜¯æ‰€æœ‰ç°ä»£è®¡ç®—æœºç³»ç»Ÿå‘æŒ¥é«˜æ€§èƒ½çš„é‡è¦å› ç´ ä¹‹ä¸€ã€‚</p><p>Web ç¼“å­˜æ˜¯æŒ‡ä¸€ä¸ª Web èµ„æºï¼ˆå¦‚ html é¡µé¢ï¼Œå›¾ç‰‡ï¼Œjsï¼Œæ•°æ®ç­‰ï¼‰å­˜åœ¨äº Web æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ä¹‹é—´çš„å‰¯æœ¬ã€‚ç¼“å­˜ä¼šæ ¹æ®è¿›æ¥çš„è¯·æ±‚ä¿å­˜è¾“å‡ºå†…å®¹çš„å‰¯æœ¬ï¼›å½“ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥åˆ°çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯ç›¸åŒçš„ URLï¼Œç¼“å­˜ä¼šæ ¹æ®ç¼“å­˜æœºåˆ¶å†³å®šæ˜¯ç›´æ¥ä½¿ç”¨å‰¯æœ¬å“åº”è®¿é—®è¯·æ±‚ï¼Œè¿˜æ˜¯å‘æºæœåŠ¡å™¨å†æ¬¡å‘é€è¯·æ±‚ã€‚æ¯”è¾ƒå¸¸è§çš„å°±æ˜¯æµè§ˆå™¨ä¼šç¼“å­˜è®¿é—®è¿‡ç½‘ç«™çš„ç½‘é¡µï¼Œå½“å†æ¬¡è®¿é—®è¿™ä¸ª URL åœ°å€çš„æ—¶å€™ï¼Œå¦‚æœç½‘é¡µæ²¡æœ‰æ›´æ–°ï¼Œå°±ä¸ä¼šå†æ¬¡ä¸‹è½½ç½‘é¡µï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„ç½‘é¡µã€‚åªæœ‰å½“ç½‘ç«™æ˜ç¡®æ ‡è¯†èµ„æºå·²ç»æ›´æ–°ï¼Œæµè§ˆå™¨æ‰ä¼šå†æ¬¡ä¸‹è½½ç½‘é¡µã€‚</p><h3 id="Webç¼“å­˜çš„ç§ç±»"><a href="#Webç¼“å­˜çš„ç§ç±»" class="headerlink" title="Webç¼“å­˜çš„ç§ç±»"></a>Webç¼“å­˜çš„ç§ç±»</h3><p>å®¢æˆ·ç«¯ç¼“å­˜</p><ul><li>æµè§ˆå™¨ç¼“å­˜</li></ul><p>æœåŠ¡ç«¯ç¼“å­˜</p><ul><li>Nginx</li><li>Redis</li><li>Memcached ç­‰</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨æµè§ˆå™¨ç¼“å­˜"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨æµè§ˆå™¨ç¼“å­˜" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨æµè§ˆå™¨ç¼“å­˜"></a>ä¸ºä»€ä¹ˆè¦ç”¨æµè§ˆå™¨ç¼“å­˜</h3><ul><li>æˆæœ¬æœ€ä½çš„ä¸€ç§ç¼“å­˜å®ç°</li><li>å‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—</li><li>é™ä½æœåŠ¡å™¨å‹åŠ›</li><li>å‡å°‘ç½‘ç»œå»¶è¿Ÿï¼ŒåŠ å¿«é¡µé¢æ‰“å¼€é€Ÿåº¦</li></ul><h3 id="æµè§ˆå™¨ç¼“å­˜æ‰§è¡Œæµç¨‹"><a href="#æµè§ˆå™¨ç¼“å­˜æ‰§è¡Œæµç¨‹" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜æ‰§è¡Œæµç¨‹"></a>æµè§ˆå™¨ç¼“å­˜æ‰§è¡Œæµç¨‹</h3><p>HTTP åè®®ä¸­å’Œé¡µé¢ç¼“å­˜ç›¸å…³çš„å­—æ®µï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸‹ï¼š</p><table><thead><tr><th>header</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Expires</td><td>ç¼“å­˜è¿‡æœŸçš„æ—¥æœŸå’Œæ—¶é—´</td></tr><tr><td>Cache-Control</td><td>è®¾ç½®å’Œç¼“å­˜ç›¸å…³çš„é…ç½®ä¿¡æ¯</td></tr><tr><td>Last-Modified</td><td>è¯·æ±‚èµ„æºæœ€åä¿®æ”¹æ—¶é—´</td></tr><tr><td>ETag</td><td>è¯·æ±‚å˜é‡çš„å®ä½“æ ‡ç­¾çš„å½“å‰å€¼ï¼Œæ¯”å¦‚æ–‡ä»¶çš„ MD5 å€¼</td></tr></tbody></table><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220731/image.209c4krjzgf4.webp" alt="image"></p><ol><li>ç”¨æˆ·é¦–æ¬¡é€šè¿‡æµè§ˆå™¨å‘é€è¯·æ±‚åˆ°æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œå®¢æˆ·ç«¯æ˜¯æ²¡æœ‰å¯¹åº”çš„ç¼“å­˜ï¼Œæ‰€ä»¥éœ€è¦å‘é€ request è¯·æ±‚æ¥è·å–æ•°æ®ï¼›</li><li>æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè·å–æœåŠ¡ç«¯çš„æ•°æ®åŠæœåŠ¡ç«¯ç¼“å­˜çš„å…è®¸åï¼Œè¿”å› 200 çš„æˆåŠŸçŠ¶æ€ç å¹¶ä¸”åœ¨å“åº”å¤´ä¸Šé™„ä¸Šå¯¹åº”èµ„æºä»¥åŠç¼“å­˜ä¿¡æ¯ï¼›</li><li>å½“ç”¨æˆ·å†æ¬¡è®¿é—®ç›¸åŒèµ„æºçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨æµè§ˆå™¨çš„ç¼“å­˜ç›®å½•ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å“åº”çš„ç¼“å­˜æ–‡ä»¶ï¼›</li><li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶ï¼Œåˆ™èµ°ç¬¬2æ­¥ï¼›</li><li>å¦‚æœæœ‰ç¼“å­˜æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å¯¹ç¼“å­˜æ–‡ä»¶æ˜¯å¦è¿‡æœŸè¿›è¡Œåˆ¤æ–­ï¼Œè¿‡æœŸçš„åˆ¤æ–­æ ‡å‡†æ˜¯(Expires)ï¼›</li><li>å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥ä»æœ¬åœ°ç¼“å­˜ä¸­è¿”å›æ•°æ®è¿›è¡Œå±•ç¤ºï¼ˆå¼ºç¼“å­˜ï¼‰ï¼›</li><li>å¦‚æœ Expires è¿‡æœŸï¼Œæ¥ä¸‹æ¥éœ€è¦åˆ¤æ–­ç¼“å­˜æ–‡ä»¶æ˜¯å¦å‘ç”Ÿè¿‡å˜åŒ–ï¼›</li><li>åˆ¤æ–­çš„æ ‡å‡†æœ‰ä¸¤ä¸ªï¼ˆéƒ½è¦åˆ¤æ–­ï¼‰ï¼Œä¸€ä¸ªæ˜¯ ETag(Entity Tag)ï¼Œä¸€ä¸ªæ˜¯ Last-Modifiedï¼›</li><li>åˆ¤æ–­ç»“æœæ˜¯æœªå‘ç”Ÿå˜åŒ–ï¼Œåˆ™æœåŠ¡ç«¯è¿”å› 304ï¼Œç›´æ¥ä»ç¼“å­˜æ–‡ä»¶ä¸­è·å–æ•°æ®ï¼ˆå¼±ç¼“å­˜ï¼‰ï¼›</li><li>å¦‚æœåˆ¤æ–­æ˜¯å‘ç”Ÿäº†å˜åŒ–ï¼Œé‡æ–°ä»æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œå¹¶æ ¹æ®ç¼“å­˜åå•†(æœåŠ¡ç«¯æ‰€è®¾ç½®çš„æ˜¯å¦éœ€è¦è¿›è¡Œç¼“å­˜æ•°æ®çš„è®¾ç½®)æ¥è¿›è¡Œæ•°æ®ç¼“å­˜ã€‚</li></ol><h3 id="æµè§ˆå™¨ç¼“å­˜ç›¸å…³æŒ‡ä»¤"><a href="#æµè§ˆå™¨ç¼“å­˜ç›¸å…³æŒ‡ä»¤" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜ç›¸å…³æŒ‡ä»¤"></a>æµè§ˆå™¨ç¼“å­˜ç›¸å…³æŒ‡ä»¤</h3><p>Nginx éœ€è¦è¿›è¡Œç¼“å­˜ç›¸å…³è®¾ç½®ï¼Œå°±éœ€è¦ç”¨åˆ°å¦‚ä¸‹çš„æŒ‡ä»¤ã€‚</p><h4 id="expiresæŒ‡ä»¤"><a href="#expiresæŒ‡ä»¤" class="headerlink" title="expiresæŒ‡ä»¤"></a>expiresæŒ‡ä»¤</h4><p>è¯¥æŒ‡ä»¤ç”¨æ¥æ§åˆ¶é¡µé¢ç¼“å­˜çš„ä½œç”¨ã€‚å¯ä»¥é€šè¿‡è¯¥æŒ‡ä»¤æ§åˆ¶ HTTP åº”ç­”ä¸­çš„ã€Expiresã€å’Œã€Cache-Controlã€</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>expires [modified] &lt;time&gt;; expires &lt;epoch | max | off&gt;;</td><td>expires off;</td><td>httpã€serverã€location</td></tr></tbody></table><ul><li><p>timeï¼šå¯ä»¥æ•´æ•°ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼ŒæŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸º sï¼ˆç§’ï¼‰ã€‚å¦‚æœæ˜¯è´Ÿæ•°ï¼ŒCache-Control åˆ™ä¸º no-cacheï¼Œå¦‚æœä¸ºæ•´æ•°æˆ– 0ï¼Œåˆ™ Cache-Control çš„å€¼ä¸º max-age=time</p></li><li><p>epochï¼šæŒ‡å®š Expires çš„å€¼ä¸ºã€â€™1 January,1970,00:00:01 GMTâ€™ã€ï¼Œå³ 1970-01-01 00:00:00 ï¼ŒCache-Control çš„å€¼ no-cache</p><p>å› ä¸º Expiresï¼ˆç¼“å­˜è¿‡æœŸæ—¶é—´ï¼‰æ˜¯ 1970 å¹´ï¼Œæ‰€ä»¥ä¸ç¼“å­˜ã€‚</p></li><li><p>maxï¼šæŒ‡å®š Expires çš„å€¼ä¸ºã€â€™31 December2037 23:59:59GMTâ€™ ã€ï¼Œå³(2037-12-31 23:59:59ï¼ŒCache-Control çš„å€¼ä¸º 10 å¹´</p><p>å› ä¸º Expiresï¼ˆç¼“å­˜è¿‡æœŸæ—¶é—´ï¼‰æ˜¯ 2037 å¹´ï¼Œè™½ç„¶è¿˜æœ‰ 16 å¹´è¿‡æœŸï¼Œä½†æ˜¯æœ€å¤§åªèƒ½ç¼“å­˜ 10 å¹´ã€‚</p></li><li><p>offï¼šé»˜è®¤ä¸ç¼“å­˜</p></li></ul><blockquote><p><strong>ä¾‹å­ 1</strong></p></blockquote><p>åœ¨é…ç½®æ–‡ä»¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ .*\.(html|js|css|png|jpg|jpeg|gif)$</span> &#123;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="attribute">expires</span> max</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€è¯·æ±‚ï¼š<code>http://192.168.91.200/jquery.js</code></p><p>æŸ¥çœ‹å¼€å‘è€…å·¥å…·(F12)çš„ NetWorkï¼Œå¦‚å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220731/image.4x3yczk58lk0.webp" alt="image"></p><p>315360000 æŠ˜ç®—ä¸‹æ¥æ­£å¥½æ˜¯ 10 å¹´ã€‚</p><blockquote><p><strong>å…¶ä»–æ ¼å¼</strong></p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">expires</span> <span class="number">30s</span>;  <span class="comment"># è¡¨ç¤ºæŠŠæ•°æ®ç¼“å­˜ 30 ç§’</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">expires</span> <span class="number">30m</span>;  <span class="comment"># è¡¨ç¤ºæŠŠæ•°æ®ç¼“å­˜ 30 åˆ†</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">expires</span> <span class="number">10h</span>;  <span class="comment"># è¡¨ç¤ºæŠŠæ•°æ®ç¼“å­˜ 10 å°æ—¶</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">expires</span> <span class="number">1d</span>;   <span class="comment"># è¡¨ç¤ºæŠŠæ•°æ®ç¼“å­˜ 1 å¤©</span></span><br></pre></td></tr></table></figure><h4 id="add-headeræŒ‡ä»¤"><a href="#add-headeræŒ‡ä»¤" class="headerlink" title="add_headeræŒ‡ä»¤"></a>add_headeræŒ‡ä»¤</h4><p>add_header æŒ‡ä»¤æ˜¯ç”¨æ¥æ·»åŠ æŒ‡å®šçš„å“åº”å¤´å’Œå“åº”å€¼ã€‚</p><p>add_header æ˜¯å“åº”ä½“çš„æŒ‡ä»¤ï¼Œä¸æ˜¯è¯·æ±‚æ—¶çš„æŒ‡ä»¤ï¼ˆæ¯”å¦‚ expires ï¼‰ï¼Œå¹¶ä¸” add_header ä¹Ÿæœ‰å’Œ expires ä¸€æ ·çš„åŠŸèƒ½ã€‚</p><p>å¦‚æœ expires å’Œ add_header åŒæ—¶å¼€å¯çš„æƒ…å†µä¸‹ï¼Œåˆ™ add_header ä¼˜äº expires ç”Ÿæ•ˆã€‚</p><table><thead><tr><th>è¯­æ³•</th><th>é»˜è®¤å€¼</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>add_header &lt;name&gt; &lt;value&gt; [always];</td><td>â€”</td><td>location &gt; server &gt; http &gt; â€¦â€¦</td></tr></tbody></table><p>always å¯é€‰ï¼Œä»£è¡¨æ€»æ˜¯æ·»åŠ ã€‚</p><p>Cache-Control ä½œä¸ºå“åº”å¤´ä¿¡æ¯ï¼Œå¯ä»¥åœ¨ Nginx é…ç½®æ–‡ä»¶è®¾ç½®å¦‚ä¸‹ç¼“å­˜å“åº”æŒ‡ä»¤ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Cache-control must-revalidate;</span><br><span class="line"><span class="attribute">add_header</span> Cache-control <span class="literal">no</span>-cache;</span><br><span class="line"><span class="attribute">add_header</span> Cache-control <span class="literal">no</span>-store;</span><br><span class="line"><span class="attribute">add_header</span> Cache-control <span class="literal">no</span>-transform;</span><br><span class="line"><span class="attribute">add_header</span> Cache-control public;</span><br><span class="line"><span class="attribute">add_header</span> Cache-control private;</span><br><span class="line"><span class="attribute">add_header</span> Cache-control proxy-revalidate;</span><br><span class="line"><span class="attribute">add_header</span> Cache-Control max-age=&lt;seconds&gt;;  <span class="comment"># ç§’</span></span><br><span class="line"><span class="attribute">add_header</span> Cache-control s-maxage=&lt;seconds&gt;; <span class="comment"># ç§’</span></span><br></pre></td></tr></table></figure><p>æè¿°ï¼š</p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>must-revalidate</td><td>å¯ç¼“å­˜ä½†å¿…é¡»å†å‘æºæœåŠ¡å™¨è¿›è¡Œç¡®è®¤</td></tr><tr><td>no-cache</td><td>æ•°æ®å†…å®¹ä¸èƒ½è¢«ç¼“å­˜ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°è®¿é—®æœåŠ¡å™¨ï¼Œè‹¥æœ‰ max-ageï¼Œåˆ™ç¼“å­˜æœŸé—´ä¸è®¿é—®æœåŠ¡å™¨</td></tr><tr><td>no-store</td><td>ä¸ç¼“å­˜è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•å†…å®¹ï¼Œæš‚å­˜ä¹Ÿä¸å¯ä»¥(ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­ä¸èƒ½æš‚å­˜è¯¥èµ„æº)</td></tr><tr><td>no-transform</td><td>ä»£ç†ä¸å¯æ›´æ”¹åª’ä½“ç±»å‹</td></tr><tr><td>public</td><td>å¯ä»¥è¢«ä»»ä½•ç¼“å­˜åŒºç¼“å­˜ï¼Œå¦‚: æµè§ˆå™¨ã€æœåŠ¡å™¨ã€ä»£ç†æœåŠ¡å™¨ç­‰</td></tr><tr><td>privateï¼ˆé»˜è®¤ï¼‰</td><td>åªèƒ½åœ¨æµè§ˆå™¨ä¸­ç¼“å­˜ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™æ‰è®¿é—®æœåŠ¡å™¨ï¼Œè‹¥æœ‰ max-ageï¼Œåˆ™ç¼“å­˜æœŸé—´ä¸è®¿é—®æœåŠ¡å™¨</td></tr><tr><td>proxy-revalidate</td><td>è¦æ±‚ä¸­é—´ç¼“å­˜æœåŠ¡å™¨å¯¹ç¼“å­˜çš„å“åº”æœ‰æ•ˆæ€§å†è¿›è¡Œç¡®è®¤</td></tr><tr><td>max-age=&lt;ç§’&gt;</td><td>è¿‡æœŸæ—¶é—´ï¼Œå³ä»¥ç§’ä¸ºå•ä½çš„ç¼“å­˜æ—¶é—´</td></tr><tr><td>s-maxage=&lt;ç§’&gt;</td><td>å…¬å…±ç¼“å­˜æœåŠ¡å™¨å“åº”çš„æœ€å¤§ Age å€¼</td></tr></tbody></table><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š</p><ul><li>è®¾ç½®äº† no-cache æˆ–è€… private åï¼Œæ‰“å¼€æ–°çª—å£æ—¶ä¼šé‡æ–°è®¿é—®æœåŠ¡å™¨ã€‚è‹¥è®¾ç½® max-ageï¼Œåˆ™ç¼“å­˜æœŸé—´ä¸è®¿é—®æœåŠ¡å™¨</li><li>è®¾ç½® private å’Œæ­£æ•°çš„ max-age æ—¶ï¼Œåé€€æ—¶å€™ä¸ä¼šè®¿é—®æœåŠ¡å™¨</li><li>è®¾ç½® no-cache å’Œæ­£æ•°çš„ max-age æ—¶ï¼Œåé€€æ—¶ä¼šè®¿é—®æœåŠ¡å™¨</li></ul><h3 id="NginxæœåŠ¡ç«¯ç¼“å­˜"><a href="#NginxæœåŠ¡ç«¯ç¼“å­˜" class="headerlink" title="NginxæœåŠ¡ç«¯ç¼“å­˜"></a>NginxæœåŠ¡ç«¯ç¼“å­˜</h3><p>åœ¨ Web ç¼“å­˜çš„ç§ç±»ï¼Œæˆ‘ä»¬æåˆ°äº† Ngixn æœåŠ¡ç«¯ç¼“å­˜ï¼Œè€Œä¸Šé¢ä»…ä»…ä»‹ç»äº†åœ¨æµè§ˆå™¨è¿›è¡Œç¼“å­˜ï¼Œè€Œå› ä¸º Ngixn æœåŠ¡ç«¯ç¼“å­˜çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥å‰å¾€ <strong>Nginx - ç¼“å­˜é›†æˆ</strong> è¿›è¡Œå­¦ä¹ ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NginxåŸºæœ¬ä½¿ç”¨</title>
      <link href="/2022/11/09/Nginx_Base_Use/"/>
      <url>/2022/11/09/Nginx_Base_Use/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-åŸºæœ¬ä½¿ç”¨"><a href="#Nginx-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="Nginx åŸºæœ¬ä½¿ç”¨"></a>Nginx åŸºæœ¬ä½¿ç”¨</h1><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.7e2zl4ci9t40.webp" alt="image"></p><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>è¿›å…¥Nginxçš„ä¸»ç›®å½•æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™äº›æ–‡ä»¶å¤¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master /]<span class="comment"># cd /usr/local/nginx/</span></span><br><span class="line">[root@master nginx]<span class="comment"># ll</span></span><br><span class="line">æ€»ç”¨é‡ 0</span><br><span class="line">drwx------ 2 nobody root   6 7æœˆ  27 20:35 client_body_temp</span><br><span class="line">drwxr-xr-x 2 root   root 333 7æœˆ  27 20:31 conf</span><br><span class="line">drwx------ 2 nobody root   6 7æœˆ  27 20:35 fastcgi_temp</span><br><span class="line">drwxr-xr-x 2 root   root  40 7æœˆ  27 20:31 html</span><br><span class="line">drwxr-xr-x 2 root   root  58 7æœˆ  27 20:35 logs</span><br><span class="line">drwx------ 2 nobody root   6 7æœˆ  27 20:35 proxy_temp</span><br><span class="line">drwxr-xr-x 2 root   root  36 7æœˆ  27 20:33 sbin</span><br><span class="line">drwx------ 2 nobody root   6 7æœˆ  27 20:35 scgi_temp</span><br><span class="line">drwx------ 2 nobody root   6 7æœˆ  27 20:35 uwsgi_temp</span><br></pre></td></tr></table></figure><p>å…¶ä¸­è¿™å‡ ä¸ªæ–‡ä»¶å¤¹åœ¨åˆšå®‰è£…åæ˜¯æ²¡æœ‰çš„ï¼Œä¸»è¦ç”¨æ¥å­˜æ”¾è¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client_body_temp fastcgi_temp proxy_temp scgi_temp</span><br></pre></td></tr></table></figure><ul><li>ä¸»è¦ç›®å½•è¯´æ˜</li></ul><table><thead><tr><th>ç›®å½•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>conf</td><td>ç”¨æ¥å­˜æ”¾é…ç½®æ–‡ä»¶ç›¸å…³</td></tr><tr><td>html</td><td>ç”¨æ¥å­˜æ”¾é™æ€æ–‡ä»¶çš„é»˜è®¤ç›®å½• htmlã€cssç­‰</td></tr><tr><td>sbin</td><td>nginxçš„ä¸»ç¨‹åº</td></tr></tbody></table><h2 id="åŸºæœ¬è¿è¡ŒåŸç†"><a href="#åŸºæœ¬è¿è¡ŒåŸç†" class="headerlink" title="åŸºæœ¬è¿è¡ŒåŸç†"></a>åŸºæœ¬è¿è¡ŒåŸç†</h2><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.5klrdamfdsg0.webp" alt="image"></p><h2 id="å¯åŠ¨åœæ­¢å‘½ä»¤"><a href="#å¯åŠ¨åœæ­¢å‘½ä»¤" class="headerlink" title="å¯åŠ¨åœæ­¢å‘½ä»¤"></a>å¯åŠ¨åœæ­¢å‘½ä»¤</h2><p>å¯¹äº Nginx çš„å¯åœåœ¨ Linux ç³»ç»Ÿä¸­ä¹Ÿæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæˆ‘ä»¬ä»‹ç»ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>Nginx æœåŠ¡çš„ä¿¡å·æ§åˆ¶</li><li>Nginx çš„å‘½ä»¤è¡Œæ§åˆ¶</li></ul><h3 id="æœåŠ¡ä¿¡å·æ§åˆ¶"><a href="#æœåŠ¡ä¿¡å·æ§åˆ¶" class="headerlink" title="æœåŠ¡ä¿¡å·æ§åˆ¶"></a>æœåŠ¡ä¿¡å·æ§åˆ¶</h3><p>åœ¨äº†è§£å†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦è€ƒè™‘ä¸€äº›é—®é¢˜ï¼š</p><ul><li><p>Nginx ä¸­çš„ master å’Œ worker è¿›ç¨‹?</p></li><li><p>Nginx çš„å·¥ä½œæ–¹å¼?</p></li><li><p>å¦‚ä½•è·å–è¿›ç¨‹çš„ PID?</p></li><li><p>ä¿¡å·æœ‰å“ªäº›?</p></li><li><p>å¦‚ä½•é€šè¿‡ä¿¡å·æ§åˆ¶ Nginx çš„å¯åœç­‰ç›¸å…³æ“ä½œ?</p></li></ul><p>å‰é¢åœ¨æåˆ° Nginx çš„é«˜æ€§èƒ½ï¼Œå…¶å®ä¹Ÿå’Œå®ƒçš„æ¶æ„æ¨¡å¼æœ‰å…³ã€‚Nginx é»˜è®¤é‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹çš„æ–¹å¼æ¥å·¥ä½œçš„ï¼Œå½“å°† Nginx å¯åŠ¨åï¼Œæˆ‘ä»¬é€šè¿‡ <code>ps -ef | grep nginx</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep nginx</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master sbin]<span class="comment"># ps -ef| grep nginx</span></span><br><span class="line">root       3564      1  0 13:54 ?        00:00:00 nginx: master process ./nginx</span><br><span class="line">nobody     3565   3564  0 13:54 ?        00:00:00 nginx: worker process</span><br><span class="line">root       3567   3483  0 13:54 pts/1    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒNginx åå°è¿›ç¨‹ä¸­åŒ…å«ä¸€ä¸ª master è¿›ç¨‹å’Œå¤šä¸ª worker è¿›ç¨‹ï¼Œmaster è¿›ç¨‹ä¸»è¦ç”¨æ¥ç®¡ç† worker è¿›ç¨‹ï¼ŒåŒ…å«æ¥æ”¶å¤–ç•Œçš„ä¿¡æ¯ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„ä¿¡å·å‘é€ç»™å„ä¸ª worker è¿›ç¨‹ï¼Œç›‘æ§ worker è¿›ç¨‹çš„çŠ¶æ€ã€‚å½“ worker è¿›ç¨‹å‡ºç°å¼‚å¸¸é€€å‡ºåï¼Œä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨æ–°çš„ worker è¿›ç¨‹ã€‚è€Œ worker è¿›ç¨‹åˆ™æ˜¯ä¸“é—¨ç”¨æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚çš„ï¼Œå„ä¸ª worker è¿›ç¨‹ä¹‹é—´æ˜¯å¹³ç­‰çš„å¹¶ä¸”ç›¸äº’ç‹¬ç«‹ï¼Œå¤„ç†è¯·æ±‚çš„æœºä¼šä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p><p>Nginx çš„è¿›ç¨‹æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥è¯´æ˜ä¸‹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220728/image.2i4zuw23isa0.webp" alt="image"></p><p>æˆ‘ä»¬ç°åœ¨ä½œä¸ºç®¡ç†å‘˜ï¼Œåªéœ€è¦é€šè¿‡ç»™ master è¿›ç¨‹å‘é€ä¿¡å·å°±å¯ä»¥æ¥æ§åˆ¶ Nginxï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æœ‰ä¸¤ä¸ªå‰ææ¡ä»¶ï¼Œä¸€ä¸ªæ˜¯è¦æ“ä½œçš„ master è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ ç»™ master è¿›ç¨‹çš„ä¿¡å·ã€‚</p><ol><li>è¦æƒ³æ“ä½œ Nginx çš„ master è¿›ç¨‹ï¼Œå°±éœ€è¦è·å–åˆ° master è¿›ç¨‹çš„è¿›ç¨‹å· PIDã€‚è·å–æ–¹å¼ç®€å•ä»‹ç»ä¸¤ä¸ªï¼š</li></ol><ul><li>é€šè¿‡ <code>ps -ef | grep nginx</code></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep nginx</span><br></pre></td></tr></table></figure><ul><li>åœ¨è®²è§£ Nginx çš„ <code>./configure</code> çš„é…ç½®å‚æ•°çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå‚æ•° <code>--pid-path=PATH</code>ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯ <code>/usr/local/nginx/logs/nginx.pid</code>ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æŸ¥çœ‹è¯¥æ–‡ä»¶æ¥è·å– Nginx çš„ master è¿›ç¨‹ PID</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿¡å·(signal)</li></ol><table><thead><tr><th>ä¿¡å·</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>TERM/INT</td><td>ç«‹å³å…³é—­æ•´ä¸ªæœåŠ¡ï¼ˆå…³é—­ Nginxï¼‰</td></tr><tr><td>QUIT</td><td>ã€Œä¼˜é›…ã€çš„å…³é—­æ•´ä¸ªæœåŠ¡ï¼ˆå…³é—­ Nginxï¼‰</td></tr><tr><td>HUP</td><td>é‡è¯»é…ç½®æ–‡ä»¶å¹¶ä½¿ç”¨æœåŠ¡å¯¹æ–°é…ç½®é¡¹ç”Ÿæ•ˆï¼ˆé‡å¯ Nginxï¼‰</td></tr><tr><td>USR1</td><td>é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œæ—¥å¿—åˆ‡å‰²ï¼ˆé‡å¯æ—¥å¿—ï¼‰</td></tr><tr><td>USR2</td><td>å¹³æ»‘å‡çº§åˆ°æœ€æ–°ç‰ˆçš„ Nginx</td></tr><tr><td>WINCH</td><td>æ‰€æœ‰å­è¿›ç¨‹ä¸åœ¨æ¥æ”¶å¤„ç†æ–°è¿æ¥ï¼Œç›¸å½“äºç»™ Work è¿›ç¨‹å‘é€ QUIT æŒ‡ä»¤</td></tr></tbody></table><p>è°ƒç”¨å‘½ä»¤ä¸º <code>kill -signal PID</code></p><blockquote><p>signalï¼šå³ä¸ºä¿¡å·ï¼›PID å³ä¸ºè·å–åˆ°çš„ master è¿›ç¨‹ PID</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -signal PID</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ¼å¼ä¸€ï¼š</span></span><br><span class="line"><span class="built_in">kill</span> -TERM PID</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç«‹å³å…³é—­å½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -TERM `cat /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid`</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¼å¼ä¸€ï¼š</span></span><br><span class="line"><span class="built_in">kill</span> -INT PID</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç«‹å³å…³é—­å½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -INT `cat /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><ul><li>æ¡ˆä¾‹</li></ul><ol><li>å‘é€ TERM/INT ä¿¡å·ç»™ master è¿›ç¨‹ï¼Œä¼šå°† Nginx æœåŠ¡ç«‹å³å…³é—­ã€‚</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master nginx]<span class="comment"># cat logs/nginx.pid</span></span><br><span class="line">3564</span><br><span class="line">[root@master nginx]<span class="comment"># kill  -TERM 3564</span></span><br><span class="line">[root@master nginx]<span class="comment"># ps -ef | grep nginx</span></span><br><span class="line">root       8874   8753  0 15:58 pts/2    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure><ol start="2"><li>å‘é€ QUIT ä¿¡å·ç»™ master è¿›ç¨‹ï¼Œmaster è¿›ç¨‹ä¼šæ§åˆ¶æ‰€æœ‰çš„ work è¿›ç¨‹ä¸å†æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œç­‰æ‰€æœ‰è¯·æ±‚å¤„ç†å®Œåï¼Œåœ¨æŠŠè¿›ç¨‹éƒ½å…³é—­æ‰ã€‚</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼˜é›… å…³é—­çº¿ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -QUIT PID</span><br><span class="line"></span><br><span class="line"><span class="comment"># ã€Œä¼˜é›…ã€å…³é—­å½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -QUIT `cat /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><ol start="3"><li>å‘é€ HUP ä¿¡å·ç»™ master è¿›ç¨‹ï¼Œmaster è¿›ç¨‹ä¼šæŠŠæ§åˆ¶æ—§çš„ worker è¿›ç¨‹ä¸å†æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œç­‰å¤„ç†å®Œè¯·æ±‚åå°†æ—§çš„ worker è¿›ç¨‹å…³é—­æ‰ï¼Œç„¶åæ ¹æ®<mark>æ›´æ”¹Nginx çš„é…ç½®æ–‡ä»¶</mark>é‡æ–°å¯åŠ¨æ–°çš„ worker è¿›ç¨‹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å¯ worker è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -HUP PID </span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯å½“å‰ worker è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -HUP `cat /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><ol start="4"><li>å‘é€ USR1 ä¿¡å·ç»™ master è¿›ç¨‹ï¼Œå‘Šè¯‰ Nginx é‡æ–°å¼€å¯æ—¥å¿—æ–‡ä»¶ã€‚å¦‚æœæ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤äº†ï¼Œå¯ä»¥åˆ©ç”¨æ­¤å‘½ä»¤é‡æ–°æ‰“å¼€ã€‚</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">kill</span> -USR1 PID</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°æ‰“å¼€å½“å‰ Nginx çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">kill</span> -USR1 `cat /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><ol start="5"><li>å‘é€ USR2 ä¿¡å·ç»™ master è¿›ç¨‹ï¼Œå‘Šè¯‰ master è¿›ç¨‹è¦å¹³æ»‘å‡çº§ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¼šé‡æ–°å¼€å¯å¯¹åº”çš„ master è¿›ç¨‹å’Œ worker è¿›ç¨‹ï¼Œæ•´ä¸ªç³»ç»Ÿä¸­å°†ä¼šæœ‰ä¸¤ä¸ªmaster è¿›ç¨‹ï¼Œå¹¶ä¸”æ–°çš„ master è¿›ç¨‹çš„ PID ä¼šè¢«è®°å½•åœ¨ <code>/usr/local/nginx/logs/nginx.pid</code>ï¼Œè€Œä¹‹å‰çš„æ—§çš„ master è¿›ç¨‹ PID ä¼šè¢«è®°å½•åœ¨ <code>/usr/local/nginx/logs/nginx.pid.oldbin</code> æ–‡ä»¶ä¸­ï¼Œæ¥ç€å†æ¬¡å‘é€ QUIT ä¿¡å·ç»™æ—§çš„ master è¿›ç¨‹ï¼Œè®©å…¶å¤„ç†å®Œè¯·æ±‚åå†è¿›è¡Œå…³é—­</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯æ–°çš„è¿›ç¨‹ï¼Œä½†æ˜¯ä¸åˆ é™¤æ—§çš„è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -USR2 PID</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯æ–°çš„è¿›ç¨‹ï¼Œä½†æ˜¯ä¸åˆ é™¤å½“å‰è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -USR2 `cat /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><p>å½“æ–°è¿›ç¨‹å‡çº§åï¼ˆå®Œå…¨å¯åŠ¨åï¼‰ï¼Œå†å…³é—­æ—§çš„è¿›ç¨‹ï¼Œæ—§è¿›ç¨‹çš„ PID åœ¨å¦ä¸€ä¸ª <code>nginx.pid.oldbin</code> æ–‡ä»¶é‡Œ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­æ—§çš„çº¿ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -QUIT `cat /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid.oldbin`</span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220728/image.5dgklob27do0.webp" alt="image"></p><ol start="6"><li>å‘é€ WINCH ä¿¡å·ç»™ master è¿›ç¨‹,è®© master è¿›ç¨‹æ§åˆ¶ä¸è®©æ‰€æœ‰çš„ worker è¿›ç¨‹åœ¨æ¥æ”¶æ–°çš„è¯·æ±‚äº†ï¼Œè¯·æ±‚å¤„ç†å®Œåå…³é—­ worker è¿›ç¨‹ã€‚æ³¨æ„ master è¿›ç¨‹ä¸ä¼šè¢«å…³é—­æ‰</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢ worker è¿›ç¨‹ï¼Œä½†æ˜¯ä¸åœæ­¢ master è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -WINCH PID </span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢å½“å‰ worker è¿›ç¨‹ï¼Œä½†æ˜¯ä¸åœæ­¢ master è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -WINCH `cat /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤è¡Œæ§åˆ¶"><a href="#å‘½ä»¤è¡Œæ§åˆ¶" class="headerlink" title="å‘½ä»¤è¡Œæ§åˆ¶"></a>å‘½ä»¤è¡Œæ§åˆ¶</h3><p>æ­¤æ–¹å¼æ˜¯é€šè¿‡ Nginx å®‰è£…ç›®å½•ä¸‹çš„ sbin ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶ nginx(æ–‡ä»¶å) æ¥è¿›è¡Œå¯¹ Nginx çŠ¶æ€çš„æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>nginx -h</code> æ¥æŸ¥çœ‹éƒ½æœ‰å“ªäº›å‚æ•°å¯ä»¥ç”¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master sbin]<span class="comment"># ./nginx -h</span></span><br><span class="line">nginx version: nginx/1.21.6</span><br><span class="line">Usage: nginx [-?hvVtTq] [-s signal] [-p prefix]</span><br><span class="line">             [-e filename] [-c filename] [-g directives]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -?,-h         : this <span class="built_in">help</span></span><br><span class="line">  -v            : show version and <span class="built_in">exit</span></span><br><span class="line">  -V            : show version and configure options <span class="keyword">then</span> <span class="built_in">exit</span></span><br><span class="line">  -t            : <span class="built_in">test</span> configuration and <span class="built_in">exit</span></span><br><span class="line">  -T            : <span class="built_in">test</span> configuration, dump it and <span class="built_in">exit</span></span><br><span class="line">  -q            : suppress non-error messages during configuration testing</span><br><span class="line">  -s signal     : send signal to a master process: stop, quit, reopen, reload</span><br><span class="line">  -p prefix     : <span class="built_in">set</span> prefix path (default: /usr/<span class="built_in">local</span>/nginx/)</span><br><span class="line">  -e filename   : <span class="built_in">set</span> error <span class="built_in">log</span> file (default: logs/error.log)</span><br><span class="line">  -c filename   : <span class="built_in">set</span> configuration file (default: conf/nginx.conf)</span><br><span class="line">  -g directives : <span class="built_in">set</span> global directives out of configuration file</span><br></pre></td></tr></table></figure><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-? å’Œ -h</td><td>æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</td></tr><tr><td>-v</td><td>æ‰“å°ç‰ˆæœ¬å·ä¿¡æ¯å¹¶é€€å‡º</td></tr><tr><td>-V</td><td>æ‰“å°ç‰ˆæœ¬å·ä¿¡æ¯å’Œé…ç½®ä¿¡æ¯å¹¶é€€å‡º</td></tr><tr><td>-t</td><td>æµ‹è¯• Nginx çš„é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®å¹¶é€€å‡º</td></tr><tr><td>-T</td><td>æµ‹è¯• Nginx çš„é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®å¹¶åˆ—å‡ºç”¨åˆ°çš„é…ç½®æ–‡ä»¶ä¿¡æ¯ç„¶åé€€å‡º</td></tr><tr><td>-q</td><td>åœ¨é…ç½®æµ‹è¯•æœŸé—´è¿‡æ»¤æ‰éé”™è¯¯æ¶ˆæ¯</td></tr><tr><td>-s</td><td>signal ä¿¡å·ï¼Œåé¢çš„å‘½ä»¤å’ŒæœåŠ¡ä¿¡å·æ§åˆ¶åŠŸèƒ½ç±»ä¼¼ï¼š  <code>stop</code>ï¼šå¿«é€Ÿå…³é—­ï¼Œç±»ä¼¼äº TERM/INT ä¿¡å·çš„ä½œç”¨ <code>quit</code>ï¼šä¼˜é›…çš„å…³é—­ï¼Œç±»ä¼¼äº QUIT ä¿¡å·çš„ä½œç”¨ <code>reopen</code>ï¼šé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ç±»ä¼¼äº USR1 ä¿¡å·çš„ä½œç”¨ <code>reload</code>ï¼šé‡å¯ Nginxï¼Œç±»ä¼¼äº HUP ä¿¡å·çš„ä½œç”¨</td></tr><tr><td>-p</td><td>prefixï¼ŒæŒ‡å®š Nginx çš„é»˜è®¤å®‰è£…è·¯å¾„ï¼Œ(é»˜è®¤ä¸ºï¼š/usr/local/nginx/)</td></tr><tr><td>-c</td><td>filenameï¼ŒæŒ‡å®š Nginx çš„é…ç½®æ–‡ä»¶è·¯å¾„,(é»˜è®¤ä¸ºï¼šconf/nginx.conf)</td></tr><tr><td>-g</td><td>ç”¨æ¥è¡¥å…… Nginx é…ç½®æ–‡ä»¶ï¼Œå‘ Nginx æœåŠ¡æŒ‡å®šå¯åŠ¨æ—¶åº”ç”¨å…¨å±€çš„é…ç½®</td></tr></tbody></table><ul><li>æ¡ˆä¾‹</li></ul><p>å¦‚æœè§‰å¾—æ¯æ¬¡æ‰§è¡Œ nginx æŒ‡ä»¤éƒ½å¿…é¡»è¿›å…¥ sbin ç›®å½•ï¼Œåˆ™å°†è¯¥æŒ‡ä»¤è®¾ç½®ä¸ºå…¨å±€ä½¿ç”¨ã€‚</p><ol><li>ä¸¤ä¸ªæŸ¥çœ‹ç‰ˆæœ¬å‘½ä»¤</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬æŒ‡ä»¤ 1</span></span><br><span class="line">[root@master sbin]<span class="comment"># nginx -v</span></span><br><span class="line"><span class="comment"># è¿”å›ç»“æœ</span></span><br><span class="line">nginx version: nginx/1.21.6</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬æŒ‡ä»¤ 2</span></span><br><span class="line">[root@master sbin]<span class="comment"># nginx -V</span></span><br><span class="line"><span class="comment"># è¿”å›ç»“æœ</span></span><br><span class="line">nginx version: nginx/1.21.6</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)</span><br><span class="line">configure arguments: --prefix=/usr/<span class="built_in">local</span>/nginx</span><br></pre></td></tr></table></figure><ol start="2"><li>æµ‹è¯• Nginx çš„é…ç½®æ–‡ä»¶è¯­æ³•</li></ol><p>æˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“é…ç½®æ–‡ä»¶çš„è·¯å¾„åœ¨å“ªï¼Œå…ˆæ‰§è¡Œ <code>-t</code> è¿›è¡Œæµ‹è¯•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æµ‹è¯• Nginx çš„é…ç½®æ–‡ä»¶è¯­æ³•</span></span><br><span class="line">[root@master sbin]<span class="comment"># nginx -t</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»“æœ è¿”å› æˆåŠŸ</span></span><br><span class="line">nginx: the configuration file /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure><p>ç”±ç¬¬ 6 è¡Œä»£ç å¯ä»¥çŸ¥é“æµ‹è¯•æˆåŠŸï¼Œç¬¬ 5 è¡Œä»£ç å‘Šè¯‰æˆ‘ä»¬é…ç½®æ–‡ä»¶çš„ç›®å½•ï¼Œæˆ‘ä»¬å»ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œç„¶åå†è¿›è¡Œæµ‹è¯•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master sbin]<span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###add</span></span><br><span class="line">HelloWorld</span><br></pre></td></tr></table></figure><p>é‡æ–°è¿›è¡Œæµ‹è¯•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æµ‹è¯• Nginx çš„é…ç½®æ–‡ä»¶è¯­æ³•</span></span><br><span class="line">[root@master sbin]<span class="comment"># nginx -t</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›ç»“æœï¼ˆå¤±è´¥ï¼‰</span></span><br><span class="line">nginx: [emerg] unknown directive <span class="string">"HelloWorld"</span> <span class="keyword">in</span> /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf:3</span><br><span class="line">nginx: configuration file /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf <span class="built_in">test</span> failed</span><br></pre></td></tr></table></figure><p>ç”±ç¬¬ 6 è¡Œä»£ç å¯ä»¥çŸ¥é“ï¼Œé…ç½®æ–‡ä»¶å‡ºé”™äº†ã€‚éªŒè¯å®Œäº†ï¼Œè®°å¾—å°†é…ç½®æ–‡ä»¶æ”¹å›æ¥ã€‚</p><ol start="3"><li>æŒ‡å®š Nginx çš„é»˜è®¤å®‰è£…è·¯å¾„</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -p /usr/<span class="built_in">local</span>/nginx/</span><br></pre></td></tr></table></figure><ol start="4"><li>æŒ‡å®š Nginx çš„é…ç½®æ–‡ä»¶è·¯å¾„</li></ol><p>å…ˆæŠŠé…ç½®æ–‡ä»¶æ‹·è´åˆ°å¦ä¸€ä¸ªç›®å½•ï¼Œç„¶åä¿®æ”¹æ‹·è´åçš„é…ç½®æ–‡ä»¶å†…å®¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‹·è´é…ç½®æ–‡ä»¶</span></span><br><span class="line">cp /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf /opt</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹æ‹·è´åçš„é…ç½®æ–‡ä»¶å†…å®¹</span></span><br><span class="line">vim /opt/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># add</span></span><br><span class="line">HelloWorld</span><br></pre></td></tr></table></figure><p>æµ‹è¯•é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼ŒæŒ‡å®šæ‹·è´åçš„é…ç½®æ–‡ä»¶è¿›è¡Œæµ‹è¯•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šé…ç½®æ–‡ä»¶è¿›è¡Œæµ‹è¯•</span></span><br><span class="line">[root@master nginx]<span class="comment"># nginx -tc /opt/nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿”å›ç»“æœ</span></span><br><span class="line">nginx: [emerg] unknown directive <span class="string">"HelloWorld"</span> <span class="keyword">in</span> /opt/nginx.conf:3</span><br><span class="line">nginx: configuration file /opt/nginx.conf <span class="built_in">test</span> failed</span><br></pre></td></tr></table></figure><p>è¯´æ˜æŒ‡å®šé…ç½®æ–‡ä»¶ç›®å½•ç”Ÿæ•ˆï¼Œåªæ˜¯æ–‡ä»¶å†…å®¹è¯­æ³•ä¸å¯¹ã€‚</p><h2 id="ç‰ˆæœ¬å‡çº§å’Œæ–°å¢æ¨¡å—"><a href="#ç‰ˆæœ¬å‡çº§å’Œæ–°å¢æ¨¡å—" class="headerlink" title="ç‰ˆæœ¬å‡çº§å’Œæ–°å¢æ¨¡å—"></a>ç‰ˆæœ¬å‡çº§å’Œæ–°å¢æ¨¡å—</h2><p>å¦‚æœæƒ³å¯¹ Nginx çš„ç‰ˆæœ¬è¿›è¡Œæ›´æ–°ï¼Œæˆ–è€…è¦åº”ç”¨ä¸€äº›æ–°çš„æ¨¡å—ï¼Œæœ€ç®€å•çš„åšæ³•å°±æ˜¯åœæ­¢å½“å‰çš„ Nginx æœåŠ¡ï¼Œç„¶åå¼€å¯æ–°çš„ Nginx æœåŠ¡ã€‚ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·æ˜¯æ— æ³•è®¿é—®æœåŠ¡å™¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° Nginx æœåŠ¡å™¨æä¾›çš„å¹³æ»‘å‡çº§åŠŸèƒ½ã€‚è¿™ä¸ªä¹Ÿæ˜¯ Nginx çš„ä¸€å¤§ç‰¹ç‚¹ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå°±å¯ä»¥ä½¿ Nginx åœ¨ 7 * 24 å°æ—¶ä¸é—´æ–­çš„æä¾›æœåŠ¡äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸‹éœ€æ±‚ï¼š</p><blockquote><p>éœ€æ±‚ï¼šNginx çš„ç‰ˆæœ¬æœ€å¼€å§‹ä½¿ç”¨çš„æ˜¯ Nginx-1.14.2ï¼Œç”±äºæœåŠ¡å‡çº§ï¼Œéœ€è¦å°† Nginx çš„ç‰ˆæœ¬å‡çº§åˆ° Nginx-1.16.1,è¦æ±‚ Nginx ä¸èƒ½ä¸­æ–­æä¾›æœåŠ¡ã€‚</p></blockquote><p>ä¸ºäº†åº”å¯¹ä¸Šè¿°çš„éœ€æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬æä¾›ä¸¤ç§è§£å†³æ–¹æ¡ˆ:</p><ul><li>ä½¿ç”¨ Nginx æœåŠ¡ä¿¡å·å®Œæˆ Nginx çš„å‡çº§</li><li>ä½¿ç”¨ Nginx å®‰è£…ç›®å½•çš„ make å‘½ä»¤å®Œæˆå‡çº§</li></ul><p>ç‰ˆæœ¬å‡çº§å…¶å®å°±æ˜¯æ›¿æ¢å¯æ‰§è¡Œæ–‡ä»¶ nginxã€‚</p><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><ol><li>å…ˆå‡†å¤‡ä¸¤ä¸ªç‰ˆæœ¬çš„ Nginx åˆ†åˆ«æ˜¯ 1.14.2 å’Œ 1.16.1</li><li>ä½¿ç”¨ Nginx æºç å®‰è£…çš„æ–¹å¼å°† 1.14.2 ç‰ˆæœ¬å®‰è£…æˆåŠŸå¹¶æ­£ç¡®è®¿é—®</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è§£å‹ 1.14.2 ç‰ˆæœ¬</span></span><br><span class="line">tar -xzf nginx-1.14.2.tar.gz</span><br><span class="line"><span class="comment"># è¿›å…¥è§£å‹ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> nginx-1.14.2/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œé…ç½®æ–‡ä»¶</span></span><br><span class="line">./configure</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘å®‰è£…</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><ol start="3"><li>å°† Nginx 1.16.1 ç‰ˆæœ¬è¿›è¡Œå‚æ•°é…ç½®å’Œç¼–è¯‘ï¼Œä¸éœ€è¦è¿›è¡Œå®‰è£…ã€‚</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è§£å‹ 1.16.1 ç‰ˆæœ¬</span></span><br><span class="line">tar -xzf nginx-1.16.1.tar.gz</span><br><span class="line"><span class="comment"># è¿›å…¥è§£å‹ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> nginx-1.16.1/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œé…ç½®æ–‡ä»¶</span></span><br><span class="line">./configure</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»…ä»…ç¼–è¯‘</span></span><br><span class="line">make</span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡ä¿¡å·è¿›è¡Œå‡çº§"><a href="#æœåŠ¡ä¿¡å·è¿›è¡Œå‡çº§" class="headerlink" title="æœåŠ¡ä¿¡å·è¿›è¡Œå‡çº§"></a>æœåŠ¡ä¿¡å·è¿›è¡Œå‡çº§</h3><p>ç¬¬ä¸€æ­¥:å°† 1.14.2 ç‰ˆæœ¬çš„ sbin ç›®å½•ä¸‹çš„ nginx è¿›è¡Œå¤‡ä»½</p><blockquote><p>ä¸æ˜¯å¤åˆ¶ä¸€ä»½ï¼Œæ˜¯ç›´æ¥ä¿®æ”¹åŸæ¥çš„ nginxã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ sbin ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½ä¸º nginxold æ–‡ä»¶</span></span><br><span class="line">mv nginx nginx.backup</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼šå°† Nginx 1.16.1 å®‰è£…ç›®å½•ç¼–è¯‘åçš„ objs ç›®å½•ä¸‹çš„ nginx æ–‡ä»¶ï¼Œæ‹·è´åˆ°åŸæ¥ <code>/usr/local/nginx/sbin</code> ç›®å½•ä¸‹</p><p>å¦‚æœç¬¬ä¸€æ­¥æ²¡æœ‰å¤‡ä»½ï¼Œé‚£ä¹ˆå°†ä¼šè¦†ç›– 1.14.2 çš„ nginx æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ objs ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> ~/nginx/core/nginx-1.16.1/objs</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´å¯æ‰§è¡Œæ–‡ä»¶åˆ°åŸæ¥çš„ç›®å½•</span></span><br><span class="line">cp nginx /usr/<span class="built_in">local</span>/nginx/sbin</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼šå‘é€ä¿¡å· USR2 ç»™ Nginx çš„ 1.14.2 ç‰ˆæœ¬å¯¹åº”çš„ master è¿›ç¨‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -USR2 `cat /usr/<span class="built_in">local</span>/logs/nginx.pid`</span><br></pre></td></tr></table></figure><p>ç¬¬å››æ­¥ï¼šå‘é€ä¿¡å· QUIT ç»™ Nginx çš„ 1.14.2 ç‰ˆæœ¬å¯¹åº”çš„ master è¿›ç¨‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -QUIT `cat /usr/<span class="built_in">local</span>/logs/nginx.pid.oldbin`</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§"><a href="#å®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§" class="headerlink" title="å®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§"></a>å®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§</h3><p>ç¬¬ä¸€æ­¥ï¼šå°† 1.14.2 ç‰ˆæœ¬çš„ sbin ç›®å½•ä¸‹çš„ nginx è¿›è¡Œå¤‡ä»½</p><blockquote><p>ä¸æ˜¯å¤åˆ¶ä¸€ä»½ï¼Œæ˜¯ç›´æ¥ä¿®æ”¹åŸæ¥çš„ nginxã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ sbin ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½ä¸º nginxold æ–‡ä»¶</span></span><br><span class="line">mv nginx nginx.backup</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼šå°† Nginx1.16.1 å®‰è£…ç›®å½•ç¼–è¯‘åçš„ objs ç›®å½•ä¸‹çš„ nginx æ–‡ä»¶ï¼Œæ‹·è´åˆ°åŸæ¥ <code>/usr/local/nginx/sbin</code> ç›®å½•ä¸‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ objs ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> ~/nginx/core/nginx-1.16.1/objs</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´å¯æ‰§è¡Œæ–‡ä»¶åˆ°åŸæ¥çš„ç›®å½•</span></span><br><span class="line">cp nginx /usr/<span class="built_in">local</span>/nginx/sbin</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼šè¿›å…¥åˆ°å®‰è£…ç›®å½•ï¼Œæ‰§è¡Œ <code>make upgrade</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make upgrade</span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220728/image.2hpc905f42a0.webp" alt="image"></p><p>ç¬¬å››æ­¥ï¼šæŸ¥çœ‹æ˜¯å¦æ›´æ–°æˆåŠŸ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -v</span><br></pre></td></tr></table></figure><p>åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå…¶å® Nginx æ˜¯ä¸€ç›´å¯¹å¤–æä¾›æœåŠ¡çš„ã€‚å¹¶ä¸”å½“ Nginx çš„æœåŠ¡å™¨å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥é€šè¿‡æµè§ˆå™¨è¿›è¡Œç›´æ¥è®¿é—®çš„ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ”¹ html ç›®å½•ä¸‹çš„é¡µé¢æ¥ä¿®æ”¹æˆ‘ä»¬åœ¨é¡µé¢ä¸Šæ‰€çœ‹åˆ°çš„å†…å®¹ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä¿®æ”¹ html ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œèƒ½ä¸èƒ½å¤šæ·»åŠ ä¸€äº›é¡µé¢æ˜¯ Nginx çš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œè¿˜æœ‰å‰é¢èŠåˆ° Nginx çš„å‰ç«¯åŠŸèƒ½åˆæ˜¯å¦‚ä½•æ¥å®ç°çš„ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å¯¹ <a href="/middleware/Nginx/Nginx_Configuration_file">Nginx çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶</a> è¿›è¡Œä¸€ä¸ªè¯¦ç»†çš„å­¦ä¹ ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxå®‰è£…</title>
      <link href="/2022/11/09/Nginx_install/"/>
      <url>/2022/11/09/Nginx_install/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-å®‰è£…"><a href="#Nginx-å®‰è£…" class="headerlink" title="Nginx å®‰è£…"></a>Nginx å®‰è£…</h1><h2 id="Nginxç‰ˆæœ¬ä»‹ç»"><a href="#Nginxç‰ˆæœ¬ä»‹ç»" class="headerlink" title="Nginxç‰ˆæœ¬ä»‹ç»"></a>Nginxç‰ˆæœ¬ä»‹ç»</h2><p>Nginx çš„å®˜æ–¹ç½‘ç«™ä¸º: <a href="http://nginx.org/" target="_blank" rel="noopener">http://nginx.org</a></p><p>æ‰“å¼€æºç å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„é¡µé¢å†…å®¹</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.4wlfyfbk53i0.webp" alt="image"></p><p>Nginx çš„å®˜æ–¹ä¸‹è½½ç½‘ç«™ä¸º <a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a>ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¹‹é—´åœ¨é¦–é¡µé€‰ä¸­å³è¾¹çš„ download è¿›å…¥ç‰ˆæœ¬ä¸‹è½½ç½‘é¡µã€‚åœ¨ä¸‹è½½é¡µé¢æˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.3e7olqaurau0.webp" alt="image"></p><h2 id="è·å–Nginxæºç "><a href="#è·å–Nginxæºç " class="headerlink" title="è·å–Nginxæºç "></a>è·å–Nginxæºç </h2><p><a href="http://nginx.org/download/" target="_blank" rel="noopener">http://nginx.org/download/</a></p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.3cu95u4zd440.webp" alt="image"></p><h2 id="å‡†å¤‡æœåŠ¡å™¨ç³»ç»Ÿ"><a href="#å‡†å¤‡æœåŠ¡å™¨ç³»ç»Ÿ" class="headerlink" title="å‡†å¤‡æœåŠ¡å™¨ç³»ç»Ÿ"></a>å‡†å¤‡æœåŠ¡å™¨ç³»ç»Ÿ</h2><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><ul><li>è™šæ‹Ÿæœºï¼šVMware WorkStation</li><li>Linux ç³»ç»Ÿï¼šCentos7</li><li>ä¸Šä¼ è½¯ä»¶å·¥å…·ï¼šMobaXtermã€xsheel,SecureCRT ä¹‹ä¸€</li><li>ç½‘ç»œ</li></ul><h3 id="ç¡®è®¤CentOSçš„å†…æ ¸"><a href="#ç¡®è®¤CentOSçš„å†…æ ¸" class="headerlink" title="ç¡®è®¤CentOSçš„å†…æ ¸"></a>ç¡®è®¤CentOSçš„å†…æ ¸</h3><p>å‡†å¤‡ä¸€ä¸ªå†…æ ¸ä¸º 2.6 åŠä»¥ä¸Šç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿï¼Œå› ä¸º linux2.6 åŠä»¥ä¸Šå†…æ ¸æ‰æ”¯æŒ epoll,è€Œ Nginx éœ€è¦è§£å†³é«˜å¹¶å‘å‹åŠ›é—®é¢˜æ˜¯éœ€è¦ç”¨åˆ° epollï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰è¿™æ ·çš„ç‰ˆæœ¬è¦æ±‚ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>uname -a</code> å‘½ä»¤æ¥æŸ¥è¯¢linuxçš„å†…æ ¸ç‰ˆæœ¬</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># uname -a</span></span><br><span class="line">Linux master 3.10.0-1160.el7.x86_64 <span class="comment">#1 SMP Mon Oct 19 16:18:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure><h3 id="ç¡®ä¿Centosèƒ½è”ç½‘"><a href="#ç¡®ä¿Centosèƒ½è”ç½‘" class="headerlink" title="ç¡®ä¿Centosèƒ½è”ç½‘"></a>ç¡®ä¿Centosèƒ½è”ç½‘</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure><p>ä¸‰ç§ç½‘ç»œæ¨¡å¼ï¼šæ¡¥æ¥ã€ä¸»æœºã€NATï¼Œå»ºè®®ä½¿ç”¨è™šæ‹Ÿæœºä½¿ç”¨ NAT æ¨¡å¼</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.4ga3snmdtsa0.webp" alt="image"></p><p>NAT æ¨¡å¼ä¸‹ï¼Œåªè¦ä¸»æœºæœ‰ç½‘ç»œï¼Œåˆ™è™šæ‹Ÿæœºä¹Ÿæœ‰ç½‘ç»œã€‚</p><h3 id="ç¡®è®¤å…³é—­é˜²ç«å¢™"><a href="#ç¡®è®¤å…³é—­é˜²ç«å¢™" class="headerlink" title="ç¡®è®¤å…³é—­é˜²ç«å¢™"></a>ç¡®è®¤å…³é—­é˜²ç«å¢™</h3><p>è¿™ä¸€é¡¹çš„è¦æ±‚ä»…é’ˆå¯¹äºé‚£äº›å¯¹ Linux ç³»ç»Ÿçš„é˜²ç«å¢™è®¾ç½®è§„åˆ™ä¸å¤ªæ¸…æ¥šçš„ï¼Œå»ºè®®å¤§å®¶æŠŠé˜²ç«å¢™éƒ½å…³é—­æ‰ï¼Œå› ä¸ºæŠŠé˜²ç«å¢™å…³é—­æ‰ï¼Œå¯ä»¥çœæ‰åç»­ Nginx ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„è¯¸å¤šé—®é¢˜ã€‚</p><p>å…³é—­çš„æ–¹å¼æœ‰å¦‚ä¸‹ä¸¤ç§:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld      <span class="comment"># å…³é—­è¿è¡Œçš„é˜²ç«å¢™ï¼Œç³»ç»Ÿé‡æ–°å¯åŠ¨åï¼Œé˜²ç«å¢™å°†é‡æ–°æ‰“å¼€</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld   <span class="comment"># æ°¸ä¹…å…³é—­é˜²ç«å¢™ï¼Œï¼Œç³»ç»Ÿé‡æ–°å¯åŠ¨åï¼Œé˜²ç«å¢™ä¾ç„¶å…³é—­</span></span><br><span class="line">systemctl status firewalld <span class="comment"># æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æƒ³å…³é—­é˜²ç«å¢™ï¼Œè®°å¾—å¼€æ”¾ Nginx çš„è®¿é—®ç«¯å£</p><h3 id="ç¡®è®¤åœç”¨selinux"><a href="#ç¡®è®¤åœç”¨selinux" class="headerlink" title="ç¡®è®¤åœç”¨selinux"></a>ç¡®è®¤åœç”¨selinux</h3><p>selinux(security-enhanced linux)ï¼Œç¾å›½å®‰å…¨å±€å¯¹äºå¼ºåˆ¶è®¿é—®æ§åˆ¶çš„å®ç°ï¼Œåœ¨ Linux2.6 å†…æ ¸ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œselinux å·²ç»æˆåŠŸå†…æ ¸ä¸­çš„ä¸€éƒ¨åˆ†ã€‚å¯ä»¥è¯´selinux æ˜¯ Linux å²ä¸Šæœ€æ°å‡ºçš„æ–°å®‰å…¨å­ç³»ç»Ÿä¹‹ä¸€ã€‚è™½ç„¶æœ‰äº† selinuxï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¼šæ›´å®‰å…¨ï¼Œä½†æ˜¯å¯¹äºä½¿ç”¨ Nginx æˆ–è€…å…¶ä»–çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰å¾ˆå¤šè®¾ç½®ï¼Œæ‰€ä»¥è¿™å—å»ºè®®å¤§å®¶å°† selinux è¿›è¡Œå…³é—­ã€‚</p><p><code>sestatus</code> æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># sestatus</span></span><br><span class="line">SELinux status:                 disabled</span><br></pre></td></tr></table></figure><p>å¦‚æœæŸ¥çœ‹ä¸æ˜¯ disabled çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥è¿›è¡Œè®¾ç½®,ä¿®æ”¹ <code>SELINUX=disabled</code>ï¼Œç„¶åé‡å¯ä¸‹ç³»ç»Ÿå³å¯ç”Ÿæ•ˆã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.1063r7fk4lz4.webp" alt="image"></p><h2 id="Nginxç¯å¢ƒå®‰è£…"><a href="#Nginxç¯å¢ƒå®‰è£…" class="headerlink" title="Nginxç¯å¢ƒå®‰è£…"></a>Nginxç¯å¢ƒå®‰è£…</h2><p>Nginx çš„å®‰è£…æ–¹å¼æœ‰ä¸¤ç§åˆ†åˆ«æ˜¯ï¼š</p><ul><li>é€šè¿‡ Nginx æºç <ul><li>é€šè¿‡ Nginx æºç ç®€å•å®‰è£…</li><li>é€šè¿‡ Nginx æºç å¤æ‚å®‰è£…</li></ul></li><li>é€šè¿‡ yum å®‰è£…</li></ul><p>å¦‚æœé€šè¿‡ Nginx æºç å®‰è£…éœ€è¦æå‰å‡†å¤‡å®‰è£…å¥½ç¯å¢ƒï¼Œæˆ‘ç›¸ä¿¡ï¼Œä»»ä½• C è¯­è¨€ç¼–å†™çš„è½¯ä»¶éƒ½ç¦»ä¸å¼€è¿™äº›ç¯å¢ƒï¼Œå®‰è£…åæ‰€æœ‰è½¯ä»¶éƒ½ä¼šæ”¶ç›Šï¼Œå¾€ä¸‹çœ‹ã€‚</p><h3 id="GCCç¼–è¯‘å™¨"><a href="#GCCç¼–è¯‘å™¨" class="headerlink" title="GCCç¼–è¯‘å™¨"></a>GCCç¼–è¯‘å™¨</h3><p>Nginx æ˜¯ä½¿ç”¨ C è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå› æ­¤æƒ³è¦è¿è¡Œ Nginx å°±éœ€è¦å®‰è£…ä¸€ä¸ªç¼–è¯‘å·¥å…·ã€‚GCC å°±æ˜¯ä¸€ä¸ªå¼€æºçš„ç¼–è¯‘å™¨é›†åˆï¼Œç”¨äºå¤„ç†å„ç§å„æ ·çš„è¯­è¨€ï¼Œå…¶ä¸­å°±åŒ…å«äº† C è¯­è¨€ã€‚</p><p>ä½¿ç”¨å‘½ä»¤ <code>yum install -y gcc</code> æ¥å®‰è£…</p><p>å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ <code>gcc --version</code> æ¥æŸ¥çœ‹ gcc æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… gcc</span></span><br><span class="line">yum install -y gcc</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ gcc ç‰ˆæœ¬</span></span><br><span class="line">gcc --version</span><br></pre></td></tr></table></figure><h3 id="PCRE"><a href="#PCRE" class="headerlink" title="PCRE"></a>PCRE</h3><p>Nginx åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨åˆ° PCRE åº“ï¼ˆperl Compatible Regular Expressoin å…¼å®¹æ­£åˆ™è¡¨è¾¾å¼åº“)ï¼Œå› ä¸ºåœ¨ Nginx çš„ Rewrite æ¨¡å—å’Œ Http æ ¸å¿ƒæ¨¡å—éƒ½ä¼šä½¿ç”¨åˆ° PCRE æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ã€‚</p><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>yum install -y pcre pcre-devel</code> æ¥è¿›è¡Œå®‰è£…</p><p>å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ <code>rpm -qa pcre pcre-devel</code> æ¥æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… PCRE å’Œ pcre-devel</span></span><br><span class="line">yum install -y pcre pcre-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ PCRE æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">rpm -qa pcre pcre-devel</span><br></pre></td></tr></table></figure><h3 id="zlib"><a href="#zlib" class="headerlink" title="zlib"></a>zlib</h3><p>zlib åº“æä¾›äº†å¼€å‘äººå‘˜çš„å‹ç¼©ç®—æ³•ï¼Œåœ¨ Nginx çš„å„ä¸ªæ¨¡å—ä¸­éœ€è¦ä½¿ç”¨ gzip å‹ç¼©ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦æå‰å®‰è£…å…¶åº“åŠæºä»£ç  zlib å’Œ zlib-develã€‚</p><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>yum install -y zlib zlib-devel</code> æ¥è¿›è¡Œå®‰è£…</p><p>å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ <code>rpm -qa zlib zlib-devel</code> æ¥æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… zlib å’Œ zlib-devel</span></span><br><span class="line">yum install -y zlib zlib-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ zlib å’Œ zlib-devel æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">rpm -qa zlib zlib-devel</span><br></pre></td></tr></table></figure><h3 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h3><p>OpenSSL æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„è½¯ä»¶åº“åŒ…ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨è¿™ä¸ªåŒ…è¿›è¡Œå®‰å…¨é€šä¿¡ï¼Œå¹¶ä¸”é¿å…è¢«çªƒå¬ã€‚</p><p>SSLï¼šSecure Sockets Layer å®‰å…¨å¥—æ¥åè®®çš„ç¼©å†™ï¼Œå¯ä»¥åœ¨ Internet ä¸Šæä¾›ç§˜å¯†æ€§ä¼ è¾“ï¼Œå…¶ç›®æ ‡æ˜¯ä¿è¯ä¸¤ä¸ªåº”ç”¨é—´é€šä¿¡çš„ä¿å¯†æ€§å’Œå¯é æ€§ã€‚åœ¨ Nginx ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦æä¾›å®‰å…¨ç½‘é¡µæ—¶å°±éœ€è¦ç”¨åˆ° OpenSSL åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ OpenSSL çš„åº“æ–‡ä»¶åŠå®ƒçš„å¼€å‘å®‰è£…åŒ…è¿›è¡Œä¸€ä¸ªå®‰è£…ã€‚</p><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>yum install -y openssl openssl-devel</code> æ¥è¿›è¡Œå®‰è£…</p><p>å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ <code>rpm -qa openssl openssl-devel</code> æ¥æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… OpenSSL åº“</span></span><br><span class="line">yum install -y openssl openssl-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ OpenSSL æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">rpm -qa openssl openssl-devel</span><br></pre></td></tr></table></figure><h3 id="å…¨éƒ¨å®‰è£…å‘½ä»¤"><a href="#å…¨éƒ¨å®‰è£…å‘½ä»¤" class="headerlink" title="å…¨éƒ¨å®‰è£…å‘½ä»¤"></a>å…¨éƒ¨å®‰è£…å‘½ä»¤</h3><p>ä¸Šè¿°å‘½ä»¤ï¼Œä¸€ä¸ªä¸ªæ¥çš„è¯æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸€æ¡å‘½ä»¤æ¥è¿›è¡Œå®‰è£…</p><p><code>yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel</code> è¿›è¡Œå…¨éƒ¨å®‰è£…ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¨éƒ¨å®‰è£… GCCã€PCREã€zlibã€OpenSSL</span></span><br><span class="line">yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬</span></span><br><span class="line">rpm -qa pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure><h2 id="Nginxå®‰è£…"><a href="#Nginxå®‰è£…" class="headerlink" title="Nginxå®‰è£…"></a>Nginxå®‰è£…</h2><p>Nginx çš„å®˜æ–¹ä¸‹è½½ç½‘ç«™ä¸º <a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a></p><h3 id="æºç ç®€å•å®‰è£…"><a href="#æºç ç®€å•å®‰è£…" class="headerlink" title="æºç ç®€å•å®‰è£…"></a>æºç ç®€å•å®‰è£…</h3><ol><li>è¿›å…¥å®˜ç½‘æŸ¥æ‰¾éœ€è¦ä¸‹è½½ç‰ˆæœ¬çš„é“¾æ¥åœ°å€ï¼Œç„¶åä½¿ç”¨ wget å‘½ä»¤è¿›è¡Œä¸‹è½½ï¼Œè¿™é‡Œä¸‹è½½åœ¨ <code>/opt</code> ç›®å½•ä¸‹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line"></span><br><span class="line">wget http://nginx.org/download/nginx-1.21.6.tar.gz</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸‹è½½çš„ç‰ˆæœ¬æ˜¯ 1.21.6ï¼Œè¯·æ ¹æ®éœ€æ±‚æ›´æ”¹ç‰ˆæœ¬å·ã€‚å¦‚æœ wget å‘½ä»¤ä¸‹è½½é€Ÿåº¦æ…¢ï¼Œå¯ä»¥å…ˆä¸‹è½½åˆ° Windows ç³»ç»Ÿï¼Œå†ä½¿ç”¨å·¥å…·ä¸Šä¼ åˆ° Linux ä¸‹ã€‚</p><ol start="2"><li>å»ºè®®å¤§å®¶å°†ä¸‹è½½çš„èµ„æºè¿›è¡ŒåŒ…ç®¡ç†ï¼Œåœ¨ <code>/opt</code> ç›®å½•ä¸‹åˆ›å»º <code>nginx/core</code> ç›®å½•ï¼Œ<code>-p</code> ä»£è¡¨å…è®¸åˆ›å»ºå¤šçº§ç›®å½•</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæŒ‡å®šç›®å½•</span></span><br><span class="line">mkdir -p /opt/nginx/core</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">mv nginx-1.21.6.tar.gz nginx/core</span><br></pre></td></tr></table></figure><ol start="3"><li>è§£å‹ç¼©</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥æŒ‡å®šç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /opt/nginx/core</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line">tar -xzf nginx-1.21.6.tar.gz</span><br></pre></td></tr></table></figure><ol start="4"><li>è¿›å…¥èµ„æºæ–‡ä»¶ä¸­ï¼Œå‘ç° configure æ–‡ä»¶ï¼Œæ‰§è¡Œè¯¥æ–‡ä»¶</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥è§£å‹å‡ºçš„ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> nginx-1.21.6/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œ configure </span></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx</span><br></pre></td></tr></table></figure><ol start="5"><li>ç¼–è¯‘</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><ol start="6"><li>å®‰è£…</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure><ol start="7"><li>æŸ¥çœ‹ nginx çš„å®‰è£…ä½ç½®</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis nginx</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master sbin]<span class="comment"># whereis nginx</span></span><br><span class="line">nginx: /usr/<span class="built_in">local</span>/nginx</span><br></pre></td></tr></table></figure><ol start="8"><li>å¯åŠ¨æµ‹è¯•ã€‚å¯åŠ¨æ–‡ä»¶åœ¨å®‰è£…ç›®å½•ä¸‹çš„ sbin å‘½ä»¤</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥å¯åŠ¨æ–‡ä»¶çš„ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œ nginx æ–‡ä»¶</span></span><br><span class="line">./nginx</span><br></pre></td></tr></table></figure><p>è®¿é—®è‡ªå·± Linux çš„ IP åœ°å€ï¼Œä¸éœ€è¦åŠ ç«¯å£ï¼Œå¦‚æœçœ‹åˆ°å¦‚ä¸‹å›¾ï¼Œä»£è¡¨æˆåŠŸ</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.6xop32js8180.webp" alt="image"></p><h3 id="yumå®‰è£…"><a href="#yumå®‰è£…" class="headerlink" title="yumå®‰è£…"></a>yumå®‰è£…</h3><p>ä½¿ç”¨æºç è¿›è¡Œç®€å•å®‰è£…ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®‰è£…çš„è¿‡ç¨‹æ¯”è¾ƒç¹çï¼Œéœ€è¦æå‰å‡†å¤‡ GCC ç¼–è¯‘å™¨ã€PCRE å…¼å®¹æ­£åˆ™è¡¨è¾¾å¼åº“ã€zlib å‹ç¼©åº“ã€OpenSSL å®‰å…¨é€šä¿¡çš„è½¯ä»¶åº“åŒ…ï¼Œç„¶åæ‰èƒ½è¿›è¡Œ Nginx çš„å®‰è£…ã€‚ä¸‹é¢ä½¿ç”¨ yum å®‰è£…ï¼Œè¿‡ç¨‹æ›´ç®€å•ã€‚</p><ol><li>å®‰è£… yum-utils</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum  install -y yum-utils</span><br></pre></td></tr></table></figure><ol start="2"><li>æ·»åŠ  yum æºæ–‡ä»¶</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/nginx.repo</span><br></pre></td></tr></table></figure><ol start="3"><li>æ·»åŠ å¦‚ä¸‹å†…å®¹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br></pre></td></tr></table></figure><ol start="4"><li>ä½¿ç”¨ yum å®‰è£… Nginx</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y nginx</span><br></pre></td></tr></table></figure><ol start="5"><li>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list | grep nginx</span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.36wvsdkk9zc0.webp" alt="image"></p><ol start="6"><li>ä½¿ç”¨ yum è¿›è¡Œå®‰è£…</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yun install -y nginx</span><br></pre></td></tr></table></figure><ol start="7"><li>æŸ¥çœ‹nginxçš„å®‰è£…ä½ç½®</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis nginx</span><br></pre></td></tr></table></figure><ol start="8"><li>å¯åŠ¨æµ‹è¯•</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cd</span> /usr/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ nginx</span></span><br><span class="line">./nginx</span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.38bsees6wz60.webp" alt="image"></p><p>è®¿é—®è‡ªå·± Linux çš„ IP åœ°å€ï¼Œä¸éœ€è¦åŠ ç«¯å£ï¼Œå¦‚æœçœ‹åˆ°å¦‚ä¸‹å›¾ï¼Œä»£è¡¨æˆåŠŸ</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.6xop32js8180.webp" alt="image"></p><h3 id="æºç ç®€å•å®‰è£…å’Œyumå®‰è£…çš„å·®å¼‚"><a href="#æºç ç®€å•å®‰è£…å’Œyumå®‰è£…çš„å·®å¼‚" class="headerlink" title="æºç ç®€å•å®‰è£…å’Œyumå®‰è£…çš„å·®å¼‚"></a>æºç ç®€å•å®‰è£…å’Œyumå®‰è£…çš„å·®å¼‚</h3><p>è¿™é‡Œå…ˆä»‹ç»ä¸€ä¸ªå‘½ä»¤: <code>./nginx -V</code>ï¼Œé€šè¿‡è¯¥å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°æ‰€å®‰è£… Nginx çš„ç‰ˆæœ¬åŠç›¸å…³é…ç½®ä¿¡æ¯ã€‚</p><p>ç®€å•å®‰è£…çš„é…ç½®ä¿¡æ¯æŸ¥çœ‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master sbin]<span class="comment"># ./nginx -V</span></span><br><span class="line">nginx version: nginx/1.21.6</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)</span><br><span class="line">configure arguments: --prefix=/usr/<span class="built_in">local</span>/nginx</span><br></pre></td></tr></table></figure><p>yum å®‰è£…çš„é…ç½®ä¿¡æ¯æŸ¥çœ‹ï¼šï¼ˆè¿™é‡Œæˆªå– 1.16.1 ç‰ˆæœ¬çš„ å›¾ç‰‡ï¼‰</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.os75hg8w3gg.webp" alt="image"></p><p>å¯ä»¥çœ‹å‡º yum å®‰è£…çš„å‚æ•°éå¸¸å¤šï¼Œå¦‚æœæƒ³æºç ç®€å•å®‰è£…ä¹Ÿæœ‰è¿™äº›å‚æ•°ï¼Œè¿™æ¶‰åŠåˆ°æºç å¤æ‚å®‰è£…ï¼Œå¾€ä¸‹çœ‹ã€‚</p><p>æ‰§è¡Œ <code>tar -zxvf nginx-1.16.1.tar.gz</code> å¯¹ä¸‹è½½çš„èµ„æºè¿›è¡Œè§£å‹ç¼©åï¼Œè¿›å…¥å‹ç¼©åçš„ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æ„</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.320qb912jy00.webp" alt="image"></p><p>å†…å®¹è§£é‡Šï¼š</p><table><thead><tr><th>å†…å®¹å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>auto</td><td>å­˜æ”¾çš„æ˜¯ç¼–è¯‘ç›¸å…³çš„è„šæœ¬</td></tr><tr><td>CHANGES</td><td>ç‰ˆæœ¬å˜æ›´è®°å½•</td></tr><tr><td>CHANGES.ru</td><td>ä¿„ç½—æ–¯æ–‡çš„ç‰ˆæœ¬å˜æ›´è®°å½•</td></tr><tr><td>conf</td><td>Nginx é»˜è®¤çš„é…ç½®æ–‡ä»¶</td></tr><tr><td>configure</td><td>Nginx è½¯ä»¶çš„è‡ªåŠ¨è„šæœ¬ç¨‹åº,æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ–‡ä»¶ï¼Œä½œç”¨å¦‚ä¸‹ï¼š 1ã€æ£€æµ‹ç¯å¢ƒåŠæ ¹æ®ç¯å¢ƒæ£€æµ‹ç»“æœç”Ÿæˆ C ä»£ç  2ã€ç”Ÿæˆç¼–è¯‘ä»£ç éœ€è¦çš„ Makefile æ–‡ä»¶</td></tr><tr><td>contrib</td><td>å­˜æ”¾çš„æ˜¯å‡ ä¸ªç‰¹æ®Šçš„è„šæœ¬æ–‡ä»¶ï¼Œå…¶ä¸­ README ä¸­å¯¹è„šæœ¬æœ‰ç€è¯¦ç»†çš„è¯´æ˜</td></tr><tr><td>html</td><td>å­˜æ”¾çš„æ˜¯ Nginx è‡ªå¸¦çš„ä¸¤ä¸ª html é¡µé¢ï¼Œè®¿é—® Nginx çš„é¦–é¡µå’Œé”™è¯¯é¡µé¢</td></tr><tr><td>LICENSE</td><td>è®¸å¯è¯çš„ç›¸å…³æè¿°æ–‡ä»¶</td></tr><tr><td>man</td><td>Nginx çš„ man æ‰‹å†Œ</td></tr><tr><td>README</td><td>Nginx çš„é˜…è¯»æŒ‡å—</td></tr><tr><td>src</td><td>Nginx çš„æºä»£ç </td></tr></tbody></table><h3 id="æºç å¤æ‚å®‰è£…"><a href="#æºç å¤æ‚å®‰è£…" class="headerlink" title="æºç å¤æ‚å®‰è£…"></a>æºç å¤æ‚å®‰è£…</h3><p>è¿™ç§æ–¹å¼å’Œç®€å•çš„å®‰è£…é…ç½®ä¸åŒçš„åœ°æ–¹åœ¨ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ <code>./configure</code> æ¥å¯¹ç¼–è¯‘å‚æ•°è¿›è¡Œè®¾ç½®ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥æŒ‡å®šã€‚é‚£ä¹ˆéƒ½æœ‰å“ªäº›å‚æ•°å¯ä»¥è¿›è¡Œè®¾ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œä¸€ä¸ªè¯¦ç»†çš„è¯´æ˜ã€‚</p><ul><li>PATHï¼šæ˜¯å’Œè·¯å¾„ç›¸å…³çš„é…ç½®ä¿¡æ¯</li><li>withï¼šæ˜¯å¯åŠ¨æ¨¡å—ï¼Œé»˜è®¤æ˜¯å…³é—­çš„</li><li>withoutï¼šæ˜¯å…³é—­æ¨¡å—ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„</li></ul><p>æˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€äº›ç®€å•çš„è·¯å¾„é…ç½®å·²ç»é€šè¿‡è¿™äº›é…ç½®æ¥å®Œæˆä¸€ä¸ªç®€å•çš„ç¼–è¯‘ï¼š</p><table><thead><tr><th>æŒ‡ä»¤</th><th>ä½œç”¨</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>â€“prefix=PATH</td><td>æŒ‡å‘ Nginx çš„å®‰è£…ç›®å½•</td><td>/usr/local/nginx</td></tr><tr><td>â€“sbin-path=PATH</td><td>æŒ‡å‘(æ‰§è¡Œ)ç¨‹åºæ–‡ä»¶(nginx)çš„è·¯å¾„</td><td>&lt;å®‰è£…ç›®å½•&gt;/sbin/nginx</td></tr><tr><td>â€“modules-path=PATH</td><td>æŒ‡å‘ Nginx åŠ¨æ€æ¨¡å—å®‰è£…ç›®å½•</td><td>&lt;å®‰è£…ç›®å½•&gt;//modules</td></tr><tr><td>â€“conf-path=PATH</td><td>æŒ‡å‘é…ç½®æ–‡ä»¶(nginx.conf)çš„è·¯å¾„</td><td>&lt;å®‰è£…ç›®å½•&gt;/conf/nginx.conf</td></tr><tr><td>â€“error-log-path=PATH</td><td>æŒ‡å‘é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„</td><td>&lt;å®‰è£…ç›®å½•&gt;/logs/error.log</td></tr><tr><td>â€“http-log-path=PATH</td><td>æŒ‡å‘è®¿é—®æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„</td><td>&lt;å®‰è£…ç›®å½•&gt;/logs/access.log</td></tr><tr><td>â€“pid-path=PATH</td><td>æŒ‡å‘ Nginx å¯åŠ¨åè¿›è¡ŒIDçš„æ–‡ä»¶è·¯å¾„</td><td>&lt;å®‰è£…ç›®å½•&gt;/logs/nginx.pid</td></tr><tr><td>â€“lock-path=PATH</td><td>æŒ‡å‘ Nginx é”æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„</td><td>&lt;å®‰è£…ç›®å½•&gt;/logs/nginx.lock</td></tr></tbody></table><p>æºç å¤æ‚å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼šï¼ˆå…ˆè¿›å…¥è§£å‹ç›®å½•ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥è§£å‹ç›®</span></span><br><span class="line"><span class="built_in">cd</span> ~/nginx/core</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å‘½ä»¤</span></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx \</span><br><span class="line">--sbin-path=/usr/<span class="built_in">local</span>/nginx/sbin/nginx \</span><br><span class="line">--modules-path=/usr/<span class="built_in">local</span>/nginx/modules \</span><br><span class="line">--conf-path=/usr/<span class="built_in">local</span>/nginx/conf/nginx.conf \</span><br><span class="line">--error-log-path=/usr/<span class="built_in">local</span>/nginx/logs/error.log \</span><br><span class="line">--http-log-path=/usr/<span class="built_in">local</span>/nginx/logs/access.log \</span><br><span class="line">--pid-path=/usr/<span class="built_in">local</span>/nginx/logs/nginx.pid \</span><br><span class="line">--lock-path=/usr/<span class="built_in">local</span>/nginx/logs/nginx.lock</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œç¼–è¯‘å’Œå®‰è£…</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ä¹‹å‰ï¼Œéœ€è¦å°†ä¹‹å‰æœåŠ¡å™¨å·²ç»å®‰è£…çš„ Nginx è¿›è¡Œå¸è½½ã€‚</p><h2 id="Nginxå¸è½½"><a href="#Nginxå¸è½½" class="headerlink" title="Nginxå¸è½½"></a>Nginxå¸è½½</h2><p>ç®€å•å®‰è£…åå¦‚æœæƒ³è¦å¸è½½ï¼Œæ­¥éª¤åˆ†ä¸ºä¸‰æ­¥éª¤ï¼š</p><p>æ­¥éª¤ä¸€ï¼šéœ€è¦å°† Nginx çš„è¿›ç¨‹å…³é—­ï¼ˆè¦åœ¨ å®‰è£…ç›®å½•çš„ sbin ç›®å½•ä¸‹ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s stop</span><br></pre></td></tr></table></figure><p>æ­¥éª¤äºŒï¼šå°†å®‰è£…çš„ Nginx è¿›è¡Œåˆ é™¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /usr/<span class="built_in">local</span>/nginx</span><br></pre></td></tr></table></figure><p>æ­¥éª¤ä¸‰ï¼šè¿›å…¥è§£å‹ç›®å½•ï¼Œå°†å®‰è£…åŒ…ä¹‹å‰ç¼–è¯‘çš„ç¯å¢ƒæ¸…é™¤æ‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥è§£å‹ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /opt/nginx/core</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é™¤ç¯å¢ƒ</span></span><br><span class="line">make clean</span><br></pre></td></tr></table></figure><h2 id="Nginxç›®å½•ç»“æ„åˆ†æ"><a href="#Nginxç›®å½•ç»“æ„åˆ†æ" class="headerlink" title="Nginxç›®å½•ç»“æ„åˆ†æ"></a>Nginxç›®å½•ç»“æ„åˆ†æ</h2><p>åœ¨ä½¿ç”¨ Nginx ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¯¹å®‰è£…å¥½çš„ Nginx ç›®å½•æ–‡ä»¶è¿›è¡Œä¸€ä¸ªåˆ†æï¼Œåœ¨è¿™å—ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªå·¥å…· treeï¼Œé€šè¿‡ tree æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹é¢çš„å»æŸ¥çœ‹ Centos ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ç›®å½•ç»“æ„ï¼Œå½“ç„¶ï¼Œå¦‚æœæƒ³ä½¿ç”¨ tree å·¥å…·ï¼Œå°±å¾—å…ˆé€šè¿‡ <code>yum install -y tree</code> æ¥è¿›è¡Œå®‰è£…ï¼Œå®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ <code>tree /usr/local/nginx</code> (tree åé¢è·Ÿçš„æ˜¯ Nginx çš„å®‰è£…ç›®å½•)ï¼Œè·å–çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@master /]<span class="comment"># tree /usr/local/nginx</span></span><br><span class="line">/usr/<span class="built_in">local</span>/nginx</span><br><span class="line">â”œâ”€â”€ client_body_temp</span><br><span class="line">â”œâ”€â”€ conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ fastcgi.conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ fastcgi.conf.default</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ fastcgi_params</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ fastcgi_params.default</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ koi-utf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ koi-win</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ mime.types</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ mime.types.default</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ nginx.conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ nginx.conf.default</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ scgi_params</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ scgi_params.default</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ uwsgi_params</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ uwsgi_params.default</span><br><span class="line">â”‚Â Â  â””â”€â”€ win-utf</span><br><span class="line">â”œâ”€â”€ fastcgi_temp</span><br><span class="line">â”œâ”€â”€ html</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ 50x.html</span><br><span class="line">â”‚Â Â  â””â”€â”€ index.html</span><br><span class="line">â”œâ”€â”€ logs</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ access.log</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ error.log</span><br><span class="line">â”‚Â Â  â””â”€â”€ nginx.pid</span><br><span class="line">â”œâ”€â”€ proxy_temp</span><br><span class="line">â”œâ”€â”€ sbin</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ nginx</span><br><span class="line">â”‚Â Â  â””â”€â”€ nginx.old</span><br><span class="line">â”œâ”€â”€ scgi_temp</span><br><span class="line">â””â”€â”€ uwsgi_temp</span><br><span class="line"></span><br><span class="line">9 directories, 22 files</span><br></pre></td></tr></table></figure><p> CGI(Common Gateway Interface)é€šç”¨ç½‘å…³ã€æ¥å£ã€‘ï¼Œä¸»è¦è§£å†³çš„é—®é¢˜æ˜¯ä»å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚å’Œæ•°æ®ï¼ŒæœåŠ¡ç«¯è·å–åˆ°è¯·æ±‚å’Œæ•°æ®åå¯ä»¥è°ƒç”¨è°ƒç”¨ CGIã€ç¨‹åºã€‘å¤„ç†åŠç›¸åº”ç»“æœç»™å®¢æˆ·ç«¯çš„ä¸€ç§æ ‡å‡†è§„èŒƒã€‚</p><table><thead><tr><th>ç›®å½•</th><th>æ–‡ä»¶å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>conf</td><td></td><td>Nginx æ‰€æœ‰é…ç½®æ–‡ä»¶ç›®å½•</td></tr><tr><td></td><td>fastcgi.conf</td><td>fastcgiç›¸å…³é…ç½®æ–‡ä»¶</td></tr><tr><td></td><td>fastcgi.conf.default</td><td>fastcgi.conf çš„å¤‡ä»½æ–‡ä»¶</td></tr><tr><td></td><td>fastcgi_params</td><td>fastcgi çš„å‚æ•°æ–‡ä»¶</td></tr><tr><td></td><td>fastcgi_params.default</td><td>fastcgi çš„å‚æ•°å¤‡ä»½æ–‡ä»¶</td></tr><tr><td></td><td>scgi_params</td><td>scgi çš„å‚æ•°æ–‡ä»¶</td></tr><tr><td></td><td>scgi_params.default</td><td>scgi çš„å‚æ•°å¤‡ä»½æ–‡ä»¶</td></tr><tr><td></td><td>uwsgi_params</td><td>uwsgi çš„å‚æ•°æ–‡ä»¶</td></tr><tr><td></td><td>uwsgi_params.default</td><td>uwsgi çš„å‚æ•°å¤‡ä»½æ–‡ä»¶</td></tr><tr><td></td><td>mime.types</td><td><strong>è®°å½•çš„æ˜¯ HTTP åè®®ä¸­çš„ Content-Type çš„å€¼å’Œæ–‡ä»¶åç¼€åçš„å¯¹åº”å…³ç³»</strong></td></tr><tr><td></td><td>mime.types.default</td><td>mime.types çš„å¤‡ä»½æ–‡ä»¶</td></tr><tr><td></td><td>nginx.conf</td><td><strong>è¿™æ˜¯ Nginx çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶éå¸¸é‡è¦ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å³å°†è¦å­¦ä¹ çš„é‡ç‚¹</strong></td></tr><tr><td></td><td>nginx.conf.default</td><td>nginx.conf çš„å¤‡ä»½æ–‡ä»¶</td></tr><tr><td></td><td>koi-utfã€koi-winã€win-utf</td><td>è¿™ä¸‰ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸ç¼–ç è½¬æ¢æ˜ å°„ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œç”¨æ¥å°†ä¸€ç§ç¼–ç è½¬æ¢æˆå¦ä¸€ç§ç¼–ç </td></tr><tr><td>html</td><td></td><td>å­˜æ”¾ Nginx è‡ªå¸¦çš„ä¸¤ä¸ªé™æ€çš„ html é¡µé¢</td></tr><tr><td></td><td>50x.html</td><td>è®¿é—®å¤±è´¥åçš„å¤±è´¥é¡µé¢</td></tr><tr><td></td><td>index.html</td><td>æˆåŠŸè®¿é—®çš„é»˜è®¤é¦–é¡µ</td></tr><tr><td>logs</td><td></td><td>è®°å½•å…¥é—¨çš„æ–‡ä»¶ï¼Œå½“ Nginx æœåŠ¡å™¨å¯åŠ¨åï¼Œè¿™é‡Œé¢ä¼šæœ‰ access.log error.log å’Œ nginx.pid ä¸‰ä¸ªæ–‡ä»¶å‡ºç°</td></tr><tr><td></td><td>access.log</td><td><strong>è®¿é—®æ—¥å¿—ï¼Œæ¯æ¬¡è®¿é—®æˆåŠŸéƒ½ä¼šè¿›è¡Œè®°å½•</strong></td></tr><tr><td></td><td>error.log</td><td><strong>é”™è¯¯æ—¥å¿—ï¼Œæ¯æ¬¡è®¿é—®å¤±è´¥éƒ½ä¼šè¿›è¡Œè®°å½•</strong></td></tr><tr><td></td><td>nginx.pid</td><td>å¯åŠ¨ Nginx åï¼Œç³»ç»Ÿç”Ÿæˆä¸€ä¸ªè¿›ç¨‹ PIDï¼Œè¿™ä¸ªæ–‡ä»¶è®°å½•è¿™ä¸ª PID</td></tr><tr><td>sbin</td><td></td><td>æ˜¯å­˜æ”¾æ‰§è¡Œç¨‹åºæ–‡ä»¶ nginx</td></tr><tr><td></td><td>nginx</td><td>ç”¨æ¥æ§åˆ¶ Nginx çš„å¯åŠ¨å’Œåœæ­¢ç­‰ç›¸å…³çš„å‘½ä»¤ã€‚<strong>æ³¨æ„ï¼šè¯¥æ–‡ä»¶åå°±å« nginx</strong></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxä»‹ç»</title>
      <link href="/2022/11/08/Nginx_introduce/"/>
      <url>/2022/11/08/Nginx_introduce/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Nginx-ä»‹ç»"><a href="#Nginx-ä»‹ç»" class="headerlink" title="Nginx ä»‹ç»"></a>Nginx ä»‹ç»</h1><h2 id="Nginxæ˜¯ä»€ä¹ˆ"><a href="#Nginxæ˜¯ä»€ä¹ˆ" class="headerlink" title="Nginxæ˜¯ä»€ä¹ˆ"></a>Nginxæ˜¯ä»€ä¹ˆ</h2><p>Nginx (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†webæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†IMAP/POP3/SMTPæœåŠ¡ã€‚Nginxæ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«ä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„Rambler.ruç«™ç‚¹ï¼ˆä¿„æ–‡ï¼šĞ Ğ°Ğ¼Ğ±Ğ»ĞµÑ€ï¼‰å¼€å‘çš„ï¼Œç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬0.1.0å‘å¸ƒäº2004å¹´10æœˆ4æ—¥ã€‚</p><p>å…¶å°†æºä»£ç ä»¥ç±»BSDè®¸å¯è¯çš„å½¢å¼å‘å¸ƒï¼Œå› å®ƒçš„ç¨³å®šæ€§ã€ä¸°å¯Œçš„åŠŸèƒ½é›†ã€ç®€å•çš„é…ç½®æ–‡ä»¶å’Œä½ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—è€Œé—»åã€‚2011å¹´6æœˆ1æ—¥ï¼Œnginx 1.0.4å‘å¸ƒã€‚Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„Web æœåŠ¡å™¨/åå‘ä»£ç†æœåŠ¡å™¨åŠç”µå­é‚®ä»¶ï¼ˆIMAP/POP3ï¼‰ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨BSD-like åè®®ä¸‹å‘è¡Œã€‚å…¶ç‰¹ç‚¹æ˜¯å æœ‰å†…å­˜å°‘ï¼Œå¹¶å‘èƒ½åŠ›å¼ºï¼Œäº‹å®ä¸Šnginxçš„å¹¶å‘èƒ½åŠ›åœ¨åŒç±»å‹çš„ç½‘é¡µæœåŠ¡å™¨ä¸­è¡¨ç°è¾ƒå¥½ï¼Œä¸­å›½å¤§é™†ä½¿ç”¨nginxç½‘ç«™ç”¨æˆ·æœ‰ï¼šç™¾åº¦ã€äº¬ä¸œã€æ–°æµªã€ç½‘æ˜“ã€è…¾è®¯ã€æ·˜å®ç­‰ã€‚</p><h2 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h2><ol><li>WebæœåŠ¡å™¨</li></ol><p>WEB æœåŠ¡å™¨ä¹Ÿå«ç½‘é¡µæœåŠ¡å™¨ï¼Œè‹±æ–‡åå« Web Serverï¼Œä¸»è¦åŠŸèƒ½æ˜¯ä¸ºç”¨æˆ·æä¾›ç½‘ä¸Šä¿¡æ¯æµè§ˆæœåŠ¡ã€‚</p><ol start="2"><li>HTTP</li></ol><p>HTTP æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œæ˜¯ç”¨äºä» WEB æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ è¾“åè®®ï¼Œä¹Ÿæ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚HTTP æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼Œå®¢æˆ·ç«¯æ˜¯ç»ˆç«¯ç”¨æˆ·ï¼ŒæœåŠ¡ç«¯æ˜¯ç½‘ç«™ï¼Œé€šè¿‡ä½¿ç”¨ Web æµè§ˆå™¨ã€ç½‘ç»œçˆ¬è™«æˆ–è€…å…¶ä»–å·¥å…·ï¼Œå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šç«¯å£çš„ HTTP è¯·æ±‚ã€‚</p><ol start="3"><li>POP3/SMTP/IMAP</li></ol><p>POP3(Post Offic Protocol 3)é‚®å±€åè®®çš„ç¬¬ä¸‰ä¸ªç‰ˆæœ¬ï¼›</p><p>SMTP(Simple Mail Transfer Protocol)ç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼›</p><p>IMAP(Internet Mail Access Protocol)äº¤äº’å¼é‚®ä»¶å­˜å–åè®®ï¼›</p><p>é€šè¿‡ä¸Šè¿°åè¯çš„è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ° Nginx ä¹Ÿå¯ä»¥ä½œä¸ºç”µå­é‚®ä»¶ä»£ç†æœåŠ¡å™¨ã€‚</p><ol start="4"><li>æ­£å‘ä»£ç†</li></ol><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.5u72na7a9hc0.webp" alt="image"></p><p>åå‘ä»£ç†</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.3622anezbxi0.webp" alt="image"></p><p>æ­£å‘ä»£ç†çš„ Proxy æ˜¯å¤šå¯¹ä¸€ï¼Œåå‘ä»£ç†çš„ Proxy æ˜¯ä¸€å¯¹å¤šã€‚</p><h2 id="å¸¸è§æœåŠ¡å™¨å¯¹æ¯”"><a href="#å¸¸è§æœåŠ¡å™¨å¯¹æ¯”" class="headerlink" title="å¸¸è§æœåŠ¡å™¨å¯¹æ¯”"></a>å¸¸è§æœåŠ¡å™¨å¯¹æ¯”</h2><p>åœ¨ä»‹ç»è¿™ä¸€èŠ‚å†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€å®¶å…¬å¸å« Netcraftã€‚</p><blockquote><p>Netcraft å…¬å¸äº 1994 å¹´åº•åœ¨è‹±å›½æˆç«‹ï¼Œå¤šå¹´æ¥ä¸€ç›´è‡´åŠ›äºäº’è”ç½‘å¸‚åœºä»¥åŠåœ¨çº¿å®‰å…¨æ–¹é¢çš„å’¨è¯¢æœåŠ¡ï¼Œå…¶ä¸­åœ¨å›½é™…ä¸Šæœ€å…·å½±å“åŠ›çš„å½“å±å…¶é’ˆå¯¹ç½‘ç«™æœåŠ¡å™¨ã€SSLå¸‚åœºæ‰€åšçš„å®¢è§‚ä¸¥è°¨çš„åˆ†æç ”ç©¶ï¼Œå…¬å¸å®˜ç½‘æ¯æœˆå…¬å¸ƒçš„è°ƒç ”æ•°æ®ï¼ˆWeb Server Surveyï¼‰å·²æˆä¸ºå½“ä»Šäººä»¬äº†è§£å…¨çƒç½‘ç«™æ•°é‡ä»¥åŠæœåŠ¡å™¨å¸‚åœºåˆ†é¢æƒ…å†µçš„ä¸»è¦å‚è€ƒä¾æ®ï¼Œæ—¶å¸¸è¢«è¯¸å¦‚åå°”è¡—æ‚å¿—ï¼Œè‹±å›½ BBCï¼ŒSlashdot ç­‰åª’ä½“æŠ¥é“æˆ–å¼•ç”¨ã€‚</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬å…ˆæ‰“å¼€ Nginx çš„å®˜æ–¹ç½‘ç«™ <a href="http://nginx.org/" target="_blank" rel="noopener">http://nginx.org/</a>ï¼Œæ‰¾åˆ° Netcraft å…¬å¸å…¬å¸ƒçš„æ•°æ®ï¼Œå¯¹å½“å‰ä¸»æµæœåŠ¡å™¨äº§å“è¿›è¡Œä»‹ç»ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.6wcjq3k197c0.webp" alt="image"></p><p>ä¸Šé¢è¿™å¼ å›¾å±•ç¤ºäº† 2019 å¹´å…¨çƒä¸»æµ Web æœåŠ¡å™¨çš„å¸‚åœºæƒ…å†µï¼Œå…¶ä¸­æœ‰ Apacheã€Microsoft-IISã€google Serversã€Nginxã€Tomcat ç­‰ï¼Œè€Œæˆ‘ä»¬åœ¨äº†è§£æ–°äº‹ç‰©çš„æ—¶å€™ï¼Œå¾€å¾€ä¹ æƒ¯é€šè¿‡ç±»æ¯”æ¥å¸®åŠ©è‡ªå·±ç†è§£äº‹ç‰©çš„æ¦‚è²Œã€‚å¯ä»¥çœ‹å‡ºç»¿è‰²çº¿çš„ nginx åœ¨ 2019 å¹´å·²ç»é¢†ç°å…¨çƒäº†ã€‚</p><p>æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬æŠŠå‡ ç§å¸¸è§çš„æœåŠ¡å™¨æ¥ç»™å¤§å®¶ç®€å•ä»‹ç»ä¸‹ï¼š</p><h3 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h3><p>å…¨ç§°(Internet Information Services)å³äº’è”ç½‘ä¿¡æ¯æœåŠ¡ï¼Œæ˜¯ç”±å¾®è½¯å…¬å¸æä¾›çš„åŸºäº Windows ç³»ç»Ÿçš„äº’è”ç½‘åŸºæœ¬æœåŠ¡ã€‚Windows ä½œä¸ºæœåŠ¡å™¨åœ¨ç¨³å®šæ€§ä¸å…¶ä»–ä¸€äº›æ€§èƒ½ä¸Šéƒ½ä¸å¦‚ç±» UNIX æ“ä½œç³»ç»Ÿï¼Œå› æ­¤åœ¨éœ€è¦é«˜æ€§èƒ½ Web æœåŠ¡å™¨çš„åœºåˆä¸‹ï¼ŒIIS å¯èƒ½å°±ä¼šè¢«ã€Œå†·è½ã€.</p><h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><p>Tomcatæ˜¯ä¸€ä¸ªè¿è¡Œ Servlet å’Œ JSP çš„ Web åº”ç”¨è½¯ä»¶ï¼ŒTomcat æŠ€æœ¯å…ˆè¿›ã€æ€§èƒ½ç¨³å®šè€Œä¸”å¼€æ”¾æºä»£ç ï¼Œå› æ­¤æ·±å— Java çˆ±å¥½è€…çš„å–œçˆ±å¹¶å¾—åˆ°äº†éƒ¨åˆ†è½¯ä»¶å¼€å‘å•†çš„è®¤å¯ï¼Œæˆä¸ºç›®å‰æ¯”è¾ƒæµè¡Œçš„ Web åº”ç”¨æœåŠ¡å™¨ã€‚ä½†æ˜¯ Tomcat å¤©ç”Ÿæ˜¯ä¸€ä¸ªé‡é‡çº§çš„ Web æœåŠ¡å™¨ï¼Œå¯¹é™æ€æ–‡ä»¶å’Œé«˜å¹¶å‘çš„å¤„ç†æ¯”è¾ƒå¼±ã€‚</p><h3 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h3><p>Apache çš„å‘å±•æ—¶æœŸå¾ˆé•¿ï¼ŒåŒæ—¶ä¹Ÿæœ‰è¿‡ä¸€æ®µè¾‰ç…Œçš„ä¸šç»©ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºå¤§æ¦‚åœ¨ 2014 å¹´ä»¥å‰éƒ½æ˜¯å¸‚åœºä»½é¢ç¬¬ä¸€çš„æœåŠ¡å™¨ã€‚Apache æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œå¦‚ç¨³å®šã€å¼€æºã€è·¨å¹³å°ç­‰ã€‚ä½†æ˜¯å®ƒå‡ºç°çš„æ—¶é—´å¤ªä¹…äº†ï¼Œåœ¨å®ƒå…´èµ·çš„å¹´ä»£ï¼Œäº’è”ç½‘çš„äº§ä¸šè§„æ¨¡è¿œè¿œä¸å¦‚ä»Šå¤©ï¼Œæ‰€ä»¥å®ƒè¢«è®¾è®¡æˆä¸€ä¸ªé‡é‡çº§çš„ã€ä¸æ”¯æŒé«˜å¹¶å‘çš„ Web æœåŠ¡å™¨ã€‚åœ¨ Apache æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœæœ‰æ•°ä»¥ä¸‡è®¡çš„å¹¶å‘ HTTP è¯·æ±‚åŒæ—¶è®¿é—®ï¼Œå°±ä¼šå¯¼è‡´æœåŠ¡å™¨ä¸Šæ¶ˆè€—å¤§é‡èƒ½å­˜ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å¯¹æˆç™¾ä¸Šåƒçš„ Apache è¿›ç¨‹åšè¿›ç¨‹é—´åˆ‡æ¢ä¹Ÿä¼šæ¶ˆè€—å¤§é‡çš„ CPU èµ„æºï¼Œå¹¶å¯¼è‡´ HTTP è¯·æ±‚çš„å¹³å‡å“åº”é€Ÿåº¦é™ä½ï¼Œè¿™äº›éƒ½å†³å®šäº† Apache ä¸å¯èƒ½æˆä¸ºé«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨ã€‚è¿™ä¹Ÿä¿ƒä½¿äº† Lighttpd å’Œ Nginx çš„å‡ºç°ã€‚</p><h3 id="Lighttpd"><a href="#Lighttpd" class="headerlink" title="Lighttpd"></a>Lighttpd</h3><p>Lighttpd æ˜¯å¾·å›½çš„ä¸€ä¸ªå¼€æºçš„ Web æœåŠ¡å™¨è½¯ä»¶ï¼Œå®ƒå’Œ Nginx ä¸€æ ·ï¼Œéƒ½æ˜¯è½»é‡çº§ã€é«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨ï¼Œæ¬§ç¾çš„ä¸šç•Œå¼€å‘è€…æ¯”è¾ƒé’Ÿçˆ± Lighttpdï¼Œè€Œå›½å†…çš„å…¬å¸æ›´å¤šçš„é’ç Nginxï¼ŒåŒæ—¶ç½‘ä¸Š Nginx çš„èµ„æºè¦æ›´ä¸°å¯Œäº›ã€‚</p><h3 id="å…¶ä»–çš„æœåŠ¡å™¨"><a href="#å…¶ä»–çš„æœåŠ¡å™¨" class="headerlink" title="å…¶ä»–çš„æœåŠ¡å™¨"></a>å…¶ä»–çš„æœåŠ¡å™¨</h3><p>Google Serversï¼ŒWeblogic, Webshpere(IBM) â€¦â€¦</p><p>Google Servers æ˜¯é—­æºçš„ï¼Œå¸‚é¢ä¸Šå¾ˆå°‘çœ‹åˆ°ã€‚Weblogic å’Œ Webshpere(IBM) ä½¿ç”¨èµ·æ¥éƒ½éœ€è¦æ”¯ä»˜ä¸€å®šè´¹ç”¨ã€‚</p><p>ç»è¿‡å„ä¸ªæœåŠ¡å™¨çš„å¯¹æ¯”ï¼Œç§ç§è¿¹è±¡éƒ½è¡¨æ˜ï¼ŒNginx å°†ä»¥æ€§èƒ½ä¸ºç‹ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆé€‰æ‹© Nginx çš„ç†ç”±ã€‚</p><h2 id="Nginxçš„ä¼˜ç‚¹"><a href="#Nginxçš„ä¼˜ç‚¹" class="headerlink" title="Nginxçš„ä¼˜ç‚¹"></a>Nginxçš„ä¼˜ç‚¹</h2><h3 id="é€Ÿåº¦æ›´å¿«ã€å¹¶å‘æ›´é«˜"><a href="#é€Ÿåº¦æ›´å¿«ã€å¹¶å‘æ›´é«˜" class="headerlink" title="é€Ÿåº¦æ›´å¿«ã€å¹¶å‘æ›´é«˜"></a>é€Ÿåº¦æ›´å¿«ã€å¹¶å‘æ›´é«˜</h3><p>å•æ¬¡è¯·æ±‚æˆ–è€…é«˜å¹¶å‘è¯·æ±‚çš„ç¯å¢ƒä¸‹ï¼ŒNginx éƒ½ä¼šæ¯”å…¶ä»– Web æœåŠ¡å™¨å“åº”çš„é€Ÿåº¦æ›´å¿«ã€‚ä¸€æ–¹é¢åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå•æ¬¡è¯·æ±‚ä¼šå¾—åˆ°æ›´å¿«çš„å“åº”ï¼Œå¦ä¸€æ–¹é¢ï¼Œåœ¨é«˜å³°æœŸ(å¦‚æœ‰æ•°ä»¥ä¸‡è®¡çš„å¹¶å‘è¯·æ±‚)ï¼ŒNginx æ¯”å…¶ä»– Web æœåŠ¡å™¨æ›´å¿«çš„å“åº”è¯·æ±‚ã€‚Nginx ä¹‹æ‰€ä»¥æœ‰è¿™ä¹ˆé«˜çš„å¹¶å‘å¤„ç†èƒ½åŠ›å’Œè¿™ä¹ˆå¥½çš„æ€§èƒ½åŸå› åœ¨äº Nginx é‡‡ç”¨äº†å¤šè¿›ç¨‹å’Œ I/O å¤šè·¯å¤ç”¨(epoll)çš„åº•å±‚å®ç°ã€‚</p><h3 id="é…ç½®ç®€å•ï¼Œæ‰©å±•æ€§å¼º"><a href="#é…ç½®ç®€å•ï¼Œæ‰©å±•æ€§å¼º" class="headerlink" title="é…ç½®ç®€å•ï¼Œæ‰©å±•æ€§å¼º"></a>é…ç½®ç®€å•ï¼Œæ‰©å±•æ€§å¼º</h3><p>Nginx çš„è®¾è®¡æå…·æ‰©å±•æ€§ï¼Œå®ƒæœ¬èº«å°±æ˜¯ç”±å¾ˆå¤šæ¨¡å—ç»„æˆï¼Œè¿™äº›æ¨¡å—çš„ä½¿ç”¨å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çš„é…ç½®æ¥æ·»åŠ ã€‚è¿™äº›æ¨¡å—æœ‰å®˜æ–¹æä¾›çš„ä¹Ÿæœ‰ç¬¬ä¸‰æ–¹æä¾›çš„æ¨¡å—ï¼Œå¦‚æœéœ€è¦å®Œå…¨å¯ä»¥å¼€å‘æœåŠ¡è‡ªå·±ä¸šåŠ¡ç‰¹æ€§çš„å®šåˆ¶æ¨¡å—</p><h3 id="é«˜å¯é æ€§"><a href="#é«˜å¯é æ€§" class="headerlink" title="é«˜å¯é æ€§"></a>é«˜å¯é æ€§</h3><p>Nginx é‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹æ¨¡å¼è¿è¡Œï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª master ä¸»è¿›ç¨‹å’Œ N å¤šä¸ª worker è¿›ç¨‹ï¼Œä¸€ä¸ª master ç®¡ç†å¤šä¸ª workerï¼Œworker è¿›ç¨‹çš„æ•°é‡æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼Œæ¯ä¸ª worker è¿›ç¨‹ä¹‹é—´éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹æä¾›æœåŠ¡ï¼Œå¹¶ä¸” master ä¸»è¿›ç¨‹å¯ä»¥åœ¨æŸä¸€ä¸ª worker è¿›ç¨‹å‡ºé”™æ—¶ï¼Œå¿«é€Ÿå»ã€Œæ‹‰èµ·ã€æ–°çš„ worker è¿›ç¨‹æä¾›æœåŠ¡ã€‚</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.3wz8th685620.webp" alt="image"></p><h3 id="çƒ­éƒ¨ç½²-æ ¸å¿ƒ"><a href="#çƒ­éƒ¨ç½²-æ ¸å¿ƒ" class="headerlink" title="çƒ­éƒ¨ç½²(æ ¸å¿ƒ)"></a>çƒ­éƒ¨ç½²(æ ¸å¿ƒ)</h3><p>ç°åœ¨äº’è”ç½‘é¡¹ç›®éƒ½è¦æ±‚ä»¥ 7 * 24 å°æ—¶è¿›è¡ŒæœåŠ¡çš„æä¾›ï¼Œé’ˆå¯¹äºè¿™ä¸€è¦æ±‚ï¼ŒNginx ä¹Ÿæä¾›äº†çƒ­éƒ¨ç½²åŠŸèƒ½ï¼Œå³å¯ä»¥åœ¨ Nginx ä¸åœæ­¢çš„æƒ…å†µä¸‹ï¼Œå¯¹ Nginx è¿›è¡Œæ–‡ä»¶å‡çº§ã€æ›´æ–°é…ç½®å’Œæ›´æ¢æ—¥å¿—æ–‡ä»¶ç­‰åŠŸèƒ½ã€‚</p><h3 id="æˆæœ¬ä½ã€BSDè®¸å¯è¯"><a href="#æˆæœ¬ä½ã€BSDè®¸å¯è¯" class="headerlink" title="æˆæœ¬ä½ã€BSDè®¸å¯è¯"></a>æˆæœ¬ä½ã€BSDè®¸å¯è¯</h3><p>BSD æ˜¯ä¸€ä¸ªå¼€æºçš„è®¸å¯è¯ï¼Œä¸–ç•Œä¸Šçš„å¼€æºè®¸å¯è¯æœ‰å¾ˆå¤šï¼Œç°åœ¨æ¯”è¾ƒæµè¡Œçš„æœ‰å…­ç§åˆ†åˆ«æ˜¯ GPLã€BSDã€MITã€Mozillaã€Apacheã€LGPLã€‚è¿™å…­ç§çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸€å¼ å›¾æ¥è§£é‡Šä¸‹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220727/image.771jinl18hw0.webp" alt="image"></p><h2 id="Nginxçš„åŠŸèƒ½ç‰¹æ€§åŠå¸¸ç”¨åŠŸèƒ½"><a href="#Nginxçš„åŠŸèƒ½ç‰¹æ€§åŠå¸¸ç”¨åŠŸèƒ½" class="headerlink" title="Nginxçš„åŠŸèƒ½ç‰¹æ€§åŠå¸¸ç”¨åŠŸèƒ½"></a>Nginxçš„åŠŸèƒ½ç‰¹æ€§åŠå¸¸ç”¨åŠŸèƒ½</h2><p>Nginx æä¾›çš„åŸºæœ¬åŠŸèƒ½æœåŠ¡ä»å¤§ä½“ä¸Šå½’çº³ä¸ºã€ŒåŸºæœ¬ HTTP æœåŠ¡ã€ã€ã€Œé«˜çº§ HTTP æœåŠ¡ã€å’Œã€Œé‚®ä»¶æœåŠ¡ã€ç­‰ä¸‰å¤§ç±»ã€‚</p><h3 id="åŸºæœ¬HTTPæœåŠ¡"><a href="#åŸºæœ¬HTTPæœåŠ¡" class="headerlink" title="åŸºæœ¬HTTPæœåŠ¡"></a>åŸºæœ¬HTTPæœåŠ¡</h3><p>Nginx å¯ä»¥æä¾›åŸºæœ¬ HTTP æœåŠ¡ï¼Œå¯ä»¥ä½œä¸º HTTP ä»£ç†æœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ”¯æŒé€šè¿‡ç¼“å­˜åŠ é€Ÿè®¿é—®ï¼Œå¯ä»¥å®Œæˆç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼Œæ”¯æŒåŒ…è¿‡æ»¤åŠŸèƒ½ï¼Œæ”¯æŒ SSL ç­‰ã€‚</p><ul><li>å¤„ç†é™æ€æ–‡ä»¶ã€å¤„ç†ç´¢å¼•æ–‡ä»¶ä»¥åŠæ”¯æŒè‡ªåŠ¨ç´¢å¼•</li><li>æä¾›åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶å¯ä»¥ä½¿ç”¨ç¼“å­˜åŠ ä¸Šåå‘ä»£ç†ï¼ŒåŒæ—¶å®Œæˆè´Ÿè½½å‡è¡¡å’Œå®¹é”™</li><li>æä¾›å¯¹ FastCGIã€memcached ç­‰æœåŠ¡çš„ç¼“å­˜æœºåˆ¶ï¼Œï¼ŒåŒæ—¶å®Œæˆè´Ÿè½½å‡è¡¡å’Œå®¹é”™</li><li>ä½¿ç”¨ Nginx çš„æ¨¡å—åŒ–ç‰¹æ€§æä¾›è¿‡æ»¤å™¨åŠŸèƒ½ã€‚Nginx åŸºæœ¬è¿‡æ»¤å™¨åŒ…æ‹¬ gzip å‹ç¼©ã€ranges æ”¯æŒã€chunked å“åº”ã€XSLTã€SSI ä»¥åŠå›¾åƒç¼©æ”¾ç­‰ã€‚å…¶ä¸­é’ˆå¯¹åŒ…å«å¤šä¸ª SSI çš„é¡µé¢ï¼Œç»ç”± FastCGI æˆ–åå‘ä»£ç†ï¼ŒSSI è¿‡æ»¤å™¨å¯ä»¥å¹¶è¡Œå¤„ç†</li><li>æ”¯æŒ HTTP ä¸‹çš„å®‰å…¨å¥—æ¥å±‚å®‰å…¨åè®® SSL.</li><li>æ”¯æŒåŸºäºåŠ æƒå’Œä¾èµ–çš„ä¼˜å…ˆæƒçš„ HTTP/2</li></ul><h3 id="é«˜çº§HTTPæœåŠ¡"><a href="#é«˜çº§HTTPæœåŠ¡" class="headerlink" title="é«˜çº§HTTPæœåŠ¡"></a>é«˜çº§HTTPæœåŠ¡</h3><ul><li>æ”¯æŒåŸºäºåå­—å’Œ IP çš„è™šæ‹Ÿä¸»æœºè®¾ç½®</li><li>æ”¯æŒ HTTP/1.0 ä¸­çš„ KEEP-Alive æ¨¡å¼å’Œç®¡çº¿(PipeLined)æ¨¡å‹è¿æ¥</li><li>è‡ªå®šä¹‰è®¿é—®æ—¥å¿—æ ¼å¼ã€å¸¦ç¼“å­˜çš„æ—¥å¿—å†™æ“ä½œä»¥åŠå¿«é€Ÿæ—¥å¿—è½®è½¬</li><li>æä¾› 3xx~5xx é”™è¯¯ä»£ç é‡å®šå‘åŠŸèƒ½</li><li>æ”¯æŒé‡å†™ï¼ˆRewrite)æ¨¡å—æ‰©å±•</li><li>æ”¯æŒé‡æ–°åŠ è½½é…ç½®ä»¥åŠåœ¨çº¿å‡çº§æ—¶æ— éœ€ä¸­æ–­æ­£åœ¨å¤„ç†çš„è¯·æ±‚</li><li>æ”¯æŒç½‘ç»œç›‘æ§</li><li>æ”¯æŒ FLV å’Œ MP4 æµåª’ä½“ä¼ è¾“</li></ul><h3 id="é‚®ä»¶æœåŠ¡"><a href="#é‚®ä»¶æœåŠ¡" class="headerlink" title="é‚®ä»¶æœåŠ¡"></a>é‚®ä»¶æœåŠ¡</h3><p>Nginx æä¾›é‚®ä»¶ä»£ç†æœåŠ¡ä¹Ÿæ˜¯å…¶åŸºæœ¬å¼€å‘éœ€æ±‚ä¹‹ä¸€ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>æ”¯æŒ IMPA/POP3 ä»£ç†æœåŠ¡åŠŸèƒ½</li><li>æ”¯æŒå†…éƒ¨ SMTP ä»£ç†æœåŠ¡åŠŸèƒ½</li></ul><h3 id="Nginxå¸¸ç”¨çš„åŠŸèƒ½æ¨¡å—"><a href="#Nginxå¸¸ç”¨çš„åŠŸèƒ½æ¨¡å—" class="headerlink" title="Nginxå¸¸ç”¨çš„åŠŸèƒ½æ¨¡å—"></a>Nginxå¸¸ç”¨çš„åŠŸèƒ½æ¨¡å—</h3><ul><li>é™æ€èµ„æºéƒ¨ç½²ï¼šæ ¸å¿ƒåŠŸèƒ½</li><li>Rewrite åœ°å€é‡å†™ï¼šç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼</li><li>åå‘ä»£ç†</li><li>è´Ÿè½½å‡è¡¡ï¼šè½®è¯¢ã€åŠ æƒè½®è¯¢ã€ip_hashã€url_hashã€fair ç­‰ç®—æ³•</li><li>Web ç¼“å­˜</li><li>ç¯å¢ƒéƒ¨ç½²ï¼šæ­å»ºé«˜å¯ç”¨çš„ç¯å¢ƒ</li><li>ç”¨æˆ·è®¤è¯æ¨¡å— â€¦</li><li>Nginx çš„æ ¸å¿ƒç»„æˆ<ul><li>nginx äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¯åŠ¨ã€å…³é—­ã€åŠ è½½ Nginxï¼‰</li><li>nginx.conf é…ç½®æ–‡ä»¶</li><li>error.log é”™è¯¯çš„æ—¥å¿—è®°å½•</li><li>access.log è®¿é—®æ—¥å¿—è®°å½•</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Nginx </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­£å‘ä»£ç†ä¸åå‘ä»£ç†</title>
      <link href="/2022/11/08/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%8E%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"/>
      <url>/2022/11/08/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%8E%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><a href="https://imgse.com/i/xxKjxS" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2022/11/08/xxKjxS.jpg" alt="xxKjxS.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> åç«¯ </tag>
            
            <tag> WebæœåŠ¡å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TSçŸ¥è¯†ç‚¹æ€»ç»“</title>
      <link href="/2022/11/03/09_Java%E7%A8%8B%E5%BA%8F%E5%91%98%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E5%89%8D%E7%AB%AF-ts/"/>
      <url>/2022/11/03/09_Java%E7%A8%8B%E5%BA%8F%E5%91%98%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E5%89%8D%E7%AB%AF-ts/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h1><h3 id="1-åŠ¨æ€ç±»å‹çš„é—®é¢˜"><a href="#1-åŠ¨æ€ç±»å‹çš„é—®é¢˜" class="headerlink" title="1) åŠ¨æ€ç±»å‹çš„é—®é¢˜"></a>1) åŠ¨æ€ç±»å‹çš„é—®é¢˜</h3><p>å‰é¢è®²è¿‡ js å±äºåŠ¨æ€ç±»å‹è¯­è¨€ï¼Œä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">obj</span>) </span>&#123;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>obj å¯èƒ½åªæ˜¯ä¸ªå­—ç¬¦ä¸²</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'hello, world'</span>)</span><br></pre></td></tr></table></figure><p>obj ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸ªå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="function"><span class="params">()</span>=&gt;</span><span class="built_in">console</span>.log(<span class="string">'hello, world'</span>))</span><br></pre></td></tr></table></figure><p>obj ç±»å‹ä¸ç¡®å®šï¼Œå°±ç»™åæœŸä½¿ç”¨è€…å¸¦æ¥äº†éº»çƒ¦ï¼Œä¸€æ—¦å‚æ•°ä¼ ä¸å¯¹ï¼Œä»£ç å°±å´©æºƒäº†</p><p>åŠ¨æ€ç±»å‹æ„å‘³ç€</p><ul><li>è¿è¡Œä»£ç æ—¶æ‰çŸ¥é“å‘ç”Ÿä»€ä¹ˆ (running the code to see what happens)</li></ul><p>é™æ€ç±»å‹æ„å‘³ç€</p><ul><li>åœ¨ä»£ç è¿è¡Œå‰ï¼Œå°±å¯¹å®ƒçš„è¡Œä¸ºåšå‡ºé¢„æµ‹ (make predications about what code is expected before it runs)</li></ul><p>ä¸‹é¢çš„ typescript ä»£ç ï¼Œå°±åœ¨ä»£ç è¿è¡Œå‰å¯¹å‚æ•°åŠ å…¥äº†çº¦æŸé™åˆ¶</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">msg : <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é™åˆ¶äº†å‚æ•°åªèƒ½åš string é‚£äº›äº‹</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">msg : <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">  msg()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é™åˆ¶äº†å‚æ•°åªèƒ½åšå‡½æ•°é‚£äº›äº‹</li></ul><h3 id="2-å…¥é—¨"><a href="#2-å…¥é—¨" class="headerlink" title="2) å…¥é—¨"></a>2) å…¥é—¨</h3><p>å®‰è£… typescript ç¼–è¯‘å™¨</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g typescript</span><br></pre></td></tr></table></figure><p>ç¼–å†™ ts ä»£ç </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">msg: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hello(<span class="string">'hello,world'</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ tsc ç¼–è¯‘å‘½ä»¤</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc xxx.ts</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ç”Ÿæˆ js ä»£ç ï¼Œç¼–è¯‘åè¿›è¡Œäº†ç±»å‹æ“¦é™¤</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;</span><br><span class="line">hello(<span class="string">'hello,world'</span>);</span><br></pre></td></tr></table></figure><p>å†æ¥ä¸€ä¸ªä¾‹å­ï¼Œç”¨ interface å®šä¹‰ç”¨æˆ·ç±»å‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> User &#123;</span><br><span class="line">  name: <span class="built_in">string</span>,</span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">u: User</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(u.name)</span><br><span class="line">  <span class="built_in">console</span>.log(u.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(&#123; name: <span class="string">'zhangs'</span>, age: <span class="number">18</span> &#125;)</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">u</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(u.name);</span><br><span class="line">    <span class="built_in">console</span>.log(u.age);</span><br><span class="line">&#125;</span><br><span class="line">test(&#123; <span class="attr">name</span>: <span class="string">'zhangs'</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;);</span><br></pre></td></tr></table></figure><p>å¯è§ï¼Œtypescript å±äºç¼–è¯‘æ—¶å®æ–½ç±»å‹æ£€æŸ¥ï¼ˆé™æ€ç±»å‹ï¼‰çš„æŠ€æœ¯</p><h3 id="3-ç±»å‹"><a href="#3-ç±»å‹" class="headerlink" title="3) ç±»å‹"></a>3) ç±»å‹</h3><table><thead><tr><th>ç±»å‹</th><th>ä¾‹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å­—ç¬¦ä¸²ç±»å‹</td><td>string</td><td></td></tr><tr><td>æ•°å­—ç±»å‹</td><td>number</td><td></td></tr><tr><td>å¸ƒå°”ç±»å‹</td><td>boolean</td><td></td></tr><tr><td>æ•°ç»„ç±»å‹</td><td>number[],string[], boolean[] ä¾æ­¤ç±»æ¨</td><td></td></tr><tr><td>ä»»æ„ç±»å‹</td><td>any</td><td>ç›¸å½“äºåˆå›åˆ°äº†æ²¡æœ‰ç±»å‹çš„æ—¶ä»£</td></tr><tr><td>å¤æ‚ç±»å‹</td><td>type ä¸ interface</td><td></td></tr><tr><td>å‡½æ•°ç±»å‹</td><td>() =&gt; void</td><td>å¯¹å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼è¿›è¡Œè¯´æ˜</td></tr><tr><td>å­—é¢é‡ç±»å‹</td><td>â€œaâ€|â€bâ€|â€câ€</td><td>é™åˆ¶å˜é‡æˆ–å‚æ•°çš„å–å€¼</td></tr><tr><td>nullishç±»å‹</td><td>null ä¸ undefined</td><td></td></tr><tr><td>æ³›å‹</td><td><code>&lt;T&gt;</code>ï¼Œ<code>&lt;T extends çˆ¶ç±»å‹&gt;</code></td><td></td></tr></tbody></table><h4 id="æ ‡æ³¨ä½ç½®"><a href="#æ ‡æ³¨ä½ç½®" class="headerlink" title="æ ‡æ³¨ä½ç½®"></a>æ ‡æ³¨ä½ç½®</h4><h5 id="æ ‡æ³¨å˜é‡"><a href="#æ ‡æ³¨å˜é‡" class="headerlink" title="æ ‡æ³¨å˜é‡"></a>æ ‡æ³¨å˜é‡</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> message: <span class="built_in">string</span> = <span class="string">'hello,world'</span></span><br></pre></td></tr></table></figure><ul><li>ä¸€èˆ¬å¯ä»¥çœç•¥ï¼Œå› ä¸ºå¯ä»¥æ ¹æ®åé¢çš„å­—é¢é‡æ¨æ–­å‡ºå‰é¢å˜é‡ç±»å‹</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> message = <span class="string">'hello,world'</span></span><br></pre></td></tr></table></figure><h5 id="æ ‡æ³¨å‚æ•°"><a href="#æ ‡æ³¨å‚æ•°" class="headerlink" title="æ ‡æ³¨å‚æ•°"></a>æ ‡æ³¨å‚æ•°</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">name: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå¤šæ—¶å€™ï¼Œéƒ½èƒ½å¤Ÿæ¨æ–­å‡ºå‚æ•°ç±»å‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> names = [<span class="string">'Alice'</span>, <span class="string">'Bob'</span>, <span class="string">'Eve'</span>]</span><br><span class="line"><span class="keyword">const</span> lowercaseNames = names.map(<span class="function">(<span class="params">e: <span class="built_in">string</span></span>) =&gt;</span> e.toLowerCase())</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥ç”¨ç±»å‹æ¨æ–­ï¼Œæ¨æ–­å‡º e æ˜¯ string ç±»å‹</li></ul><h5 id="æ ‡æ³¨è¿”å›å€¼"><a href="#æ ‡æ³¨è¿”å›å€¼" class="headerlink" title="æ ‡æ³¨è¿”å›å€¼"></a>æ ‡æ³¨è¿”å›å€¼</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) : <span class="title">number</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸€èˆ¬ä¹Ÿå¯ä»¥çœç•¥ï¼Œå› ä¸ºå¯ä»¥æ ¹æ®è¿”å›å€¼åšç±»å‹æ¨æ–­</li></ul><h4 id="å¤æ‚ç±»å‹"><a href="#å¤æ‚ç±»å‹" class="headerlink" title="å¤æ‚ç±»å‹"></a>å¤æ‚ç±»å‹</h4><h5 id="type"><a href="#type" class="headerlink" title="type"></a>type</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Cat = &#123;</span><br><span class="line">  name: <span class="built_in">string</span>,</span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c1: Cat = &#123; name: <span class="string">'å°ç™½'</span>, age: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">const</span> c2: Cat = &#123; name: <span class="string">'å°èŠ±'</span> &#125;  <span class="comment">// é”™è¯¯: ç¼ºå°‘ age å±æ€§</span></span><br><span class="line"><span class="keyword">const</span> c3: Cat = &#123; name: <span class="string">'å°é»‘'</span>, age: <span class="number">1</span>, sex: <span class="string">'å…¬'</span> &#125; <span class="comment">// é”™è¯¯: å¤šå‡º sex å±æ€§</span></span><br></pre></td></tr></table></figure><h5 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Cat &#123;</span><br><span class="line">  name: <span class="built_in">string</span>,</span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c1: Cat = &#123; name: <span class="string">'å°ç™½'</span>, age: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">const</span> c2: Cat = &#123; name: <span class="string">'å°èŠ±'</span> &#125;  <span class="comment">// é”™è¯¯: ç¼ºå°‘ age å±æ€§</span></span><br><span class="line"><span class="keyword">const</span> c3: Cat = &#123; name: <span class="string">'å°é»‘'</span>, age: <span class="number">1</span>, sex: <span class="string">'å…¬'</span> &#125; <span class="comment">// é”™è¯¯: å¤šå‡º sex å±æ€§</span></span><br></pre></td></tr></table></figure><h5 id="å¯é€‰å±æ€§"><a href="#å¯é€‰å±æ€§" class="headerlink" title="å¯é€‰å±æ€§"></a>å¯é€‰å±æ€§</h5><p>å¦‚æœéœ€è¦æŸä¸ªå±æ€§å¯é€‰ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„è¯­æ³•</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Cat &#123;</span><br><span class="line">  name: <span class="built_in">string</span>,</span><br><span class="line">  age?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c1: Cat = &#123; name: <span class="string">'å°ç™½'</span>, age: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">const</span> c2: Cat = &#123; name: <span class="string">'å°èŠ±'</span> &#125;  <span class="comment">// æ­£ç¡®: age å±æ€§å¯é€‰</span></span><br></pre></td></tr></table></figure><ul><li>å¯é€‰å±æ€§è¦æ³¨æ„å¤„ç† undefined å€¼</li></ul><h5 id="é¸­å­ç±»å‹"><a href="#é¸­å­ç±»å‹" class="headerlink" title="é¸­å­ç±»å‹"></a>é¸­å­ç±»å‹</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Cat &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">cat: Cat</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(cat.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c1 = &#123; name: <span class="string">'å°ç™½'</span>, age: <span class="number">1</span> &#125; </span><br><span class="line">test(c1)</span><br></pre></td></tr></table></figure><ul><li>const c1 å¹¶æ²¡æœ‰å£°æ˜ç±»å‹ä¸º Catï¼Œä½†å®ƒä¸ Cat ç±»å‹æœ‰ä¸€æ ·çš„å±æ€§ï¼Œä¹Ÿå¯ä»¥è¢«å½“ä½œæ˜¯ Cat ç±»å‹</li></ul><h4 id="æ–¹æ³•ç±»å‹"><a href="#æ–¹æ³•ç±»å‹" class="headerlink" title="æ–¹æ³•ç±»å‹"></a>æ–¹æ³•ç±»å‹</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Api &#123;</span><br><span class="line">  foo(): <span class="built_in">void</span>,</span><br><span class="line">  bar(str: <span class="built_in">string</span>): <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">api: Api</span>) </span>&#123;</span><br><span class="line">  api.foo()</span><br><span class="line">  <span class="built_in">console</span>.log(api.bar(<span class="string">'hello'</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(&#123;</span><br><span class="line">  foo() &#123; <span class="built_in">console</span>.log(<span class="string">'ok'</span>) &#125;,</span><br><span class="line">  bar(str: <span class="built_in">string</span>) &#123; <span class="keyword">return</span> str.toUpperCase() &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="å­—é¢é‡ç±»å‹"><a href="#å­—é¢é‡ç±»å‹" class="headerlink" title="å­—é¢é‡ç±»å‹"></a>å­—é¢é‡ç±»å‹</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printText</span>(<span class="params">s: <span class="built_in">string</span>, alignment: "left" | "right" | "center"</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(s, alignment)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printText(<span class="string">'hello'</span>, <span class="string">'left'</span>)</span><br><span class="line">printText(<span class="string">'hello'</span>, <span class="string">'aaa'</span>) <span class="comment">// é”™è¯¯: å–å€¼åªèƒ½æ˜¯ left | right | center</span></span><br></pre></td></tr></table></figure><h4 id="nullish-ç±»å‹"><a href="#nullish-ç±»å‹" class="headerlink" title="nullish ç±»å‹"></a>nullish ç±»å‹</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">x?: <span class="built_in">string</span> | <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x?.toUpperCase())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'aaa'</span>)</span><br><span class="line">test(<span class="literal">null</span>)</span><br><span class="line">test()</span><br></pre></td></tr></table></figure><ul><li>x?: string | null è¡¨ç¤ºå¯èƒ½æ˜¯ undefined æˆ–è€…æ˜¯ string æˆ–è€…æ˜¯ null</li></ul><h4 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h4><p>ä¸‹é¢çš„å‡ ä¸ªç±»å‹å£°æ˜æ˜¾ç„¶æœ‰ä¸€å®šçš„ç›¸ä¼¼æ€§</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> RefString &#123;</span><br><span class="line">  value: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> RefNumber &#123;</span><br><span class="line">  value: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> RefBoolean &#123;</span><br><span class="line">  value: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> r1: RefString = &#123; value: <span class="string">'hello'</span> &#125;</span><br><span class="line"><span class="keyword">const</span> r2: RefNumber = &#123; value: <span class="number">123</span> &#125;</span><br><span class="line"><span class="keyword">const</span> r3: RefBoolean = &#123; value: <span class="literal">true</span> &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ”¹è¿›ä¸º</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Ref&lt;T&gt; &#123;</span><br><span class="line">  value: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> r1: Ref&lt;<span class="built_in">string</span>&gt; = &#123; value: <span class="string">'hello'</span> &#125;</span><br><span class="line"><span class="keyword">const</span> r2: Ref&lt;<span class="built_in">number</span>&gt; = &#123; value: <span class="number">123</span> &#125;</span><br><span class="line"><span class="keyword">const</span> r3: Ref&lt;<span class="built_in">boolean</span>&gt; = &#123; value: <span class="literal">true</span> &#125;</span><br></pre></td></tr></table></figure><ul><li>æ³›å‹çš„è¦ç‚¹å°±æ˜¯ <code>&lt;ç±»å‹å‚æ•°&gt;</code>ï¼ŒæŠŠã€ç±»å‹ã€‘ä¹Ÿå½“ä½œä¸€ä¸ªå˜åŒ–çš„è¦ç´ ï¼Œåƒå‚æ•°ä¸€æ ·ä¼ é€’è¿‡æ¥ï¼Œè¿™æ ·å°±å¯ä»¥æ´¾ç”Ÿå‡ºç»“æ„ç›¸ä¼¼çš„æ–°ç±»å‹</li></ul><p>å‡½æ•°å®šä¹‰ä¹Ÿæ”¯æŒæ³›å‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ref</span>&lt;<span class="title">T</span>&gt;(<span class="params">n: T</span>): <span class="title">Ref</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; value: n &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> v1 = ref(<span class="string">"hello"</span>); <span class="comment">// Ref&lt;string&gt;</span></span><br><span class="line"><span class="keyword">const</span> v2 = ref(<span class="number">123.3333</span>);<span class="comment">// Ref&lt;number&gt;</span></span><br><span class="line"></span><br><span class="line">v1.value.toLocaleLowerCase()</span><br><span class="line">v2.value.toFixed(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><h3 id="4-æ„ä¹‰"><a href="#4-æ„ä¹‰" class="headerlink" title="4) æ„ä¹‰"></a>4) æ„ä¹‰</h3><h4 id="æ›´å¥½ç†è§£æ¡†æ¶"><a href="#æ›´å¥½ç†è§£æ¡†æ¶" class="headerlink" title="æ›´å¥½ç†è§£æ¡†æ¶"></a>æ›´å¥½ç†è§£æ¡†æ¶</h4><p>ç°åœ¨è¶Šæ¥è¶Šå¤šçš„å‰ç«¯æ¡†æ¶é‡‡ç”¨ typescriptï¼Œå¦‚æœæ‡‚ typescript è¯­æ³•ï¼Œå¯ä»¥æ›´å¥½åœ°é˜…è¯»æ¡†æ¶ä»£ç </p><p>ä»¥ Map ä¸ºä¾‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> Map&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;()</span><br><span class="line">map</span><br><span class="line">  .set(<span class="string">"a"</span>, <span class="string">"b"</span>)</span><br><span class="line">  .set(<span class="string">"c"</span>, <span class="string">"d"</span>)</span><br><span class="line"></span><br><span class="line">map.forEach(<span class="function">(<span class="params">value,key,m</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value, key)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„ç¼–è¯‘éœ€è¦ <code>tsc --target es6 .\xxx.ts</code></li></ul><h4 id="æ›´å¥½çš„æç¤º"><a href="#æ›´å¥½çš„æç¤º" class="headerlink" title="æ›´å¥½çš„æç¤º"></a>æ›´å¥½çš„æç¤º</h4><p>ä¾‹å¦‚ï¼Œä»æœåŠ¡å™¨è¿”å›çš„ä¸€æ®µ jsonï¼Œå¦‚æœä¸ç”¨ typescriptï¼Œåˆ™ç¼–è¾‘å™¨ä¹Ÿä¸èƒ½ç»™å‡ºå‡†ç¡®çš„æç¤º</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> User &#123;</span><br><span class="line">  name: <span class="built_in">string</span>,</span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user: User = <span class="built_in">JSON</span>.parse(<span class="string">`&#123; "name":"å¼ ä¸‰", "age":18 &#125;`</span>)</span><br></pre></td></tr></table></figure><h3 id="5-ç±»"><a href="#5-ç±»" class="headerlink" title="5) ç±»"></a>5) ç±»</h3><blockquote><p>å…³äº TypeScript ä¸ JavaScript ä¸­çš„ç±»è¯­æ³•ä¸æ˜¯é‡ç‚¹ï¼Œclass ç›¸å…³è¯­æ³•åªæ˜¯èµ·åˆ°è¾…åŠ©ä½œç”¨ï¼Œæ›´é‡è¦çš„æ˜¯å‰é¢è®²çš„ interface</p></blockquote><h4 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> User &#123;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> User(<span class="string">'å¼ ä¸‰'</span>)</span><br></pre></td></tr></table></figure><p>å…¶å®ä¼šè¢«ç¼–è¯‘æˆè¿™ä¸ªæ ·å­ï¼ˆé»˜è®¤ â€“target=es3ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = <span class="comment">/** @class */</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">User</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> User;</span><br><span class="line">&#125;());</span><br><span class="line"><span class="keyword">var</span> u = <span class="keyword">new</span> User(<span class="string">'å¼ ä¸‰'</span>);</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ js ä¸­çš„ classï¼Œå¹¶ä¸ç­‰ä»·äº java ä¸­çš„ classï¼Œå®ƒè¿˜æ˜¯åŸºäºåŸå‹å®ç°çš„ï¼ŒåŸç†å‚è€ƒç¬¬äºŒç« ï¼ˆ036ã€037ï¼‰</p><h4 id="åªè¯»å±æ€§"><a href="#åªè¯»å±æ€§" class="headerlink" title="åªè¯»å±æ€§"></a>åªè¯»å±æ€§</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> User &#123;</span><br><span class="line">  readonly name: <span class="built_in">string</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> User(<span class="string">'å¼ ä¸‰'</span>)</span><br><span class="line">u.name = <span class="string">'æå››'</span><span class="comment">// ç¼–è¯‘é”™è¯¯</span></span><br></pre></td></tr></table></figure><ul><li>readonly æ˜¯ typescript ç‰¹æœ‰çš„ï¼Œè¡¨ç¤ºè¯¥å±æ€§åªè¯»</li></ul><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> User &#123;</span><br><span class="line">  readonly name: <span class="built_in">string</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  study() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;this.name&#125;</span>]æ­£åœ¨å­¦ä¹ `</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> User(<span class="string">'å¼ ä¸‰'</span>)</span><br><span class="line">u.study()</span><br></pre></td></tr></table></figure><h4 id="getï¼Œset"><a href="#getï¼Œset" class="headerlink" title="getï¼Œset"></a>getï¼Œset</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> User &#123;</span><br><span class="line">  _name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>._name = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> name() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> name(name: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>._name = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> User(<span class="string">'å¼ ä¸‰'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(u.name)</span><br><span class="line">u.name = <span class="string">'æå››'</span></span><br><span class="line"><span class="built_in">console</span>.log(u.name)</span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„ï¼Œéœ€è¦åœ¨ç¼–è¯‘æ—¶åŠ ä¸Š <code>tsc --target es6 .\xxx.ts</code> é€‰é¡¹</li><li>es6 ç­‰ä»·äº es2015ï¼Œå†æ­¤ä¹‹ä¸Šè¿˜æœ‰ es2016 â€¦ es2022</li></ul><h4 id="ç±»ä¸æ¥å£"><a href="#ç±»ä¸æ¥å£" class="headerlink" title="ç±»ä¸æ¥å£"></a>ç±»ä¸æ¥å£</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> User &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  study(course: <span class="built_in">string</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> UserImpl <span class="keyword">implements</span> User &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  study(course: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;this.name&#125;</span>]æ­£åœ¨å­¦ä¹ [<span class="subst">$&#123;course&#125;</span>]`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  foo() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user: User = <span class="keyword">new</span> UserImpl(<span class="string">'å¼ ä¸‰'</span>)</span><br><span class="line">user.study(<span class="string">'Typescript'</span>)</span><br><span class="line">user.foo() <span class="comment">// é”™è¯¯ï¼Œå¿…é¡»æ˜¯æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•</span></span><br></pre></td></tr></table></figure><h4 id="ç»§æ‰¿ä¸æ¥å£"><a href="#ç»§æ‰¿ä¸æ¥å£" class="headerlink" title="ç»§æ‰¿ä¸æ¥å£"></a>ç»§æ‰¿ä¸æ¥å£</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Flyable &#123;</span><br><span class="line">  fly(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Bird <span class="keyword">extends</span> Animal <span class="keyword">implements</span> Flyable &#123;</span><br><span class="line">  fly() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;this.name&#125;</span>åœ¨é£ç¿”`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b: Flyable &amp; Animal = <span class="keyword">new</span> Bird(<span class="string">"å°èŠ±"</span>)</span><br><span class="line">b.fly()</span><br></pre></td></tr></table></figure><ul><li>Flyable &amp; Animal è¡¨ç¤ºå˜é‡æ˜¯ flyable ç±»å‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ Animal ç±»å‹</li></ul><h4 id="æ–¹æ³•é‡å†™"><a href="#æ–¹æ³•é‡å†™" class="headerlink" title="æ–¹æ³•é‡å†™"></a>æ–¹æ³•é‡å†™</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Father &#123;</span><br><span class="line">  study(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`father study`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Son <span class="keyword">extends</span> Father &#123;  </span><br><span class="line">  study(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.study()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`son study`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> f: Father = <span class="keyword">new</span> Son()</span><br><span class="line">f.study()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Typescript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> Typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue2çŸ¥è¯†ç‚¹æ€»ç»“</title>
      <link href="/2022/11/03/09_Java%E7%A8%8B%E5%BA%8F%E5%91%98%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E5%89%8D%E7%AB%AF-vue2/"/>
      <url>/2022/11/03/09_Java%E7%A8%8B%E5%BA%8F%E5%91%98%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E5%89%8D%E7%AB%AF-vue2/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Vue-2"><a href="#Vue-2" class="headerlink" title="Vue 2"></a>Vue 2</h1><h2 id="1-Vue-åŸºç¡€"><a href="#1-Vue-åŸºç¡€" class="headerlink" title="1. Vue åŸºç¡€"></a>1. Vue åŸºç¡€</h2><h3 id="1-ç¯å¢ƒå‡†å¤‡"><a href="#1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1) ç¯å¢ƒå‡†å¤‡"></a>1) ç¯å¢ƒå‡†å¤‡</h3><h4 id="å®‰è£…è„šæ‰‹æ¶"><a href="#å®‰è£…è„šæ‰‹æ¶" class="headerlink" title="å®‰è£…è„šæ‰‹æ¶"></a>å®‰è£…è„šæ‰‹æ¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br></pre></td></tr></table></figure><ul><li>-g å‚æ•°è¡¨ç¤ºå…¨å±€å®‰è£…ï¼Œè¿™æ ·åœ¨ä»»æ„ç›®å½•éƒ½å¯ä»¥ä½¿ç”¨ vue è„šæœ¬åˆ›å»ºé¡¹ç›®</li></ul><h4 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue ui</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…-devtools"><a href="#å®‰è£…-devtools" class="headerlink" title="å®‰è£… devtools"></a>å®‰è£… devtools</h4><ul><li>devtools æ’ä»¶ç½‘å€ï¼š<a href="https://devtools.vuejs.org/guide/installation.html" target="_blank" rel="noopener">https://devtools.vuejs.org/guide/installation.html</a></li></ul><h4 id="è¿è¡Œé¡¹ç›®"><a href="#è¿è¡Œé¡¹ç›®" class="headerlink" title="è¿è¡Œé¡¹ç›®"></a>è¿è¡Œé¡¹ç›®</h4><p>è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œæ‰§è¡Œ</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹ç«¯å£"><a href="#ä¿®æ”¹ç«¯å£" class="headerlink" title="ä¿®æ”¹ç«¯å£"></a>ä¿®æ”¹ç«¯å£</h4><p>å‰ç«¯æœåŠ¡å™¨é»˜è®¤å ç”¨äº† 8080 ç«¯å£ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹</p><ul><li><p>æ–‡æ¡£åœ°å€ï¼š<a href="https://webpack.js.org/configuration/dev-server/#devserverport" target="_blank" rel="noopener">DevServer | webpack</a></p></li><li><p>æ‰“å¼€ vue.config.js æ·»åŠ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">'@vue/cli-service'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = defineConfig(&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">7070</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h4 id="æ·»åŠ ä»£ç†"><a href="#æ·»åŠ ä»£ç†" class="headerlink" title="æ·»åŠ ä»£ç†"></a>æ·»åŠ ä»£ç†</h4><p>ä¸ºäº†é¿å…å‰åç«¯æœåŠ¡å™¨è”è°ƒæ—¶ï¼Œ fetchã€xhr è¯·æ±‚äº§ç”Ÿè·¨åŸŸé—®é¢˜ï¼Œéœ€è¦é…ç½®ä»£ç†</p><ul><li><p>æ–‡æ¡£åœ°å€åŒä¸Š</p></li><li><p>æ‰“å¼€ vue.config.js æ·»åŠ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">'@vue/cli-service'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = defineConfig(&#123;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">7070</span>,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/api'</span>: &#123;</span><br><span class="line">        target: <span class="string">'http://localhost:8080'</span>,</span><br><span class="line">        changeOrigin: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h4 id="Vue-é¡¹ç›®ç»“æ„"><a href="#Vue-é¡¹ç›®ç»“æ„" class="headerlink" title="Vue é¡¹ç›®ç»“æ„"></a>Vue é¡¹ç›®ç»“æ„</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS D:\2022.js\ä»£ç \ç¬¬3ç« \client&gt; tree src</span><br><span class="line">D:\2022.JS\ä»£ç \ç¬¬3ç« \CLIENT\SRC</span><br><span class="line">â”œâ”€assets</span><br><span class="line">â”œâ”€components</span><br><span class="line">â”œâ”€router</span><br><span class="line">â”œâ”€store</span><br><span class="line">â””â”€views</span><br></pre></td></tr></table></figure><ul><li>assets - é™æ€èµ„æº</li><li>components - å¯é‡ç”¨ç»„ä»¶</li><li>router - è·¯ç”±</li><li>store - æ•°æ®å…±äº«</li><li>views - è§†å›¾ç»„ä»¶</li></ul><p>ä»¥åè¿˜ä¼šæ·»åŠ </p><ul><li>api - è·Ÿåå°äº¤äº’ï¼Œå‘é€ fetchã€xhr è¯·æ±‚ï¼Œæ¥æ”¶å“åº”</li><li>plugins - æ’ä»¶</li></ul><h3 id="2-Vue-ç»„ä»¶"><a href="#2-Vue-ç»„ä»¶" class="headerlink" title="2) Vue ç»„ä»¶"></a>2) Vue ç»„ä»¶</h3><p>Vue çš„ç»„ä»¶æ–‡ä»¶ä»¥ .vue ç»“å°¾ï¼Œæ¯ä¸ªç»„ä»¶ç”±ä¸‰éƒ¨åˆ†ç»„æˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><ul><li>template æ¨¡æ¿éƒ¨åˆ†ï¼Œç”±å®ƒç”Ÿæˆ html ä»£ç </li><li>script ä»£ç éƒ¨åˆ†ï¼Œæ§åˆ¶æ¨¡æ¿çš„æ•°æ®æ¥æºå’Œè¡Œä¸º</li><li>style æ ·å¼éƒ¨åˆ†ï¼Œä¸€èˆ¬ä¸å’‹å…³å¿ƒ</li></ul><p>å…¥å£ç»„ä»¶æ˜¯ App.vue</p><p>å…ˆåˆ é™¤åŸæœ‰ä»£ç ï¼Œæ¥ä¸ª Hello, World ä¾‹å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;&#123;&#123;msg&#125;&#125;&lt;/h1&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      msg: &quot;Hello, Vue!&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>è§£é‡Š</p><ul><li>export default å¯¼å‡ºç»„ä»¶å¯¹è±¡ï¼Œä¾› main.js å¯¼å…¥ä½¿ç”¨</li><li>è¿™ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ª data æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª<strong>å¯¹è±¡</strong>ï¼Œç»™ template æä¾›æ•°æ®</li><li>åŒæ‹¬å· åœ¨ Vue é‡Œç§°ä¹‹ä¸ºæ’å€¼è¡¨è¾¾å¼ï¼Œç”¨æ¥<strong>ç»‘å®š</strong> data æ–¹æ³•è¿”å›çš„<strong>å¯¹è±¡</strong>å±æ€§ï¼Œ<strong>ç»‘å®š</strong>çš„å«ä¹‰æ˜¯æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé¡µé¢æ˜¾ç¤ºä¼šåŒæ­¥å˜åŒ–</li></ul><h4 id="æ–‡æœ¬æ’å€¼"><a href="#æ–‡æœ¬æ’å€¼" class="headerlink" title="æ–‡æœ¬æ’å€¼"></a>æ–‡æœ¬æ’å€¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;&#123; name &#125;&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;h1&gt;&#123;&#123; age &gt; 60 ? &apos;è€å¹´&apos; : &apos;é’å¹´&apos; &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const options = &#123;</span><br><span class="line">    data: function () &#123;</span><br><span class="line">        return &#123; name: &apos;å¼ ä¸‰&apos;, age: 70 &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>åŒæ‹¬å· é‡Œåªèƒ½ç»‘å®šä¸€ä¸ªå±æ€§ï¼Œç»‘å®šå¤šä¸ªå±æ€§éœ€è¦ç”¨å¤šä¸ª åŒæ‹¬å· åˆ†åˆ«ç»‘å®š</li><li>template å†…åªèƒ½æœ‰ä¸€ä¸ªæ ¹å…ƒç´ </li><li>æ’å€¼å†…å¯ä»¥è¿›è¡Œç®€å•çš„è¡¨è¾¾å¼è®¡ç®—</li></ul><h4 id="å±æ€§ç»‘å®š"><a href="#å±æ€§ç»‘å®š" class="headerlink" title="å±æ€§ç»‘å®š"></a>å±æ€§ç»‘å®š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;div&gt;&lt;input type=&quot;text&quot; v-bind:value=&quot;name&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&lt;input type=&quot;date&quot; v-bind:value=&quot;birthday&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&lt;input type=&quot;text&quot; :value=&quot;age&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const options = &#123;</span><br><span class="line">    data: function () &#123;</span><br><span class="line">        return &#123; name: &apos;ç‹äº”&apos;, birthday: &apos;1995-05-01&apos;, age: 20 &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>ç®€å†™æ–¹å¼ï¼šå¯ä»¥çœç•¥ v-bind åªä¿ç•™å†’å·</li></ul><h4 id="äº‹ä»¶ç»‘å®š"><a href="#äº‹ä»¶ç»‘å®š" class="headerlink" title="äº‹ä»¶ç»‘å®š"></a>äº‹ä»¶ç»‘å®š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- äº‹ä»¶ç»‘å®š --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;div&gt;&lt;input type=&quot;button&quot; value=&quot;ç‚¹æˆ‘æ‰§è¡Œm1&quot; v-on:click=&quot;m1&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&lt;input type=&quot;button&quot; value=&quot;ç‚¹æˆ‘æ‰§è¡Œm2&quot; @click=&quot;m2&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123;count&#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const options = &#123;</span><br><span class="line">    data: function () &#123;</span><br><span class="line">        return &#123; count: 0 &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        m1() &#123;</span><br><span class="line">            this.count ++;</span><br><span class="line">            console.log(&quot;m1&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        m2() &#123;</span><br><span class="line">            this.count --;</span><br><span class="line">            console.log(&quot;m2&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>ç®€å†™æ–¹å¼ï¼šå¯ä»¥æŠŠ v-on: æ›¿æ¢ä¸º @</li><li>åœ¨ methods æ–¹æ³•ä¸­çš„ this ä»£è¡¨çš„æ˜¯ data å‡½æ•°è¿”å›çš„æ•°æ®å¯¹è±¡</li></ul><h4 id="åŒå‘ç»‘å®š"><a href="#åŒå‘ç»‘å®š" class="headerlink" title="åŒå‘ç»‘å®š"></a>åŒå‘ç»‘å®š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;label for=&quot;&quot;&gt;è¯·è¾“å…¥å§“å&lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; v-model=&quot;name&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;label for=&quot;&quot;&gt;è¯·è¾“å…¥å¹´é¾„&lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; v-model=&quot;age&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;label for=&quot;&quot;&gt;è¯·é€‰æ‹©æ€§åˆ«&lt;/label&gt;</span><br><span class="line">            ç”· &lt;input type=&quot;radio&quot; value=&quot;ç”·&quot; v-model=&quot;sex&quot;&gt;</span><br><span class="line">            å¥³ &lt;input type=&quot;radio&quot; value=&quot;å¥³&quot; v-model=&quot;sex&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;label for=&quot;&quot;&gt;è¯·é€‰æ‹©çˆ±å¥½&lt;/label&gt;</span><br><span class="line">            æ¸¸æ³³ &lt;input type=&quot;checkbox&quot; value=&quot;æ¸¸æ³³&quot; v-model=&quot;fav&quot;&gt;</span><br><span class="line">            æ‰“çƒ &lt;input type=&quot;checkbox&quot; value=&quot;æ‰“çƒ&quot; v-model=&quot;fav&quot;&gt;</span><br><span class="line">            å¥èº« &lt;input type=&quot;checkbox&quot; value=&quot;å¥èº«&quot; v-model=&quot;fav&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const options = &#123;</span><br><span class="line">    data: function () &#123;</span><br><span class="line">        return &#123; name: &apos;&apos;, age: null, sex:&apos;ç”·&apos; , fav:[&apos;æ‰“çƒ&apos;]&#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>ç”¨ v-model å®ç°åŒå‘ç»‘å®šï¼Œå³ <ul><li>javascript æ•°æ®å¯ä»¥åŒæ­¥åˆ°è¡¨å•æ ‡ç­¾</li><li>åè¿‡æ¥ç”¨æˆ·åœ¨è¡¨å•æ ‡ç­¾è¾“å…¥çš„æ–°å€¼ä¹Ÿä¼šåŒæ­¥åˆ° javascript è¿™è¾¹</li></ul></li><li>åŒå‘ç»‘å®šåªé€‚ç”¨äºè¡¨å•è¿™ç§å¸¦ã€è¾“å…¥ã€‘åŠŸèƒ½çš„æ ‡ç­¾ï¼Œå…¶å®ƒæ ‡ç­¾çš„æ•°æ®ç»‘å®šï¼Œå•å‘å°±è¶³å¤Ÿäº†</li><li>å¤é€‰æ¡†è¿™ç§æ ‡ç­¾ï¼ŒåŒå‘ç»‘å®šçš„ javascript æ•°æ®ç±»å‹ä¸€èˆ¬ç”¨æ•°ç»„</li></ul><h4 id="è®¡ç®—å±æ€§"><a href="#è®¡ç®—å±æ€§" class="headerlink" title="è®¡ç®—å±æ€§"></a>è®¡ç®—å±æ€§</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- è®¡ç®—å±æ€§ --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h2&gt;&#123;&#123;fullName&#125;&#125;&lt;/h2&gt;</span><br><span class="line">        &lt;h2&gt;&#123;&#123;fullName&#125;&#125;&lt;/h2&gt;</span><br><span class="line">        &lt;h2&gt;&#123;&#123;fullName&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const options = &#123;</span><br><span class="line">    data: function () &#123;</span><br><span class="line">        return &#123; firstName: &apos;ä¸‰&apos;, lastName: &apos;å¼ &apos; &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    /* methods: &#123;</span><br><span class="line">        fullName() &#123;</span><br><span class="line">            console.log(&apos;è¿›å…¥äº† fullName&apos;)</span><br><span class="line">            return this.lastName + this.firstName;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,*/</span><br><span class="line">    computed: &#123;</span><br><span class="line">        fullName() &#123;</span><br><span class="line">            console.log(&apos;è¿›å…¥äº† fullName&apos;)</span><br><span class="line">            return this.lastName + this.firstName;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br></pre></td></tr></table></figure><ul><li>æ™®é€šæ–¹æ³•è°ƒç”¨å¿…é¡»åŠ  ()ï¼Œæ²¡æœ‰ç¼“å­˜åŠŸèƒ½</li><li>è®¡ç®—å±æ€§ä½¿ç”¨æ—¶å°±æŠŠå®ƒå½“å±æ€§æ¥ç”¨ï¼Œä¸åŠ  ()ï¼Œæœ‰ç¼“å­˜åŠŸèƒ½ï¼š<ul><li>ä¸€æ¬¡è®¡ç®—åï¼Œä¼šå°†ç»“æœç¼“å­˜ï¼Œä¸‹æ¬¡å†è®¡ç®—æ—¶ï¼Œåªè¦æ•°æ®æ²¡æœ‰å˜åŒ–ï¼Œä¸ä¼šé‡æ–°è®¡ç®—ï¼Œç›´æ¥è¿”å›ç¼“å­˜ç»“æœ</li></ul></li></ul><h4 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h4><p>axios å®ƒçš„åº•å±‚æ˜¯ç”¨äº† XMLHttpRequestï¼ˆxhrï¼‰æ–¹å¼å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”ï¼Œxhr ç›¸å¯¹äºä¹‹å‰è®²è¿‡çš„ fetch api æ¥è¯´ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†ç”±äºæ˜¯æ¯”è¾ƒè€çš„ apiï¼Œä¸æ”¯æŒ Promiseï¼Œaxios å¯¹ xhr è¿›è¡Œäº†å°è£…ï¼Œä½¿ä¹‹æ”¯æŒ Promiseï¼Œå¹¶æä¾›äº†å¯¹è¯·æ±‚ã€å“åº”çš„ç»Ÿä¸€æ‹¦æˆªåŠŸèƒ½</p><p>å®‰è£…</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios -S</span><br></pre></td></tr></table></figure><p>å¯¼å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br></pre></td></tr></table></figure><ul><li>axios é»˜è®¤å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œçš„ import å¯¼å…¥çš„å°±æ˜¯å®ƒé»˜è®¤å¯¼å‡ºçš„å¯¹è±¡</li></ul><p>æ–¹æ³•</p><table><thead><tr><th>è¯·æ±‚</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>axios.get(url[, config])</td><td>:star:</td></tr><tr><td>axios.delete(url[, config])</td><td></td></tr><tr><td>axios.head(url[, config])</td><td></td></tr><tr><td>axios.options(url[, config])</td><td></td></tr><tr><td>axios.post(url[, data[, config]])</td><td>:star:</td></tr><tr><td>axios.put(url[, data[, config]])</td><td></td></tr><tr><td>axios.patch(url[, data[, config]])</td><td></td></tr></tbody></table><ul><li>config - é€‰é¡¹å¯¹è±¡ã€ä¾‹å¦‚æŸ¥è¯¢å‚æ•°ã€è¯·æ±‚å¤´â€¦</li><li>data - è¯·æ±‚ä½“æ•°æ®ã€æœ€å¸¸è§çš„æ˜¯ json æ ¼å¼æ•°æ®</li><li>getã€head è¯·æ±‚æ— æ³•æºå¸¦è¯·æ±‚ä½“ï¼Œè¿™åº”å½“æ˜¯æµè§ˆå™¨çš„é™åˆ¶æ‰€è‡´ï¼ˆxhrã€fetch api å‡æœ‰é™åˆ¶ï¼‰</li><li>optionsã€delete è¯·æ±‚å¯ä»¥é€šè¿‡ config ä¸­çš„ data æºå¸¦è¯·æ±‚ä½“</li></ul><p>ä¾‹å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; value=&quot;è·å–è¿œç¨‹æ•°æ®&quot; @click=&quot;sendReq()&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &apos;axios&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        async sendReq() &#123;</span><br><span class="line">            // 1. æ¼”ç¤º get, post</span><br><span class="line">            // const resp = await axios.post(&apos;/api/a2&apos;);</span><br><span class="line"></span><br><span class="line">            // 2. å‘é€è¯·æ±‚å¤´</span><br><span class="line">            // const resp = await axios.post(&apos;/api/a3&apos;,&#123;&#125;,&#123;</span><br><span class="line">            //     headers:&#123;</span><br><span class="line">            //         Authorization:&apos;abc&apos;</span><br><span class="line">            //     &#125;</span><br><span class="line">            // &#125;);</span><br><span class="line"></span><br><span class="line">            // 3. å‘é€è¯·æ±‚æ—¶æºå¸¦æŸ¥è¯¢å‚æ•° ?name=xxx&amp;age=xxx</span><br><span class="line">            // const name = encodeURIComponent(&apos;&amp;&amp;&amp;&apos;);</span><br><span class="line">            // const age = 18;</span><br><span class="line">            // const resp = await axios.post(`/api/a4?name=$&#123;name&#125;&amp;age=$&#123;age&#125;`);</span><br><span class="line"></span><br><span class="line">            // ä¸æƒ³è‡ªå·±æ‹¼ä¸²ã€å¤„ç†ç‰¹æ®Šå­—ç¬¦ã€å°±ç”¨ä¸‹é¢çš„åŠæ³•</span><br><span class="line">            // const resp = await axios.post(&apos;/api/a4&apos;, &#123;&#125;, &#123;</span><br><span class="line">            //     params: &#123;</span><br><span class="line">            //         name:&apos;&amp;&amp;&amp;&amp;&apos;,</span><br><span class="line">            //         age: 20</span><br><span class="line">            //     &#125;</span><br><span class="line">            // &#125;);</span><br><span class="line"></span><br><span class="line">            // 4. ç”¨è¯·æ±‚ä½“å‘æ•°æ®ï¼Œæ ¼å¼ä¸º urlencoded</span><br><span class="line">            // const params = new URLSearchParams();</span><br><span class="line">            // params.append(&quot;name&quot;, &quot;å¼ ä¸‰&quot;);</span><br><span class="line">            // params.append(&quot;age&quot;, 24)</span><br><span class="line"></span><br><span class="line">            // const resp = await axios.post(&apos;/api/a4&apos;, params);</span><br><span class="line"></span><br><span class="line">            // 5. ç”¨è¯·æ±‚ä½“å‘æ•°æ®ï¼Œæ ¼å¼ä¸º multipart</span><br><span class="line">            // const params = new FormData();</span><br><span class="line">            // params.append(&quot;name&quot;, &quot;æå››&quot;);</span><br><span class="line">            // params.append(&quot;age&quot;, 30);</span><br><span class="line">            // const resp = await axios.post(&apos;/api/a5&apos;, params);</span><br><span class="line"></span><br><span class="line">            // 6. ç”¨è¯·æ±‚ä½“å‘æ•°æ®ï¼Œæ ¼å¼ä¸º json</span><br><span class="line">            const resp = await axios.post(&apos;/api/a5json&apos;, &#123;</span><br><span class="line">                name: &apos;ç‹äº”&apos;,</span><br><span class="line">                age: 50</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            console.log(resp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _axios = axios.create(config);</span><br></pre></td></tr></table></figure><ul><li>axios å¯¹è±¡å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä½†ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„è®¾ç½®</li><li>ç”¨ axios.create åˆ›å»ºçš„å¯¹è±¡ï¼Œå¯ä»¥è¦†ç›–é»˜è®¤è®¾ç½®ï¼Œconfig è§ä¸‹é¢è¯´æ˜</li></ul><p>å¸¸è§çš„ config é¡¹æœ‰</p><table><thead><tr><th>åç§°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>baseURL</td><td>å°†è‡ªåŠ¨åŠ åœ¨ url å‰é¢</td></tr><tr><td>headers</td><td>è¯·æ±‚å¤´ï¼Œç±»å‹ä¸ºç®€å•å¯¹è±¡</td></tr><tr><td>params</td><td>è·Ÿåœ¨ URL åçš„è¯·æ±‚å‚æ•°ï¼Œç±»å‹ä¸ºç®€å•å¯¹è±¡æˆ– URLSearchParams</td></tr><tr><td>data</td><td>è¯·æ±‚ä½“ï¼Œç±»å‹æœ‰ç®€å•å¯¹è±¡ã€FormDataã€URLSearchParamsã€File ç­‰</td></tr><tr><td>withCredentials</td><td>è·¨åŸŸæ—¶æ˜¯å¦æºå¸¦ Cookie ç­‰å‡­è¯ï¼Œé»˜è®¤ä¸º false</td></tr><tr><td>responseType</td><td>å“åº”ç±»å‹ï¼Œé»˜è®¤ä¸º json</td></tr></tbody></table><p>ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _axios = axios.create(&#123;</span><br><span class="line">    baseURL: <span class="string">'http://localhost:8080'</span>,</span><br><span class="line">    withCredentials: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">await</span> _axios.post(<span class="string">'/api/a6set'</span>)</span><br><span class="line"><span class="keyword">await</span> _axios.post(<span class="string">'/api/a6get'</span>)</span><br></pre></td></tr></table></figure><ul><li>ç”Ÿäº§ç¯å¢ƒå¸Œæœ› xhr è¯·æ±‚ä¸èµ°ä»£ç†ï¼Œå¯ä»¥ç”¨ baseURL ç»Ÿä¸€ä¿®æ”¹</li><li>å¸Œæœ›è·¨åŸŸè¯·æ±‚æºå¸¦ cookieï¼Œéœ€è¦é…ç½® withCredentials: trueï¼ŒæœåŠ¡å™¨ä¹Ÿè¦é…ç½® allowCredentials = trueï¼Œå¦åˆ™æµè§ˆå™¨è·å–è·¨åŸŸè¿”å›çš„ cookie æ—¶ä¼šæŠ¥é”™</li></ul><p>å“åº”æ ¼å¼</p><table><thead><tr><th>åç§°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>data</td><td>å“åº”ä½“æ•°æ® :star:</td></tr><tr><td>status</td><td>çŠ¶æ€ç  :star:</td></tr><tr><td>headers</td><td>å“åº”å¤´</td></tr></tbody></table><ul><li>200 è¡¨ç¤ºå“åº”æˆåŠŸ</li><li>400 è¯·æ±‚æ•°æ®ä¸æ­£ç¡® age=abc</li><li>401 èº«ä»½éªŒè¯æ²¡é€šè¿‡</li><li>403 æ²¡æœ‰æƒé™</li><li>404 èµ„æºä¸å­˜åœ¨</li><li>405 ä¸æ”¯æŒè¯·æ±‚æ–¹å¼ post</li><li>500 æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</li></ul><p>è¯·æ±‚æ‹¦æˆªå™¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">_axios.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æ¯”å¦‚åœ¨è¿™é‡Œæ·»åŠ ç»Ÿä¸€çš„ headers</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å“åº”æ‹¦æˆªå™¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">_axios.interceptors.response.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2xx èŒƒå›´å†…èµ°è¿™é‡Œ</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è¶…å‡º 2xx, æ¯”å¦‚ 4xx, 5xx èµ°è¿™é‡Œ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="æ¡ä»¶æ¸²æŸ“"><a href="#æ¡ä»¶æ¸²æŸ“" class="headerlink" title="æ¡ä»¶æ¸²æŸ“"></a>æ¡ä»¶æ¸²æŸ“</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; value=&quot;è·å–è¿œç¨‹æ•°æ®&quot; @click=&quot;sendReq()&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;title&quot;&gt;å­¦ç”Ÿåˆ—è¡¨&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;thead&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;row bold&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;col&quot;&gt;ç¼–å·&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;col&quot;&gt;å§“å&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;col&quot;&gt;æ€§åˆ«&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;col&quot;&gt;å¹´é¾„&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;tbody&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;row&quot; v-if=&quot;students.length &gt; 0&quot;&gt;æ˜¾ç¤ºå­¦ç”Ÿæ•°æ®&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;row&quot; v-else&gt;æš‚æ— å­¦ç”Ÿæ•°æ®&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &apos;../util/myaxios&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    data: function() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            students: []</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods : &#123;</span><br><span class="line">        async sendReq() &#123;</span><br><span class="line">            const resp = await axios.get(&quot;/api/students&quot;);</span><br><span class="line">            console.log(resp.data.data)</span><br><span class="line">            this.students = resp.data.data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    div &#123;</span><br><span class="line">        font-family: åæ–‡è¡Œæ¥·;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .title &#123;</span><br><span class="line">        margin-bottom: 10px;</span><br><span class="line">        font-size: 30px;</span><br><span class="line">        color: #333;</span><br><span class="line">        text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .row &#123;</span><br><span class="line">        background-color: #fff;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .col &#123;</span><br><span class="line">        border: 1px solid #f0f0f0;</span><br><span class="line">        width: 15%;</span><br><span class="line">        height: 35px;</span><br><span class="line">        text-align: center;</span><br><span class="line">        line-height: 35px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .bold .col &#123;</span><br><span class="line">        background-color: #f1f1f1;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="åˆ—è¡¨æ¸²æŸ“"><a href="#åˆ—è¡¨æ¸²æŸ“" class="headerlink" title="åˆ—è¡¨æ¸²æŸ“"></a>åˆ—è¡¨æ¸²æŸ“</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;!-- &lt;input type=&quot;button&quot; value=&quot;è·å–è¿œç¨‹æ•°æ®&quot; @click=&quot;sendReq()&quot;&gt; --&gt;</span><br><span class="line">        &lt;div class=&quot;title&quot;&gt;å­¦ç”Ÿåˆ—è¡¨&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;thead&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;row bold&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;col&quot;&gt;ç¼–å·&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;col&quot;&gt;å§“å&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;col&quot;&gt;æ€§åˆ«&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;col&quot;&gt;å¹´é¾„&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;tbody&quot;&gt;</span><br><span class="line">            &lt;div v-if=&quot;students.length &gt; 0&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;row&quot; v-for=&quot;s of students&quot; :key=&quot;s.id&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;col&quot;&gt;&#123;&#123;s.id&#125;&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;col&quot;&gt;&#123;&#123;s.name&#125;&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;col&quot;&gt;&#123;&#123;s.sex&#125;&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;col&quot;&gt;&#123;&#123;s.age&#125;&#125;&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;row&quot; v-else&gt;æš‚æ— å­¦ç”Ÿæ•°æ®&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &apos;../util/myaxios&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    mounted: function()&#123;</span><br><span class="line">        this.sendReq()</span><br><span class="line">    &#125;,</span><br><span class="line">    data: function() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            students: []</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods : &#123;</span><br><span class="line">        async sendReq() &#123;</span><br><span class="line">            const resp = await axios.get(&quot;/api/students&quot;);</span><br><span class="line">            console.log(resp.data.data)</span><br><span class="line">            this.students = resp.data.data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    div &#123;</span><br><span class="line">        font-family: åæ–‡è¡Œæ¥·;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .title &#123;</span><br><span class="line">        margin-bottom: 10px;</span><br><span class="line">        font-size: 30px;</span><br><span class="line">        color: #333;</span><br><span class="line">        text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .row &#123;</span><br><span class="line">        background-color: #fff;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .col &#123;</span><br><span class="line">        border: 1px solid #f0f0f0;</span><br><span class="line">        width: 15%;</span><br><span class="line">        height: 35px;</span><br><span class="line">        text-align: center;</span><br><span class="line">        line-height: 35px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .bold .col &#123;</span><br><span class="line">        background-color: #f1f1f1;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ul><li>v-if å’Œ v-for ä¸èƒ½ç”¨äºåŒä¸€ä¸ªæ ‡ç­¾</li><li>v-for éœ€è¦é…åˆç‰¹æ®Šçš„æ ‡ç­¾å±æ€§ key ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ä¸” key å±æ€§è¦ç»‘å®šåˆ°ä¸€ä¸ªèƒ½èµ·åˆ°å”¯ä¸€æ ‡è¯†ä½œç”¨çš„æ•°æ®ä¸Šï¼Œæœ¬ä¾‹ç»‘å®šåˆ°äº†å­¦ç”Ÿç¼–å·ä¸Š</li><li>options çš„ mounted å±æ€§å¯¹åº”ä¸€ä¸ªå‡½æ•°ï¼Œæ­¤å‡½æ•°ä¼šåœ¨ç»„ä»¶æŒ‚è½½åï¼ˆå‡†å¤‡å°±ç»ªï¼‰è¢«è°ƒç”¨ï¼Œå¯ä»¥åœ¨å®ƒå†…éƒ¨å‘èµ·è¯·æ±‚ï¼Œå»è·å–å­¦ç”Ÿæ•°æ®</li></ul><h4 id="é‡ç”¨ç»„ä»¶"><a href="#é‡ç”¨ç»„ä»¶" class="headerlink" title="é‡ç”¨ç»„ä»¶"></a>é‡ç”¨ç»„ä»¶</h4><p>æŒ‰é’®ç»„ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;button&quot; :class=&quot;[type,size]&quot;&gt;</span><br><span class="line">        a&lt;slot&gt;&lt;/slot&gt;b</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const options = &#123;</span><br><span class="line">    props: [&quot;type&quot;, &quot;size&quot;]</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„ï¼Œçœç•¥äº†æ ·å¼éƒ¨åˆ†</li></ul><p>ä½¿ç”¨ç»„ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;çˆ¶ç»„ä»¶&lt;/h1&gt;</span><br><span class="line">        &lt;my-button type=&quot;primary&quot; size=&quot;small&quot;&gt;1&lt;/my-button&gt;</span><br><span class="line">        &lt;my-button type=&quot;danger&quot; size=&quot;middle&quot;&gt;2&lt;/my-button&gt;</span><br><span class="line">        &lt;my-button type=&quot;success&quot; size=&quot;large&quot;&gt;3&lt;/my-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import MyButton from &apos;../components/MyButton.vue&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    components: &#123;</span><br><span class="line">        MyButton</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="2-Vue-è¿›é˜¶"><a href="#2-Vue-è¿›é˜¶" class="headerlink" title="2. Vue è¿›é˜¶"></a>2. Vue è¿›é˜¶</h2><h3 id="1-ElementUI"><a href="#1-ElementUI" class="headerlink" title="1) ElementUI"></a>1) ElementUI</h3><p>å®‰è£…</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install element-ui -S</span><br></pre></td></tr></table></figure><p>å¼•å…¥ç»„ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Element <span class="keyword">from</span> <span class="string">'element-ui'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'element-ui/lib/theme-chalk/index.css'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Element)</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼Œåœ¨è‡ªå·±çš„ç»„ä»¶ä¸­ä½¿ç”¨ ElementUI çš„ç»„ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button&gt;æŒ‰é’®&lt;/el-button&gt;</span><br></pre></td></tr></table></figure><h4 id="è¡¨æ ¼ç»„ä»¶"><a href="#è¡¨æ ¼ç»„ä»¶" class="headerlink" title="è¡¨æ ¼ç»„ä»¶"></a>è¡¨æ ¼ç»„ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;el-table :data=&quot;students&quot;&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;ç¼–å·&quot; prop=&quot;id&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;å§“å&quot; prop=&quot;name&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;æ€§åˆ«&quot; prop=&quot;sex&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;å¹´é¾„&quot; prop=&quot;age&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &apos;../util/myaxios&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    async mounted() &#123;</span><br><span class="line">        const resp = await axios.get(&apos;/api/students&apos;);</span><br><span class="line">        this.students = resp.data.data</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            students: []</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="åˆ†é¡µç»„ä»¶"><a href="#åˆ†é¡µç»„ä»¶" class="headerlink" title="åˆ†é¡µç»„ä»¶"></a>åˆ†é¡µç»„ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;el-table v-bind:data=&quot;students&quot;&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;ç¼–å·&quot; prop=&quot;id&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;å§“å&quot; prop=&quot;name&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;æ€§åˆ«&quot; prop=&quot;sex&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;å¹´é¾„&quot; prop=&quot;age&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">        &lt;el-pagination </span><br><span class="line">            :total=&quot;total&quot;</span><br><span class="line">            :page-size=&quot;queryDto.size&quot;</span><br><span class="line">            :current-page=&quot;queryDto.page&quot;</span><br><span class="line">            layout=&quot;prev,pager,next,sizes,-&gt;,total&quot;</span><br><span class="line">            :page-sizes=&quot;[5,10,15,20]&quot;</span><br><span class="line">            @current-change=&quot;currentChange&quot;</span><br><span class="line">            @size-change=&quot;sizeChange&quot;</span><br><span class="line">        &gt;&lt;/el-pagination&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &apos;../util/myaxios&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    mounted() &#123;</span><br><span class="line">        this.query();</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        currentChange(page) &#123;</span><br><span class="line">            this.queryDto.page = page;</span><br><span class="line">            this.query();</span><br><span class="line">        &#125;,</span><br><span class="line">        sizeChange(size)&#123;</span><br><span class="line">            this.queryDto.size = size;</span><br><span class="line">            this.query();</span><br><span class="line">        &#125;,</span><br><span class="line">        async query() &#123;</span><br><span class="line">            const resp = await axios.get(&apos;/api/students/q&apos;, &#123;</span><br><span class="line">                params: this.queryDto</span><br><span class="line">            &#125;);</span><br><span class="line">            this.students = resp.data.data.list;</span><br><span class="line">            this.total = resp.data.data.total;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            students: [],</span><br><span class="line">            total: 0,</span><br><span class="line">            queryDto: &#123;</span><br><span class="line">                page: 1,</span><br><span class="line">                size: 5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>ä¸‰ç§æƒ…å†µéƒ½åº”è¯¥è§¦å‘æŸ¥è¯¢<ul><li>mounted ç»„ä»¶æŒ‚è½½å®Œæˆå</li><li>é¡µå·å˜åŒ–æ—¶</li><li>é¡µå¤§å°å˜åŒ–æ—¶</li></ul></li><li>æŸ¥è¯¢ä¼ å‚åº”è¯¥æ ¹æ®åå°éœ€æ±‚ï¼Œçµæ´»é‡‡ç”¨ä¸åŒæ–¹å¼<ul><li>æœ¬ä¾‹ä¸­å› ä¸ºæ˜¯ get è¯·æ±‚ï¼Œæ— æ³•é‡‡ç”¨è¯·æ±‚ä½“ï¼Œåªèƒ½ç”¨ params æ–¹å¼ä¼ å‚</li></ul></li><li>è¿”å›å“åº”çš„æ ¼å¼ä¹Ÿè®¸ä¼šå¾ˆå¤æ‚ï¼Œéœ€è¦æŒæ¡ã€æ ¹æ®è¿”å›çš„å“åº”ç»“æ„ï¼Œè·å–æ•°æ®ã€‘çš„èƒ½åŠ›</li></ul><h4 id="åˆ†é¡µæœç´¢"><a href="#åˆ†é¡µæœç´¢" class="headerlink" title="åˆ†é¡µæœç´¢"></a>åˆ†é¡µæœç´¢</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;el-input placeholder=&quot;è¯·è¾“å…¥å§“å&quot; size=&quot;mini&quot; v-model=&quot;queryDto.name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;el-select placeholder=&quot;è¯·é€‰æ‹©æ€§åˆ«&quot; size=&quot;mini&quot; v-model=&quot;queryDto.sex&quot; clearable&gt;</span><br><span class="line">            &lt;el-option value=&quot;ç”·&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">            &lt;el-option value=&quot;å¥³&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">        &lt;el-select placeholder=&quot;è¯·é€‰æ‹©å¹´é¾„&quot; size=&quot;mini&quot; v-model=&quot;queryDto.age&quot; clearable&gt;</span><br><span class="line">            &lt;el-option value=&quot;0,20&quot; label=&quot;0åˆ°20å²&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">            &lt;el-option value=&quot;21,30&quot; label=&quot;21åˆ°30å²&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">            &lt;el-option value=&quot;31,40&quot; label=&quot;31åˆ°40å²&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">            &lt;el-option value=&quot;41,120&quot; label=&quot;41åˆ°120å²&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;search()&quot;&gt;æœç´¢&lt;/el-button&gt;</span><br><span class="line">        &lt;el-divider&gt;&lt;/el-divider&gt;</span><br><span class="line">        &lt;el-table v-bind:data=&quot;students&quot;&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;ç¼–å·&quot; prop=&quot;id&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;å§“å&quot; prop=&quot;name&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;æ€§åˆ«&quot; prop=&quot;sex&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;å¹´é¾„&quot; prop=&quot;age&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">        &lt;el-pagination :total=&quot;total&quot; :page-size=&quot;queryDto.size&quot; :current-page=&quot;queryDto.page&quot;</span><br><span class="line">            layout=&quot;prev,pager,next,sizes,-&gt;,total&quot; :page-sizes=&quot;[5, 10, 15, 20]&quot; @current-change=&quot;currentChange&quot;</span><br><span class="line">            @size-change=&quot;sizeChange&quot;&gt;&lt;/el-pagination&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &apos;../util/myaxios&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    mounted() &#123;</span><br><span class="line">        this.query();</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        currentChange(page) &#123;</span><br><span class="line">            this.queryDto.page = page;</span><br><span class="line">            this.query();</span><br><span class="line">        &#125;,</span><br><span class="line">        sizeChange(size) &#123;</span><br><span class="line">            this.queryDto.size = size;</span><br><span class="line">            this.query();</span><br><span class="line">        &#125;,</span><br><span class="line">        async query() &#123;</span><br><span class="line">            const resp = await axios.get(&apos;/api/students/q&apos;, &#123;</span><br><span class="line">                params: this.queryDto</span><br><span class="line">            &#125;);</span><br><span class="line">            this.students = resp.data.data.list;</span><br><span class="line">            this.total = resp.data.data.total;</span><br><span class="line">        &#125;,</span><br><span class="line">        search() &#123;</span><br><span class="line">            this.query();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            students: [],</span><br><span class="line">            total: 0,</span><br><span class="line">            queryDto: &#123;</span><br><span class="line">                name: &apos;&apos;,</span><br><span class="line">                sex: &apos;&apos;,</span><br><span class="line">                age: &apos;&apos;,  </span><br><span class="line">                page: 1,</span><br><span class="line">                size: 5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>sex ä¸  age å‡ç”¨ <code>&#39;&#39;</code> è¡¨ç¤ºç”¨æˆ·æ²¡æœ‰é€‰æ‹©çš„æƒ…å†µ</li><li>age å–å€¼ <code>0,20</code> ä¼šè¢« spring è½¬æ¢ä¸º <code>new int[]{0, 20}</code></li><li>age å–å€¼ <code>&#39;&#39;</code> ä¼šè¢« spring è½¬æ¢ä¸º <code>new int[0]</code></li></ul><h4 id="çº§è”é€‰æ‹©"><a href="#çº§è”é€‰æ‹©" class="headerlink" title="çº§è”é€‰æ‹©"></a>çº§è”é€‰æ‹©</h4><p>çº§è”é€‰æ‹©å™¨ä¸­é€‰é¡¹çš„æ•°æ®ç»“æ„ä¸º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;<span class="attr">value</span>:<span class="number">100</span>, <span class="attr">label</span>:<span class="string">'ä¸»é¡µ'</span>,<span class="attr">children</span>:[</span><br><span class="line">        &#123;<span class="attr">value</span>:<span class="number">101</span>, <span class="attr">label</span>:<span class="string">'èœå•1'</span>, <span class="attr">children</span>:[</span><br><span class="line">            &#123;<span class="attr">value</span>:<span class="number">105</span>, <span class="attr">label</span>:<span class="string">'å­é¡¹1'</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">value</span>:<span class="number">106</span>, <span class="attr">label</span>:<span class="string">'å­é¡¹2'</span>&#125;</span><br><span class="line">        ]&#125;,</span><br><span class="line">        &#123;<span class="attr">value</span>:<span class="number">102</span>, <span class="attr">label</span>:<span class="string">'èœå•2'</span>, <span class="attr">children</span>:[</span><br><span class="line">            &#123;<span class="attr">value</span>:<span class="number">107</span>, <span class="attr">label</span>:<span class="string">'å­é¡¹3'</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">value</span>:<span class="number">108</span>, <span class="attr">label</span>:<span class="string">'å­é¡¹4'</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">value</span>:<span class="number">109</span>, <span class="attr">label</span>:<span class="string">'å­é¡¹5'</span>&#125;</span><br><span class="line">        ]&#125;,</span><br><span class="line">        &#123;<span class="attr">value</span>:<span class="number">103</span>, <span class="attr">label</span>:<span class="string">'èœå•3'</span>, <span class="attr">children</span>:[</span><br><span class="line">            &#123;<span class="attr">value</span>:<span class="number">110</span>, <span class="attr">label</span>:<span class="string">'å­é¡¹6'</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">value</span>:<span class="number">111</span>, <span class="attr">label</span>:<span class="string">'å­é¡¹7'</span>&#125;</span><br><span class="line">        ]&#125;,</span><br><span class="line">        &#123;<span class="attr">value</span>:<span class="number">104</span>, <span class="attr">label</span>:<span class="string">'èœå•4'</span>&#125;</span><br><span class="line">    ]&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„ä¾‹å­æ˜¯å°†åç«¯è¿”å›çš„ä¸€ç»´æ•°ç»„ã€æ ‘åŒ–ã€‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-cascader :options=&quot;ops&quot;&gt;&lt;/el-cascader&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &apos;../util/myaxios&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    async mounted() &#123;</span><br><span class="line">        const resp = await axios.get(&apos;/api/menu&apos;)</span><br><span class="line">        console.log(resp.data.data)</span><br><span class="line">        const array = resp.data.data;</span><br><span class="line"></span><br><span class="line">        const map = new Map(); </span><br><span class="line"></span><br><span class="line">        // 1. å°†æ‰€æœ‰æ•°æ®å­˜å…¥ map é›†åˆ(ä¸ºäº†æ¥ä¸‹æ¥æŸ¥æ‰¾æ•ˆç‡)</span><br><span class="line">        for(const &#123;id,name,pid&#125; of array) &#123;</span><br><span class="line">            map.set(id, &#123;value:id, label:name, pid:pid&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        // 2. å»ºç«‹çˆ¶å­å…³ç³»</span><br><span class="line">        // 3. æ‰¾åˆ°é¡¶å±‚å¯¹è±¡</span><br><span class="line">        const top = [];</span><br><span class="line">        for(const obj of map.values()) &#123;</span><br><span class="line">            const parent = map.get(obj.pid);</span><br><span class="line">            if(parent !== undefined) &#123;</span><br><span class="line">                parent.children ??= [];</span><br><span class="line">                parent.children.push(obj);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                top.push(obj)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        this.ops = top;</span><br><span class="line">    &#125;,</span><br><span class="line">    data()&#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            ops: []</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="2-Vue-Router"><a href="#2-Vue-Router" class="headerlink" title="2) Vue-Router"></a>2) Vue-Router</h3><p>vue å±äºå•é¡µé¢åº”ç”¨ï¼Œæ‰€è°“çš„è·¯ç”±ï¼Œå°±æ˜¯æ ¹æ®æµè§ˆå™¨è·¯å¾„ä¸åŒï¼Œç”¨ä¸åŒçš„<strong>è§†å›¾ç»„ä»¶</strong>æ›¿æ¢è¿™ä¸ªé¡µé¢å†…å®¹å±•ç¤º</p><h4 id="é…ç½®è·¯ç”±"><a href="#é…ç½®è·¯ç”±" class="headerlink" title="é…ç½®è·¯ç”±"></a>é…ç½®è·¯ç”±</h4><p>æ–°å»ºä¸€ä¸ªè·¯ç”± js æ–‡ä»¶ï¼Œä¾‹å¦‚ src/router/example14.jsï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> ContainerView <span class="keyword">from</span> <span class="string">'@/views/example14/ContainerView.vue'</span></span><br><span class="line"><span class="keyword">import</span> LoginView <span class="keyword">from</span> <span class="string">'@/views/example14/LoginView.vue'</span></span><br><span class="line"><span class="keyword">import</span> NotFoundView <span class="keyword">from</span> <span class="string">'@/views/example14/NotFoundView.vue'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path:<span class="string">'/'</span>,</span><br><span class="line">    component: ContainerView</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path:<span class="string">'/login'</span>,</span><br><span class="line">    component: LoginView</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path:<span class="string">'/404'</span>,</span><br><span class="line">    component: NotFoundView</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><ul><li>æœ€é‡è¦çš„å°±æ˜¯å»ºç«‹äº†ã€è·¯å¾„ã€‘ä¸ã€è§†å›¾ç»„ä»¶ã€‘ä¹‹é—´çš„æ˜ å°„å…³ç³»</li><li>æœ¬ä¾‹ä¸­æ˜ å°„äº† 3 ä¸ªè·¯å¾„ä¸å¯¹åº”çš„è§†å›¾ç»„ä»¶</li></ul><p>åœ¨ main.js ä¸­é‡‡ç”¨æˆ‘ä»¬çš„è·¯ç”± js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> e14 <span class="keyword">from</span> <span class="string">'./views/Example14View.vue'</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router/example14'</span>  <span class="comment">// ä¿®æ”¹è¿™é‡Œ</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"><span class="keyword">import</span> Element <span class="keyword">from</span> <span class="string">'element-ui'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'element-ui/lib/theme-chalk/index.css'</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Vue.use(Element)</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(e14)</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure><p>æ ¹ç»„ä»¶æ˜¯ Example14View.vueï¼Œå†…å®¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;all&quot;&gt;</span><br><span class="line">        &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ul><li>æ ·å¼ç•¥</li><li>å…¶ä¸­ <code>&lt;router-view&gt;</code> èµ·åˆ°å ä½ä½œç”¨ï¼Œæ”¹å˜è·¯å¾„åï¼Œè¿™ä¸ªè·¯å¾„å¯¹åº”çš„è§†å›¾ç»„ä»¶å°±ä¼šå æ® <code>&lt;router-view&gt;</code> çš„ä½ç½®ï¼Œæ›¿æ¢æ‰å®ƒä¹‹å‰çš„å†…å®¹</li></ul><h4 id="åŠ¨æ€å¯¼å…¥"><a href="#åŠ¨æ€å¯¼å…¥" class="headerlink" title="åŠ¨æ€å¯¼å…¥"></a>åŠ¨æ€å¯¼å…¥</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path:<span class="string">'/'</span>,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/example14/ContainerView.vue'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path:<span class="string">'/login'</span>,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/example14/LoginView.vue'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path:<span class="string">'/404'</span>,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/example14/NotFoundView.vue'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><ul><li>é™æ€å¯¼å…¥æ˜¯å°†æ‰€æœ‰ç»„ä»¶çš„ js ä»£ç æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå¦‚æœç»„ä»¶éå¸¸å¤šï¼Œæ‰“åŒ…åçš„ js æ–‡ä»¶ä¼šå¾ˆå¤§ï¼Œå½±å“é¡µé¢åŠ è½½é€Ÿåº¦</li><li>åŠ¨æ€å¯¼å…¥æ˜¯å°†ç»„ä»¶çš„ js ä»£ç æ”¾å…¥ç‹¬ç«‹çš„æ–‡ä»¶ï¼Œç”¨åˆ°æ—¶æ‰åŠ è½½</li></ul><h4 id="åµŒå¥—è·¯ç”±"><a href="#åµŒå¥—è·¯ç”±" class="headerlink" title="åµŒå¥—è·¯ç”±"></a>åµŒå¥—è·¯ç”±</h4><p>ç»„ä»¶å†…å†è¦åˆ‡æ¢å†…å®¹ï¼Œå°±éœ€è¦ç”¨åˆ°åµŒå¥—è·¯ç”±ï¼ˆå­è·¯ç”±ï¼‰ï¼Œä¸‹é¢çš„ä¾‹å­æ˜¯åœ¨ã€ContainerView ç»„ä»¶ã€‘å†…å®šä¹‰äº† 3 ä¸ªå­è·¯ç”±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path:<span class="string">'/'</span>,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/example14/ContainerView.vue'</span>),</span><br><span class="line">    redirect: <span class="string">'/c/p1'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123; </span><br><span class="line">        path:<span class="string">'c/p1'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/example14/container/P1View.vue'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; </span><br><span class="line">        path:<span class="string">'c/p2'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/example14/container/P2View.vue'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; </span><br><span class="line">        path:<span class="string">'c/p3'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/example14/container/P3View.vue'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path:<span class="string">'/login'</span>,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/example14/LoginView.vue'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path:<span class="string">'/404'</span>,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/example14/NotFoundView.vue'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path:<span class="string">'*'</span>,</span><br><span class="line">    redirect: <span class="string">'/404'</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å­è·¯ç”±å˜åŒ–ï¼Œåˆ‡æ¢çš„æ˜¯ã€ContainerView ç»„ä»¶ã€‘ä¸­ <code>&lt;router-view&gt;&lt;/router-view&gt;</code> éƒ¨åˆ†çš„å†…å®¹</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ul><li>redirect å¯ä»¥ç”¨æ¥é‡å®šå‘ï¼ˆè·³è½¬ï¼‰åˆ°ä¸€ä¸ªæ–°çš„åœ°å€</li><li>path çš„å–å€¼ä¸º * è¡¨ç¤ºåŒ¹é…ä¸åˆ°å…¶å®ƒ path æ—¶ï¼Œå°±ä¼šåŒ¹é…å®ƒ</li></ul><h4 id="ElementUI-å¸ƒå±€"><a href="#ElementUI-å¸ƒå±€" class="headerlink" title="ElementUI å¸ƒå±€"></a>ElementUI å¸ƒå±€</h4><p>é€šå¸¸ä¸»é¡µè¦åšå¸ƒå±€ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ ElementUI æä¾›çš„ã€ä¸Š-ã€å·¦-å³ã€‘ã€‘å¸ƒå±€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;el-container&gt;</span><br><span class="line">            &lt;el-header&gt;&lt;/el-header&gt;</span><br><span class="line">            &lt;el-container&gt;</span><br><span class="line">                &lt;el-aside width=&quot;200px&quot;&gt;&lt;/el-aside&gt;</span><br><span class="line">                &lt;el-main&gt;</span><br><span class="line">                    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">                &lt;/el-main&gt;</span><br><span class="line">            &lt;/el-container&gt;</span><br><span class="line">        &lt;/el-container&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="è·¯ç”±è·³è½¬"><a href="#è·¯ç”±è·³è½¬" class="headerlink" title="è·¯ç”±è·³è½¬"></a>è·¯ç”±è·³è½¬</h4><h5 id="æ ‡ç­¾å¼"><a href="#æ ‡ç­¾å¼" class="headerlink" title="æ ‡ç­¾å¼"></a>æ ‡ç­¾å¼</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">    &lt;router-link to=&quot;/c1/p1&quot;&gt;P1&lt;/router-link&gt;</span><br><span class="line">    &lt;router-link to=&quot;/c1/p2&quot;&gt;P2&lt;/router-link&gt;</span><br><span class="line">    &lt;router-link to=&quot;/c1/p3&quot;&gt;P3&lt;/router-link&gt;</span><br><span class="line">&lt;/el-aside&gt;</span><br></pre></td></tr></table></figure><h5 id="ç¼–ç¨‹å¼"><a href="#ç¼–ç¨‹å¼" class="headerlink" title="ç¼–ç¨‹å¼"></a>ç¼–ç¨‹å¼</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-header&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-edit&quot; </span><br><span class="line">               circle size=&quot;mini&quot; @click=&quot;jump(&apos;/c1/p1&apos;)&quot;&gt;&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;success&quot; icon=&quot;el-icon-check&quot; </span><br><span class="line">               circle size=&quot;mini&quot; @click=&quot;jump(&apos;/c1/p2&apos;)&quot;&gt;&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;warning&quot; icon=&quot;el-icon-star-off&quot; </span><br><span class="line">               circle size=&quot;mini&quot; @click=&quot;jump(&apos;/c1/p3&apos;)&quot;&gt;&lt;/el-button&gt;</span><br><span class="line">&lt;/el-header&gt;</span><br></pre></td></tr></table></figure><p>jump æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">const options = &#123;</span><br><span class="line">    methods : &#123;</span><br><span class="line">        jump(url) &#123;</span><br><span class="line">            this.$router.push(url);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>å…¶ä¸­ this.$router æ˜¯æ‹¿åˆ°è·¯ç”±å¯¹è±¡</li><li>push æ–¹æ³•æ ¹æ® url è¿›è¡Œè·³è½¬</li></ul><h5 id="å¯¼èˆªèœå•"><a href="#å¯¼èˆªèœå•" class="headerlink" title="å¯¼èˆªèœå•"></a>å¯¼èˆªèœå•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-menu router background-color=&quot;#545c64&quot; text-color=&quot;#fff&quot; active-text-color=&quot;#ffd04b&quot;&gt;</span><br><span class="line">    &lt;el-submenu index=&quot;/c1&quot;&gt;</span><br><span class="line">        &lt;span slot=&quot;title&quot;&gt;</span><br><span class="line">            &lt;i class=&quot;el-icon-platform-eleme&quot;&gt;&lt;/i&gt;</span><br><span class="line">            èœå•1</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;el-menu-item index=&quot;/c1/p1&quot;&gt;å­é¡¹1&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;el-menu-item index=&quot;/c1/p2&quot;&gt;å­é¡¹2&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;el-menu-item index=&quot;/c1/p3&quot;&gt;å­é¡¹3&lt;/el-menu-item&gt;</span><br><span class="line">    &lt;/el-submenu&gt;</span><br><span class="line">    &lt;el-menu-item index=&quot;/c2&quot;&gt;</span><br><span class="line">        &lt;span slot=&quot;title&quot;&gt;</span><br><span class="line">            &lt;i class=&quot;el-icon-phone&quot;&gt;&lt;/i&gt;</span><br><span class="line">            èœå•2</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">    &lt;/el-menu-item&gt;</span><br><span class="line">    &lt;el-menu-item index=&quot;/c3&quot;&gt;</span><br><span class="line">        &lt;span slot=&quot;title&quot;&gt;</span><br><span class="line">            &lt;i class=&quot;el-icon-star-on&quot;&gt;&lt;/i&gt;</span><br><span class="line">            èœå•3</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">    &lt;/el-menu-item&gt;</span><br><span class="line">&lt;/el-menu&gt;</span><br></pre></td></tr></table></figure><ul><li>å›¾æ ‡å’Œèœå•é¡¹æ–‡å­—å»ºè®®ç”¨ <code>&lt;span slot=&#39;title&#39;&gt;&lt;/span&gt;</code> åŒ…è£¹èµ·æ¥</li><li><code>el-menu</code> æ ‡ç­¾ä¸ŠåŠ ä¸Š <code>router</code> å±æ€§ï¼Œè¡¨ç¤ºç»“åˆå¯¼èˆªèœå•ä¸è·¯ç”±å¯¹è±¡ï¼Œæ­¤æ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨èœå•é¡¹çš„ <code>index</code> å±æ€§æ¥è·¯ç”±è·³è½¬</li></ul><h4 id="åŠ¨æ€è·¯ç”±ä¸èœå•"><a href="#åŠ¨æ€è·¯ç”±ä¸èœå•" class="headerlink" title="åŠ¨æ€è·¯ç”±ä¸èœå•"></a>åŠ¨æ€è·¯ç”±ä¸èœå•</h4><p>å°†èœå•ã€è·¯ç”±ä¿¡æ¯ï¼ˆä»…ä¸»é¡µçš„ï¼‰å­˜å…¥æ•°æ®åº“ä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> menu(<span class="keyword">id</span>, <span class="keyword">name</span>, pid, <span class="keyword">path</span>, component, icon) <span class="keyword">values</span></span><br><span class="line">    (<span class="number">101</span>, <span class="string">'èœå•1'</span>, <span class="number">0</span>,   <span class="string">'/m1'</span>,    <span class="literal">null</span>,         <span class="string">'el-icon-platform-eleme'</span>),</span><br><span class="line">    (<span class="number">102</span>, <span class="string">'èœå•2'</span>, <span class="number">0</span>,   <span class="string">'/m2'</span>,    <span class="literal">null</span>,         <span class="string">'el-icon-delete-solid'</span>),</span><br><span class="line">    (<span class="number">103</span>, <span class="string">'èœå•3'</span>, <span class="number">0</span>,   <span class="string">'/m3'</span>,    <span class="literal">null</span>,         <span class="string">'el-icon-s-tools'</span>),</span><br><span class="line">    (<span class="number">104</span>, <span class="string">'èœå•4'</span>, <span class="number">0</span>,   <span class="string">'/m4'</span>,    <span class="string">'M4View.vue'</span>, <span class="string">'el-icon-user-solid'</span>),</span><br><span class="line">    (<span class="number">105</span>, <span class="string">'å­é¡¹1'</span>, <span class="number">101</span>, <span class="string">'/m1/c1'</span>, <span class="string">'C1View.vue'</span>, <span class="string">'el-icon-s-goods'</span>),</span><br><span class="line">    (<span class="number">106</span>, <span class="string">'å­é¡¹2'</span>, <span class="number">101</span>, <span class="string">'/m1/c2'</span>, <span class="string">'C2View.vue'</span>, <span class="string">'el-icon-menu'</span>),</span><br><span class="line">    (<span class="number">107</span>, <span class="string">'å­é¡¹3'</span>, <span class="number">102</span>, <span class="string">'/m2/c3'</span>, <span class="string">'C3View.vue'</span>, <span class="string">'el-icon-s-marketing'</span>),</span><br><span class="line">    (<span class="number">108</span>, <span class="string">'å­é¡¹4'</span>, <span class="number">102</span>, <span class="string">'/m2/c4'</span>, <span class="string">'C4View.vue'</span>, <span class="string">'el-icon-s-platform'</span>),</span><br><span class="line">    (<span class="number">109</span>, <span class="string">'å­é¡¹5'</span>, <span class="number">102</span>, <span class="string">'/m2/c5'</span>, <span class="string">'C5View.vue'</span>, <span class="string">'el-icon-picture'</span>),</span><br><span class="line">    (<span class="number">110</span>, <span class="string">'å­é¡¹6'</span>, <span class="number">103</span>, <span class="string">'/m3/c6'</span>, <span class="string">'C6View.vue'</span>, <span class="string">'el-icon-upload'</span>),</span><br><span class="line">    (<span class="number">111</span>, <span class="string">'å­é¡¹7'</span>, <span class="number">103</span>, <span class="string">'/m3/c7'</span>, <span class="string">'C7View.vue'</span>, <span class="string">'el-icon-s-promotion'</span>);</span><br></pre></td></tr></table></figure><p>ä¸åŒçš„ç”¨æˆ·æŸ¥è¯¢çš„çš„èœå•ã€è·¯ç”±ä¿¡æ¯æ˜¯ä¸ä¸€æ ·çš„</p><p>ä¾‹å¦‚ï¼šè®¿é—® <code>/api/menu/admin</code> è¿”å›æ‰€æœ‰çš„æ•°æ®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">102</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"èœå•2"</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="string">"el-icon-delete-solid"</span>,</span><br><span class="line">        <span class="attr">"path"</span>: <span class="string">"/m2"</span>,</span><br><span class="line">        <span class="attr">"pid"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"component"</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">107</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"å­é¡¹3"</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="string">"el-icon-s-marketing"</span>,</span><br><span class="line">        <span class="attr">"path"</span>: <span class="string">"/m2/c3"</span>,</span><br><span class="line">        <span class="attr">"pid"</span>: <span class="number">102</span>,</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"C3View.vue"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">108</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"å­é¡¹4"</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="string">"el-icon-s-platform"</span>,</span><br><span class="line">        <span class="attr">"path"</span>: <span class="string">"/m2/c4"</span>,</span><br><span class="line">        <span class="attr">"pid"</span>: <span class="number">102</span>,</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"C4View.vue"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">109</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"å­é¡¹5"</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="string">"el-icon-picture"</span>,</span><br><span class="line">        <span class="attr">"path"</span>: <span class="string">"/m2/c5"</span>,</span><br><span class="line">        <span class="attr">"pid"</span>: <span class="number">102</span>,</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"C5View.vue"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>è®¿é—® <code>/api/menu/wang</code> è¿”å›</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">103</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"èœå•3"</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="string">"el-icon-s-tools"</span>,</span><br><span class="line">        <span class="attr">"path"</span>: <span class="string">"/m3"</span>,</span><br><span class="line">        <span class="attr">"pid"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"component"</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">110</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"å­é¡¹6"</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="string">"el-icon-upload"</span>,</span><br><span class="line">        <span class="attr">"path"</span>: <span class="string">"/m3/c6"</span>,</span><br><span class="line">        <span class="attr">"pid"</span>: <span class="number">103</span>,</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"C6View.vue"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">111</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"å­é¡¹7"</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="string">"el-icon-s-promotion"</span>,</span><br><span class="line">        <span class="attr">"path"</span>: <span class="string">"/m3/c7"</span>,</span><br><span class="line">        <span class="attr">"pid"</span>: <span class="number">103</span>,</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"C7View.vue"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å‰ç«¯æ ¹æ®ä»–ä»¬èº«ä»½ä¸åŒï¼ŒåŠ¨æ€æ·»åŠ è·¯ç”±å’Œæ˜¾ç¤ºèœå•</p><h5 id="åŠ¨æ€è·¯ç”±"><a href="#åŠ¨æ€è·¯ç”±" class="headerlink" title="åŠ¨æ€è·¯ç”±"></a>åŠ¨æ€è·¯ç”±</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addServerRoutes</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> &#123; id, path, component &#125; <span class="keyword">of</span> array) &#123;</span><br><span class="line">    <span class="keyword">if</span> (component !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// åŠ¨æ€æ·»åŠ è·¯ç”±</span></span><br><span class="line">      <span class="comment">// å‚æ•°1ï¼šçˆ¶è·¯ç”±åç§°</span></span><br><span class="line">      <span class="comment">// å‚æ•°2ï¼šè·¯ç”±ä¿¡æ¯å¯¹è±¡</span></span><br><span class="line">      router.addRoute(<span class="string">'c'</span>, &#123;</span><br><span class="line">        path: path,</span><br><span class="line">        name: id,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">`@/views/example15/container/<span class="subst">$&#123;component&#125;</span>`</span>)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>js è¿™è¾¹åªä¿ç•™å‡ ä¸ªå›ºå®šè·¯ç”±ï¼Œå¦‚ä¸»é¡µã€404 å’Œ login</li><li>ä»¥ä¸Šæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œå°†æœåŠ¡å™¨è¿”å›çš„è·¯ç”±ä¿¡æ¯åŠ å…¥åˆ°åä¸º c çš„çˆ¶è·¯ç”±ä¸­å»</li><li>è¿™é‡Œè¦æ³¨æ„ç»„ä»¶è·¯å¾„ï¼Œå‰é¢ @/views æ˜¯å¿…é¡»åœ¨ js è¿™è¾¹å®Œæˆæ‹¼æ¥çš„ï¼Œå¦åˆ™ import å‡½æ•°ä¼šå¤±æ•ˆ</li></ul><h5 id="é‡ç½®è·¯ç”±"><a href="#é‡ç½®è·¯ç”±" class="headerlink" title="é‡ç½®è·¯ç”±"></a>é‡ç½®è·¯ç”±</h5><p>åœ¨ç”¨æˆ·æ³¨é”€æ—¶åº”å½“é‡ç½®è·¯ç”±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">resetRouter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  router.matcher = <span class="keyword">new</span> VueRouter(&#123; routes &#125;).matcher</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é¡µé¢åˆ·æ–°"><a href="#é¡µé¢åˆ·æ–°" class="headerlink" title="é¡µé¢åˆ·æ–°"></a>é¡µé¢åˆ·æ–°</h5><p>é¡µé¢åˆ·æ–°åï¼Œä¼šå¯¼è‡´åŠ¨æ€æ·»åŠ çš„è·¯ç”±å¤±æ•ˆï¼Œè§£å†³æ–¹æ³•æ˜¯å°†è·¯ç”±æ•°æ®å­˜å…¥ sessionStorage</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &apos;@/util/myaxios&apos;</span><br><span class="line">import &#123;resetRouter, addServerRoutes&#125; from &apos;@/router/example15&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            username: &apos;admin&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        async login() &#123;       </span><br><span class="line">            resetRouter(); // é‡ç½®è·¯ç”±     </span><br><span class="line">            const resp = await axios.get(`/api/menu/$&#123;this.username&#125;`)</span><br><span class="line">            const array = resp.data.data;</span><br><span class="line">            // localStorage     å³ä½¿æµè§ˆå™¨å…³é—­ï¼Œå­˜å‚¨çš„æ•°æ®ä»åœ¨</span><br><span class="line">            // sessionStorage   ä»¥æ ‡ç­¾é¡µä¸ºå•ä½ï¼Œå…³é—­æ ‡ç­¾é¡µæ—¶ï¼Œæ•°æ®è¢«æ¸…é™¤</span><br><span class="line">            sessionStorage.setItem(&apos;serverRoutes&apos;, JSON.stringify(array))</span><br><span class="line">            addServerRoutes(array); // åŠ¨æ€æ·»åŠ è·¯ç”±</span><br><span class="line">            this.$router.push(&apos;/&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>é¡µé¢åˆ·æ–°ï¼Œé‡æ–°åˆ›å»ºè·¯ç”±å¯¹è±¡æ—¶ï¼Œä» sessionStorage é‡Œæ¢å¤è·¯ç”±æ•°æ®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä» sessionStorage ä¸­æ¢å¤è·¯ç”±æ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> serverRoutes = sessionStorage.getItem(<span class="string">'serverRoutes'</span>);</span><br><span class="line"><span class="keyword">if</span>(serverRoutes) &#123;</span><br><span class="line">  <span class="keyword">const</span> array = <span class="built_in">JSON</span>.parse(serverRoutes);</span><br><span class="line">  addServerRoutes(array) <span class="comment">// åŠ¨æ€æ·»åŠ è·¯ç”±</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åŠ¨æ€èœå•"><a href="#åŠ¨æ€èœå•" class="headerlink" title="åŠ¨æ€èœå•"></a>åŠ¨æ€èœå•</h5><p>ä»£ç éƒ¨åˆ†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">const options = &#123;</span><br><span class="line">    mounted() &#123;</span><br><span class="line">        const serverRoutes = sessionStorage.getItem(&apos;serverRoutes&apos;);</span><br><span class="line">        const array = JSON.parse(serverRoutes);</span><br><span class="line">        const map = new Map();</span><br><span class="line">        for(const obj of array) &#123;</span><br><span class="line">            map.set(obj.id, obj);</span><br><span class="line">        &#125;</span><br><span class="line">        const top = [];</span><br><span class="line">        for(const obj of array) &#123;</span><br><span class="line">            const parent = map.get(obj.pid);</span><br><span class="line">            if(parent) &#123;</span><br><span class="line">                parent.children ??= [];</span><br><span class="line">                parent.children.push(obj);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                top.push(obj);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        this.top = top;</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            top: []</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>èœå•éƒ¨åˆ†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-menu router background-color=&quot;#545c64&quot; text-color=&quot;#fff&quot; active-text-color=&quot;#ffd04b&quot; :unique-opened=&quot;true&quot;&gt;</span><br><span class="line">    &lt;template v-for=&quot;m1 of top&quot;&gt;</span><br><span class="line">&lt;el-submenu v-if=&quot;m1.children&quot; :key=&quot;m1.id&quot; :index=&quot;m1.path&quot;&gt;</span><br><span class="line">    &lt;span slot=&quot;title&quot;&gt;</span><br><span class="line">        &lt;i :class=&quot;m1.icon&quot;&gt;&lt;/i&gt; &#123;&#123;m1.name&#125;&#125;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">    &lt;el-menu-item v-for=&quot;m2 of m1.children&quot; :key=&quot;m2.id&quot; :index=&quot;m2.path&quot;&gt;</span><br><span class="line">        &lt;span slot=&quot;title&quot;&gt;</span><br><span class="line">            &lt;i :class=&quot;m2.icon&quot;&gt;&lt;/i&gt; &#123;&#123;m2.name&#125;&#125;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-submenu&gt;</span><br><span class="line">&lt;el-menu-item v-else :key=&quot;m1.id&quot; :index=&quot;m1.path&quot;&gt;</span><br><span class="line">    &lt;span slot=&quot;title&quot;&gt;</span><br><span class="line">        &lt;i :class=&quot;m1.icon&quot;&gt;&lt;/i&gt; &#123;&#123;m1.name&#125;&#125;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;/el-menu-item&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;/el-menu&gt;</span><br></pre></td></tr></table></figure><ul><li>æ²¡æœ‰è€ƒè™‘é€’å½’èœå•é—®é¢˜ï¼Œè®¤ä¸ºèœå•åªæœ‰ä¸¤çº§</li></ul><h3 id="3-Vuex"><a href="#3-Vuex" class="headerlink" title="3) Vuex"></a>3) Vuex</h3><h4 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h4><p>vuex å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®ï¼Œå¹¶ä¸”å…±äº«çš„æ•°æ®æ˜¯ã€å“åº”å¼ã€‘çš„ï¼Œå³æ•°æ®çš„å˜æ›´èƒ½åŠæ—¶æ¸²æŸ“åˆ°æ¨¡æ¿</p><ul><li>ä¸ä¹‹å¯¹æ¯” localStorage ä¸ sessionStorage ä¹Ÿèƒ½å…±äº«æ•°æ®ï¼Œä½†ç¼ºç‚¹æ˜¯æ•°æ®å¹¶éã€å“åº”å¼ã€‘</li></ul><p>é¦–å…ˆéœ€è¦å®šä¹‰ state ä¸ mutations ä»–ä»¬ä¸€ä¸ªç”¨æ¥è¯»å–å…±äº«æ•°æ®ï¼Œä¸€ä¸ªç”¨æ¥ä¿®æ”¹å…±äº«æ•°æ®</p><p>src/store/index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  è¯»å–æ•°æ®ï¼Œèµ° state, getters</span></span><br><span class="line"><span class="comment">  ä¿®æ”¹æ•°æ®ï¼Œèµ° mutations, actions</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    name: <span class="string">''</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    updateName(state, name) &#123;</span><br><span class="line">      state.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å…±äº«æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;p&quot;&gt;</span><br><span class="line">        &lt;el-input placeholder=&quot;è¯·ä¿®æ”¹ç”¨æˆ·å§“å&quot; </span><br><span class="line">            size=&quot;mini&quot; v-model=&quot;name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;update()&quot;&gt;ä¿®æ”¹&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const options = &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        update()&#123;</span><br><span class="line">            this.$store.commit(&apos;updateName&apos;, this.name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            name:&apos;&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>mutations æ–¹æ³•ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡ <code>store.commit(mutationæ–¹æ³•å, å‚æ•°)</code> æ¥é—´æ¥è°ƒç”¨</li></ul><p>è¯»å–å…±äº«æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;el-container&gt;</span><br><span class="line">            &lt;el-header&gt;</span><br><span class="line">                &lt;div class=&quot;t&quot;&gt;</span><br><span class="line">                    æ¬¢è¿æ‚¨ï¼š&#123;&#123; $store.state.name &#125;&#125;, &#123;&#123; $store.state.age &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">            &lt;/el-header&gt;</span><br><span class="line">            &lt;el-container&gt;</span><br><span class="line">                &lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">                &lt;/el-aside&gt;</span><br><span class="line">                &lt;el-main&gt;</span><br><span class="line">                    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">                &lt;/el-main&gt;</span><br><span class="line">            &lt;/el-container&gt;</span><br><span class="line">        &lt;/el-container&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="mapState"><a href="#mapState" class="headerlink" title="mapState"></a>mapState</h4><p>æ¯æ¬¡å»å†™ <code>$store.state.name</code> è¿™æ ·çš„ä»£ç æ˜¾å¾—éå¸¸ç¹çï¼Œå¯ä»¥ç”¨ vuex å¸®æˆ‘ä»¬ç”Ÿæˆè®¡ç®—å±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;el-container&gt;</span><br><span class="line">            &lt;el-header&gt;</span><br><span class="line">                &lt;div class=&quot;t&quot;&gt;æ¬¢è¿æ‚¨ï¼š&#123;&#123; name &#125;&#125;, &#123;&#123; age &#125;&#125;&lt;/div&gt;</span><br><span class="line">            &lt;/el-header&gt;</span><br><span class="line">            &lt;el-container&gt;</span><br><span class="line">                &lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">                &lt;/el-aside&gt;</span><br><span class="line">                &lt;el-main&gt;</span><br><span class="line">                    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">                &lt;/el-main&gt;</span><br><span class="line">            &lt;/el-container&gt;</span><br><span class="line">        &lt;/el-container&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState &#125; from &apos;vuex&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    computed: &#123;</span><br><span class="line">        ...mapState([&apos;name&apos;, &apos;age&apos;])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>mapState è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å†…åŒ…å«äº† name() å’Œ age() çš„è¿™ä¸¤ä¸ªæ–¹æ³•ä½œä¸ºè®¡ç®—å±æ€§</li><li>æ­¤å¯¹è±¡é…åˆ <code>...</code> å±•å¼€è¿ç®—ç¬¦ï¼Œå¡«å……å…¥ computed å³å¯ä½¿ç”¨</li></ul><h4 id="mapMutations"><a href="#mapMutations" class="headerlink" title="mapMutations"></a>mapMutations</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;p&quot;&gt;</span><br><span class="line">        &lt;el-input placeholder=&quot;è¯·ä¿®æ”¹ç”¨æˆ·å§“å&quot; </span><br><span class="line">            size=&quot;mini&quot; v-model=&quot;name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;updateName(name)&quot;&gt;ä¿®æ”¹&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;mapMutations&#125; from &apos;vuex&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        ...mapMutations([&apos;updateName&apos;])</span><br><span class="line">    &#125;,</span><br><span class="line">    data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            name:&apos;&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>ç±»ä¼¼çš„ï¼Œè°ƒç”¨ mutation ä¿®æ”¹å…±äº«æ•°æ®ä¹Ÿå¯ä»¥ç®€åŒ–</li><li>mapMutations è¿”å›çš„å¯¹è±¡ä¸­åŒ…å«çš„æ–¹æ³•ï¼Œå°±ä¼šè°ƒç”¨ store.commit() æ¥æ‰§è¡Œ mutation æ–¹æ³•</li><li>æ³¨æ„å‚æ•°ä¼ é€’ç•¥æœ‰ä¸åŒ</li></ul><h4 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h4><p>mutations æ–¹æ³•å†…ä¸èƒ½åŒ…æ‹¬ä¿®æ”¹ä¸èƒ½ç«‹åˆ»ç”Ÿæ•ˆçš„ä»£ç ï¼Œå¦åˆ™ä¼šé€ æˆ Vuex è°ƒè¯•å·¥å…·å·¥ä½œä¸å‡†ç¡®ï¼Œå¿…é¡»æŠŠè¿™äº›ä»£ç å†™åœ¨ actions æ–¹æ³•ä¸­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  è¯»å–æ•°æ®ï¼Œèµ° state, getters</span></span><br><span class="line"><span class="comment">  ä¿®æ”¹æ•°æ®ï¼Œèµ° mutations, actions</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'@/util/myaxios'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    name: <span class="string">''</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    updateName(state, name) &#123;</span><br><span class="line">      state.name = name;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// é”™è¯¯çš„ç”¨æ³•ï¼Œå¦‚æœåœ¨mutationsæ–¹æ³•ä¸­åŒ…å«äº†å¼‚æ­¥æ“ä½œï¼Œä¼šé€ æˆå¼€å‘å·¥å…·ä¸å‡†ç¡®</span></span><br><span class="line">    <span class="comment">/* async updateServerName(state) &#123;</span></span><br><span class="line"><span class="comment">      const resp = await axios.get('/api/user');</span></span><br><span class="line"><span class="comment">      const &#123;name, age&#125; = resp.data.data;</span></span><br><span class="line"><span class="comment">      state.name = name;</span></span><br><span class="line"><span class="comment">      state.age = age;</span></span><br><span class="line"><span class="comment">    &#125; */</span></span><br><span class="line">    updateServerName(state, user) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; name, age &#125; = user;</span><br><span class="line">      state.name = name;</span><br><span class="line">      state.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="keyword">async</span> updateServerName(context) &#123;</span><br><span class="line">      <span class="keyword">const</span> resp = <span class="keyword">await</span> axios.get(<span class="string">'/api/user'</span>);</span><br><span class="line">      context.commit(<span class="string">'updateServerName'</span>, resp.data.data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆåº”å½“è°ƒç”¨ actions çš„ updateServerName è·å–æ•°æ®</li><li>ç„¶åå†ç”±å®ƒé—´æ¥è°ƒç”¨ mutations çš„ updateServerName æ›´æ–°å…±äº«æ•°æ®</li></ul><p>é¡µé¢ä½¿ç”¨ actions çš„æ–¹æ³•å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;p&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;updateServerName()&quot;&gt;ä»æœåŠ¡å™¨è·å–æ•°æ®,å­˜å…¥store&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapActions &#125; from &apos;vuex&apos;</span><br><span class="line">const options = &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        ...mapActions([&apos;updateServerName&apos;])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default options;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li><p>mapActions ä¼šç”Ÿæˆè°ƒç”¨ actions ä¸­æ–¹æ³•çš„ä»£ç </p></li><li><p>è°ƒç”¨ actions çš„ä»£ç å†…éƒ¨ç­‰ä»·äºï¼Œå®ƒè¿”å›çš„æ˜¯ Promise å¯¹è±¡ï¼Œå¯ä»¥ç”¨åŒæ­¥æˆ–å¼‚æ­¥æ–¹å¼æ¥æ”¶ç»“æœ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$store.dispatch(<span class="string">'actionåç§°'</span>, å‚æ•°)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Vue2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> Vue2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--æ¥å£å­¦ä¹ </title>
      <link href="/2022/10/30/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(41)/"/>
      <url>/2022/10/30/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(41)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><a href="https://imgse.com/i/xI7rNV" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2022/10/30/xI7rNV.png" alt="xI7rNV.png"></a></p><p>è¯´æ˜ï¼šæ¥å£ä¸­çš„å­—æ®µé»˜è®¤ä¸º <strong>static+final</strong> ä¿®é¥°<br>è¡¥å……ï¼š</p><ul><li><p>å…³äºå­—æ®µâ€“&gt; only <strong>public, static &amp; final</strong> are permitted Java(33554775)</p></li><li><p>æ¥å£çš„æ–¹æ³•é»˜è®¤ä¸º<strong>public</strong>ç±»å‹ä¸”åªèƒ½ä¸º<strong>public</strong>ç±»å‹</p></li><li><p>æ¥å£å¯ä»¥å£°æ˜ä¸º<strong>public</strong>æˆ–è€…ä¸å£°æ˜(<strong>åŒ…è®¿é—®</strong>)</p></li><li><p>JDK9ä¸­æ¥å£çš„<strong>defaultæ–¹æ³•å’Œstaticæ–¹æ³•</strong>å¯ä»¥ä¸º<strong>private</strong></p></li><li><p>å½“ä¸€ä¸ªç±»ï¼Œæ—¢ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œåˆå®ç°è‹¥å¹²ä¸ªæ¥å£æ—¶ (é‡ç‚¹)ï¼šçˆ¶ç±»ä¸­çš„æˆå‘˜æ–¹æ³•ä¸æ¥å£ä¸­çš„é»˜è®¤æ–¹æ³•é‡åï¼Œå­ç±»å°±è¿‘é€‰æ‹©æ‰§è¡Œçˆ¶ç±»çš„æˆå‘˜æ–¹æ³•ã€‚</p></li><li><p>JDK 1.8å¼€å§‹ä¹‹åæ¥å£æ–°å¢äº†å¦‚ä¸‹ä¸‰ç§æ–¹æ³•ï¼š</p><p>â€‹     <em>a.é»˜è®¤æ–¹æ³•ï¼ˆå°±æ˜¯ä¹‹å‰å†™çš„æ™®é€šå®ä¾‹æ–¹æ³•ï¼‰</em></p><p>â€‹            <em>â€“ å¿…é¡»ç”¨defaultä¿®é¥°ï¼Œé»˜è®¤ä¼špublicä¿®é¥°</em></p><p>â€‹            <em>â€“ åªèƒ½ç”¨æ¥å£çš„å®ç°ç±»çš„å¯¹è±¡æ¥è°ƒç”¨ï¼ˆæ‰€ä»¥å½“ä¸€ä¸ªç±»å®ç°å¤šä¸ªæ¥å£æ—¶ï¼Œå¤šä¸ªæ¥å£ä¸­å­˜åœ¨åŒåçš„é»˜è®¤æ–¹æ³•ï¼Œå®ç°ç±»å¿…é¡»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼‰ã€‚</em></p><p>â€‹    <em>b.é™æ€æ–¹æ³•</em></p><p>â€‹            <em>â€“ é»˜è®¤ä¼špublicä¿®é¥°</em></p><p>â€‹            <em>â€“ æ³¨æ„ï¼šæ¥å£çš„é™æ€æ–¹æ³•åªèƒ½ç”¨æ¥å£çš„ç±»åæœ¬èº«æ¥è°ƒç”¨ï¼ˆ<em>æ‰€ä»¥å¦‚æœå®ç°äº†å¤šä¸ªæ¥å£ï¼Œå¤šä¸ªæ¥å£ä¸­å­˜åœ¨åŒåçš„é™æ€æ–¹æ³•å¹¶ä¸ä¼šå†²çª</em>ï¼‰ã€‚</em></p><p>â€‹    <em>c.ç§æœ‰æ–¹æ³•ï¼ˆå°±æ˜¯ç§æœ‰çš„å®ä¾‹æ–¹æ³•ï¼‰: JDK 1.9æ‰å¼€å§‹æœ‰çš„ã€‚</em></p><p>â€‹        <em>â€“ åªèƒ½åœ¨æœ¬ç±»ä¸­è¢«å…¶ä»–çš„é»˜è®¤æ–¹æ³•æˆ–è€…ç§æœ‰æ–¹æ³•è®¿é—®ã€‚</em></p></li></ul><hr><p><strong>2022/10/31 æ›´æ–°</strong></p><p><a href="https://imgse.com/i/xTuYsU" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2022/10/31/xTuYsU.png" alt="xTuYsU.png"></a></p><p><strong>2022/11/1 æ›´æ–°</strong></p><p><a href="https://imgse.com/i/xTWTIS" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2022/11/01/xTWTIS.png" alt="xTWTIS.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--åˆå§‹åŒ–é¡ºåº</title>
      <link href="/2022/10/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(40)/"/>
      <url>/2022/10/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(40)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><a href="https://imgse.com/i/xROaQA" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2022/10/25/xROaQA.png" alt="xROaQA.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML&amp;CSSçŸ¥è¯†ç‚¹æ€»ç»“</title>
      <link href="/2022/10/24/07_Java%E7%A8%8B%E5%BA%8F%E5%91%98%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E5%89%8D%E7%AB%AF_HTML&amp;CSS/"/>
      <url>/2022/10/24/07_Java%E7%A8%8B%E5%BA%8F%E5%91%98%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E5%89%8D%E7%AB%AF_HTML&amp;CSS/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="HTML-ä¸-CSS"><a href="#HTML-ä¸-CSS" class="headerlink" title="HTML ä¸ CSS"></a>HTML ä¸ CSS</h1><p>HTML æ˜¯ä»€ä¹ˆï¼šå³ HyperText Markup language è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œå’±ä»¬ç†ŸçŸ¥çš„ç½‘é¡µå°±æ˜¯ç”¨å®ƒç¼–å†™çš„ï¼ŒHTML çš„ä½œç”¨æ˜¯å®šä¹‰ç½‘é¡µçš„å†…å®¹å’Œç»“æ„ã€‚</p><ul><li>HyperText æ˜¯æŒ‡ç”¨è¶…é“¾æ¥çš„æ–¹å¼ç»„ç»‡ç½‘é¡µï¼ŒæŠŠç½‘é¡µè”ç³»èµ·æ¥</li><li>Markup æ˜¯æŒ‡ç”¨ <code>&lt;æ ‡ç­¾&gt;</code> çš„æ–¹å¼èµ‹äºˆå†…å®¹ä¸åŒçš„åŠŸèƒ½å’Œå«ä¹‰</li></ul><p>CSS æ˜¯ä»€ä¹ˆï¼šå³ Cascading  Style  Sheets çº§è”ï¼ˆå±‚å ï¼‰æ ·å¼è¡¨ï¼Œå®ƒæè¿°äº†ç½‘é¡µçš„è¡¨ç°ä¸å±•ç¤ºæ•ˆæœ</p><h2 id="1-HTML-å…ƒç´ "><a href="#1-HTML-å…ƒç´ " class="headerlink" title="1. HTML å…ƒç´ "></a>1. HTML å…ƒç´ </h2><p>HTML ç”±ä¸€ç³»åˆ—å…ƒç´  <code>elements</code> ç»„æˆï¼Œä¾‹å¦‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>æ•´ä½“ç§°ä¹‹ä¸ºå…ƒç´ </p></li><li><p><code>&lt;p&gt;</code> å’Œ <code>&lt;/p&gt;</code> åˆ†åˆ«ç§°ä¸ºèµ·å§‹å’Œç»“æŸæ ‡ç­¾</p></li><li><p>æ ‡ç­¾åŒ…å›´èµ·æ¥çš„ Hello, world ç§°ä¹‹ä¸ºå†…å®¹</p></li><li><p>p æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„ html æ ‡ç­¾ï¼Œä½œç”¨æ˜¯å°†å†…å®¹ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æ®µè½</p></li></ul><p>å…ƒç´ è¿˜å¯ä»¥æœ‰å±æ€§ï¼Œå¦‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"p1"</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å±æ€§ä¸€èˆ¬æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„ï¼Œè¿™é‡Œçš„ id å±æ€§æ˜¯ç»™å…ƒç´ ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†</li></ul><p>å…ƒç´ ä¹‹é—´å¯ä»¥åµŒå¥—ï¼Œå¦‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>HTML æ˜¯ä¸€é—¨éå¸¸<span class="tag">&lt;<span class="name">b</span>&gt;</span>å¼ºå¤§<span class="tag">&lt;/<span class="name">b</span>&gt;</span>çš„è¯­è¨€<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é”™è¯¯åµŒå¥—å†™æ³•ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>HTML æ˜¯ä¸€é—¨éå¸¸<span class="tag">&lt;<span class="name">b</span>&gt;</span>å¼ºå¤§çš„è¯­è¨€<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸åŒ…å«å†…å®¹çš„å…ƒç´ ç§°ä¹‹ä¸ºç©ºå…ƒç´ ï¼Œå¦‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"1.png"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"1.png"</span>/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>img ä½œç”¨æ˜¯ç”¨æ¥å±•ç¤ºå›¾ç‰‡</li><li>src å±æ€§ç”¨æ¥æŒ‡æ˜å›¾ç‰‡è·¯å¾„</li></ul><h2 id="2-HTML-é¡µé¢"><a href="#2-HTML-é¡µé¢" class="headerlink" title="2. HTML é¡µé¢"></a>2. HTML é¡µé¢</h2><p>å‰é¢ä»‹ç»çš„åªæ˜¯å•ç‹¬çš„ HTML å…ƒç´ ï¼Œå®ƒä»¬å¯ä»¥å……å½“ä¸€ä»½å®Œæ•´çš„ HTML é¡µé¢çš„ç»„æˆéƒ¨åˆ†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>æµ‹è¯•é¡µé¢<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"p1"</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"1.png"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>html</code> å…ƒç´ å›Šæ‹¬äº†é¡µé¢ä¸­æ‰€æœ‰å…¶å®ƒå…ƒç´ ï¼Œæ•´ä¸ªé¡µé¢åªéœ€ä¸€ä¸ªï¼Œç§°ä¸ºæ ¹å…ƒç´ </li><li><code>head</code> å…ƒç´ åŒ…å«çš„æ˜¯é‚£äº›ä¸ç”¨äºå±•ç°å†…å®¹çš„å…ƒç´ ï¼Œå¦‚ <code>title</code>ï¼Œ<code>link</code>ï¼Œ<code>meta</code> ç­‰</li><li><code>body</code> å…ƒç´ åŒ…å«äº†å¯¹ç”¨æˆ·å±•ç°å†…å®¹çš„å…ƒç´ ï¼Œä¾‹å¦‚åé¢ä¼šå­¦åˆ°çš„ç”¨äºå±•ç¤ºæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘çš„å„ç§å…ƒç´ </li></ul><h2 id="3-å¸¸è§å…ƒç´ "><a href="#3-å¸¸è§å…ƒç´ " class="headerlink" title="3. å¸¸è§å…ƒç´ "></a>3. å¸¸è§å…ƒç´ </h2><h3 id="1-æ–‡æœ¬"><a href="#1-æ–‡æœ¬" class="headerlink" title="1) æ–‡æœ¬"></a>1) æ–‡æœ¬</h3><h4 id="Heading"><a href="#Heading" class="headerlink" title="Heading"></a>Heading</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>1å·æ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>2å·æ ‡é¢˜<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>3å·æ ‡é¢˜<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>4å·æ ‡é¢˜<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h5</span>&gt;</span>5å·æ ‡é¢˜<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h6</span>&gt;</span>6å·æ ‡é¢˜<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Paragraph"><a href="#Paragraph" class="headerlink" title="Paragraph"></a>Paragraph</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>æ— åºåˆ—è¡¨ unordered list</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>åˆ—è¡¨é¡¹1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>åˆ—è¡¨é¡¹2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>åˆ—è¡¨é¡¹3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ‰åºåˆ—è¡¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>åˆ—è¡¨é¡¹1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>åˆ—è¡¨é¡¹2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>åˆ—è¡¨é¡¹3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¤šçº§åˆ—è¡¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    åŒ—äº¬å¸‚</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>æµ·æ·€åŒº<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>æœé˜³åŒº<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ˜Œå¹³åŒº<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    æ²³åŒ—çœ</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>çŸ³å®¶åº„<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>ä¿å®š<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Anchor"><a href="#Anchor" class="headerlink" title="Anchor"></a>Anchor</h4><p>é”šï¼Œè¶…é“¾æ¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"ç½‘é¡µåœ°å€"</span>&gt;</span>è¶…é“¾æ¥æ–‡æœ¬<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-å¤šåª’ä½“"><a href="#2-å¤šåª’ä½“" class="headerlink" title="2) å¤šåª’ä½“"></a>2) å¤šåª’ä½“</h3><h4 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"æ–‡ä»¶è·¯å¾„"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>src æ ¼å¼æœ‰ 3 ç§</p><ul><li><p>æ–‡ä»¶åœ°å€</p></li><li><p>data URLï¼Œæ ¼å¼å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:åª’ä½“ç±»å‹;base64,æ•°æ®</span><br></pre></td></tr></table></figure></li><li><p>object URLï¼Œéœ€è¦é…åˆ javascript ä½¿ç”¨</p></li></ul><h4 id="Video"><a href="#Video" class="headerlink" title="Video"></a>Video</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">"æ–‡ä»¶è·¯å¾„"</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Audio"><a href="#Audio" class="headerlink" title="Audio"></a>Audio</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">"æ–‡ä»¶è·¯å¾„"</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-è¡¨å•"><a href="#3-è¡¨å•" class="headerlink" title="3) è¡¨å•"></a>3) è¡¨å•</h3><h4 id="ä½œç”¨ä¸è¯­æ³•"><a href="#ä½œç”¨ä¸è¯­æ³•" class="headerlink" title="ä½œç”¨ä¸è¯­æ³•"></a>ä½œç”¨ä¸è¯­æ³•</h4><p>è¡¨å•çš„ä½œç”¨ï¼š<strong>æ”¶é›†</strong>ç”¨æˆ·å¡«å…¥çš„<strong>æ•°æ®</strong>ï¼Œå¹¶å°†è¿™äº›æ•°æ®<strong>æäº¤ç»™æœåŠ¡å™¨</strong></p><p>è¡¨å•çš„è¯­æ³•</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"æœåŠ¡å™¨åœ°å€"</span> <span class="attr">method</span>=<span class="string">"è¯·æ±‚æ–¹å¼"</span> <span class="attr">enctype</span>=<span class="string">"æ•°æ®æ ¼å¼"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- è¡¨å•é¡¹ --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"æäº¤æŒ‰é’®"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>method è¯·æ±‚æ–¹å¼æœ‰ <ul><li>get ï¼ˆé»˜è®¤ï¼‰æäº¤æ—¶ï¼Œæ•°æ®è·Ÿåœ¨ URL åœ°å€ä¹‹å</li><li>post æäº¤æ—¶ï¼Œæ•°æ®åœ¨è¯·æ±‚ä½“å†…</li></ul></li><li>enctype åœ¨ post è¯·æ±‚æ—¶ï¼ŒæŒ‡å®šè¯·æ±‚ä½“çš„æ•°æ®æ ¼å¼<ul><li>application/x-www-form-urlencodedï¼ˆé»˜è®¤ï¼‰</li><li>multipart/form-data</li></ul></li><li>å…¶ä¸­è¡¨å•é¡¹æä¾›å¤šç§æ”¶é›†æ•°æ®çš„æ–¹å¼<ul><li>æœ‰ name å±æ€§çš„è¡¨å•é¡¹æ•°æ®ï¼Œæ‰ä¼šè¢«å‘é€ç»™æœåŠ¡å™¨</li></ul></li></ul><h4 id="å¸¸è§çš„è¡¨å•é¡¹"><a href="#å¸¸è§çš„è¡¨å•é¡¹" class="headerlink" title="å¸¸è§çš„è¡¨å•é¡¹"></a>å¸¸è§çš„è¡¨å•é¡¹</h4><p>æ–‡æœ¬æ¡†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"uesrname"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯†ç æ¡†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>éšè—æ¡†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ—¥æœŸæ¡†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"date"</span> <span class="attr">name</span>=<span class="string">"birthday"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å•é€‰</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"ç”·"</span> <span class="attr">checked</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"å¥³"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¤šé€‰</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"fav"</span> <span class="attr">value</span>=<span class="string">"å”±æ­Œ"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"fav"</span> <span class="attr">value</span>=<span class="string">"é€›è¡—"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"fav"</span> <span class="attr">value</span>=<span class="string">"æ¸¸æˆ"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸Šä¼ </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"avatar"</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4-HTTP-è¯·æ±‚"><a href="#4-HTTP-è¯·æ±‚" class="headerlink" title="4. HTTP è¯·æ±‚"></a>4. HTTP è¯·æ±‚</h2><h3 id="1-è¯·æ±‚ç»„æˆ"><a href="#1-è¯·æ±‚ç»„æˆ" class="headerlink" title="1) è¯·æ±‚ç»„æˆ"></a>1) è¯·æ±‚ç»„æˆ</h3><p>è¯·æ±‚ç”±ä¸‰éƒ¨åˆ†ç»„æˆ</p><ol><li>è¯·æ±‚è¡Œ</li><li>è¯·æ±‚å¤´</li><li>è¯·æ±‚ä½“</li></ol><p>å¯ä»¥ç”¨ telnet ç¨‹åºæµ‹è¯•</p><h3 id="2-è¯·æ±‚æ–¹å¼ä¸æ•°æ®æ ¼å¼"><a href="#2-è¯·æ±‚æ–¹å¼ä¸æ•°æ®æ ¼å¼" class="headerlink" title="2) è¯·æ±‚æ–¹å¼ä¸æ•°æ®æ ¼å¼"></a>2) è¯·æ±‚æ–¹å¼ä¸æ•°æ®æ ¼å¼</h3><h4 id="get-è¯·æ±‚ç¤ºä¾‹"><a href="#get-è¯·æ±‚ç¤ºä¾‹" class="headerlink" title="get è¯·æ±‚ç¤ºä¾‹"></a>get è¯·æ±‚ç¤ºä¾‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /test2?name=%E5%BC%A0&amp;age=20 HTTP/1.1</span><br><span class="line">Host: localhost</span><br></pre></td></tr></table></figure><ul><li>%E5%BC%A0 æ˜¯ã€å¼ ã€‘ç»è¿‡ URL ç¼–ç åçš„ç»“æœ</li></ul><h4 id="post-è¯·æ±‚ç¤ºä¾‹"><a href="#post-è¯·æ±‚ç¤ºä¾‹" class="headerlink" title="post è¯·æ±‚ç¤ºä¾‹"></a>post è¯·æ±‚ç¤ºä¾‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /test2 HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 21</span><br><span class="line"></span><br><span class="line">name=%E5%BC%A0&amp;age=18</span><br></pre></td></tr></table></figure><p>application/x-www-form-urlencoed æ ¼å¼ç»†èŠ‚ï¼š</p><ul><li>å‚æ•°åˆ†æˆåå­—å’Œå€¼ï¼Œä¸­é—´ç”¨ = åˆ†éš”</li><li>å¤šä¸ªå‚æ•°ä½¿ç”¨ &amp; è¿›è¡Œåˆ†éš”</li><li>ã€å¼ ã€‘ç­‰ç‰¹æ®Šå­—ç¬¦éœ€è¦ç”¨ encodeURIComponent() ç¼–ç ä¸º ã€%E5%BC%A0ã€‘åæ‰èƒ½å‘é€</li></ul><h4 id="json-è¯·æ±‚ç¤ºä¾‹"><a href="#json-è¯·æ±‚ç¤ºä¾‹" class="headerlink" title="json è¯·æ±‚ç¤ºä¾‹"></a>json è¯·æ±‚ç¤ºä¾‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /test3 HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 25</span><br><span class="line"></span><br><span class="line">&#123;&quot;name&quot;:&quot;zhang&quot;,&quot;age&quot;:18&#125;</span><br></pre></td></tr></table></figure><p>json å¯¹è±¡æ ¼å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;å±æ€§å&quot;:å±æ€§å€¼&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å±æ€§å€¼å¯ä»¥æ˜¯</p><ul><li>å­—ç¬¦ä¸² â€œâ€</li><li>æ•°å­—</li><li>true, false</li><li>null</li><li>å¯¹è±¡</li><li>æ•°ç»„</li></ul><p>json æ•°ç»„æ ¼å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[å…ƒç´ 1, å…ƒç´ 2, ...]</span><br></pre></td></tr></table></figure><h4 id="multipart-è¯·æ±‚ç¤ºä¾‹"><a href="#multipart-è¯·æ±‚ç¤ºä¾‹" class="headerlink" title="multipart è¯·æ±‚ç¤ºä¾‹"></a>multipart è¯·æ±‚ç¤ºä¾‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /test2 HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Content-Type: multipart/form-data; boundary=123</span><br><span class="line">Content-Length: 125</span><br><span class="line"></span><br><span class="line">--123</span><br><span class="line">Content-Disposition: form-data; name=&quot;name&quot;</span><br><span class="line"></span><br><span class="line">lisi</span><br><span class="line">--123</span><br><span class="line">Content-Disposition: form-data; name=&quot;age&quot;</span><br><span class="line"></span><br><span class="line">30</span><br><span class="line">--123--</span><br></pre></td></tr></table></figure><ul><li>boundary=123 ç”¨æ¥å®šä¹‰åˆ†éš”ç¬¦</li><li>èµ·å§‹åˆ†éš”ç¬¦æ˜¯ <code>--åˆ†éš”ç¬¦</code></li><li>ç»“æŸåˆ†éš”ç¬¦æ˜¯ <code>--åˆ†éš”ç¬¦--</code></li></ul><h4 id="æ•°æ®æ ¼å¼å°ç»“"><a href="#æ•°æ®æ ¼å¼å°ç»“" class="headerlink" title="æ•°æ®æ ¼å¼å°ç»“"></a>æ•°æ®æ ¼å¼å°ç»“</h4><p>å®¢æˆ·ç«¯å‘é€</p><ul><li>ç¼–ç  <ul><li>application/x-www-form-urlencoded ï¼šurl ç¼–ç </li><li>application/jsonï¼šutf-8 ç¼–ç </li><li>multipart/form-dataï¼šæ¯éƒ¨åˆ†ç¼–ç å¯ä»¥ä¸åŒ</li></ul></li><li>è¡¨å•åªæ”¯æŒä»¥ application/x-www-form-urlencoded å’Œ multipart/form-data æ ¼å¼å‘é€æ•°æ®</li><li>æ–‡ä»¶ä¸Šä¼ éœ€è¦ç”¨ multipart/form-data æ ¼å¼</li><li>js ä»£ç å¯ä»¥æ”¯æŒä»»æ„æ ¼å¼å‘é€æ•°æ® </li></ul><p>æœåŠ¡ç«¯æ¥æ”¶</p><ul><li>å¯¹ application/x-www-form-urlencoded å’Œ multipart/form-data æ ¼å¼çš„æ•°æ®ï¼ŒSpring æ¥æ”¶æ–¹å¼æ˜¯ç»Ÿä¸€çš„ï¼Œåªéœ€è¦ç”¨ java bean çš„å±æ€§åå¯¹åº”è¯·æ±‚å‚æ•°åå³å¯</li><li>å¯¹äº applicaiton/json æ ¼å¼çš„æ•°æ®ï¼ŒSpring æ¥æ”¶éœ€è¦ä½¿ç”¨ @RequestBody æ³¨è§£ + java bean çš„æ–¹å¼</li></ul><h3 id="3-session-åŸç†"><a href="#3-session-åŸç†" class="headerlink" title="3) session åŸç†"></a>3) session åŸç†</h3><p>Http æ— çŠ¶æ€ï¼Œæœ‰ä¼šè¯</p><ul><li>æ— çŠ¶æ€æ˜¯æŒ‡ï¼Œè¯·æ±‚ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ•°æ®ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚ä¸èƒ½é‡ç”¨</li><li>æœ‰ä¼šè¯æ˜¯æŒ‡ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æœ‰ç›¸åº”çš„æŠ€æœ¯ï¼Œå¯ä»¥æš‚å­˜æ•°æ®ï¼Œè®©æ•°æ®åœ¨è¯·æ±‚é—´å…±äº«</li></ul><p>æœåŠ¡ç«¯ä½¿ç”¨äº† session æŠ€æœ¯æ¥æš‚å­˜æ•°æ®</p><p>å­˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /s1?name=zhang HTTP/1.1</span><br><span class="line">Host: localhost</span><br></pre></td></tr></table></figure><p>å–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /s2 HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Cookie: JSESSIONID=560FA845D02AE09B176E1BC5D9816A5D</span><br></pre></td></tr></table></figure><p>session æŠ€æœ¯å®ç°èº«ä»½éªŒè¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">participant Client</span><br><span class="line">participant L as LoginController</span><br><span class="line">participant i as LoginInterceptor</span><br><span class="line">participant Session</span><br><span class="line">rect rgb(200, 223, 255)</span><br><span class="line">Client -&gt;&gt; +L : ç™»å½•è¯·æ±‚</span><br><span class="line">L -&gt;&gt; L : æ£€æŸ¥ç”¨æˆ·åï¼Œå¯†ç ï¼ŒéªŒè¯é€šè¿‡</span><br><span class="line">L -&gt;&gt; +Session : å­˜å…¥ç”¨æˆ·å</span><br><span class="line">Session --&gt;&gt; -L: </span><br><span class="line">L --&gt;&gt; -Client: ç™»å½•æˆåŠŸ</span><br><span class="line">end</span><br><span class="line">rect rgb(200, 190, 255)</span><br><span class="line">Client -&gt;&gt; +i : å…¶å®ƒè¯·æ±‚</span><br><span class="line">i -&gt;&gt; +Session : è·å–ç”¨æˆ·å</span><br><span class="line">Session --&gt;&gt; -i : </span><br><span class="line">i -&gt;&gt; i: ç”¨æˆ·åå­˜åœ¨ï¼Œæ”¾è¡Œ</span><br><span class="line">i --&gt;&gt; -Client : </span><br><span class="line">end</span><br></pre></td></tr></table></figure><h3 id="4-jwt-åŸç†"><a href="#4-jwt-åŸç†" class="headerlink" title="4) jwt åŸç†"></a>4) jwt åŸç†</h3><p>jwt æŠ€æœ¯å®ç°èº«ä»½éªŒè¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">participant Client</span><br><span class="line">participant L as LoginController</span><br><span class="line">participant i as LoginInterceptor</span><br><span class="line"></span><br><span class="line">rect rgb(200, 223, 255)</span><br><span class="line">Client -&gt;&gt; +L : ç™»å½•è¯·æ±‚</span><br><span class="line">L -&gt;&gt; L : æ£€æŸ¥ç”¨æˆ·åï¼Œå¯†ç ï¼ŒéªŒè¯é€šè¿‡</span><br><span class="line">L --&gt;&gt; -Client : ç™»å½•æˆåŠŸï¼Œè¿”å›token</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">rect rgb(150, 190, 155)</span><br><span class="line">Client -&gt;&gt; +i : å…¶å®ƒè¯·æ±‚ï¼Œæºå¸¦token</span><br><span class="line">i -&gt;&gt; i : æ ¡éªŒtokenï¼Œæ ¡éªŒæ— è¯¯ï¼Œæ”¾è¡Œ</span><br><span class="line">i --&gt;&gt; -Client : </span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ token</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /j1?name=zhang&amp;pass=123 HTTP/1.1</span><br><span class="line">Host: localhost</span><br></pre></td></tr></table></figure><p>æ ¡éªŒ token</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /j2 HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Authorization: eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiJ9._1-P_TLlzQPb1_lCyGwplMZaKQ8Mcw_plBbYPZ3OX28</span><br></pre></td></tr></table></figure><h2 id="5-CSS"><a href="#5-CSS" class="headerlink" title="5. CSS"></a>5. CSS</h2><p>å³ Cascading  Style  Sheetsï¼Œå®ƒæè¿°äº†ç½‘é¡µçš„è¡¨ç°ä¸å±•ç¤ºæ•ˆæœ</p><h3 id="1-é€‰æ‹©å™¨"><a href="#1-é€‰æ‹©å™¨" class="headerlink" title="1) é€‰æ‹©å™¨"></a>1) é€‰æ‹©å™¨</h3><ul><li><p>type é€‰æ‹©å™¨ - æ ¹æ®æ ‡ç­¾åè¿›è¡ŒåŒ¹é…ï¼ˆå…ƒç´ é€‰æ‹©å™¨ï¼‰</p></li><li><p>class é€‰æ‹©å™¨ - æ ¹æ®å…ƒç´ çš„ class å±æ€§è¿›è¡ŒåŒ¹é…</p></li><li><p>id é€‰æ‹©å™¨  - æ ¹æ®å…ƒç´ çš„ id å±æ€§è¿›è¡ŒåŒ¹é…</p></li></ul><h3 id="2-å±æ€§å’Œå€¼"><a href="#2-å±æ€§å’Œå€¼" class="headerlink" title="2) å±æ€§å’Œå€¼"></a>2) å±æ€§å’Œå€¼</h3><ul><li>background-color : red;</li><li>â€¦</li><li>display</li></ul><h3 id="3-å¸ƒå±€"><a href="#3-å¸ƒå±€" class="headerlink" title="3) å¸ƒå±€"></a>3) å¸ƒå±€</h3><p>ä¸å¸ƒå±€ç›¸å…³çš„ html å…ƒç´ </p><ul><li>div</li><li>template</li></ul>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> HTML </tag>
            
            <tag> CSS </tag>
            
            <tag> å‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSçŸ¥è¯†ç‚¹æ€»ç»“</title>
      <link href="/2022/10/20/08_Java%E7%A8%8B%E5%BA%8F%E5%91%98%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E5%89%8D%E7%AB%AF-js/"/>
      <url>/2022/10/20/08_Java%E7%A8%8B%E5%BA%8F%E5%91%98%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E5%89%8D%E7%AB%AF-js/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h1><p>å®ƒæ˜¯ä¸€ç§è„šæœ¬è¯­è¨€ï¼Œå¯ä»¥ç”¨æ¥æ›´æ”¹é¡µé¢å†…å®¹ï¼Œæ§åˆ¶å¤šåª’ä½“ï¼Œåˆ¶ä½œå›¾åƒã€åŠ¨ç”»ç­‰ç­‰</p><p>ä¾‹å­</p><ul><li>ä¿®æ”¹é¡µé¢å†…å®¹</li></ul><p>js ä»£ç ä½ç½®</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">// js ä»£ç </span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¼•å…¥ js è„šæœ¬</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jsè„šæœ¬è·¯å¾„"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„ï¼Œåˆ°äº†æ¡†æ¶ä¹‹åï¼Œå¼•å…¥æ–¹å¼ä¼šæœ‰ä¸åŒ</li></ul><h2 id="1-å˜é‡ä¸æ•°æ®ç±»å‹"><a href="#1-å˜é‡ä¸æ•°æ®ç±»å‹" class="headerlink" title="1. å˜é‡ä¸æ•°æ®ç±»å‹"></a>1. å˜é‡ä¸æ•°æ®ç±»å‹</h2><h3 id="å£°æ˜å˜é‡"><a href="#å£°æ˜å˜é‡" class="headerlink" title="å£°æ˜å˜é‡"></a>å£°æ˜å˜é‡</h3><h4 id="1-let"><a href="#1-let" class="headerlink" title="1) let"></a>1) let</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> å˜é‡å = å€¼;</span><br></pre></td></tr></table></figure><ul><li>let å£°æ˜çš„å˜é‡å¯ä»¥è¢«å¤šæ¬¡èµ‹å€¼ï¼Œä¾‹å¦‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">100</span>;  <span class="comment">// åˆå§‹å€¼æ˜¯ 100</span></span><br><span class="line">a = <span class="number">200</span>;  <span class="comment">// ok, è¢«é‡æ–°èµ‹å€¼ä¸º 200</span></span><br></pre></td></tr></table></figure><h4 id="2-const"><a href="#2-const" class="headerlink" title="2) const"></a>2) const</h4><ul><li>const ä¿®é¥°çš„å«å¸¸é‡ï¼Œåªèƒ½èµ‹å€¼ä¸€æ¬¡</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> b = <span class="number">300</span>; <span class="comment">// åˆå§‹å€¼æ˜¯ 300</span></span><br><span class="line">b = <span class="number">400</span>;   <span class="comment">// error, ä¸èƒ½å†æ¬¡èµ‹å€¼</span></span><br></pre></td></tr></table></figure><ul><li>const å¹¶ä¸æ„å‘³ç€å®ƒå¼•ç”¨çš„å†…å®¹ä¸å¯ä¿®æ”¹ï¼Œä¾‹å¦‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> c = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">c[<span class="number">2</span>] = <span class="number">4</span>;         <span class="comment">// ok, æ•°ç»„å†…å®¹è¢«ä¿®æ”¹æˆ [1,2,4]</span></span><br><span class="line">c = [<span class="number">5</span>,<span class="number">6</span>];<span class="comment">// error, ä¸èƒ½å†æ¬¡èµ‹å€¼</span></span><br></pre></td></tr></table></figure><h4 id="3-var"><a href="#3-var" class="headerlink" title="3) var"></a>3) var</h4><p>var å£°æ˜çš„å˜é‡å¯ä»¥è¢«å¤šæ¬¡èµ‹å€¼ï¼Œä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="number">100</span>;</span><br><span class="line">f = <span class="number">200</span>;</span><br></pre></td></tr></table></figure><h3 id="åŸºæœ¬ç±»å‹"><a href="#åŸºæœ¬ç±»å‹" class="headerlink" title="åŸºæœ¬ç±»å‹"></a>åŸºæœ¬ç±»å‹</h3><h4 id="1-2-undefined-å’Œ-null"><a href="#1-2-undefined-å’Œ-null" class="headerlink" title="1,2) undefined å’Œ null"></a>1,2) undefined å’Œ null</h4><ul><li>æ‰§è¡Œè¡¨è¾¾å¼æˆ–å‡½æ•°ï¼Œæ²¡æœ‰è¿”å›ç»“æœï¼Œå‡ºç° undefined</li><li>è®¿é—®æ•°ç»„ä¸å­˜åœ¨çš„å…ƒç´ ï¼Œè®¿é—®å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§ï¼Œå‡ºç° undefined</li><li>å®šä¹‰å˜é‡ï¼Œæ²¡æœ‰åˆå§‹åŒ–ï¼Œå‡ºç° undefined</li></ul><p>ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>);  <span class="comment">// å‡½æ•°æ²¡æœ‰è¿”å›å€¼, ç»“æœæ˜¯  undefined</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">10</span>; <span class="comment">// è¡¨è¾¾å¼æ²¡æœ‰è¿”å›å€¼, ç»“æœæ˜¯ undefined</span></span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(b[<span class="number">10</span>]); <span class="comment">// æ•°ç»„æœªå®šä¹‰å…ƒç´ æ˜¯ undefined</span></span><br><span class="line"><span class="keyword">let</span> c = &#123;<span class="string">"name"</span>:<span class="string">"å¼ ä¸‰"</span>&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(c.age); <span class="comment">// å¯¹è±¡æœªå®šä¹‰å±æ€§æ˜¯ undefined</span></span><br><span class="line"><span class="keyword">let</span> d;</span><br><span class="line"><span class="built_in">console</span>.log(d);<span class="comment">// å˜é‡æœªåˆå§‹åŒ–æ˜¯ undefined</span></span><br></pre></td></tr></table></figure><p>äºŒè€…å…±åŒç‚¹</p><ul><li>éƒ½æ²¡æœ‰å±æ€§ã€æ–¹æ³•</li><li>äºŒè€…åˆç§° Nullish</li></ul><p>äºŒè€…åŒºåˆ«</p><ul><li>undefined ç”± js äº§ç”Ÿ</li><li>null ç”±ç¨‹åºå‘˜æä¾›</li></ul><h4 id="3-string"><a href="#3-string" class="headerlink" title="3) string"></a>3) string</h4><p>js å­—ç¬¦ä¸²ä¸‰ç§å†™æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">"hello"</span>;  <span class="comment">// åŒå¼•å·</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="string">"world"</span>;  <span class="comment">// å•å¼•å·</span></span><br><span class="line"><span class="keyword">let</span> c = <span class="string">`hello`</span>;  <span class="comment">// åå¼•å·</span></span><br></pre></td></tr></table></figure><p>html ä»£ç å¦‚ä¸‹ï¼Œç”¨ java å’Œ js ä¸­çš„å­—ç¬¦ä¸²å¦‚ä½•è¡¨ç¤ºï¼Ÿ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"1.html"</span>&gt;</span>è¶…é“¾æ¥<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>java æ˜¾å¾—æ¯”è¾ƒç¹ç</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String s1 = <span class="string">"&lt;a href=\"1.html\"&gt;è¶…é“¾æ¥&lt;/a&gt;"</span>;</span><br><span class="line"></span><br><span class="line">String s2 = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    &lt;a href="</span><span class="number">1</span>.html<span class="string">"&gt;è¶…é“¾æ¥&lt;/a&gt;"</span><span class="string">""</span>;</span><br></pre></td></tr></table></figure><p>js å°±æ¯”è¾ƒçµæ´»</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="string">'&lt;a href="1.html"&gt;è¶…é“¾æ¥&lt;/a&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s2 = <span class="string">`&lt;a href="1.html"&gt;è¶…é“¾æ¥&lt;/a&gt;`</span>;</span><br></pre></td></tr></table></figure><p>æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆTemplate stringsï¼‰</p><p>éœ€æ±‚ï¼šæ‹¼æ¥ URI çš„è¯·æ±‚å‚æ•°ï¼Œå¦‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/test?name=zhang&amp;age=18</span><br><span class="line">/test?name=li&amp;age=20</span><br></pre></td></tr></table></figure><p>ä¼ ç»Ÿæ–¹æ³•æ‹¼æ¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = ; <span class="comment">// zhang li ...</span></span><br><span class="line"><span class="keyword">let</span> age = ; <span class="comment">// 18 20 ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> uri = <span class="string">"/test?name="</span> + name + <span class="string">"&amp;age="</span> + age;</span><br></pre></td></tr></table></figure><p>æ¨¡æ¿å­—ç¬¦ä¸²æ–¹å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = ; <span class="comment">// zhang li ...</span></span><br><span class="line"><span class="keyword">let</span> age = ; <span class="comment">// 18 20 ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> uri = <span class="string">`/test?name=<span class="subst">$&#123;name&#125;</span>&amp;age=<span class="subst">$&#123;age&#125;</span>`</span>;</span><br></pre></td></tr></table></figure><h4 id="4-5-number-å’Œ-bigint"><a href="#4-5-number-å’Œ-bigint" class="headerlink" title="4,5) number å’Œ bigint"></a>4,5) number å’Œ bigint</h4><p>number ç±»å‹æ ‡è¯†çš„æ˜¯åŒç²¾åº¦æµ®åŠ¨å°æ•°ï¼Œä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span> / <span class="number">3</span>;   <span class="comment">// ç»“æœ 3.3333333333333335</span></span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ˜¯æµ®ç‚¹å°æ•°ï¼Œé‚£ä¹ˆå¯ä»¥é™¤é›¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span> / <span class="number">0</span>;  <span class="comment">// ç»“æœ Infinity æ­£æ— ç©·å¤§</span></span><br><span class="line"><span class="number">-10</span> / <span class="number">0</span>;  <span class="comment">// ç»“æœ -Infinity è´Ÿæ— ç©·å¤§</span></span><br></pre></td></tr></table></figure><p>æµ®ç‚¹å°æ•°éƒ½æœ‰è¿ç®—ç²¾åº¦é—®é¢˜ï¼Œä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.0</span> - <span class="number">1.1</span>; <span class="comment">// ç»“æœ 0.8999999999999999</span></span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²è½¬æ•°å­—</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">parseInt</span>(<span class="string">"10"</span>); <span class="comment">// ç»“æœæ˜¯æ•°å­— 10 </span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">"10.5"</span>);<span class="comment">// ç»“æœæ˜¯æ•°å­— 10, å»é™¤äº†å°æ•°éƒ¨åˆ†</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">"10"</span>) / <span class="number">3</span>; <span class="comment">// ç»“æœä»è§†ä¸º number æµ®ç‚¹æ•°, å› æ­¤ç»“æœä¸º 3.3333333333333335</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">"abc"</span>);<span class="comment">// è½¬æ¢å¤±è´¥ï¼Œç»“æœæ˜¯ç‰¹æ®Šå€¼ NaN (Not a Number)</span></span><br></pre></td></tr></table></figure><p>è¦è¡¨ç¤ºçœŸæ­£çš„æ•´æ•°ï¼Œéœ€è¦ç”¨ bigintï¼Œæ•°å­—çš„ç»“å°¾ç”¨ n è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ª bigint ç±»å‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span>n / <span class="number">3</span>n;<span class="comment">// ç»“æœ 3n, æŒ‰æ•´æ•°é™¤æ³•å¤„ç†</span></span><br></pre></td></tr></table></figure><h4 id="6-boolean"><a href="#6-boolean" class="headerlink" title="6) boolean"></a>6) boolean</h4><ul><li>Truthy</li><li>Falsy</li></ul><p>åœ¨ js ä¸­ï¼Œå¹¶ä¸æ˜¯ boolean æ‰èƒ½ç”¨äºæ¡ä»¶åˆ¤æ–­ï¼Œä½ å¯ä»¥åœ¨ if è¯­å¥ä¸­ä½¿ç”¨ã€æ•°å­—ã€‘ã€ã€å­—ç¬¦ä¸²ã€‘â€¦ ä½œä¸ºåˆ¤æ–­æ¡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> b = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(b) &#123; <span class="comment">// true</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"è¿›å…¥äº†"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å°±æœ‰ä¸€ä¸ªè§„åˆ™ï¼Œå½“éœ€è¦æ¡ä»¶åˆ¤æ–­æ—¶ï¼Œè¿™ä¸ªå€¼è¢«å½“ä½œ true è¿˜æ˜¯ falseï¼Œå½“ä½œ true çš„å€¼å½’ç±»ä¸º truthyï¼Œå½“ä½œ false çš„å€¼å½’ç±»ä¸º falsy</p><p>ä¸‹é¢å€¼éƒ½æ˜¯ falsy</p><ul><li><code>false</code></li><li><code>Nullish (null, undefined)</code></li><li><code>0, 0n, NaN</code></li><li>é•¿åº¦ä¸ºé›¶çš„å­—ç¬¦ä¸²</li></ul><p>å‰©ä½™çš„å€¼ç»å¤§éƒ¨åˆ†éƒ½æ˜¯ truthy</p><p>æœ‰å‡ ä¸ªå®¹æ˜“è¢«å½“ä½œ falsy å®é™…æ˜¯ truthy çš„</p><ul><li><code>&quot;false&quot;, &quot;0&quot;</code> å³å­—ç¬¦ä¸²çš„ false å’Œ å­—ç¬¦ä¸²çš„é›¶</li><li><code>[]</code> ç©ºæ•°ç»„</li><li><code>{}</code> ç©ºå¯¹è±¡</li></ul><h4 id="7-symbol"><a href="#7-symbol" class="headerlink" title="7) symbol"></a>7) symbol</h4><ul><li>å¾ˆå°‘ä½¿ç”¨</li></ul><h3 id="å¯¹è±¡ç±»å‹"><a href="#å¯¹è±¡ç±»å‹" class="headerlink" title="å¯¹è±¡ç±»å‹"></a>å¯¹è±¡ç±»å‹</h3><h4 id="1-Function"><a href="#1-Function" class="headerlink" title="1) Function"></a>1) Function</h4><h5 id="å®šä¹‰å‡½æ•°"><a href="#å®šä¹‰å‡½æ•°" class="headerlink" title="å®šä¹‰å‡½æ•°"></a>å®šä¹‰å‡½æ•°</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> å‡½æ•°å(<span class="params">å‚æ•°</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å‡½æ•°ä½“</span></span><br><span class="line">    <span class="keyword">return</span> ç»“æœ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è°ƒç”¨å‡½æ•°"><a href="#è°ƒç”¨å‡½æ•°" class="headerlink" title="è°ƒç”¨å‡½æ•°"></a>è°ƒç”¨å‡½æ•°</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å‡½æ•°å(å®å‚);</span><br></pre></td></tr></table></figure><p>ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">1</span>, <span class="number">2</span>);     <span class="comment">// è¿”å› 3</span></span><br></pre></td></tr></table></figure><p>js ä¸­çš„å‡½æ•°è°ƒç”¨ç‰¹ç‚¹ï¼šå¯¹å‚æ•°çš„<strong>ç±»å‹</strong>å’Œ<strong>ä¸ªæ•°</strong>éƒ½æ²¡æœ‰é™åˆ¶ï¼Œä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">'a'</span>, <span class="string">'b'</span>);  <span class="comment">// è¿”å› ab</span></span><br><span class="line">add(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);   <span class="comment">// è¿”å› 9, ç¬¬ä¸‰ä¸ªå‚æ•°æ²¡æœ‰è¢«ç”¨åˆ°, ä¸ä¼šæŠ¥é”™</span></span><br><span class="line">add(<span class="number">1</span>);<span class="comment">// è¿”å› NaN, è¿™æ—¶ b æ²¡æœ‰å®šä¹‰æ˜¯ undefined, undefined åšæ•°å­¦è¿ç®—ç»“æœå°±æ˜¯ NaN</span></span><br></pre></td></tr></table></figure><h5 id="é»˜è®¤å‚æ•°"><a href="#é»˜è®¤å‚æ•°" class="headerlink" title="é»˜è®¤å‚æ•°"></a>é»˜è®¤å‚æ•°</h5><p>java ä¸­ï¼ˆspringï¼‰è¦å®ç°é»˜è®¤å‚æ•°çš„æ•ˆæœå¾—è¿™ä¹ˆåšï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/page"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">page</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        @RequestParam(defaultValue=<span class="string">"1"</span>)</span> <span class="keyword">int</span> page, </span></span><br><span class="line"><span class="function">        @<span class="title">RequestParam</span><span class="params">(defaultValue=<span class="string">"10"</span>)</span> <span class="keyword">int</span> size</span></span><br><span class="line"><span class="function">    )</span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pagination</span>(<span class="params">page = <span class="number">1</span>, size = <span class="number">10</span></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(page, size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åŒ¿åå‡½æ•°"><a href="#åŒ¿åå‡½æ•°" class="headerlink" title="åŒ¿åå‡½æ•°"></a>åŒ¿åå‡½æ•°</h5><p>è¯­æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">å‚æ•°</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å‡½æ•°ä½“</span></span><br><span class="line">    <span class="keyword">return</span> ç»“æœ;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§åœºæ™¯ï¼šå®šä¹‰å®Œæ¯•åç«‹åˆ»è°ƒç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;)(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§åœºæ™¯ï¼šä½œä¸ºå…¶å®ƒå¯¹è±¡çš„æ–¹æ³•ï¼Œä¾‹å¦‚</p><p>é¡µé¢æœ‰å…ƒç´ </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"p1"</span>&gt;</span>ç‚¹æˆ‘å•Š<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤å…ƒç´ æœ‰ä¸€ä¸ª onclick æ–¹æ³•ï¼Œä¼šåœ¨é¼ æ ‡å•å‡»è¿™ä¸ªå…ƒç´ åè¢«æ‰§è¡Œï¼Œonclick æ–¹æ³•åˆšå¼€å§‹æ˜¯ nullï¼Œéœ€è¦èµ‹å€¼åæ‰èƒ½ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"p1"</span>).onclick = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"é¼ æ ‡å•å‡»äº†..."</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="ç®­å¤´å‡½æ•°"><a href="#ç®­å¤´å‡½æ•°" class="headerlink" title="ç®­å¤´å‡½æ•°"></a>ç®­å¤´å‡½æ•°</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(å‚æ•°) =&gt; &#123;</span><br><span class="line">    <span class="comment">// å‡½æ•°ä½“</span></span><br><span class="line">    <span class="keyword">return</span> ç»“æœ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œ() è¿˜æ˜¯è¦ä¿ç•™</li><li>å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œ() å¯ä»¥çœç•¥</li><li>å¦‚æœå‡½æ•°ä½“å†…åªæœ‰ä¸€è¡Œä»£ç ï¼Œ{} å¯ä»¥çœç•¥</li><li>å¦‚æœè¿™ä¸€è¡Œä»£ç å°±æ˜¯ç»“æœï¼Œreturn å¯ä»¥çœç•¥</li></ul><p>ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"p1"</span>).onclick = <span class="function"><span class="params">()</span> =&gt;</span>  <span class="built_in">console</span>.log(<span class="string">"aa"</span>);</span><br></pre></td></tr></table></figure><h5 id="å‡½æ•°æ˜¯å¯¹è±¡"><a href="#å‡½æ•°æ˜¯å¯¹è±¡" class="headerlink" title="å‡½æ•°æ˜¯å¯¹è±¡"></a>å‡½æ•°æ˜¯å¯¹è±¡</h5><p>ä»¥ä¸‹å½¢å¼åœ¨ js ä¸­éå¸¸å¸¸è§ï¼</p><ol><li>å¯ä»¥å‚ä¸èµ‹å€¼ï¼Œä¾‹ï¼Œå…·åå‡½æ•°ä¹Ÿèƒ½å‚ä¸èµ‹å€¼</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">abc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"bb"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"p1"</span>).onclick = abc;</span><br></pre></td></tr></table></figure><ol start="2"><li>æœ‰å±æ€§ã€æœ‰æ–¹æ³•ï¼Œæ‰§è¡Œ <code>console.dir(abc)</code>ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Æ’ abc()</span><br><span class="line">    arguments: null</span><br><span class="line">    caller: null</span><br><span class="line">    length: 0</span><br><span class="line">    name: &quot;abc&quot;</span><br><span class="line">    â¡prototype: &#123;constructor: Æ’&#125;</span><br><span class="line">    [[FunctionLocation]]: VM1962:1</span><br><span class="line">    â¡[[Prototype]]: Æ’ ()</span><br><span class="line">    â¡[[Scopes]]: Scopes[1]</span><br></pre></td></tr></table></figure><ul><li><p>å…¶ä¸­å¸¦æœ‰ f æ ‡è®°çš„æ˜¯æ–¹æ³•ï¼Œä¸å¸¦çš„æ˜¯å±æ€§</p></li><li><p>å¸¦æœ‰ â¡ ç¬¦å·çš„å¯ä»¥ç»§ç»­å±•å¼€ï¼Œé™äºç¯‡å¹…çœç•¥äº†</p></li><li><p>å¸¦æœ‰ <code>[[ ]]</code> çš„æ˜¯å†…ç½®å±æ€§ï¼Œä¸èƒ½è®¿é—®ï¼Œåªèƒ½æŸ¥çœ‹</p></li><li><p>ç›¸å¯¹é‡è¦çš„æ˜¯ <code>[[Prototype]]</code> å’Œ <code>[[Scopes]]</code> ä¼šåœ¨åé¢ç»§æ‰¿å’Œä½œç”¨åŸŸæ—¶è®²åˆ°</p></li></ul><ol start="3"><li>å¯ä»¥ä½œä¸ºæ–¹æ³•å‚æ•°</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params">fn</span>) </span>&#123;          <span class="comment">// fn å°†æ¥å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'b'</span>)</span><br><span class="line">    fn();                 <span class="comment">// è°ƒç”¨å‡½æ•°å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b(a)</span><br></pre></td></tr></table></figure><ol start="4"><li>å¯ä»¥ä½œä¸ºæ–¹æ³•è¿”å›å€¼</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"c"</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"d"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c()()</span><br></pre></td></tr></table></figure><h5 id="å‡½æ•°ä½œç”¨åŸŸ"><a href="#å‡½æ•°ä½œç”¨åŸŸ" class="headerlink" title="å‡½æ•°ä½œç”¨åŸŸ"></a>å‡½æ•°ä½œç”¨åŸŸ</h5><p>å‡½æ•°å¯ä»¥åµŒå¥—ï¼ˆjs ä»£ç ä¸­å¾ˆå¸¸è§ï¼Œåªæ˜¯åµŒå¥—çš„å½¢å¼æ›´å¤šæ˜¯åŒ¿åå‡½æ•°ï¼Œç®­å¤´å‡½æ•°ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹é¢çš„ä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> z = <span class="number">30</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">20</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// çœ‹è¿™é‡Œ</span></span><br><span class="line">        <span class="built_in">console</span>.log(x, y);</span><br><span class="line">    &#125;</span><br><span class="line">    b();</span><br><span class="line">&#125;</span><br><span class="line">a();</span><br></pre></td></tr></table></figure><ul><li>ä»¥å‡½æ•°ä¸ºåˆ†ç•Œçº¿åˆ’å®šä½œç”¨åŸŸï¼Œæ‰€æœ‰å‡½æ•°ä¹‹å¤–æ˜¯å…¨å±€ä½œç”¨åŸŸ</li><li>æŸ¥æ‰¾å˜é‡æ—¶ï¼Œç”±å†…å‘å¤–æŸ¥æ‰¾<ul><li>åœ¨å†…å±‚ä½œç”¨åŸŸæ‰¾åˆ°å˜é‡ï¼Œå°±ä¼šåœæ­¢æŸ¥æ‰¾ï¼Œä¸ä¼šå†æ‰¾å¤–å±‚</li><li>æ‰€æœ‰ä½œç”¨åŸŸéƒ½æ‰¾ä¸åˆ°å˜é‡ï¼ŒæŠ¥é”™</li></ul></li><li>ä½œç”¨åŸŸæœ¬è´¨ä¸Šæ˜¯å‡½æ•°å¯¹è±¡çš„å±æ€§ï¼Œå¯ä»¥é€šè¿‡ console.dir æ¥æŸ¥çœ‹è°ƒè¯•</li></ul><h5 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">20</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(x,y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line">a()();  <span class="comment">// åœ¨å¤–é¢æ‰§è¡Œäº† b</span></span><br></pre></td></tr></table></figure><ul><li>å‡½æ•°å®šä¹‰æ—¶ï¼Œå®ƒçš„ä½œç”¨åŸŸå·²ç»ç¡®å®šå¥½äº†ï¼Œå› æ­¤æ— è®ºå‡½æ•°å°†æ¥å»äº†å“ªï¼Œéƒ½èƒ½ä»å®ƒçš„ä½œç”¨åŸŸä¸­æ‰¾åˆ°å½“æ—¶é‚£äº›å˜é‡</li><li>åˆ«è¢«æ¦‚å¿µå¿½æ‚ äº†ï¼Œé—­åŒ…å°±æ˜¯æŒ‡<strong>å‡½æ•°èƒ½å¤Ÿè®¿é—®è‡ªå·±çš„ä½œç”¨åŸŸä¸­å˜é‡</strong></li></ul><h5 id="letã€var-ä¸ä½œç”¨åŸŸ"><a href="#letã€var-ä¸ä½œç”¨åŸŸ" class="headerlink" title="letã€var ä¸ä½œç”¨åŸŸ"></a>letã€var ä¸ä½œç”¨åŸŸ</h5><p>å¦‚æœå‡½æ•°å¤–å±‚å¼•ç”¨çš„æ˜¯ let å˜é‡ï¼Œé‚£ä¹ˆå¤–å±‚æ™®é€šçš„ {} ä¹Ÿä¼šä½œä¸ºä½œç”¨åŸŸè¾¹ç•Œï¼Œæœ€å¤–å±‚çš„ let ä¹Ÿå ä¸€ä¸ª script ä½œç”¨åŸŸ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">10</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> y = <span class="number">20</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(x,y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.dir(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡½æ•°å¤–å±‚å¼•ç”¨çš„æ˜¯ var å˜é‡ï¼Œå¤–å±‚æ™®é€šçš„ {} ä¸ä¼šè§†ä¸ºè¾¹ç•Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">20</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(x,y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.dir(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ var å˜é‡å‡ºç°äº†é‡åï¼Œåˆ™ä»–ä¿©ä¼šè¢«è§†ä¸ºåŒä¸€ä½œç”¨åŸŸä¸­çš„åŒä¸€ä¸ªå˜é‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> e = <span class="number">10</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(e);<span class="comment">// æ‰“å° 20</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(e);<span class="comment">// å› ä¸ºæ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œè¿˜æ˜¯æ‰“å° 20</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ letï¼Œåˆ™è§†ä¸ºä¸¤ä¸ªä½œç”¨åŸŸä¸­çš„ä¸¤ä¸ªå˜é‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> e = <span class="number">10</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> e = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(e);<span class="comment">// æ‰“å° 20</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(e);<span class="comment">// æ‰“å° 10</span></span><br></pre></td></tr></table></figure><p>è¦æƒ³é‡Œé¢çš„ e å’Œå¤–é¢çš„ e èƒ½åŒºåˆ†å¼€æ¥ï¼Œæœ€ç®€å•çš„åŠæ³•æ˜¯æ”¹æˆ letï¼Œæˆ–è€…ç”¨å‡½æ•°æ¥ç•Œå®šä½œç”¨åŸŸèŒƒå›´</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> e = <span class="number">10</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> e = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">    &#125;</span><br><span class="line">    b();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(e);</span><br></pre></td></tr></table></figure><h4 id="2-Array-star"><a href="#2-Array-star" class="headerlink" title="2) Array :star:"></a>2) Array :star:</h4><p>è¯­æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ•°ç»„</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]; </span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ•°ç»„å…ƒç´ </span></span><br><span class="line"><span class="built_in">console</span>.log(arr[<span class="number">0</span>]); <span class="comment">// è¾“å‡º 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹æ•°ç»„å…ƒç´ </span></span><br><span class="line">array[<span class="number">0</span>] = <span class="number">5</span>; <span class="comment">// æ•°ç»„å…ƒç´ å˜æˆäº† [5,2,3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†æ•°ç»„å…ƒç´ ï¼Œå…¶ä¸­ length æ˜¯æ•°ç»„å±æ€§ï¼Œä»£è¡¨æ•°ç»„é•¿åº¦</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(arr[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>API</p><ul><li>pushã€shiftã€splice</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]; </span><br><span class="line"></span><br><span class="line">arr.push(<span class="number">4</span>);    <span class="comment">// å‘æ•°ç»„å°¾éƒ¨(å³ä¾§)æ·»åŠ å…ƒç´ , ç»“æœ [1,2,3,4]</span></span><br><span class="line">arr.shift();<span class="comment">// ä»æ•°ç»„å¤´éƒ¨(å·¦ä¾§)ç§»é™¤å…ƒç´ , ç»“æœ [2,3,4]</span></span><br><span class="line">arr.splice(<span class="number">1</span>,<span class="number">1</span>);<span class="comment">// åˆ é™¤ã€å‚æ•°1ã€‘ç´¢å¼•ä½ç½®çš„ã€å‚æ•°2ã€‘ä¸ªå…ƒç´ ï¼Œç»“æœ [2,4]</span></span><br></pre></td></tr></table></figure><ul><li>join</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>];</span><br><span class="line"></span><br><span class="line">arr.join(); <span class="comment">// é»˜è®¤ä½¿ç”¨ã€,ã€‘ä½œä¸ºè¿æ¥ç¬¦ï¼Œç»“æœ 'a,b,c'</span></span><br><span class="line">arr.join(<span class="string">''</span>);<span class="comment">// ç»“æœ 'abc'</span></span><br><span class="line">arr.join(<span class="string">'-'</span>);<span class="comment">// ç»“æœ 'a-b-c'</span></span><br></pre></td></tr></table></figure><ul><li>mapã€filterã€forEach</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">i</span>) </span>&#123;   <span class="comment">// ä»£è¡¨çš„æ–°æ—§å…ƒç´ ä¹‹é—´çš„å˜æ¢è§„åˆ™</span></span><br><span class="line">    <span class="keyword">return</span> i * <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// arr.map(a) // å…·åå‡½æ•°ï¼Œç»“æœ [10,20,30,60]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// arr.map( (i) =&gt; &#123;return i * 10&#125; ); // ç®­å¤´å‡½æ•°</span></span><br><span class="line">arr.map( <span class="function"><span class="params">i</span> =&gt;</span> i * <span class="number">10</span> ); <span class="comment">// ç®­å¤´å‡½æ•°</span></span><br></pre></td></tr></table></figure><ul><li>ä¼ ç»™ map çš„å‡½æ•°ï¼Œå‚æ•°ä»£è¡¨æ—§å…ƒç´ ï¼Œè¿”å›å€¼ä»£è¡¨æ–°å…ƒç´ </li></ul><p>map çš„å†…éƒ¨å®ç°ï¼ˆä¼ªä»£ç ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">a</span>) </span>&#123; <span class="comment">// å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="keyword">let</span> narr = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> o = arr[i]; <span class="comment">// æ—§å…ƒç´ </span></span><br><span class="line">        <span class="keyword">let</span> n = a(o);   <span class="comment">// æ–°å…ƒç´ </span></span><br><span class="line">        narr.push(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> narr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>filter ä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>];</span><br><span class="line">arr.filter( <span class="function">(<span class="params">i</span>)=&gt;</span> i % <span class="number">2</span> == <span class="number">1</span> ); <span class="comment">// ç»“æœ [1,3]</span></span><br></pre></td></tr></table></figure><ul><li>ä¼ ç»™ filter çš„å‡½æ•°ï¼Œå‚æ•°ä»£è¡¨æ—§å…ƒç´ ï¼Œè¿”å› true è¡¨ç¤ºè¦ç•™ä¸‹çš„å…ƒç´ </li></ul><p>forEach ä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*for(let i = 0; i &lt; arr.length; i++) &#123;</span></span><br><span class="line"><span class="comment">    console.log(arr[i]);</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line">arr.forEach( <span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">console</span>.log(i) );</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªç§°å‘¼</p><ul><li>é«˜é˜¶å‡½æ•°ï¼Œmapï¼Œfilterï¼ŒforEach</li><li>å›è°ƒå‡½æ•°ï¼Œä¾‹å¦‚ä½œä¸ºå‚æ•°ä¼ å…¥çš„å‡½æ•°</li></ul><h4 id="3-Object-star-star"><a href="#3-Object-star-star" class="headerlink" title="3) Object :star::star:"></a>3) Object :star::star:</h4><h5 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    å±æ€§å: å€¼,</span><br><span class="line">    æ–¹æ³•å: å‡½æ•°,</span><br><span class="line">    <span class="keyword">get</span> å±æ€§å() &#123;&#125;,</span><br><span class="line">    <span class="keyword">set</span> å±æ€§å(æ–°å€¼) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu1 = &#123;</span><br><span class="line">    name: <span class="string">"å°æ˜"</span>,</span><br><span class="line">    age: <span class="number">18</span>,</span><br><span class="line">    study: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">"çˆ±å­¦ä¹ "</span>);</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹2</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">"å°é»‘"</span>;</span><br><span class="line"><span class="keyword">let</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">let</span> study = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">"çˆ±å­¦ä¹ "</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stu2 = &#123; name, age, study &#125;</span><br></pre></td></tr></table></figure><p>ä¾‹3ï¼ˆé‡ç‚¹ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu3 = &#123;</span><br><span class="line">    name: <span class="string">"å°ç™½"</span>,</span><br><span class="line">    age: <span class="number">18</span>,</span><br><span class="line">    study()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">"çˆ±å­¦ä¹ "</span>);</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>æ³¨æ„</strong>ï¼šå¯¹è±¡æ–¹æ³•è¿™ä¹ˆå†™ï¼Œä»…é™äºå¯¹è±¡å†…éƒ¨</li></ul><p>ä¾‹4</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu4 = &#123;</span><br><span class="line">    _name: <span class="literal">null</span>, <span class="comment">/*ç±»ä¼¼äºjavaä¸­ç§æœ‰æˆå‘˜å˜é‡*/</span></span><br><span class="line">    <span class="keyword">get</span> name() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"è¿›å…¥äº†get"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._name;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span> name(name) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"è¿›å…¥äº†set"</span>);</span><br><span class="line">        <span class="keyword">this</span>._name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ getï¼Œset</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stu4.name = <span class="string">"å°ç™½"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(stu4.name)</span><br></pre></td></tr></table></figure><h5 id="ç‰¹è‰²ï¼šå±æ€§å¢åˆ "><a href="#ç‰¹è‰²ï¼šå±æ€§å¢åˆ " class="headerlink" title="ç‰¹è‰²ï¼šå±æ€§å¢åˆ "></a>ç‰¹è‰²ï¼šå±æ€§å¢åˆ </h5><p>å¯¹æ¯”ä¸€ä¸‹ Java ä¸­çš„ Object</p><ul><li>Java çš„ Object æ˜¯ä»¥ç±»ä½œä¸ºæ¨¡æ¿æ¥åˆ›å»ºï¼Œå¯¹è±¡ä¸èƒ½è„±ç¦»ç±»æ¨¡æ¿çš„èŒƒå›´ï¼Œä¸€ä¸ªå¯¹è±¡çš„å±æ€§ã€èƒ½ç”¨çš„æ–¹æ³•éƒ½æ˜¯ç¡®å®šå¥½çš„</li><li>js çš„å¯¹è±¡ï¼Œä¸éœ€è¦ä»€ä¹ˆæ¨¡æ¿ï¼Œå®ƒçš„å±æ€§å’Œæ–¹æ³•å¯ä»¥éšæ—¶åŠ å‡</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu = &#123;<span class="attr">name</span>:<span class="string">'å¼ ä¸‰'</span>&#125;;</span><br><span class="line">stu.age = <span class="number">18</span>;<span class="comment">// æ·»åŠ å±æ€§</span></span><br><span class="line"><span class="keyword">delete</span> stu.age;<span class="comment">// åˆ é™¤å±æ€§</span></span><br><span class="line"></span><br><span class="line">stu.study = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="comment">// æ·»åŠ æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">"åœ¨å­¦ä¹ "</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ  getï¼Œsetï¼Œéœ€è¦å€ŸåŠ© Object.definePropery</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu = &#123;<span class="attr">_name</span>:<span class="literal">null</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(stu, <span class="string">"name"</span>, &#123;</span><br><span class="line">    <span class="keyword">get</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._name;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span>(name)&#123;</span><br><span class="line">        <span class="keyword">this</span>._name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>å‚æ•°1ï¼šç›®æ ‡å¯¹è±¡</li><li>å‚æ•°2ï¼šå±æ€§å</li><li>å‚æ•°3ï¼šgetï¼Œset çš„å®šä¹‰</li></ul><h5 id="ç‰¹è‰²ï¼šthis"><a href="#ç‰¹è‰²ï¼šthis" class="headerlink" title="ç‰¹è‰²ï¼šthis"></a>ç‰¹è‰²ï¼šthis</h5><p>å…ˆæ¥å¯¹ Java ä¸­çš„ this æœ‰ä¸ªç†è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMethod</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">study</span><span class="params">(Student <span class="keyword">this</span>, String subject)</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.name + <span class="string">"åœ¨å­¦ä¹  "</span> + subject);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Student stu = <span class="keyword">new</span> Student(<span class="string">"å°æ˜"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸‹é¢çš„ä»£ç ï¼Œæœ¬è´¨ä¸Šæ˜¯æ‰§è¡Œ study(stu, "java")ï¼Œå› æ­¤ this å°±æ˜¯ stu</span></span><br><span class="line">        stu.study(<span class="string">"java"</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Java ä¸­çš„ this æ˜¯ä¸ªéšå¼å‚æ•°</li><li>Java ä¸­ï¼Œæˆ‘ä»¬è¯´ this ä»£è¡¨çš„å°±æ˜¯è°ƒç”¨æ–¹æ³•çš„é‚£ä¸ªå¯¹è±¡</li></ul><p>js ä¸­çš„ this ä¹Ÿæ˜¯éšå¼å‚æ•°ï¼Œä½†å®ƒä¸å‡½æ•°è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ç›¸å…³</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªâ€œè½å•â€çš„å‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">study</span>(<span class="params">subject</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">"åœ¨å­¦ä¹  "</span> + subject)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">study(<span class="string">"js"</span>);  <span class="comment">// è¾“å‡º åœ¨å­¦ä¹  js</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºæ­¤æ—¶å‡½æ•°æ‰§è¡Œï¼Œå…¨å±€å¯¹è±¡ window è¢«å½“ä½œäº† thisï¼Œwindow å¯¹è±¡çš„ name å±æ€§æ˜¯ç©ºä¸²</p><p>åŒæ ·çš„å‡½æ•°ï¼Œå¦‚æœä½œä¸ºå¯¹è±¡çš„æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu = &#123;</span><br><span class="line">    name:<span class="string">"å°ç™½"</span>,</span><br><span class="line">    study</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šå°†å½“å‰å¯¹è±¡ä½œä¸º this</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stu.study(<span class="string">'js'</span>); <span class="comment">// è¾“å‡º å°ç™½åœ¨å­¦ä¹  js</span></span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥åŠ¨æ€æ”¹å˜ this</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu = &#123;<span class="attr">name</span>:<span class="string">"å°é»‘"</span>&#125;;</span><br><span class="line">study.call(stu, <span class="string">"js"</span>);<span class="comment">// è¾“å‡º å°é»‘åœ¨å­¦ä¹  js</span></span><br></pre></td></tr></table></figure><p>è¿™å› study æ‰§è¡Œæ—¶ï¼Œå°±æŠŠ call çš„ç¬¬ä¸€ä¸ªå‚æ•° stu ä½œä¸º this</p><p>ä¸€ä¸ªä¾‹å¤–æ˜¯ï¼Œåœ¨<strong>ç®­å¤´å‡½æ•°</strong>å†…å‡ºç°çš„ thisï¼Œä»¥å¤–å±‚ this ç†è§£ </p><p>ç”¨åŒ¿åå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu = &#123;</span><br><span class="line">    name: <span class="string">"å°èŠ±"</span>,</span><br><span class="line">    friends: [<span class="string">"å°ç™½"</span>,<span class="string">"å°é»‘"</span>,<span class="string">"å°æ˜"</span>],</span><br><span class="line">    play() &#123;</span><br><span class="line">        <span class="keyword">this</span>.friends.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">"ä¸"</span> + e + <span class="string">"åœ¨ç©è€"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">stu.play()</span><br></pre></td></tr></table></figure><ul><li>this.name æ‰€åœ¨çš„å‡½æ•°æ˜¯ã€è½å•ã€‘çš„å‡½æ•°ï¼Œå› æ­¤ this ä»£è¡¨ window</li></ul><p>è¾“å‡ºç»“æœä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸å°ç™½åœ¨ç©è€</span><br><span class="line">ä¸å°é»‘åœ¨ç©è€</span><br><span class="line">ä¸å°æ˜åœ¨ç©è€</span><br></pre></td></tr></table></figure><p>ç”¨ç®­å¤´å‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu = &#123;</span><br><span class="line">    name: <span class="string">"å°èŠ±"</span>,</span><br><span class="line">    friends: [<span class="string">"å°ç™½"</span>,<span class="string">"å°é»‘"</span>,<span class="string">"å°æ˜"</span>],</span><br><span class="line">    play() &#123;</span><br><span class="line">        <span class="keyword">this</span>.friends.forEach(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">"ä¸"</span> + e + <span class="string">"åœ¨ç©è€"</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>this.name æ‰€åœ¨çš„å‡½æ•°æ˜¯ç®­å¤´å‡½æ•°ï¼Œå› æ­¤ this è¦çœ‹å®ƒå¤–å±‚çš„ play å‡½æ•°ï¼Œplay åˆæ˜¯å±äº stu çš„æ–¹æ³•ï¼Œå› æ­¤ this ä»£è¡¨ stu å¯¹è±¡</li></ul><p>è¾“å‡ºç»“æœä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å°èŠ±ä¸å°ç™½åœ¨ç©è€</span><br><span class="line">å°èŠ±ä¸å°é»‘åœ¨ç©è€</span><br><span class="line">å°èŠ±ä¸å°æ˜åœ¨ç©è€</span><br></pre></td></tr></table></figure><p>ä¸ç”¨ç®­å¤´å‡½æ•°çš„åšæ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu = &#123;</span><br><span class="line">    name: <span class="string">"å°èŠ±"</span>,</span><br><span class="line">    friends: [<span class="string">"å°ç™½"</span>,<span class="string">"å°é»‘"</span>,<span class="string">"å°æ˜"</span>],</span><br><span class="line">    play() &#123;</span><br><span class="line">        <span class="keyword">let</span> me = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">this</span>.friends.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(me.name + <span class="string">"ä¸"</span> + e + <span class="string">"åœ¨ç©è€"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç‰¹è‰²ï¼šåŸå‹ç»§æ‰¿"><a href="#ç‰¹è‰²ï¼šåŸå‹ç»§æ‰¿" class="headerlink" title="ç‰¹è‰²ï¼šåŸå‹ç»§æ‰¿"></a>ç‰¹è‰²ï¼šåŸå‹ç»§æ‰¿</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> father = &#123;</span><br><span class="line">    f1: <span class="string">'çˆ¶å±æ€§'</span>,</span><br><span class="line">    m1: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"çˆ¶æ–¹æ³•"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> son = <span class="built_in">Object</span>.create(father);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(son.f1);  <span class="comment">// æ‰“å° çˆ¶å±æ€§</span></span><br><span class="line">son.m1();  <span class="comment">// æ‰“å° çˆ¶æ–¹æ³•</span></span><br></pre></td></tr></table></figure><ul><li>father æ˜¯çˆ¶å¯¹è±¡ï¼Œson å»è°ƒç”¨ .m1 æˆ– .f1 æ—¶ï¼Œè‡ªèº«å¯¹è±¡æ²¡æœ‰ï¼Œå°±åˆ°çˆ¶å¯¹è±¡æ‰¾</li><li>son è‡ªå·±å¯ä»¥æ·»åŠ è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•</li><li>son é‡Œæœ‰ç‰¹æ®Šå±æ€§ <code>__proto__</code> ä»£è¡¨å®ƒçš„çˆ¶å¯¹è±¡ï¼Œjs æœ¯è¯­ï¼š son çš„åŸå‹å¯¹è±¡</li><li>ä¸åŒæµè§ˆå™¨å¯¹æ‰“å° son çš„ <code>__proto__</code> å±æ€§æ—¶æ˜¾ç¤ºä¸åŒ<ul><li>Edge æ‰“å° console.dir(son) æ˜¾ç¤º <code>[[Prototype]]</code></li><li>Firefox æ‰“å° console.dir(son) æ˜¾ç¤º <code>&lt;prototype&gt;</code></li></ul></li></ul><h5 id="ç‰¹è‰²ï¼šåŸºäºå‡½æ•°çš„åŸå‹ç»§æ‰¿"><a href="#ç‰¹è‰²ï¼šåŸºäºå‡½æ•°çš„åŸå‹ç»§æ‰¿" class="headerlink" title="ç‰¹è‰²ï¼šåŸºäºå‡½æ•°çš„åŸå‹ç»§æ‰¿"></a>ç‰¹è‰²ï¼šåŸºäºå‡½æ•°çš„åŸå‹ç»§æ‰¿</h5><p>å‡ºäºæ–¹ä¾¿çš„åŸå› ï¼Œjs åˆæä¾›äº†ä¸€ç§åŸºäºå‡½æ•°çš„åŸå‹ç»§æ‰¿</p><blockquote><p><strong>å‡½æ•°èŒè´£</strong></p><ol><li><p>è´Ÿè´£åˆ›å»ºå­å¯¹è±¡ï¼Œç»™å­å¯¹è±¡æä¾›å±æ€§ã€æ–¹æ³•ï¼ŒåŠŸèƒ½ä¸Šç›¸å½“äºæ„é€ æ–¹æ³•</p></li><li><p>å‡½æ•°æœ‰ä¸ªç‰¹æ®Šçš„å±æ€§ prototypeï¼Œå®ƒå°±æ˜¯å‡½æ•°åˆ›å»ºçš„å­å¯¹è±¡çš„çˆ¶å¯¹è±¡</p><p><strong>æ³¨æ„ï¼</strong>åå­—æœ‰å·®å¼‚ï¼Œè¿™ä¸ªå±æ€§çš„ä½œç”¨å°±æ˜¯ä¸ºæ–°å¯¹è±¡æä¾›åŸå‹</p></li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cons</span>(<span class="params">f2</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå­å¯¹è±¡(this), ç»™å­å¯¹è±¡æä¾›å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">this</span>.f2 = f2;</span><br><span class="line">    <span class="keyword">this</span>.m2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"å­æ–¹æ³•"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// cons.prototype å°±æ˜¯çˆ¶å¯¹è±¡</span></span><br><span class="line">cons.prototype.f1 = <span class="string">"çˆ¶å±æ€§"</span>;</span><br><span class="line">cons.prototype.m1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"çˆ¶æ–¹æ³•"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…åˆ new å…³é”®å­—ï¼Œåˆ›å»ºå­å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> cons(<span class="string">"å­å±æ€§"</span>)</span><br></pre></td></tr></table></figure><p>å­å¯¹è±¡çš„ <code>__proto__</code> å°±æ˜¯å‡½æ•°çš„ <code>prototype</code> å±æ€§</p><h5 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h5><p>ä¹‹å‰æˆ‘ä»¬è®² http è¯·æ±‚æ ¼å¼æ—¶ï¼Œè®²è¿‡ json è¿™ç§æ•°æ®æ ¼å¼ï¼Œå®ƒçš„è¯­æ³•çœ‹èµ·æ¥ä¸ js å¯¹è±¡éå¸¸ç›¸ä¼¼ï¼Œä¾‹å¦‚ï¼š</p><p>ä¸€ä¸ª json å¯¹è±¡å¯ä»¥é•¿è¿™æ ·ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>:<span class="string">"å¼ ä¸‰"</span>,</span><br><span class="line">    <span class="attr">"age"</span>:<span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ª js å¯¹è±¡é•¿è¿™æ ·ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    name:<span class="string">"å¼ ä¸‰"</span>,</span><br><span class="line">    age:<span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä»–ä»¬çš„åŒºåˆ«åœ¨å“ªå„¿å‘¢ï¼Ÿæˆ‘æ€»ç»“äº†è¿™ä¹ˆå‡ ç‚¹</p><ol><li>æœ¬è´¨ä¸åŒ<ul><li>json å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒçš„èŒè´£æ˜¯ä½œä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’æ•°æ®çš„ä¸€ç§æ ¼å¼ï¼Œå®ƒçš„å±æ€§åªæ˜¯æ ·å­è´§</li><li>js å¯¹è±¡æ˜¯åˆ‡åˆ‡å®å®çš„å¯¹è±¡ï¼Œå¯ä»¥æœ‰å±æ€§æ–¹æ³•</li></ul></li><li>è¯­æ³•ç»†èŠ‚ä¸åŒ<ul><li>json ä¸­åªèƒ½æœ‰ nullã€true|falseã€æ•°å­—ã€å­—ç¬¦ä¸²ï¼ˆåªæœ‰åŒå¼•å·ï¼‰ã€å¯¹è±¡ã€æ•°ç»„</li><li>json ä¸­ä¸èƒ½æœ‰é™¤ä»¥ä¸Šçš„å…¶å®ƒ js å¯¹è±¡çš„ç‰¹æ€§ï¼Œå¦‚æ–¹æ³•ç­‰</li><li>json ä¸­çš„å±æ€§å¿…é¡»ç”¨åŒå¼•å·å¼•èµ·æ¥</li></ul></li></ol><p>json å­—ç¬¦ä¸²ä¸ js å¯¹è±¡çš„è½¬æ¢</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(jsonå­—ç¬¦ä¸²);  <span class="comment">// è¿”å›jså¯¹è±¡</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(jså¯¹è±¡);  <span class="comment">// è¿”å›jsonå­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure><h3 id="åŠ¨æ€ç±»å‹"><a href="#åŠ¨æ€ç±»å‹" class="headerlink" title="åŠ¨æ€ç±»å‹"></a>åŠ¨æ€ç±»å‹</h3><p>é™æ€ç±»å‹è¯­è¨€ï¼Œå¦‚ Javaï¼Œå€¼æœ‰ç±»å‹ï¼Œå˜é‡ä¹Ÿæœ‰ç±»å‹ã€èµ‹å€¼ç»™å˜é‡æ—¶ï¼Œç±»å‹è¦ç›¸ç¬¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">String b = <span class="string">"abc"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> c = <span class="string">"abc"</span>;  <span class="comment">// é”™è¯¯</span></span><br></pre></td></tr></table></figure><p>è€Œ js å±äºåŠ¨æ€ç±»å‹è¯­è¨€ï¼Œå€¼æœ‰ç±»å‹ï¼Œä½†å˜é‡æ²¡æœ‰ç±»å‹ï¼Œèµ‹å€¼ç»™å˜é‡æ—¶ï¼Œæ²¡è¦æ±‚</p><p>ä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">100</span>;</span><br><span class="line">b = <span class="string">'abc'</span>;</span><br><span class="line">b = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>åŠ¨æ€ç±»å‹çœ‹èµ·æ¥æ¯”è¾ƒçµæ´»ï¼Œä½†å˜é‡æ²¡æœ‰ç±»å‹ï¼Œä¼šç»™åæœŸç»´æŠ¤å¸¦æ¥å›°éš¾ï¼Œä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// obj çš„ç±»å‹æœªçŸ¥ï¼Œå¿…é¡»æ ¹æ®ä¸åŒç±»å‹åšå‡ºç›¸åº”çš„å®¹é”™å¤„ç†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-è¿ç®—ç¬¦ä¸è¡¨è¾¾å¼"><a href="#2-è¿ç®—ç¬¦ä¸è¡¨è¾¾å¼" class="headerlink" title="2. è¿ç®—ç¬¦ä¸è¡¨è¾¾å¼"></a>2. è¿ç®—ç¬¦ä¸è¡¨è¾¾å¼</h2><ul><li><code>+ - * / % **</code></li><li><code>+= -= *= /= %= **=</code></li><li><code>++ --</code></li><li>ä½è¿ç®—ã€ç§»ä½è¿ç®—</li><li><code>== != &gt; &gt;= &lt; &lt;=</code></li><li><code>=== !==</code> :star:</li><li><code>&amp;&amp; || !</code> :star:</li><li><code>?? ?.</code> :star:</li><li><code>...</code> :star:</li><li>è§£æ„èµ‹å€¼ :star:</li></ul><h3 id="1"><a href="#1" class="headerlink" title="1) ==="></a>1) ===</h3><p>ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼Œç”¨ä½œé€»è¾‘åˆ¤ç­‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> == <span class="number">1</span>    <span class="comment">// è¿”å› true </span></span><br><span class="line"><span class="number">1</span> == <span class="string">'1'</span><span class="comment">// è¿”å› trueï¼Œä¼šå…ˆå°†å³ä¾§çš„å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ï¼Œå†åšæ¯”è¾ƒ</span></span><br><span class="line"><span class="number">1</span> === <span class="string">'1'</span><span class="comment">// è¿”å› falseï¼Œç±»å‹ä¸ç­‰ï¼Œç›´æ¥è¿”å› false</span></span><br></pre></td></tr></table></figure><p>typeof æŸ¥çœ‹æŸä¸ªå€¼çš„ç±»å‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="number">1</span><span class="comment">// è¿”å› 'number'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">'1'</span><span class="comment">// è¿”å› 'string'</span></span><br></pre></td></tr></table></figure><h3 id="2"><a href="#2" class="headerlink" title="2) ||"></a>2) ||</h3><p>éœ€æ±‚ï¼Œå¦‚æœå‚æ•° n æ²¡æœ‰ä¼ é€’ï¼Œç»™å®ƒä¸€ä¸ªã€ç”·ã€‘</p><p><strong>æ¨è</strong>åšæ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">n = <span class="string">'ç”·'</span></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½çš„åšæ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        n = <span class="string">'ç”·'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜å¯èƒ½æ˜¯è¿™æ ·</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    n = (n === <span class="literal">undefined</span>) ? <span class="string">'ç”·'</span> : n;</span><br><span class="line">    <span class="built_in">console</span>.log(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€äº›è€æ—§ä»£ç ä¸­å¯èƒ½çš„åšæ³•ï¼ˆä¸æ¨èï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    n = n || <span class="string">'ç”·'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒçš„è¯­æ³•æ˜¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å€¼<span class="number">1</span> || å€¼<span class="number">2</span></span><br></pre></td></tr></table></figure><p>å¦‚æœå€¼1 æ˜¯ Truthyï¼Œè¿”å›å€¼1ï¼Œå¦‚æœå€¼1 æ˜¯ Falsy è¿”å›å€¼ 2</p><h3 id="3-ä¸"><a href="#3-ä¸" class="headerlink" title="3) ?? ä¸ ?."></a>3) ?? ä¸ ?.</h3><h4 id><a href="#" class="headerlink" title="??"></a>??</h4><p>éœ€æ±‚ï¼Œå¦‚æœå‚æ•° n æ²¡æœ‰ä¼ é€’æˆ–æ˜¯ nullï¼Œç»™å®ƒä¸€ä¸ªã€ç”·ã€‘</p><p>å¦‚æœç”¨ä¼ ç»ŸåŠæ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n === <span class="literal">undefined</span> || n === <span class="literal">null</span>) &#123;</span><br><span class="line">        n = <span class="string">'ç”·'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨ ??</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    n = n ?? <span class="string">'ç”·'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯­æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å€¼1 ?? å€¼2</span><br></pre></td></tr></table></figure><ul><li>å€¼1 æ˜¯ nullishï¼Œè¿”å›å€¼2</li><li>å€¼1 ä¸æ˜¯ nullishï¼Œè¿”å›å€¼1</li></ul><h4 id="-1"><a href="#-1" class="headerlink" title="?."></a>?.</h4><p>éœ€æ±‚ï¼Œå‡½æ•°å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯èƒ½åŒ…å«æœ‰å­å±æ€§</p><p>ä¾‹å¦‚ï¼Œå‚æ•°å¯èƒ½æ˜¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu1 = &#123;</span><br><span class="line">    name:<span class="string">"å¼ ä¸‰"</span>,</span><br><span class="line">    address: &#123;</span><br><span class="line">        city: <span class="string">'åŒ—äº¬'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stu2 = &#123;</span><br><span class="line">    name:<span class="string">"æå››"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stu3 = &#123;</span><br><span class="line">    name:<span class="string">"æå››"</span>,</span><br><span class="line">    address: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¦è®¿é—®å­å±æ€§ï¼ˆæœ‰é—®é¢˜ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">stu</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(stu.address.city)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å¸Œæœ›å½“æŸä¸ªå±æ€§æ˜¯ nullish æ—¶ï¼ŒçŸ­è·¯å¹¶è¿”å› undefinedï¼Œå¯ä»¥ç”¨ ?.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">stu</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(stu.address?.city)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨ä¼ ç»ŸåŠæ³• </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">stu</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(stu.address === <span class="literal">undefined</span> || stu.address === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="literal">undefined</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(stu.address.city)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-â€¦"><a href="#4-â€¦" class="headerlink" title="4) â€¦"></a>4) â€¦</h3><p>å±•å¼€è¿ç®—ç¬¦</p><p>ä½œç”¨1ï¼šæ‰“æ•£æ•°ç»„ï¼ŒæŠŠå…ƒç´ ä¼ é€’ç»™å¤šä¸ªå‚æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a,b,c</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a,b,c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€æ±‚ï¼ŒæŠŠæ•°ç»„å…ƒç´ ä¾æ¬¡ä¼ é€’ç»™å‡½æ•°å‚æ•°</p><p>ä¼ ç»Ÿå†™æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test(arr[<span class="number">0</span>],arr[<span class="number">1</span>],arr[<span class="number">2</span>]);<span class="comment">// è¾“å‡º 1,2,3</span></span><br></pre></td></tr></table></figure><p>å±•å¼€è¿ç®—ç¬¦å†™æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test(...arr);<span class="comment">// è¾“å‡º 1,2,3</span></span><br></pre></td></tr></table></figure><ul><li>æ‰“æ•£å¯ä»¥ç†è§£ä¸ºã€å»æ‰äº†ã€‘æ•°ç»„å¤–ä¾§çš„ä¸­æ‹¬å·ï¼Œåªå‰©ä¸‹æ•°ç»„å…ƒç´ </li></ul><p>ä½œç”¨2ï¼šå¤åˆ¶æ•°ç»„æˆ–å¯¹è±¡</p><p>æ•°ç»„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = [...arr1];<span class="comment">// å¤åˆ¶æ•°ç»„</span></span><br></pre></td></tr></table></figure><p>å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;<span class="attr">name</span>:<span class="string">'å¼ ä¸‰'</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;...obj1&#125;;<span class="comment">// å¤åˆ¶å¯¹è±¡</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šå±•å¼€è¿ç®—ç¬¦å¤åˆ¶å±äºæµ…æ‹·è´ï¼Œä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;<span class="attr">name</span>:<span class="string">'å¼ ä¸‰'</span>, <span class="attr">address</span>: &#123;<span class="attr">city</span>: <span class="string">'åŒ—äº¬'</span>&#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> o2 = &#123;...o1&#125;;</span><br></pre></td></tr></table></figure><p>ä½œç”¨3ï¼šåˆå¹¶æ•°ç»„æˆ–å¯¹è±¡</p><p>åˆå¹¶æ•°ç»„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = [<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line"><span class="keyword">let</span> a2 = [<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b1 = [...a1,...a2];<span class="comment">// ç»“æœ [1,2,3,4]</span></span><br><span class="line"><span class="keyword">let</span> b2 = [...a2,<span class="number">5</span>,...a1]<span class="comment">// ç»“æœ [3,4,5,1,2]</span></span><br></pre></td></tr></table></figure><p>åˆå¹¶å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;<span class="attr">name</span>:<span class="string">'å¼ ä¸‰'</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">age</span>:<span class="number">18</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> o3 = &#123;<span class="attr">name</span>:<span class="string">'æå››'</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> n1 = &#123;...o1, ...o2&#125;;<span class="comment">// ç»“æœ &#123;name:'å¼ ä¸‰',age:18&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> n2 = &#123;...o3, ...o2, ...o1&#125;; <span class="comment">// ç»“æœ&#123;name:'æå››',age:18&#125;</span></span><br></pre></td></tr></table></figure><ul><li>å¤åˆ¶å¯¹è±¡æ—¶å‡ºç°åŒåå±æ€§ï¼Œåé¢çš„ä¼šè¦†ç›–å‰é¢çš„</li></ul><h3 id="5"><a href="#5" class="headerlink" title="5) [] {}"></a>5) [] {}</h3><p>è§£æ„èµ‹å€¼</p><h4 id="-2"><a href="#-2" class="headerlink" title="[]"></a>[]</h4><p>ç”¨åœ¨å£°æ˜å˜é‡æ—¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a, b, c] = arr;<span class="comment">// ç»“æœ a=1, b=2, c=3</span></span><br></pre></td></tr></table></figure><p>ç”¨åœ¨å£°æ˜å‚æ•°æ—¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">[a,b,c]</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a,b,c) <span class="comment">// ç»“æœ a=1, b=2, c=3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(arr);</span><br></pre></td></tr></table></figure><h4 id="-3"><a href="#-3" class="headerlink" title="{}"></a>{}</h4><p>ç”¨åœ¨å£°æ˜å˜é‡æ—¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">name</span>:<span class="string">"å¼ ä¸‰"</span>, <span class="attr">age</span>:<span class="number">18</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;name,age&#125; = obj;<span class="comment">// ç»“æœ name=å¼ ä¸‰, age=18</span></span><br></pre></td></tr></table></figure><p>ç”¨åœ¨å£°æ˜å‚æ•°æ—¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">name</span>:<span class="string">"å¼ ä¸‰"</span>, <span class="attr">age</span>:<span class="number">18</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">&#123;name, age&#125;</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, age); <span class="comment">// ç»“æœ name=å¼ ä¸‰, age=18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(obj)</span><br></pre></td></tr></table></figure><h2 id="3-æ§åˆ¶è¯­å¥"><a href="#3-æ§åˆ¶è¯­å¥" class="headerlink" title="3. æ§åˆ¶è¯­å¥"></a>3. æ§åˆ¶è¯­å¥</h2><ul><li><code>if ... else</code></li><li><code>switch</code></li><li><code>while</code></li><li><code>do ... while</code></li><li><code>for</code> </li><li><code>for ... in</code> :star:</li><li><code>for ... of</code> :star:</li><li><code>try ... catch</code> :star:</li></ul><h3 id="1-for-in"><a href="#1-for-in" class="headerlink" title="1) for in"></a>1) for in</h3><p>ä¸»è¦ç”¨æ¥éå†å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> father = &#123;<span class="attr">name</span>:<span class="string">'å¼ ä¸‰'</span>, <span class="attr">age</span>:<span class="number">18</span>, <span class="attr">study</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> n <span class="keyword">in</span> father) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…¶ä¸­ const n ä»£è¡¨éå†å‡ºæ¥çš„å±æ€§å</li><li>æ³¨æ„1ï¼šæ–¹æ³•åä¹Ÿèƒ½è¢«éå†å‡ºæ¥ï¼ˆå®ƒå…¶å®ä¹Ÿç®—ä¸€ç§ç‰¹æ®Šå±æ€§ï¼‰</li><li>æ³¨æ„2ï¼šéå†å­å¯¹è±¡æ—¶ï¼Œçˆ¶å¯¹è±¡çš„å±æ€§ä¼šè·Ÿç€éå†å‡ºæ¥</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> son = <span class="built_in">Object</span>.create(father);</span><br><span class="line">son.sex = <span class="string">"ç”·"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> n <span class="keyword">in</span> son) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„3ï¼šåœ¨ for in å†…è·å–å±æ€§å€¼ï¼Œè¦ä½¿ç”¨ [] è¯­æ³•ï¼Œè€Œä¸èƒ½ç”¨ . è¯­æ³•</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> n <span class="keyword">in</span> son) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(n, son[n]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-for-of"><a href="#2-for-of" class="headerlink" title="2) for of"></a>2) for of</h3><p>ä¸»è¦ç”¨æ¥éå†æ•°ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒå¯è¿­ä»£å¯¹è±¡ï¼Œå¦‚ Mapï¼ŒSet ç­‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> i <span class="keyword">of</span> a1) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a2 = [</span><br><span class="line">    &#123;<span class="attr">name</span>:<span class="string">'å¼ ä¸‰'</span>, <span class="attr">age</span>:<span class="number">18</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>:<span class="string">'æå››'</span>, <span class="attr">age</span>:<span class="number">20</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>:<span class="string">'ç‹äº”'</span>, <span class="attr">age</span>:<span class="number">22</span>&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> obj <span class="keyword">of</span> a2) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(obj.name, obj.age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> &#123;name,age&#125; <span class="keyword">of</span> a2) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-try-catch"><a href="#3-try-catch" class="headerlink" title="3) try catch"></a>3) try catch</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stu1 = &#123;<span class="attr">name</span>:<span class="string">'å¼ ä¸‰'</span>, <span class="attr">age</span>:<span class="number">18</span>, <span class="attr">address</span>: &#123;<span class="attr">city</span>:<span class="string">'åŒ—äº¬'</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> stu2 = &#123;<span class="attr">name</span>:<span class="string">'å¼ ä¸‰'</span>, <span class="attr">age</span>:<span class="number">18</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">stu</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(stu.address.city)   </span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'å‡ºç°äº†å¼‚å¸¸'</span>, e.message)</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'finally'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-API"><a href="#4-API" class="headerlink" title="4. API"></a>4. API</h2><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><h4 id="1-å®‰è£…-nvm"><a href="#1-å®‰è£…-nvm" class="headerlink" title="1) å®‰è£… nvm"></a>1) å®‰è£… nvm</h4><p>nvm å³ (node version manager)ï¼Œå¥½å¤„æ˜¯æ–¹ä¾¿åˆ‡æ¢ node.js ç‰ˆæœ¬</p><p>å®‰è£…æ³¨æ„äº‹é¡¹</p><ol><li>è¦å¸è½½æ‰ç°æœ‰çš„ nodejs</li><li>æç¤ºé€‰æ‹© nvm å’Œ nodejs ç›®å½•æ—¶ï¼Œä¸€å®šè¦é¿å…ç›®å½•ä¸­å‡ºç°ç©ºæ ¼</li><li>é€‰ç”¨ã€ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€‘cmd ç¨‹åºæ¥æ‰§è¡Œ nvm å‘½ä»¤</li><li>é¦–æ¬¡è¿è¡Œå‰è®¾ç½®å¥½å›½å†…é•œåƒåœ°å€</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nvm node_mirror http://npm.taobao.org/mirrors/node/</span><br><span class="line">nvm npm_mirror https://npm.taobao.org/mirrors/npm/</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæŸ¥çœ‹æœ‰å“ªäº›å¯ç”¨ç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm list available</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">|   CURRENT    |     LTS      |  OLD STABLE  | OLD UNSTABLE |</span><br><span class="line">|--------------|--------------|--------------|--------------|</span><br><span class="line">|    18.7.0    |   16.16.0    |   0.12.18    |   0.11.16    |</span><br><span class="line">|    18.6.0    |   16.15.1    |   0.12.17    |   0.11.15    |</span><br><span class="line">|    18.5.0    |   16.15.0    |   0.12.16    |   0.11.14    |</span><br><span class="line">|    18.4.0    |   16.14.2    |   0.12.15    |   0.11.13    |</span><br><span class="line">|    18.3.0    |   16.14.1    |   0.12.14    |   0.11.12    |</span><br><span class="line">|    18.2.0    |   16.14.0    |   0.12.13    |   0.11.11    |</span><br><span class="line">|    18.1.0    |   16.13.2    |   0.12.12    |   0.11.10    |</span><br><span class="line">|    18.0.0    |   16.13.1    |   0.12.11    |    0.11.9    |</span><br><span class="line">|    17.9.1    |   16.13.0    |   0.12.10    |    0.11.8    |</span><br><span class="line">|    17.9.0    |   14.20.0    |    0.12.9    |    0.11.7    |</span><br><span class="line">|    17.8.0    |   14.19.3    |    0.12.8    |    0.11.6    |</span><br><span class="line">|    17.7.2    |   14.19.2    |    0.12.7    |    0.11.5    |</span><br><span class="line">|    17.7.1    |   14.19.1    |    0.12.6    |    0.11.4    |</span><br><span class="line">|    17.7.0    |   14.19.0    |    0.12.5    |    0.11.3    |</span><br><span class="line">|    17.6.0    |   14.18.3    |    0.12.4    |    0.11.2    |</span><br><span class="line">|    17.5.0    |   14.18.2    |    0.12.3    |    0.11.1    |</span><br><span class="line">|    17.4.0    |   14.18.1    |    0.12.2    |    0.11.0    |</span><br><span class="line">|    17.3.1    |   14.18.0    |    0.12.1    |    0.9.12    |</span><br><span class="line">|    17.3.0    |   14.17.6    |    0.12.0    |    0.9.11    |</span><br><span class="line">|    17.2.0    |   14.17.5    |   0.10.48    |    0.9.10    |</span><br></pre></td></tr></table></figure><p>å»ºè®®å®‰è£… LTSï¼ˆé•¿æœŸæ”¯æŒç‰ˆï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nvm install 16.16.0</span><br><span class="line">nvm install 14.20.0</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>nvm list</code> ä¼šåˆ—å‡ºå·²å®‰è£…ç‰ˆæœ¬</p><p>åˆ‡æ¢åˆ° 16.16.0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm use 16.16.0</span><br></pre></td></tr></table></figure><p>åˆ‡æ¢åˆ° 14.20.0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm use 14.20.0</span><br></pre></td></tr></table></figure><p>å®‰è£…å nvm è‡ªå·±çš„ç¯å¢ƒå˜é‡ä¼šè‡ªåŠ¨æ·»åŠ ï¼Œä½†å¯èƒ½éœ€è¦æ‰‹å·¥æ·»åŠ  nodejs çš„ PATH ç¯å¢ƒå˜é‡</p><h4 id="2-æ£€æŸ¥-npm"><a href="#2-æ£€æŸ¥-npm" class="headerlink" title="2) æ£€æŸ¥ npm"></a>2) æ£€æŸ¥ npm</h4><p>npm æ˜¯ js çš„åŒ…ç®¡ç†å™¨ï¼Œå°±ç±»ä¼¼äº java ç•Œçš„ mavenï¼Œè¦ç¡®ä¿å®ƒä½¿ç”¨çš„æ˜¯å›½å†…é•œåƒ</p><p>æ£€æŸ¥é•œåƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm get registry</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿”å›çš„ä¸æ˜¯ <code>https://registry.npm.taobao.org/</code>ï¼Œéœ€è¦åšå¦‚ä¸‹è®¾ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org/</span><br></pre></td></tr></table></figure><h4 id="3-æ­å»ºå‰ç«¯æœåŠ¡å™¨"><a href="#3-æ­å»ºå‰ç«¯æœåŠ¡å™¨" class="headerlink" title="3) æ­å»ºå‰ç«¯æœåŠ¡å™¨"></a>3) æ­å»ºå‰ç«¯æœåŠ¡å™¨</h4><p>æ–°å»ºä¸€ä¸ªä¿å­˜é¡¹ç›®çš„ client æ–‡ä»¶å¤¹ï¼Œè¿›å…¥æ–‡ä»¶å¤¹æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express --save-dev</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ package.json æ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"module"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"express"</span>: <span class="string">"^4.18.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…¶ä¸­ devDependencies æ˜¯ npm install â€“save-dev æ·»åŠ çš„</li></ul><p>ç¼–å†™ main.js ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">'express'</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(express.static(<span class="string">'./'</span>))</span><br><span class="line">app.listen(<span class="number">7070</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ js ä»£ç ï¼ˆè¿è¡Œå‰ç«¯æœåŠ¡å™¨ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node main.js</span><br></pre></td></tr></table></figure><h3 id="å‰ç«¯æ¡ˆä¾‹"><a href="#å‰ç«¯æ¡ˆä¾‹" class="headerlink" title="å‰ç«¯æ¡ˆä¾‹"></a>å‰ç«¯æ¡ˆä¾‹</h3><p>åˆæ­¥æ•ˆæœ</p><p><img src="https://s1.ax1x.com/2022/10/21/xcKwEF.png" alt="image-20220812103323220"></p><p>æ¶æ„</p><p><img src="https://s1.ax1x.com/2022/10/21/xcKNuV.png" alt="image-20220812103219916"></p><ul><li>å‰ç«¯åªæœ‰é™æ€é¡µé¢ï¼Œä½¿ç”¨ Express æœåŠ¡å™¨</li><li>åç«¯ä½¿ç”¨ Tomcat æœåŠ¡å™¨ï¼Œé€šè¿‡ SpringBootã€MyBatis ç­‰æ¡†æ¶è·å–æ•°æ®åº“æ•°æ®</li></ul><h4 id="1-æŸ¥æ‰¾å…ƒç´ "><a href="#1-æŸ¥æ‰¾å…ƒç´ " class="headerlink" title="1) æŸ¥æ‰¾å…ƒç´ "></a>1) æŸ¥æ‰¾å…ƒç´ </h4><ul><li>document.getElementById - æ ¹æ® id å€¼æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ </li><li>[document|å…ƒç´ ].querySelector - æ ¹æ®é€‰æ‹©å™¨æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…å…ƒç´ </li><li>[document|å…ƒç´ ].querySelectorAll - æ ¹æ®é€‰æ‹©å™¨æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…å…ƒç´ </li></ul><p>ä¾‹å¦‚ï¼Œæœ‰ä¸‹é¢çš„ html ä»£ç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>å­¦ç”Ÿåˆ—è¡¨<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"thead"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row bold"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>ç¼–å·<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>å§“å<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>æ€§åˆ«<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>å¹´é¾„<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tbody"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>å¼ ä¸‰<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>ç”·<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>18<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'.title'</span>); <span class="comment">// æ‰¾åˆ° &lt;div class="title"&gt;å­¦ç”Ÿåˆ—è¡¨&lt;/div&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'.col'</span>); <span class="comment">// æ‰¾åˆ° &lt;div class="col"&gt;ç¼–å·&lt;/div&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelectorAll(<span class="string">'.col'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  æ‰¾åˆ°çš„æ˜¯ä¸€ä¸ªé›†åˆ</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;ç¼–å·&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;å§“å&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;æ€§åˆ«&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;å¹´é¾„&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;1&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;å¼ ä¸‰&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;ç”·&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;18&lt;/div&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> thead = <span class="built_in">document</span>.querySelector(<span class="string">'.thead'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªåœ¨ thead å…ƒç´ èŒƒå›´å†…æ‰¾</span></span><br><span class="line">thead.querySelectorAll(<span class="string">'.col'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  æ‰¾åˆ°çš„æ˜¯ä¸€ä¸ªé›†åˆ</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;ç¼–å·&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;å§“å&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;æ€§åˆ«&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  &lt;div class="col"&gt;å¹´é¾„&lt;/div&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æ ¹æ® id å±æ€§æŸ¥æ‰¾æ—¢å¯ä»¥ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"idå€¼"</span>)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">"#idå€¼"</span>)</span><br></pre></td></tr></table></figure><h4 id="2-ä¿®æ”¹å…ƒç´ å†…å®¹"><a href="#2-ä¿®æ”¹å…ƒç´ å†…å®¹" class="headerlink" title="2) ä¿®æ”¹å…ƒç´ å†…å®¹"></a>2) ä¿®æ”¹å…ƒç´ å†…å®¹</h4><ul><li>å…ƒç´ .innerHTML</li><li>å…ƒç´ .textContent</li></ul><p>ä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'.title'</span>).innerHTML = <span class="string">'ä¾ å®¢åˆ—è¡¨'</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœ</p><p><img src="https://s1.ax1x.com/2022/10/21/xcKUBT.png" alt="image-20220812161003958"></p><p>innerHTML  ä¼šè§£æå†…å®¹ä¸­çš„æ ‡ç­¾ï¼Œä¾‹å¦‚</p><p><img src="https://s1.ax1x.com/2022/10/21/xcK0N4.png" alt="image-20220812161137912"></p><p>textContext ä¸ä¼šè§£æå†…å®¹ä¸­çš„æ ‡ç­¾</p><p><img src="https://s1.ax1x.com/2022/10/21/xcKaHU.png" alt="image-20220812161341825"></p><p>ç»™ innerHTML æˆ– textContent èµ‹å€¼ç©ºä¸²ï¼Œå¯ä»¥å®ç°æ¸…ç©ºæ ‡ç­¾å†…å®¹çš„æ•ˆæœ</p><h4 id="3-åˆ©ç”¨æ¨¡æ¿"><a href="#3-åˆ©ç”¨æ¨¡æ¿" class="headerlink" title="3) åˆ©ç”¨æ¨¡æ¿"></a>3) åˆ©ç”¨æ¨¡æ¿</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>å­¦ç”Ÿåˆ—è¡¨<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"thead"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row bold"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>ç¼–å·<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>å§“å<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>æ€§åˆ«<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>å¹´é¾„<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tbody"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">"tp"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>xx<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>xx<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>xx<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span>xx<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// å°†æ¥è¿™äº›æ•°æ®ä» java ç«¯è¿”å›</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> array = [</span></span><br><span class="line"><span class="javascript">        &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'å¼ ä¸‰'</span>, <span class="attr">sex</span>: <span class="string">'ç”·'</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;,</span></span><br><span class="line"><span class="javascript">        &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">'æå››'</span>, <span class="attr">sex</span>: <span class="string">'å¥³'</span>, <span class="attr">age</span>: <span class="number">17</span> &#125;</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> tp = <span class="built_in">document</span>.getElementById(<span class="string">"tp"</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> row = tp.content;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> [c1,c2,c3,c4] = row.querySelectorAll(<span class="string">".col"</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> tbody = <span class="built_in">document</span>.querySelector(<span class="string">'.tbody'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span>(<span class="keyword">const</span> &#123;id,name,sex,age&#125; <span class="keyword">of</span> array) &#123;</span></span><br><span class="line">        c1.textContent = id;</span><br><span class="line">        c2.textContent = name;</span><br><span class="line">        c3.textContent = sex;</span><br><span class="line">        c4.textContent = age;</span><br><span class="line"><span class="javascript">        <span class="comment">// å¤åˆ¶å…ƒç´ </span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> newRow = <span class="built_in">document</span>.importNode(row, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// å»ºç«‹çˆ¶å­å…³ç³»ï¼Œå·¦è¾¹çˆ¶ï¼Œå³è¾¹å­</span></span></span><br><span class="line">        tbody.appendChild(newRow);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-Fetch-API"><a href="#4-Fetch-API" class="headerlink" title="4) Fetch API"></a>4) Fetch API</h4><p>Fetch API å¯ä»¥ç”¨æ¥è·å–è¿œç¨‹æ•°æ®ï¼Œå®ƒæœ‰ä¸¤ç§æ–¹å¼æ¥æ”¶ç»“æœï¼ŒåŒæ­¥æ–¹å¼ä¸å¼‚æ­¥æ–¹å¼</p><p>æ ¼å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(url, options) <span class="comment">// è¿”å› Promise</span></span><br></pre></td></tr></table></figure><p>åŒæ­¥æ–¹å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ç»“æœ = <span class="keyword">await</span> <span class="built_in">Promise</span></span><br><span class="line"><span class="comment">// åç»­ä»£ç </span></span><br></pre></td></tr></table></figure><ul><li>await å…³é”®å­—å¿…é¡»åœ¨ä¸€ä¸ªæ ‡è®°äº† async çš„ function å†…æ¥ä½¿ç”¨</li><li>åç»­ä»£ç ä¸ä¼šåœ¨ç»“æœè¿”å›å‰æ‰§è¡Œ</li></ul><p>å¼‚æ­¥æ–¹å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span></span><br><span class="line">.then(ç»“æœ =&gt; &#123; ... &#125;)</span><br><span class="line"><span class="comment">// åç»­ä»£ç </span></span><br></pre></td></tr></table></figure><ul><li>åç»­ä»£ç ä¸å¿…ç­‰å¾…ç»“æœè¿”å›å°±å¯ä»¥æ‰§è¡Œ</li></ul><p>ä¾‹ï¼š</p><p>åœ¨ express æœåŠ¡å™¨ä¸Šæœ‰ students.json æ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="number">1</span>, <span class="attr">"name"</span>: <span class="string">"å¼ ä¸‰"</span>, <span class="attr">"sex"</span>: <span class="string">"ç”·"</span>, <span class="attr">"age"</span>: <span class="number">18</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="number">2</span>, <span class="attr">"name"</span>: <span class="string">"æå››"</span>, <span class="attr">"sex"</span>: <span class="string">"å¥³"</span>, <span class="attr">"age"</span>: <span class="number">17</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç”¨ fetch api è·å–è¿™äº›æ•°æ®ï¼Œå¹¶å±•ç¤º</p><p>åŒæ­¥æ–¹å¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">findStudents</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// è·å–å“åº”å¯¹è±¡</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(<span class="string">'students.json'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="comment">// è·å–å“åº”ä½“, æŒ‰jsonæ ¼å¼è½¬æ¢ä¸ºjsæ•°ç»„</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> array = <span class="keyword">await</span> resp.json();</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="comment">// æ˜¾ç¤ºæ•°æ®</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> tp = <span class="built_in">document</span>.getElementById(<span class="string">"tp"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> row = tp.content;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> [c1,c2,c3,c4] = row.querySelectorAll(<span class="string">".col"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> tbody = <span class="built_in">document</span>.querySelector(<span class="string">'.tbody'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">const</span> &#123;id,name,sex,age&#125; <span class="keyword">of</span> array) &#123;</span></span><br><span class="line">                c1.textContent = id;</span><br><span class="line">                c2.textContent = name;</span><br><span class="line">                c3.textContent = sex;</span><br><span class="line">                c4.textContent = age;</span><br><span class="line"><span class="javascript">                <span class="comment">// å¤åˆ¶å…ƒç´ </span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> newRow = <span class="built_in">document</span>.importNode(row, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">                <span class="comment">// å»ºç«‹çˆ¶å­å…³ç³»</span></span></span><br><span class="line">                tbody.appendChild(newRow);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(e);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    findStudents()</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>fetch(â€˜students.jsonâ€™) å†…éƒ¨ä¼šå‘é€è¯·æ±‚ï¼Œä½†å“åº”ç»“æœä¸èƒ½ç«‹åˆ»è¿”å›ï¼Œå› æ­¤ await å°±æ˜¯ç­‰å¾…å“åº”ç»“æœè¿”å›</li><li>å…¶ä¸­ resp.json() ä¹Ÿä¸æ˜¯ç«‹åˆ»èƒ½è¿”å›ç»“æœï¼Œå®ƒè¿”å›çš„ä¹Ÿæ˜¯ Promise å¯¹è±¡ï¼Œä¹Ÿè¦é…åˆ await å–ç»“æœ</li></ul><p>å¼‚æ­¥æ–¹å¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    fetch(<span class="string">'students.json'</span>)</span></span><br><span class="line"><span class="javascript">        .then( <span class="function"><span class="params">resp</span> =&gt;</span> resp.json() )</span></span><br><span class="line"><span class="javascript">        .then( <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// æ˜¾ç¤ºæ•°æ®</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> tp = <span class="built_in">document</span>.getElementById(<span class="string">"tp"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> row = tp.content;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> [c1,c2,c3,c4] = row.querySelectorAll(<span class="string">".col"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> tbody = <span class="built_in">document</span>.querySelector(<span class="string">'.tbody'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">const</span> &#123;id,name,sex,age&#125; <span class="keyword">of</span> array) &#123;</span></span><br><span class="line">                c1.textContent = id;</span><br><span class="line">                c2.textContent = name;</span><br><span class="line">                c3.textContent = sex;</span><br><span class="line">                c4.textContent = age;</span><br><span class="line"><span class="javascript">                <span class="comment">// å¤åˆ¶å…ƒç´ </span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> newRow = <span class="built_in">document</span>.importNode(row, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">                <span class="comment">// å»ºç«‹çˆ¶å­å…³ç³»</span></span></span><br><span class="line">                tbody.appendChild(newRow);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="javascript">        .catch( <span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(e) )</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ª then æ˜¯åœ¨å“åº”è¿”å›åï¼Œæ‰ä¼šè°ƒç”¨å®ƒé‡Œé¢çš„ç®­å¤´å‡½æ•°ï¼Œç®­å¤´å‡½æ•°å‚æ•°å³ resp  å“åº”å¯¹è±¡</li><li>ç¬¬äºŒä¸ª then æ˜¯åœ¨ json è§£æå®Œæˆåï¼Œæ‰ä¼šè°ƒç”¨å®ƒé‡Œé¢çš„ç®­å¤´å‡½æ•°ï¼Œç®­å¤´å‡½æ•°å‚æ•°å³è§£æç»“æœï¼ˆæœ¬ä¾‹æ˜¯ array æ•°ç»„ï¼‰</li><li>ä¸Šä¸€ä¸ª then è¿”å›çš„æ˜¯ Promise å¯¹è±¡æ—¶ï¼Œæ‰èƒ½é“¾å¼è°ƒç”¨ä¸‹ä¸€ä¸ª then</li></ul><h5 id="è·¨åŸŸé—®é¢˜"><a href="#è·¨åŸŸé—®é¢˜" class="headerlink" title="è·¨åŸŸé—®é¢˜"></a>è·¨åŸŸé—®é¢˜</h5><p><img src="https://s1.ax1x.com/2022/10/21/xcKB4J.png" alt="image-20220814105448882"></p><ul><li>åªè¦åè®®ã€ä¸»æœºã€ç«¯å£ä¹‹ä¸€ä¸åŒï¼Œå°±ä¸åŒæºï¼Œä¾‹å¦‚<ul><li><a href="http://localhost:7070/a" target="_blank" rel="noopener">http://localhost:7070/a</a> å’Œ <a href="https://localhost:7070/b" target="_blank" rel="noopener">https://localhost:7070/b</a> å°±ä¸åŒæº</li></ul></li><li>åŒæºæ£€æŸ¥æ˜¯æµè§ˆå™¨çš„è¡Œä¸ºï¼Œè€Œä¸”åªé’ˆå¯¹ fetchã€xhr è¯·æ±‚<ul><li>å¦‚æœæ˜¯å…¶å®ƒå®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ java http clientï¼Œpostmanï¼Œå®ƒä»¬æ˜¯ä¸åšåŒæºæ£€æŸ¥çš„</li><li>é€šè¿‡è¡¨å•æäº¤ã€æµè§ˆå™¨ç›´æ¥è¾“å…¥ url åœ°å€è¿™äº›æ–¹å¼å‘é€çš„è¯·æ±‚ï¼Œä¹Ÿä¸ä¼šåšåŒæºæ£€æŸ¥</li></ul></li><li>æ›´å¤šç›¸å…³çŸ¥è¯†è¯·å‚è€ƒ<ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS" target="_blank" rel="noopener">è·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰ - HTTP | MDN (mozilla.org)</a></li></ul></li></ul><p>è¯·æ±‚å“åº”å¤´è§£å†³</p><p><img src="https://s1.ax1x.com/2022/10/21/xcKrC9.png" alt="image-20220814144040703"></p><ul><li>fetch è¯·æ±‚è·¨åŸŸï¼Œä¼šæºå¸¦ä¸€ä¸ª Origin å¤´ï¼Œä»£è¡¨ã€å‘è¯·æ±‚çš„èµ„æºæºè‡ªä½•å¤„ã€‘ï¼Œç›®æ ‡é€šè¿‡å®ƒå°±èƒ½è¾¨åˆ«æ˜¯å¦å‘ç”Ÿè·¨åŸŸ<ul><li>æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼šstudent.html å‘é€ fetch è¯·æ±‚ï¼Œå‘Šè¯‰ tomcatï¼Œæˆ‘æºè‡ª localhost:7070</li></ul></li><li>ç›®æ ‡èµ„æºé€šè¿‡è¿”å› Access-Control-Allow-Origin å¤´ï¼Œå‘Šè¯‰æµè§ˆå™¨ã€å…è®¸å“ªäº›æºä½¿ç”¨æ­¤å“åº”ã€‘<ul><li>æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼štomcat è¿”å› fetch å“åº”ï¼Œå‘Šè¯‰æµè§ˆå™¨ï¼Œè¿™ä¸ªå“åº”å…è®¸æºè‡ª localhost:7070 çš„èµ„æºä½¿ç”¨</li></ul></li></ul><p>ä»£ç†è§£å†³</p><p><img src="https://s1.ax1x.com/2022/10/21/xcKTgI.png" alt="image-20220814161532141"></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install http-proxy-middleware --save-dev</span><br></pre></td></tr></table></figure><p>åœ¨ express æœåŠ¡å™¨å¯åŠ¨ä»£ç ä¸­åŠ å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createProxyMiddleware&#125; <span class="keyword">from</span> <span class="string">'http-proxy-middleware'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/api'</span>, createProxyMiddleware(&#123; <span class="attr">target</span>: <span class="string">'http://localhost:8080'</span>, <span class="attr">changeOrigin</span>: <span class="literal">true</span> &#125;));</span><br></pre></td></tr></table></figure><p>fetch ä»£ç æ”¹ä¸º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(<span class="string">'http://localhost:7070/api/students'</span>)</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(<span class="string">'/api/students'</span>)</span><br></pre></td></tr></table></figure><h4 id="5-æ¨¡å—åŒ–"><a href="#5-æ¨¡å—åŒ–" class="headerlink" title="5) æ¨¡å—åŒ–"></a>5) æ¨¡å—åŒ–</h4><p>å•ä¸ªå¯¼å‡º constã€letã€function</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> b = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'c'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€é½å¯¼å‡º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">20</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'c'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;a,b,c&#125;</span><br></pre></td></tr></table></figure><p>å¯¼å‡º defaultï¼Œåªèƒ½æœ‰ä¸€ä¸ª</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> b = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'c'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> b;</span><br></pre></td></tr></table></figure><p>import è¯­æ³•</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> è¯­å¥</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>import éœ€è¦éµå¾ªåŒæºç­–ç•¥</li></ul><p>æ•´ä¸ªå¯¼å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="built_in">module</span> <span class="keyword">from</span> <span class="string">'/1.js'</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.a)<span class="comment">// è¾“å‡º10</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.b)<span class="comment">// è¾“å‡º20</span></span><br><span class="line"><span class="built_in">module</span>.c()<span class="comment">// è¾“å‡ºc</span></span><br></pre></td></tr></table></figure><p>å•ä¸ªå¯¼å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;a,c&#125; <span class="keyword">from</span> <span class="string">'/1.js'</span></span><br><span class="line"><span class="built_in">console</span>.log(a)<span class="comment">// è¾“å‡º10</span></span><br><span class="line">c()<span class="comment">// è¾“å‡ºc</span></span><br></pre></td></tr></table></figure><p>å¯¼å…¥é»˜è®¤</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> x <span class="keyword">from</span> <span class="string">'/1.js'</span></span><br><span class="line"><span class="built_in">console</span>.log(x)<span class="comment">// è¾“å‡º20</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysqlä¸»ä»å¤åˆ¶â€”â€”â€”â€”åŸºäºDockerçš„å®ç°</title>
      <link href="/2022/09/21/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
      <url>/2022/09/21/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="ä¸»åº“"><a href="#ä¸»åº“" class="headerlink" title="ä¸»åº“"></a>ä¸»åº“</h2><p><strong>ä¸»åº“é‡‡ç”¨è¿œç¨‹æœåŠ¡å™¨ä¸­å®‰è£…çš„Mysql 8.0.26</strong></p><h3 id="Step1-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#Step1-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="Step1 ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>Step1 ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>viæ‰“å¼€/etc/my.cnfå†™å…¥ğŸ‘‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log-bin=mysql-bin   #[å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">server-id=100       #[å¿…é¡»]é…ç½®æœåŠ¡å™¨IDï¼Œå¯è‡ªå®š</span><br></pre></td></tr></table></figure><h3 id="Step2-é‡å¯MysqlæœåŠ¡"><a href="#Step2-é‡å¯MysqlæœåŠ¡" class="headerlink" title="Step2 é‡å¯MysqlæœåŠ¡"></a>Step2 é‡å¯MysqlæœåŠ¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><h3 id="Step3-åˆ›å»ºä»åº“ç”¨æˆ·å¹¶æˆæƒ"><a href="#Step3-åˆ›å»ºä»åº“ç”¨æˆ·å¹¶æˆæƒ" class="headerlink" title="Step3 åˆ›å»ºä»åº“ç”¨æˆ·å¹¶æˆæƒ"></a>Step3 åˆ›å»ºä»åº“ç”¨æˆ·å¹¶æˆæƒ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create user â€˜#userNameâ€™@â€™#hostâ€™ identified by â€˜#passWordâ€™;</span><br></pre></td></tr></table></figure><ul><li><strong>#userName</strong> ä»£è¡¨ä½ è¦åˆ›å»ºçš„æ­¤æ•°æ®åº“çš„æ–°ç”¨æˆ·è´¦å·</li><li><strong>#host</strong> ä»£è¡¨è®¿é—®æƒé™ï¼Œå¦‚ä¸‹ï¼š<ul><li><strong>%</strong> ä»£è¡¨é€šé…æ‰€æœ‰hoståœ°å€æƒé™(å¯è¿œç¨‹è®¿é—®)</li><li><strong>localhost</strong> ä¸ºæœ¬åœ°æƒé™(ä¸å¯è¿œç¨‹è®¿é—®)</li><li>æŒ‡å®šç‰¹æ®ŠIpè®¿é—®æƒé™ å¦‚10.138.106.102</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant all privileges on *.* to &apos;#userName&apos;@&apos;#host&apos;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å¹¶è®°å½•ä¸»åº“çŠ¶æ€"><a href="#æŸ¥çœ‹å¹¶è®°å½•ä¸»åº“çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹å¹¶è®°å½•ä¸»åº“çŠ¶æ€"></a>æŸ¥çœ‹å¹¶è®°å½•ä¸»åº“çŠ¶æ€</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure><p>è®°å½•ä¸‹<strong>File</strong>å’Œ<strong>Position</strong></p><h2 id="ä»åº“"><a href="#ä»åº“" class="headerlink" title="ä»åº“"></a>ä»åº“</h2><p>ä»åº“ä½¿ç”¨äº†Docker</p><h3 id="åˆ›å»ºå®¹å™¨å¹¶æŒ‚åœ¨æ•°æ®å·"><a href="#åˆ›å»ºå®¹å™¨å¹¶æŒ‚åœ¨æ•°æ®å·" class="headerlink" title="åˆ›å»ºå®¹å™¨å¹¶æŒ‚åœ¨æ•°æ®å·"></a>åˆ›å»ºå®¹å™¨å¹¶æŒ‚åœ¨æ•°æ®å·</h3><p>viæ‰“å¼€/etc/my.cnfå†™å…¥ğŸ‘‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -id \</span><br><span class="line">-p 3307:3306 \</span><br><span class="line">--name=c_mysql \</span><br><span class="line">-v $PWD/conf:/etc/mysql \</span><br><span class="line">-v $PWD/logs:/logs \</span><br><span class="line">-v $PWD/mysql-files:/var/lib/mysql-files \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=**** \</span><br><span class="line">mysql:8.0.26</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ä»åº“é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹ä»åº“é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ä»åº“é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹ä»åº“é…ç½®æ–‡ä»¶</h3><p>viæ‰“å¼€$PWD/conf/my.cnfæ–‡ä»¶æ·»åŠ ğŸ‘‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">## è®¾ç½®serverid,åŒä¸€ä¸ªå±€åŸŸç½‘å†…è¦å”¯ä¸€</span><br><span class="line">server_id=101</span><br><span class="line">##æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“åç§°</span><br><span class="line">binlog-ignore-db=mysql</span><br><span class="line">##å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½</span><br><span class="line">log-bin=mall-mysql-slave1-bin</span><br><span class="line">##è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—ä½¿ç”¨å†…å­˜å¤§å°(äº‹åŠ¡)</span><br><span class="line">binlog_cache_size=1M</span><br><span class="line">##è®¾ç½®ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼</span><br><span class="line">binlog_format=mixed</span><br><span class="line">##äºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸæ¸…ç†æ—¶é—´</span><br><span class="line">expire_logs_days=7</span><br><span class="line">##è·³è¿‡ä¸»ä»å¤åˆ¶ä¸­æ‰€æœ‰é”™è¯¯æˆ–æŒ‡å®šç±»å‹çš„é”™è¯¯ï¼Œé¿å…slaveç«¯å¤åˆ¶ä¸­æ–­</span><br><span class="line">###1062ä¸»é”®é‡å¤ï¼Œ1032ä¸»é‡æ•°æ®ä¸ä¸€è‡´</span><br><span class="line">slave_skip_errors=1062</span><br><span class="line">##é…ç½®ä¸­ç»§æ—¥å¿—</span><br><span class="line">relay_log=mall-mysql-relay-bin</span><br><span class="line">##è¡¨ç¤ºslaveå°†å¤åˆ¶äº‹ä»¶å†™è¿›è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">log_slave_updates=1</span><br><span class="line">##slaveè®¾ç½®ä¸ºåªè¯»</span><br><span class="line">read_only=1</span><br></pre></td></tr></table></figure><h3 id="é‡å¯Dockerå®¹å™¨"><a href="#é‡å¯Dockerå®¹å™¨" class="headerlink" title="é‡å¯Dockerå®¹å™¨"></a>é‡å¯Dockerå®¹å™¨</h3><h3 id="å¼€å¯ä»åº“Slaveæ¨¡å¼"><a href="#å¼€å¯ä»åº“Slaveæ¨¡å¼" class="headerlink" title="å¼€å¯ä»åº“Slaveæ¨¡å¼"></a>å¼€å¯ä»åº“Slaveæ¨¡å¼</h3><p>è¿›å…¥å®¹å™¨Bashåç™»å½•æ•°æ®åº“ï¼Œæ‰§è¡ŒğŸ‘‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change master to master_host=&apos;****&apos;, master_user=&apos;slave&apos;, master_password=&apos;****&apos;, master_port=3306, master_log_file=&apos;mysql-bin.000004&apos;, master_log_pos=156;</span><br></pre></td></tr></table></figure><ul><li>master_log_file å‚è€ƒä¸»åº“çŠ¶æ€çš„<strong>File</strong></li><li>master_log_pos å‚è€ƒä¸»åº“çŠ¶æ€çš„<strong>Position</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start slave;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ˜¯å¦å¼€å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show slave status;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Mysql </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> åç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»£ç†æ¨¡å¼</title>
      <link href="/2022/09/19/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
      <url>/2022/09/19/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><p>åœ¨ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰ä¸­ï¼Œä¸€ä¸ªç±»ä»£è¡¨å¦ä¸€ä¸ªç±»çš„åŠŸèƒ½ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ã€‚<br>åœ¨ä»£ç†æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºå…·æœ‰ç°æœ‰å¯¹è±¡çš„å¯¹è±¡ï¼Œä»¥ä¾¿å‘å¤–ç•Œæä¾›åŠŸèƒ½æ¥å£ã€‚</p><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><ul><li><p><strong>æ„å›¾</strong>ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p></li><li><p><strong>ä¸»è¦è§£å†³</strong>ï¼šåœ¨ç›´æ¥è®¿é—®å¯¹è±¡æ—¶å¸¦æ¥çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼šè¦è®¿é—®çš„å¯¹è±¡åœ¨è¿œç¨‹çš„æœºå™¨ä¸Šã€‚åœ¨é¢å‘å¯¹è±¡ç³»ç»Ÿä¸­ï¼Œæœ‰äº›å¯¹è±¡ç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚å¯¹è±¡åˆ›å»ºå¼€é”€å¾ˆå¤§ï¼Œæˆ–è€…æŸäº›æ“ä½œéœ€è¦å®‰å…¨æ§åˆ¶ï¼Œæˆ–è€…éœ€è¦è¿›ç¨‹å¤–çš„è®¿é—®ï¼‰ï¼Œç›´æ¥è®¿é—®ä¼šç»™ä½¿ç”¨è€…æˆ–è€…ç³»ç»Ÿç»“æ„å¸¦æ¥å¾ˆå¤šéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¿é—®æ­¤å¯¹è±¡æ—¶åŠ ä¸Šä¸€ä¸ªå¯¹æ­¤å¯¹è±¡çš„è®¿é—®å±‚ã€‚</p></li><li><p><strong>ä½•æ—¶ä½¿ç”¨</strong>ï¼šæƒ³åœ¨è®¿é—®ä¸€ä¸ªç±»æ—¶åšä¸€äº›æ§åˆ¶ã€‚</p></li></ul><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>è¿™é‡Œå°†åˆ›å»ºä¸€ä¸ª Image æ¥å£å’Œå®ç°äº† Image æ¥å£çš„å®ä½“ç±»ã€‚ProxyImage æ˜¯ä¸€ä¸ªä»£ç†ç±»ï¼Œå‡å°‘ RealImage å¯¹è±¡åŠ è½½çš„å†…å­˜å ç”¨ã€‚</p><p>ProxyPatternDemo ç±»ä½¿ç”¨ ProxyImage æ¥è·å–è¦åŠ è½½çš„ Image å¯¹è±¡ï¼Œå¹¶æŒ‰ç…§éœ€æ±‚è¿›è¡Œæ˜¾ç¤ºã€‚</p><p><img src="https://s1.ax1x.com/2022/09/19/x9x6tf.jpg" alt></p><h3 id="æ­¥éª¤ä¸€ï¼šåˆ›å»ºæ¥å£"><a href="#æ­¥éª¤ä¸€ï¼šåˆ›å»ºæ¥å£" class="headerlink" title="æ­¥éª¤ä¸€ï¼šåˆ›å»ºæ¥å£"></a>æ­¥éª¤ä¸€ï¼šåˆ›å»ºæ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Image.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Image</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¥éª¤äºŒï¼šåˆ›å»ºå®ç°ç±»"><a href="#æ­¥éª¤äºŒï¼šåˆ›å»ºå®ç°ç±»" class="headerlink" title="æ­¥éª¤äºŒï¼šåˆ›å»ºå®ç°ç±»"></a>æ­¥éª¤äºŒï¼šåˆ›å»ºå®ç°ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RealImage.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealImage</span> <span class="keyword">implements</span> <span class="title">Image</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">private</span> String fileName;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">RealImage</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">      loadFromDisk(fileName);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"Displaying "</span> + fileName);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadFromDisk</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"Loading "</span> + fileName);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ProxyImage.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyImage</span> <span class="keyword">implements</span> <span class="title">Image</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">private</span> RealImage realImage;</span><br><span class="line">   <span class="keyword">private</span> String fileName;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ProxyImage</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(realImage == <span class="keyword">null</span>)&#123;</span><br><span class="line">         realImage = <span class="keyword">new</span> RealImage(fileName);</span><br><span class="line">      &#125;</span><br><span class="line">      realImage.display();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¥éª¤ä¸‰ï¼š-æµ‹è¯•ç±»"><a href="#æ­¥éª¤ä¸‰ï¼š-æµ‹è¯•ç±»" class="headerlink" title="æ­¥éª¤ä¸‰ï¼š æµ‹è¯•ç±»"></a>æ­¥éª¤ä¸‰ï¼š æµ‹è¯•ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Test.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Image image = <span class="keyword">new</span> ProxyImage(<span class="string">"test_10mb.jpg"</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// å›¾åƒå°†ä»ç£ç›˜åŠ è½½</span></span><br><span class="line">      image.display(); </span><br><span class="line">      System.out.println(<span class="string">""</span>);</span><br><span class="line">      <span class="comment">// å›¾åƒä¸éœ€è¦ä»ç£ç›˜åŠ è½½</span></span><br><span class="line">      image.display();  </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> ä»£ç†æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerä¸­çš„Rediséƒ¨ç½²</title>
      <link href="/2022/09/18/Docker%E4%B8%AD%E7%9A%84Redis%E9%83%A8%E7%BD%B2/"/>
      <url>/2022/09/18/Docker%E4%B8%AD%E7%9A%84Redis%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="åˆ›å»ºRedisçš„Dockerå®¹å™¨"><a href="#åˆ›å»ºRedisçš„Dockerå®¹å™¨" class="headerlink" title="åˆ›å»ºRedisçš„Dockerå®¹å™¨"></a>åˆ›å»ºRedisçš„Dockerå®¹å™¨</h2><center>ğŸ‘‡ç›´å¥”ä¸»é¢˜ğŸ‘‡</center><h3 id="shellè„šæœ¬"><a href="#shellè„šæœ¬" class="headerlink" title="shellè„šæœ¬"></a>shellè„šæœ¬</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">--name myredis \</span><br><span class="line">-v /root/redis_docker/mydata/redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-v /root/redis_docker/mydata/redis/data:/data \</span><br><span class="line">-p 6379:6379 \</span><br><span class="line">-d --restart=always redis:5.0 redis-server /etc/redis/redis.conf \</span><br><span class="line">--appendonly yes  \</span><br><span class="line">--requirepass ******</span><br></pre></td></tr></table></figure><h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><ul><li>â€“name redis ã€å®¹å™¨åã€‘</li><li>-p 6379:6379 ã€æ˜ å°„ç«¯å£ã€‘</li><li>-v /usr/local/app/redis/redis.conf:/etc/redis/redis.conf ã€confæ–‡ä»¶æŒ‚è½½ç›®å½•ã€‘</li><li>-v /usr/local/app/redis/data:/data ã€dataæŒ‚è½½ç›®å½•ã€‘</li><li>-d redis:5.0 ã€åå°è¿è¡Œé•œåƒã€‘</li><li>â€“restart=always ã€dockeré‡å¯åè‡ªåŠ¨å¯åŠ¨é•œåƒã€‘</li><li>redis-server /etc/redis/redis.conf ã€åœ¨å®¹å™¨æ‰§è¡Œredis-serverå¯åŠ¨å‘½ä»¤ï¼Œæ‰§è¡Œconfæ–‡ä»¶ã€‘</li><li>â€“appendonly yes ã€æŒä¹…åŒ–ã€‘</li><li>â€“requirepass â€œrootâ€ ã€è®¾ç½®å¯†ç ã€‘</li></ul><h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><ul><li>docker exec -it redis bash ã€è¿›å…¥å®¹å™¨ã€‘</li><li>redis-cli ã€è¿æ¥ã€‘</li><li>auth root ã€ç™»å½•ã€‘</li><li>set hello world</li><li>get hello</li></ul>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitå·¥ä½œåŒºä¸­æ–‡ä»¶çŠ¶æ€æ€»ç»“</title>
      <link href="/2022/09/16/git_status%E6%80%BB%E7%BB%93/"/>
      <url>/2022/09/16/git_status%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Gitå·¥ä½œåŒºä¸­æ–‡ä»¶çš„çŠ¶æ€ğŸ‘‡</p><p>Gitå·¥ä½œåŒºä¸­çš„æ–‡ä»¶å­˜åœ¨ä¸¤ç§çŠ¶æ€:</p><ul><li>untrackedæœªè·Ÿè¸ªï¼ˆæœªè¢«çº³å…¥ç‰ˆæœ¬æ§åˆ¶)</li><li>trackedå·²è·Ÿè¸ªï¼ˆè¢«çº³å…¥ç‰ˆæœ¬æ§åˆ¶)<ul><li>1.Unmodified æœªä¿®æ”¹çŠ¶æ€</li><li>2.Modified å·²ä¿®æ”¹çŠ¶æ€</li><li>3.Staged å·²æš‚å­˜çŠ¶æ€</li></ul></li></ul><h1 id="è¯¦ç»†è¯´æ˜"><a href="#è¯¦ç»†è¯´æ˜" class="headerlink" title="è¯¦ç»†è¯´æ˜"></a>è¯¦ç»†è¯´æ˜</h1><p><strong>æ³¨âš ï¼šä½¿ç”¨git statusæŸ¥çœ‹æ–‡ä»¶çŠ¶æ€</strong></p><h2 id="untracker"><a href="#untracker" class="headerlink" title="untracker"></a>untracker</h2><p>è®¾æƒ³ï¼šæ­¤æ—¶åœ¨.gitæ‰€åœ¨ç›®å½•ä¸­æ–°å»ºæ–‡ä»¶Hello.txt<br>åˆ™ï¼šæ­¤æ—¶æŸ¥çœ‹æ–‡ä»¶Hello.txtçŠ¶æ€ä¸º <font color="#660000">untracker</font> </p><h2 id="tracker"><a href="#tracker" class="headerlink" title="tracker"></a>tracker</h2><h3 id="Staged"><a href="#Staged" class="headerlink" title="Staged"></a>Staged</h3><p>è®¾æƒ³ï¼šæ­¤æ—¶å¯¹Hello.txtæ–‡ä»¶è¿›è¡Œgit add. æ“ä½œ<br>åˆ™ï¼šæ­¤æ—¶æŸ¥çœ‹æ–‡ä»¶Hello.txtçŠ¶æ€ä¸º <font color="#006600">Staged</font></p><h3 id="Unmodified"><a href="#Unmodified" class="headerlink" title="Unmodified"></a>Unmodified</h3><p>è®¾æƒ³ï¼šæ­¤æ—¶å¯¹Hello.txtæ–‡ä»¶è¿›è¡Œgit commit æ“ä½œ<br>åˆ™ï¼šæ­¤æ—¶æŸ¥çœ‹æ–‡ä»¶Hello.txtçŠ¶æ€ä¸º Unmodifiedï¼Œæ³¨æ„æ­¤æ—¶è°ƒç”¨çŠ¶æ€æŸ¥çœ‹ç»“æœå¹¶ä¸æ˜¾ç¤º</p><h3 id="Modified"><a href="#Modified" class="headerlink" title="Modified"></a>Modified</h3><p>è®¾æƒ³ï¼šæ­¤æ—¶å¯¹Hello.txtæ–‡ä»¶å†…å®¹è¿›è¡Œä¿®æ”¹æ“ä½œ<br>åˆ™ï¼šæ­¤æ—¶æŸ¥çœ‹æ–‡ä»¶Hello.txtçŠ¶æ€ä¸º <font color="#660000">Modified</font> (æœªæ”¾å…¥ç¼“å­˜åŒº)</p><p>ç´§æ¥ç€ï¼šå†æ¬¡æ‰§è¡Œgit add. æ“ä½œ<br>åˆ™ï¼šæ­¤æ—¶æŸ¥çœ‹æ–‡ä»¶Hello.txtçŠ¶æ€ä¸º <font color="#006600">Modified</font> (å·²å½’å…¥ç¼“å­˜åŒº)</p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC - è·å–Getè¯·æ±‚å‚æ•°è¯¦è§£</title>
      <link href="/2022/09/13/SpringMVC%20-%20%E8%8E%B7%E5%8F%96Get%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"/>
      <url>/2022/09/13/SpringMVC%20-%20%E8%8E%B7%E5%8F%96Get%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p><strong><center>ğŸ“¨æœ¬ç¯‡ä¸»è¦å¯¹æ¯”ä¸¤ç§è·å–Getè¯·æ±‚å‚æ•°æ–¹æ³•çš„åŒºåˆ«ğŸ“¨</center></strong></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>å…ˆçœ‹å¦‚ä¸‹ä¸¤æ®µåŸºäº@GetMappingæ³¨è§£çš„æ–¹æ³•ğŸ‘‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/page"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;Page&gt; <span class="title">page</span><span class="params">(<span class="keyword">int</span> page, <span class="keyword">int</span> pageSize, String name)</span></span>&#123;</span><br><span class="line">    log.info(<span class="string">"page=&#123;&#125;, pageSize=&#123;&#125;, name=&#123;&#125;"</span>, page, pageSize, name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºé¡µé¢å¯¹è±¡</span></span><br><span class="line">    Page pageInfo = <span class="keyword">new</span> Page(page,pageSize);</span><br><span class="line">    <span class="comment">//é…ç½®åˆ†é¡µæ¡ä»¶</span></span><br><span class="line">    LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper();</span><br><span class="line">    queryWrapper.like(StringUtils.isNotEmpty(name), Employee::getName, name);</span><br><span class="line">    queryWrapper.orderByDesc(Employee::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    employeeService.page(pageInfo, queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;Employee&gt; <span class="title">getByID</span><span class="params">(@PathVariable Long id)</span></span>&#123;</span><br><span class="line">    Employee employee = employeeService.getById(id);</span><br><span class="line">    <span class="keyword">if</span> (employee != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(employee);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">"æŸ¥è¯¢å¤±è´¥ï¼"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>ä¸Šé¢ä¸¤æ®µä»£ç ä¸­ï¼š</p><ul><li>å…±åŒç‚¹æ˜¯éƒ½æ˜¯é’ˆå¯¹Getè¯·æ±‚çš„åç«¯ä»£ç é€»è¾‘å¤„ç†</li><li>ä¸»è¦çš„ä¸åŒä¹‹å¤„æ˜¯å¯¹äºGetè¯·æ±‚å‚æ•°çš„è·å–æ–¹å¼</li><li>ç¬¬ä¸€æ®µä»£ç çš„å®Œæ•´è¯·æ±‚è·¯å¾„æ˜¯ï¼š<strong><a href="http://localhost:8080/employee/page?page=1&amp;pageSize=2" target="_blank" rel="noopener">http://localhost:8080/employee/page?page=1&amp;pageSize=2</a></strong></li><li>ç¬¬äºŒæ®µä»£ç çš„å®Œæ•´è¯·æ±‚è·¯å¾„æ˜¯ï¼š<strong><a href="http://localhost:8080/employee/141242344443454456" target="_blank" rel="noopener">http://localhost:8080/employee/141242344443454456</a></strong></li></ul><h2 id="å…³äºç¬¬ä¸€ç§æ–¹å¼"><a href="#å…³äºç¬¬ä¸€ç§æ–¹å¼" class="headerlink" title="å…³äºç¬¬ä¸€ç§æ–¹å¼"></a>å…³äºç¬¬ä¸€ç§æ–¹å¼</h2><p>ç¬¬ä¸€ç§å±äºä¼ ç»Ÿæ–¹å¼çš„Getè¯·æ±‚å‚æ•°è·å–æ–¹æ³•ï¼Œå³å‚æ•°è·Ÿåœ¨é—®å·åé¢ã€‚<br>æˆ‘ä»¬å‡æœ‰è¿™æ ·ä¸€æ®µè¯·æ±‚éœ€è¦å¤„ç†ï¼š<strong><a href="http://localhost:8080/helloworld?name=å¼ ä¸‰" target="_blank" rel="noopener">http://localhost:8080/helloworld?name=å¼ ä¸‰</a></strong><br>åˆ™Controllerä¸­çš„å¤„ç†ä»£ç å¦‚ä¸‹ğŸ‘‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/helloworld"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">helloworld1</span><span class="params">(@RequestParam(<span class="string">"name"</span>)</span> String name) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"è·å–åˆ°çš„nameæ˜¯ï¼š"</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="RequestParamä½¿ç”¨"><a href="#RequestParamä½¿ç”¨" class="headerlink" title="@RequestParamä½¿ç”¨"></a>@RequestParamä½¿ç”¨</h3><p>è¿™ç§æ–¹å¼æ¶‰åŠäº†@RequestParamæ³¨è§£çš„ä½¿ç”¨ï¼Œå…³äºè¯¥æ³¨è§£æ€»ç»“å¦‚ä¸‹ğŸ‘‡</p><ul><li><p>ä¸åŠ @RequestParamï¼Œå‰ç«¯çš„å‚æ•°åéœ€è¦å’Œåç«¯æ§åˆ¶å™¨çš„å˜é‡åä¿æŒä¸€è‡´æ‰èƒ½ç”Ÿæ•ˆ</p></li><li><p>ä¸åŠ @RequestParamï¼Œå‚æ•°ä¸ºéå¿…ä¼ ï¼ŒåŠ @RequestParamå†™æ³•å‚æ•°ä¸ºå¿…ä¼ ã€‚ä½†@RequestParamå¯ä»¥é€šè¿‡@RequestParam(required = false)è®¾ç½®ä¸ºéå¿…ä¼ ã€‚</p></li><li><p>@RequestParamå¯ä»¥é€šè¿‡@RequestParam(â€œuserIdâ€)æˆ–è€…@RequestParam(value = â€œuserIdâ€)æŒ‡å®šä¼ å…¥çš„å‚æ•°åã€‚</p></li><li><p>@RequestParamå¯ä»¥é€šè¿‡@RequestParam(defaultValue = â€œ0â€)æŒ‡å®šå‚æ•°é»˜è®¤å€¼</p></li><li><p>å¦‚æœæ¥å£é™¤äº†å‰ç«¯è°ƒç”¨è¿˜æœ‰åç«¯RPCè°ƒç”¨ï¼Œåˆ™ä¸èƒ½çœç•¥@RequestParamï¼Œå¦åˆ™RPCä¼šæ‰¾ä¸åˆ°å‚æ•°æŠ¥é”™</p></li><li><p>è®¿é—®æ—¶ï¼š</p><ul><li>ä¸åŠ @RequestParamæ³¨è§£ï¼šurlå¯å¸¦å‚æ•°ä¹Ÿå¯ä¸å¸¦å‚æ•°</li><li>åŠ @RequestParamæ³¨è§£ï¼šurlå¿…é¡»å¸¦æœ‰å‚æ•°</li></ul></li></ul><h2 id="å…³äºç¬¬äºŒç§æ–¹å¼"><a href="#å…³äºç¬¬äºŒç§æ–¹å¼" class="headerlink" title="å…³äºç¬¬äºŒç§æ–¹å¼"></a>å…³äºç¬¬äºŒç§æ–¹å¼</h2><p>ç¬¬äºŒç§æ˜¯å…¸å‹çš„ RESTful é£æ ¼ï¼ŒIDå‚æ•°å€¼ç›´æ¥æ”¾åœ¨è·¯å¾„é‡Œé¢ã€‚<br>æˆ‘ä»¬å‡æœ‰è¿™æ ·ä¸€æ®µè¯·æ±‚éœ€è¦å¤„ç†ï¼š<strong><a href="http://localhost:8080/helloworld/å¼ ä¸‰" target="_blank" rel="noopener">http://localhost:8080/helloworld/å¼ ä¸‰</a></strong><br>åˆ™Controllerä¸­çš„å¤„ç†ä»£ç å¦‚ä¸‹ğŸ‘‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/helloworld/&#123;name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">helloworld</span><span class="params">(@PathVariable(<span class="string">"name"</span>)</span> String name) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"è·å–åˆ°çš„nameæ˜¯ï¼š"</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PathVariableä½¿ç”¨"><a href="#PathVariableä½¿ç”¨" class="headerlink" title="@PathVariableä½¿ç”¨"></a>@PathVariableä½¿ç”¨</h3><p>é€šè¿‡ @PathVariable å¯ä»¥å°† URL ä¸­å ä½ç¬¦å‚æ•°ç»‘å®šåˆ°æ§åˆ¶å™¨å¤„ç†æ–¹æ³•çš„å½¢å‚ä¸­ã€‚</p><ul><li><p>è‹¥æ–¹æ³•å‚æ•°åç§°å’Œéœ€è¦ç»‘å®šçš„urlä¸­å˜é‡åç§°ä¸€è‡´æ—¶,å¯ä»¥ç®€å†™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;Employee&gt; <span class="title">getByID</span><span class="params">(@PathVariable Long id)</span></span>&#123;</span><br><span class="line">    Employee employee = employeeService.getById(id);</span><br><span class="line">    <span class="keyword">if</span> (employee != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(employee);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">"æŸ¥è¯¢å¤±è´¥ï¼"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è‹¥æ–¹æ³•å‚æ•°åç§°å’Œéœ€è¦ç»‘å®šçš„urlä¸­å˜é‡åç§°ä¸ä¸€è‡´æ—¶ï¼Œå†™æˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;Employee&gt; <span class="title">getByID</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Long empId)</span>&#123;</span><br><span class="line">    Employee employee = employeeService.getById(id);</span><br><span class="line">    <span class="keyword">if</span> (employee != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(employee);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">"æŸ¥è¯¢å¤±è´¥ï¼"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="2022-9-14-æ›´æ–°"><a href="#2022-9-14-æ›´æ–°" class="headerlink" title="2022/9/14 æ›´æ–°"></a>2022/9/14 æ›´æ–°</h2><h3 id="ç¬¬ä¸€ç§æ–¹å¼çš„è¡¥å……ï¼šä½¿ç”¨å¯¹è±¡æ¥æ¥æ”¶å‚æ•°"><a href="#ç¬¬ä¸€ç§æ–¹å¼çš„è¡¥å……ï¼šä½¿ç”¨å¯¹è±¡æ¥æ¥æ”¶å‚æ•°" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼çš„è¡¥å……ï¼šä½¿ç”¨å¯¹è±¡æ¥æ¥æ”¶å‚æ•°"></a>ç¬¬ä¸€ç§æ–¹å¼çš„è¡¥å……ï¼šä½¿ç”¨å¯¹è±¡æ¥æ¥æ”¶å‚æ•°</h3><p>æ­¤å¤„å®šä¹‰ä¸€ä¸ªç®€å•çš„POJOå¦‚ä¸‹ğŸ‘‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>å®šä¹‰ä¸€ä¸ªRestControllerå¦‚ä¸‹ğŸ‘‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/helloworld"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">helloworld</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"nameï¼š"</span> + user.getName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç»™å‡ºä¸€ä¸ªGETè¯·æ±‚ï¼š<strong><a href="http://localhost:8080/helloworld?name=å¼ ä¸‰" target="_blank" rel="noopener">http://localhost:8080/helloworld?name=å¼ ä¸‰</a></strong><br>åˆ™æµè§ˆå™¨å¯ä»¥çœ‹åˆ°ï¼š<strong>name: å¼ ä¸‰</strong></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> JavaWeb </tag>
            
            <tag> SpringMVC </tag>
            
            <tag> RESTful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Servletè¿›åŒ–ä¹‹æ—… â€”â€” ä»ServerSocketç¼–ç¨‹åˆ°SpringMVCæ¡†æ¶å¼€å‘</title>
      <link href="/2022/09/08/servlet%E8%BF%9B%E5%8C%96%E4%B9%8B%E6%97%85/"/>
      <url>/2022/09/08/servlet%E8%BF%9B%E5%8C%96%E4%B9%8B%E6%97%85/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><strong><center>æœ¬ç¯‡ä¸»è¦è®°å½•Javaåç«¯å¼€å‘å­¦ä¹ è¿‡ç¨‹ä¸­å…³äºServletç›¸å…³æŠ€æœ¯è·¯çº¿çš„æ¢³ç†å’Œæ€»ç»“</center></strong></p><p>æŒ‰æŠ€æœ¯è¿­ä»£é¡ºåºä¾æ¬¡ä»ä¸‹è¿°å‡ ä¸ªWebæŠ€æœ¯å¼€å±•æ¢³ç†ï¼š</p><ul><li>ServerSocketç¼–ç¨‹</li><li>WebæœåŠ¡å™¨</li><li>Servletè§„èŒƒ</li><li>SpringMCVæ¡†æ¶</li></ul><h1 id="ServerSocketç¼–ç¨‹"><a href="#ServerSocketç¼–ç¨‹" class="headerlink" title="ServerSocketç¼–ç¨‹"></a>ServerSocketç¼–ç¨‹</h1><p><strong><center>æœ¬éƒ¨åˆ†é€šè¿‡æ‰‹æ’¸ä¸€ä¸ªåŸºäºJavaçš„ç®€æ˜“HTTPæœåŠ¡å™¨æ¥ä½“ä¼šæœ€åŸåˆçš„JavaWebåç«¯å¼€å‘è¿‡ç¨‹</center></strong></p><h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><p>è¿™é‡Œå®¢æˆ·ç«¯å°±ä¸ä½¿ç”¨Javaä»£ç ç¼–å†™äº†ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æœ€åŸºæœ¬çš„æµè§ˆå™¨æˆ–è€…åç«¯æµ‹è¯•å·¥å…·å¦‚PostManã€‚</p><h2 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h2><ul><li>ç¬¬ä¸€æ­¥æˆ‘ä»¬å…ˆåˆ›å»ºServerSocketï¼Œç›‘å¬8080ç«¯å£</li><li>ç¬¬äºŒæ­¥æ¥æ”¶åˆ°è¯·æ±‚åæŠŠæµåœ¨æ§åˆ¶å°è¿›è¡Œè¾“å‡º</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">null</span>;</span><br><span class="line">        Socket socket = <span class="keyword">null</span>;</span><br><span class="line">        InputStream is = <span class="keyword">null</span>;</span><br><span class="line">        InputStreamReader isr = <span class="keyword">null</span>;</span><br><span class="line">        BufferedReader br = <span class="keyword">null</span>;</span><br><span class="line">        OutputStream os = <span class="keyword">null</span>;</span><br><span class="line">        PrintWriter pw = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">8080</span>);</span><br><span class="line">            <span class="comment">//è°ƒç”¨accept()æ–¹æ³•å¼€å§‹ç›‘å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">            <span class="keyword">while</span> ((socket = serverSocket.accept()) != <span class="keyword">null</span> )&#123;</span><br><span class="line">                List&lt;String&gt; lines = IOUtils.readLines(socket.getInputStream(), <span class="string">"utf-8"</span>);</span><br><span class="line">                <span class="keyword">for</span> (String line : lines) &#123;</span><br><span class="line">                    System.out.println(line);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//å…³é—­èµ„æº</span></span><br><span class="line">            pw.close();</span><br><span class="line">            os.close();</span><br><span class="line">            br.close();</span><br><span class="line">            isr.close();</span><br><span class="line">            is.close();</span><br><span class="line">            socket.close();</span><br><span class="line">            serverSocket.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°åˆ°æ§åˆ¶å°æ˜¯ä»¥ä¸‹è¿™æ®µæ–‡æœ¬:<br><img src="https://img.gejiba.com/images/e49002a3b302ec04645132ea159a3f8a.png" alt></p><p><strong>è§£é‡Šä¸€ä¸‹ï¼š</strong> ä¸Šè¿°ä»£ç ç›‘å¬äº†8080ç«¯å£å¹¶å°†å®¢æˆ·ç«¯çš„è®¿é—®è¯·æ±‚æ‰“å°ä¸ºå­—ç¬¦ä¸²ï¼Œå³æ§åˆ¶å°ä¸­çš„æ–‡æœ¬ä¿¡æ¯ï¼Œåªè¦æˆ‘ä»¬çš„æœåŠ¡å™¨è§£æè¿™æ®µå­—ç¬¦ä¸²ç„¶åæ‹¼æ¥æˆrequestï¼Œå°±èƒ½å°è£…HTTPè¯·æ±‚ã€‚ä½†æ˜¯è¿™æ—¶è§‚å¯Ÿæµè§ˆå™¨ç•Œé¢å‘ç°æ²¡æœ‰ä»»ä½•å“åº”ã€‚å› ä¸ºæˆ‘ä»¬ç¼–å†™çš„HTTPæœåŠ¡å™¨ä»€ä¹ˆéƒ½æ²¡è¿”å›å°±å…³é—­äº†è¿æ¥ã€‚å¦‚æœè¦æµè§ˆå™¨æ­£ç¡®çš„æ˜¾ç¤ºæˆ‘ä»¬æƒ³è¦çœ‹åˆ°çš„hellowordã€‚åŒæ ·ä¹Ÿè¦æ‹¼æ¥æˆæµè§ˆå™¨èƒ½ç†è§£çš„httpåè®®å“åº”æ ¼å¼æ‰èƒ½æ­£ç¡®è¢«è§£æã€‚</p><p>ä¸‹é¢ç»§ç»­æ”¹åŠ¨ä»£ç ï¼Œè®©httpè¿”å›200æˆåŠŸï¼Œå¹¶è¿”å›hellowordï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">null</span>;</span><br><span class="line">        Socket socket = <span class="keyword">null</span>;</span><br><span class="line">        InputStream is = <span class="keyword">null</span>;</span><br><span class="line">        InputStreamReader isr = <span class="keyword">null</span>;</span><br><span class="line">        BufferedReader br = <span class="keyword">null</span>;</span><br><span class="line">        OutputStream os = <span class="keyword">null</span>;</span><br><span class="line">        PrintWriter pw = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">8080</span>);</span><br><span class="line">            <span class="comment">//è°ƒç”¨accept()æ–¹æ³•å¼€å§‹ç›‘å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">            <span class="keyword">while</span> ((socket = serverSocket.accept()) != <span class="keyword">null</span> )&#123;</span><br><span class="line">                <span class="comment">//è·å–è¾“å‡ºæµï¼Œå“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚</span></span><br><span class="line">                os = socket.getOutputStream();</span><br><span class="line">                pw = <span class="keyword">new</span> PrintWriter(os);</span><br><span class="line">                pw.write(<span class="string">"HTTP/1.1 200 OK\n"</span> +</span><br><span class="line">                        <span class="string">"Date: Fri, 7 Sept 2022 06:07:21 GMT\n"</span> +</span><br><span class="line">                        <span class="string">"Content-Type: text/html; charset=UTF-8\n"</span> +</span><br><span class="line">                        <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"&lt;html&gt;\n"</span> +</span><br><span class="line">                        <span class="string">"      &lt;head&gt;&lt;/head&gt;\n"</span> +</span><br><span class="line">                        <span class="string">"      &lt;body&gt;\n"</span> +</span><br><span class="line">                        <span class="string">"            helloWord!\n"</span> +</span><br><span class="line">                        <span class="string">"      &lt;/body&gt;\n"</span> +</span><br><span class="line">                        <span class="string">"&lt;/html&gt;"</span>);</span><br><span class="line">                pw.flush();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//å…³é—­èµ„æº</span></span><br><span class="line">            pw.close();</span><br><span class="line">            os.close();</span><br><span class="line">            br.close();</span><br><span class="line">            isr.close();</span><br><span class="line">            is.close();</span><br><span class="line">            socket.close();</span><br><span class="line">            serverSocket.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—®ï¼šlocalhost:8080 å¯è§ï¼š<br><img src="https://img.gejiba.com/images/e252a903e9cf4d35eaa77788489e4a4c.png" alt></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸Šè¿°ç¤ºä¾‹å®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„åŸºäºHTTPåè®®çš„JavaæœåŠ¡å™¨åç«¯ï¼Œé‡Œé¢å¹¶ä¸åŒ…å«å¯¹requestè¯·æ±‚å­—ç¬¦ä¸²çš„å¤„ç†ï¼Œä»…ä»…æ˜¯æ‰“å°äº†å®ƒï¼Œresponseä¹Ÿä»…ä»…æ˜¯æŒ‰HTTPåè®®çš„è§„å®šå°è£…äº†ä¸€å¥â€œhelloworldï¼â€ã€‚å¦‚æ­¤ç®€æ˜“åŸå§‹çš„HTTPæœåŠ¡å™¨çš„æ•´ä¸ªè®¿é—®å’Œå›å¤è¿‡ç¨‹æ˜¯å¦‚æ­¤ç¹çï¼Œå¯è§æ–°æŠ€æœ¯å‡ºç°çš„å¿…è¦æ€§ã€‚</p><h1 id="WebæœåŠ¡å™¨"><a href="#WebæœåŠ¡å™¨" class="headerlink" title="WebæœåŠ¡å™¨"></a>WebæœåŠ¡å™¨</h1><p><strong><center><br>WebæœåŠ¡å™¨æ˜¯ä¸€ä¸ªåº”è¯¥ç¨‹åº(è½¯ä»¶)ï¼Œå¯¹HTTPåè®®çš„æ“ä½œè¿›è¡Œå°è£…ï¼Œä½¿å¾—ç¨‹åºå‘˜ä¸å¿…ç›´æ¥å¯¹åè®®è¿›è¡Œæ“ä½œï¼Œè®©Webå¼€å‘æ›´åŠ ä¾¿æ·ã€‚ä¸»è¦åŠŸèƒ½æ˜¯â€æä¾›ç½‘ä¸Šä¿¡æ¯æµè§ˆæœåŠ¡â€</center></strong></p><p><img src="https://img.gejiba.com/images/d2eca8a0000dc6e254f5bcf9300b8418.png" alt></p><p>ä¸‹é¢ä»¥Apache TomcatæœåŠ¡å™¨ä¸ºä¾‹å±•ç¤ºä¸€ä¸ªæœ€ç®€å•çš„HTTP WebæœåŠ¡ã€‚</p><h2 id="åˆ›å»ºå±•ç¤ºé¡µé¢"><a href="#åˆ›å»ºå±•ç¤ºé¡µé¢" class="headerlink" title="åˆ›å»ºå±•ç¤ºé¡µé¢"></a>åˆ›å»ºå±•ç¤ºé¡µé¢</h2><p>åœ¨Tomcatæ ¹ç›®å½•çš„<strong>Webapps</strong>ä¸‹åˆ›å»ºä¸€ä¸ªtestæ–‡ä»¶å¤¹ï¼Œå†…éƒ¨åˆ›å»ºhello.htmlæ–‡ä»¶ç”¨äºè¿”å›è¯·æ±‚é¡µé¢ğŸ‘‡ğŸ‘‡</p><p><img src="https://img.gejiba.com/images/ba7d619e9f80190fa9b379c01b9ac67d.png" alt></p><h2 id="å¯åŠ¨æœåŠ¡å™¨å¹¶è¯·æ±‚èµ„æº"><a href="#å¯åŠ¨æœåŠ¡å™¨å¹¶è¯·æ±‚èµ„æº" class="headerlink" title="å¯åŠ¨æœåŠ¡å™¨å¹¶è¯·æ±‚èµ„æº"></a>å¯åŠ¨æœåŠ¡å™¨å¹¶è¯·æ±‚èµ„æº</h2><ul><li>å¯åŠ¨Tomcatæ ¹ç›®å½•ä¸‹çš„<strong>bin/startup.bat</strong></li><li>ä½¿ç”¨Postè®¿é—®<strong>localhost:8080/test/hello.html</strong></li></ul><p><img src="https://img.gejiba.com/images/2c4d42954c3df74e89901c3eac879458.png" alt></p><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>WebæœåŠ¡å™¨ä½œç”¨?<br>â¢å°è£…HTTPåè®®æ“ä½œï¼Œç®€åŒ–å¼€å‘<br>â¢å¯ä»¥å°†Webé¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸­ï¼Œå¯¹å¤–æä¾›ç½‘ä¸Šæµè§ˆæœåŠ¡</li><li>ä»€ä¹ˆæ˜¯Tomcat?<br>Tomcatæ˜¯ä¸€ä¸ªè½»é‡çº§çš„WebæœåŠ¡å™¨ï¼Œ æ”¯æŒServlet/JSPå°‘é‡JavaEEè§„èŒƒï¼Œä¹Ÿç§°ä¸ºWebå®¹å™¨ï¼ŒServletå®¹å™¨ï¼ŒServletä¾èµ–äºå®ƒæˆ–å…¶ä»–WebæœåŠ¡å™¨æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚</li></ol><h1 id="Servletè§„èŒƒ"><a href="#Servletè§„èŒƒ" class="headerlink" title="Servletè§„èŒƒ"></a>Servletè§„èŒƒ</h1><h2 id="Servletè§„èŒƒç®€ä»‹"><a href="#Servletè§„èŒƒç®€ä»‹" class="headerlink" title="Servletè§„èŒƒç®€ä»‹"></a>Servletè§„èŒƒç®€ä»‹</h2><p>Servletï¼ˆServer Appletï¼ŒæœåŠ¡ç«¯å°ç¨‹åºï¼Œæ˜¯æœåŠ¡ç«¯çš„ä¸€å°éƒ¨åˆ†ï¼‰ï¼Œå…¨ç§°Java Servletï¼Œæœªæœ‰ä¸­æ–‡è¯‘æ–‡ã€‚æ˜¯ç”¨Javaç¼–å†™çš„æœåŠ¡å™¨ç«¯ç¨‹åºã€‚å…¶ä¸»è¦åŠŸèƒ½åœ¨äºäº¤äº’å¼åœ°æµè§ˆå’Œä¿®æ”¹æ•°æ®ï¼Œç”ŸæˆåŠ¨æ€Webå†…å®¹ã€‚ç‹­ä¹‰çš„Servletæ˜¯æŒ‡Javaè¯­è¨€å®ç°çš„ä¸€ä¸ªæ¥å£ï¼Œå¹¿ä¹‰çš„Servletæ˜¯æŒ‡ä»»ä½•å®ç°äº†è¿™ä¸ªServletæ¥å£çš„ç±»ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œäººä»¬å°†Servletç†è§£ä¸ºåè€…ã€‚</p><h3 id="è¡¥å……ï¼šServletå’ŒWebæœåŠ¡å™¨çš„å…³ç³»"><a href="#è¡¥å……ï¼šServletå’ŒWebæœåŠ¡å™¨çš„å…³ç³»" class="headerlink" title="è¡¥å……ï¼šServletå’ŒWebæœåŠ¡å™¨çš„å…³ç³»"></a>è¡¥å……ï¼šServletå’ŒWebæœåŠ¡å™¨çš„å…³ç³»</h3><p>é¦–å…ˆè¦æ˜ç™½æˆ‘ä»¬ä»æ¥ä¸ä¼šåœ¨Servletä¸­å†™ä»€ä¹ˆç›‘å¬8080ç«¯å£çš„ä»£ç ï¼ŒServletä¸ä¼šç›´æ¥å’Œå®¢æˆ·ç«¯æ‰“äº¤é“ï¼è¿™äº›å…¨è¢«WebæœåŠ¡å™¨å°è£…äº†ã€‚</p><p>é‚£è¯·æ±‚æ˜¯æ€ä¹ˆæ¥åˆ°Servletçš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯Servletå®¹å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€å¸¸ç”¨çš„Tomcatã€‚Servletéƒ½æ˜¯éƒ¨ç½²åœ¨ä¸€ä¸ªå®¹å™¨ä¸­çš„ï¼Œä¸ç„¶ä½ çš„Servletæ ¹æœ¬ä¸èµ·ä½œç”¨ã€‚</p><p>Tomcatæ‰æ˜¯ä¸å®¢æˆ·ç«¯ç›´æ¥æ‰“äº¤é“çš„å®¶ä¼™ï¼Œå®ƒç›‘å¬äº†ç«¯å£ï¼Œè¯·æ±‚è¿‡æ¥åï¼Œæ ¹æ®URLç­‰ä¿¡æ¯ï¼Œç¡®å®šè¦å°†è¯·æ±‚äº¤ç»™å“ªä¸ªServletå»å¤„ç†ï¼Œç„¶åè°ƒç”¨é‚£ä¸ªServletçš„serviceæ–¹æ³•ï¼Œserviceæ–¹æ³•è¿”å›ä¸€ä¸ªresponseå¯¹è±¡ï¼ŒTomcatå†æŠŠè¿™ä¸ªrespondè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><h2 id="æ¥å£ä»£ç "><a href="#æ¥å£ä»£ç " class="headerlink" title="æ¥å£ä»£ç "></a>æ¥å£ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Javax.Servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig var1)</span> <span class="keyword">throws</span> ServletException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ServletConfig <span class="title">getServletConfig</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest var1, ServletResponse var2)</span> <span class="keyword">throws</span> ServletException, IOException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getServletInfo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Servletæ¥å£å®šä¹‰çš„æ˜¯ä¸€å¥—å¤„ç†ç½‘ç»œè¯·æ±‚çš„è§„èŒƒï¼Œæ‰€æœ‰å®ç°Servletçš„ç±»ï¼Œéƒ½éœ€è¦å®ç°å®ƒçš„é‚£äº”ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯ä¸¤ä¸ªå£°æ˜å‘¨æœŸæ–¹æ³•init()å’Œdestory()ï¼Œè¿˜æœ‰ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„service()ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰å®ç°Servletæ¥å£çš„ç±»ï¼Œæˆ–è€…è¯´ï¼Œæ‰€æœ‰æƒ³è¦å¤„ç†ç½‘ç»œè¯·æ±‚çš„ç±»ï¼Œéƒ½éœ€è¦å›ç­”è¿™ä¸‰ä¸ªé—®é¢˜ï¼š</p><ul><li>ä½ åˆå§‹åŒ–æ—¶è¦åšä»€ä¹ˆï¼Ÿ</li><li>ä½ é”€æ¯æ—¶è¦åšä»€ä¹ˆï¼Ÿ</li><li>ä½ æ¥æ”¶åˆ°è¯·æ±‚æ—¶è¦åšä»€ä¹ˆï¼Ÿ</li></ul><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h2><p>1ã€å®¢æˆ·ç«¯è¯·æ±‚è¯¥ Servletï¼›</p><p>2ã€TomcatåŠ è½½ Servlet ç±»åˆ°å†…å­˜ï¼›</p><p>3ã€Tomcatå®ä¾‹åŒ–å¹¶è°ƒç”¨init()æ–¹æ³•åˆå§‹åŒ–è¯¥ Servletï¼›</p><p>4ã€Tomcatè°ƒç”¨service()ï¼ˆæ ¹æ®è¯·æ±‚æ–¹æ³•ä¸åŒè°ƒç”¨doGet() æˆ–è€… doPost()ï¼Œæ­¤å¤–è¿˜æœ‰doHead()ã€doPut()ã€doTrace()ã€doDelete()ã€doOptions()ï¼‰ï¼›</p><p>5ã€destroy()ï¼›</p><p>6ã€åŠ è½½å’Œå®ä¾‹åŒ– Servletã€‚è¿™é¡¹æ“ä½œä¸€èˆ¬æ˜¯åŠ¨æ€æ‰§è¡Œçš„ã€‚ç„¶è€Œï¼ŒServer é€šå¸¸ä¼šæä¾›ä¸€ä¸ªç®¡ç†çš„é€‰é¡¹ï¼Œç”¨äºåœ¨ Server å¯åŠ¨æ—¶å¼ºåˆ¶è£…è½½å’Œåˆå§‹åŒ–ç‰¹å®šçš„ Servletï¼›</p><p>7ã€Server åˆ›å»ºä¸€ä¸ª Servletçš„å®ä¾‹ï¼›</p><p>8ã€ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°è¾¾ Serverï¼›</p><p>9ã€Server è°ƒç”¨ Servlet çš„ init() æ–¹æ³•ï¼ˆå¯é…ç½®ä¸º Server åˆ›å»º Servlet å®ä¾‹æ—¶è°ƒç”¨ï¼‰ï¼›</p><p>10ã€ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°è¾¾ Serverï¼›</p><p>11ã€Server åˆ›å»ºä¸€ä¸ªè¯·æ±‚å¯¹è±¡ï¼Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼›</p><p>12ã€Server åˆ›å»ºä¸€ä¸ªå“åº”å¯¹è±¡ï¼Œå“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼›</p><p>13ã€Server æ¿€æ´» Servlet çš„ service() æ–¹æ³•ï¼Œä¼ é€’è¯·æ±‚å’Œå“åº”å¯¹è±¡ä½œä¸ºå‚æ•°ï¼›</p><p>14ã€service() æ–¹æ³•è·å¾—å…³äºè¯·æ±‚å¯¹è±¡çš„ä¿¡æ¯ï¼Œå¤„ç†è¯·æ±‚ï¼Œè®¿é—®å…¶ä»–èµ„æºï¼Œè·å¾—éœ€è¦çš„ä¿¡æ¯ï¼›</p><p>15ã€service() æ–¹æ³•ä½¿ç”¨å“åº”å¯¹è±¡çš„æ–¹æ³•ï¼Œå°†å“åº”ä¼ å›Serverï¼Œæœ€ç»ˆåˆ°è¾¾å®¢æˆ·ç«¯ã€‚service()æ–¹æ³•å¯èƒ½æ¿€æ´»å…¶å®ƒæ–¹æ³•ä»¥å¤„ç†è¯·æ±‚ï¼Œå¦‚ doGet() æˆ– doPost() æˆ–ç¨‹åºå‘˜è‡ªå·±å¼€å‘çš„æ–°çš„æ–¹æ³•ï¼›</p><h2 id="ç»§æ‰¿ä½“ç³»"><a href="#ç»§æ‰¿ä½“ç³»" class="headerlink" title="ç»§æ‰¿ä½“ç³»"></a>ç»§æ‰¿ä½“ç³»</h2><p><a href="https://img.gejiba.com/image/EAAFoV" target="_blank" rel="noopener"><img src="https://img.gejiba.com/images/c4ed97e0e4b645e0968dc28a9fd82b22.png" alt></a></p><h3 id="HttpServletæºç "><a href="#HttpServletæºç " class="headerlink" title="HttpServletæºç "></a>HttpServletæºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.text.MessageFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.GenericServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServlet</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_DELETE = <span class="string">"DELETE"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_HEAD = <span class="string">"HEAD"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_GET = <span class="string">"GET"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_OPTIONS = <span class="string">"OPTIONS"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_POST = <span class="string">"POST"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_PUT = <span class="string">"PUT"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_TRACE = <span class="string">"TRACE"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String HEADER_IFMODSINCE = <span class="string">"If-Modified-Since"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String HEADER_LASTMOD = <span class="string">"Last-Modified"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LSTRING_FILE = <span class="string">"javax.servlet.http.LocalStrings"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ResourceBundle lStrings = ResourceBundle.getBundle(<span class="string">"javax.servlet.http.LocalStrings"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String protocol = req.getProtocol();</span><br><span class="line">        String msg = lStrings.getString(<span class="string">"http.method_get_not_supported"</span>);</span><br><span class="line">        <span class="keyword">if</span> (protocol.endsWith(<span class="string">"1.1"</span>)) &#123;</span><br><span class="line">            resp.sendError(<span class="number">405</span>, msg);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resp.sendError(<span class="number">400</span>, msg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">long</span> <span class="title">getLastModified</span><span class="params">(HttpServletRequest req)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doHead</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        NoBodyResponse response = <span class="keyword">new</span> NoBodyResponse(resp);</span><br><span class="line">        <span class="keyword">this</span>.doGet(req, response);</span><br><span class="line">        response.setContentLength();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String protocol = req.getProtocol();</span><br><span class="line">        String msg = lStrings.getString(<span class="string">"http.method_post_not_supported"</span>);</span><br><span class="line">        <span class="keyword">if</span> (protocol.endsWith(<span class="string">"1.1"</span>)) &#123;</span><br><span class="line">            resp.sendError(<span class="number">405</span>, msg);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resp.sendError(<span class="number">400</span>, msg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPut</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String protocol = req.getProtocol();</span><br><span class="line">        String msg = lStrings.getString(<span class="string">"http.method_put_not_supported"</span>);</span><br><span class="line">        <span class="keyword">if</span> (protocol.endsWith(<span class="string">"1.1"</span>)) &#123;</span><br><span class="line">            resp.sendError(<span class="number">405</span>, msg);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resp.sendError(<span class="number">400</span>, msg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDelete</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String protocol = req.getProtocol();</span><br><span class="line">        String msg = lStrings.getString(<span class="string">"http.method_delete_not_supported"</span>);</span><br><span class="line">        <span class="keyword">if</span> (protocol.endsWith(<span class="string">"1.1"</span>)) &#123;</span><br><span class="line">            resp.sendError(<span class="number">405</span>, msg);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resp.sendError(<span class="number">400</span>, msg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Method[] getAllDeclaredMethods(Class c) &#123;</span><br><span class="line">        <span class="keyword">if</span> (c.equals(HttpServlet.class)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Method[] parentMethods = <span class="keyword">this</span>.getAllDeclaredMethods(c.getSuperclass());</span><br><span class="line">            Method[] thisMethods = c.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">if</span> (parentMethods != <span class="keyword">null</span> &amp;&amp; parentMethods.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                Method[] allMethods = <span class="keyword">new</span> Method[parentMethods.length + thisMethods.length];</span><br><span class="line">                System.arraycopy(parentMethods, <span class="number">0</span>, allMethods, <span class="number">0</span>, parentMethods.length);</span><br><span class="line">                System.arraycopy(thisMethods, <span class="number">0</span>, allMethods, parentMethods.length, thisMethods.length);</span><br><span class="line">                thisMethods = allMethods;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> thisMethods;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doOptions</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        Method[] methods = <span class="keyword">this</span>.getAllDeclaredMethods(<span class="keyword">this</span>.getClass());</span><br><span class="line">        <span class="keyword">boolean</span> ALLOW_GET = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">boolean</span> ALLOW_HEAD = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">boolean</span> ALLOW_POST = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">boolean</span> ALLOW_PUT = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">boolean</span> ALLOW_DELETE = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">boolean</span> ALLOW_TRACE = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">boolean</span> ALLOW_OPTIONS = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; methods.length; ++i) &#123;</span><br><span class="line">            Method m = methods[i];</span><br><span class="line">            <span class="keyword">if</span> (m.getName().equals(<span class="string">"doGet"</span>)) &#123;</span><br><span class="line">                ALLOW_GET = <span class="keyword">true</span>;</span><br><span class="line">                ALLOW_HEAD = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (m.getName().equals(<span class="string">"doPost"</span>)) &#123;</span><br><span class="line">                ALLOW_POST = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (m.getName().equals(<span class="string">"doPut"</span>)) &#123;</span><br><span class="line">                ALLOW_PUT = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (m.getName().equals(<span class="string">"doDelete"</span>)) &#123;</span><br><span class="line">                ALLOW_DELETE = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String allow = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (ALLOW_GET &amp;&amp; allow == <span class="keyword">null</span>) &#123;</span><br><span class="line">            allow = <span class="string">"GET"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ALLOW_HEAD) &#123;</span><br><span class="line">            <span class="keyword">if</span> (allow == <span class="keyword">null</span>) &#123;</span><br><span class="line">                allow = <span class="string">"HEAD"</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                allow = allow + <span class="string">", HEAD"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ALLOW_POST) &#123;</span><br><span class="line">            <span class="keyword">if</span> (allow == <span class="keyword">null</span>) &#123;</span><br><span class="line">                allow = <span class="string">"POST"</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                allow = allow + <span class="string">", POST"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ALLOW_PUT) &#123;</span><br><span class="line">            <span class="keyword">if</span> (allow == <span class="keyword">null</span>) &#123;</span><br><span class="line">                allow = <span class="string">"PUT"</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                allow = allow + <span class="string">", PUT"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ALLOW_DELETE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (allow == <span class="keyword">null</span>) &#123;</span><br><span class="line">                allow = <span class="string">"DELETE"</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                allow = allow + <span class="string">", DELETE"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ALLOW_TRACE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (allow == <span class="keyword">null</span>) &#123;</span><br><span class="line">                allow = <span class="string">"TRACE"</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                allow = allow + <span class="string">", TRACE"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ALLOW_OPTIONS) &#123;</span><br><span class="line">            <span class="keyword">if</span> (allow == <span class="keyword">null</span>) &#123;</span><br><span class="line">                allow = <span class="string">"OPTIONS"</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                allow = allow + <span class="string">", OPTIONS"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        resp.setHeader(<span class="string">"Allow"</span>, allow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doTrace</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String CRLF = <span class="string">"\r\n"</span>;</span><br><span class="line">        String responseString = <span class="string">"TRACE "</span> + req.getRequestURI() + <span class="string">" "</span> + req.getProtocol();</span><br><span class="line"></span><br><span class="line">        String headerName;</span><br><span class="line">        <span class="keyword">for</span>(Enumeration reqHeaderEnum = req.getHeaderNames(); reqHeaderEnum.hasMoreElements(); responseString = responseString + CRLF + headerName + <span class="string">": "</span> + req.getHeader(headerName)) &#123;</span><br><span class="line">            headerName = (String)reqHeaderEnum.nextElement();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        responseString = responseString + CRLF;</span><br><span class="line">        <span class="keyword">int</span> responseLength = responseString.length();</span><br><span class="line">        resp.setContentType(<span class="string">"message/http"</span>);</span><br><span class="line">        resp.setContentLength(responseLength);</span><br><span class="line">        ServletOutputStream out = resp.getOutputStream();</span><br><span class="line">        out.print(responseString);</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String method = req.getMethod();</span><br><span class="line">        <span class="keyword">long</span> lastModified;</span><br><span class="line">        <span class="keyword">if</span> (method.equals(<span class="string">"GET"</span>)) &#123;</span><br><span class="line">            lastModified = <span class="keyword">this</span>.getLastModified(req);</span><br><span class="line">            <span class="keyword">if</span> (lastModified == -<span class="number">1L</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.doGet(req, resp);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">long</span> ifModifiedSince = req.getDateHeader(<span class="string">"If-Modified-Since"</span>);</span><br><span class="line">                <span class="keyword">if</span> (ifModifiedSince &lt; lastModified / <span class="number">1000L</span> * <span class="number">1000L</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.maybeSetLastModified(resp, lastModified);</span><br><span class="line">                    <span class="keyword">this</span>.doGet(req, resp);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resp.setStatus(<span class="number">304</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"HEAD"</span>)) &#123;</span><br><span class="line">            lastModified = <span class="keyword">this</span>.getLastModified(req);</span><br><span class="line">            <span class="keyword">this</span>.maybeSetLastModified(resp, lastModified);</span><br><span class="line">            <span class="keyword">this</span>.doHead(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"POST"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doPost(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"PUT"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doPut(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"DELETE"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doDelete(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"OPTIONS"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doOptions(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"TRACE"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doTrace(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            String errMsg = lStrings.getString(<span class="string">"http.method_not_implemented"</span>);</span><br><span class="line">            Object[] errArgs = <span class="keyword">new</span> Object[]&#123;method&#125;;</span><br><span class="line">            errMsg = MessageFormat.format(errMsg, errArgs);</span><br><span class="line">            resp.sendError(<span class="number">501</span>, errMsg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">maybeSetLastModified</span><span class="params">(HttpServletResponse resp, <span class="keyword">long</span> lastModified)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!resp.containsHeader(<span class="string">"Last-Modified"</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lastModified &gt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                resp.setDateHeader(<span class="string">"Last-Modified"</span>, lastModified);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpServletRequest request;</span><br><span class="line">        HttpServletResponse response;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            request = (HttpServletRequest)req;</span><br><span class="line">            response = (HttpServletResponse)res;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException var6) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"non-HTTP request or response"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.service(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Servletç¤ºä¾‹"><a href="#Servletç¤ºä¾‹" class="headerlink" title="Servletç¤ºä¾‹"></a>Servletç¤ºä¾‹</h2><p><strong><center>ğŸ‘‡æ­¤å¤„å±•ç¤ºä¸€æ®µå¤„ç†ç™»å½•ä¸šåŠ¡çš„Servletä»£ç ğŸ‘‡</center></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.geyu.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.geyu.web.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.geyu.web.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/loginServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletDemo</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String username = req.getParameter(<span class="string">"username"</span>);</span><br><span class="line">        String password = req.getParameter(<span class="string">"password"</span>);</span><br><span class="line"></span><br><span class="line">        String resource = <span class="string">"mybatis-config.xml"</span>;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line"></span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">        User user = userMapper.select(username, password);</span><br><span class="line"></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        resp.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">        PrintWriter writer = resp.getWriter();</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//ç™»é™†æˆåŠŸ</span></span><br><span class="line">            writer.write(<span class="string">"ç™»é™†æˆåŠŸ"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//ç™»é™†å¤±è´¥</span></span><br><span class="line">            writer.write(<span class="string">"ç™»å½•å¤±è´¥"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è®²äº†è¿™ä¹ˆå¤šåºŸè¯ï¼Œæ€»ç»“æ¥è¯´Servletå°±æ˜¯ä¸€ç¾¤äººæ¥åˆ¶å®šJavaåº”ç”¨ä¸­ä½¿ç”¨Webæ—¶çš„å„ç§è§„èŒƒï¼Œç»Ÿä¸€æ¥å£ï¼Œå…¶ä»–å†…éƒ¨å®ç°ç”±å‚å•†è‡ªå·±å®ç°ï¼Œtomcat jetty jbossç­‰ç­‰åº”è¿è€Œç”Ÿã€‚</p><p>å…³äºä»–å¦‚ä½•å·¥ä½œçš„ï¼šä¸€ä¸ªhttpè¯·æ±‚åˆ°æ¥ï¼Œå®¹å™¨å°†è¯·æ±‚å°è£…æˆServletä¸­çš„requestå¯¹è±¡ï¼Œåœ¨requestä¸­ä½ å¯ä»¥å¾—åˆ°æ‰€æœ‰çš„httpä¿¡æ¯ï¼Œç„¶åä½ å¯ä»¥å–å‡ºæ¥æ“ä½œï¼Œæœ€åä½ å†æŠŠæ•°æ®å°è£…æˆServletçš„responseå¯¹è±¡ï¼Œåº”ç”¨å®¹å™¨å°†resposeå¯¹è±¡è§£æä¹‹åå°è£…æˆä¸€ä¸ªhttp responseã€‚</p><p>WebæœåŠ¡å™¨ä¹ æƒ¯å¤„ç†é™æ€é¡µé¢ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªç¨‹åºæ¥å¸®å¿™å¤„ç†åŠ¨æ€è¯·æ±‚(å¦‚å½“å‰æ—¶é—´)ã€‚WebæœåŠ¡å™¨ç¨‹åºä¼šå°†åŠ¨æ€è¯·æ±‚è½¬å‘ç»™å¸®åŠ©ç¨‹åºï¼Œå¸®åŠ©ç¨‹åºå¤„ç†åï¼Œè¿”å›å¤„ç†åçš„é™æ€ç»“æœç»™WebæœåŠ¡å™¨ç¨‹åºã€‚è¿™æ ·å°±é¿å…äº†WebæœåŠ¡å™¨ç¨‹åºå¤„ç†åŠ¨æ€é¡µé¢ã€‚</p><h1 id="SpringMVCæ¡†æ¶"><a href="#SpringMVCæ¡†æ¶" class="headerlink" title="SpringMVCæ¡†æ¶"></a>SpringMVCæ¡†æ¶</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Spring MVCæ˜¯ä¸€ä¸ªåŸºäºJavaçš„å®ç°äº†MVCè®¾è®¡æ¨¡å¼çš„è¯·æ±‚é©±åŠ¨ç±»å‹çš„è½»é‡çº§Webæ¡†æ¶ï¼Œé€šè¿‡æŠŠModelï¼ŒViewï¼ŒControlleråˆ†ç¦»ï¼Œå°†webå±‚è¿›è¡ŒèŒè´£è§£è€¦ï¼ŒæŠŠå¤æ‚çš„webåº”ç”¨åˆ†æˆé€»è¾‘æ¸…æ™°çš„å‡ éƒ¨åˆ†ï¼Œç®€åŒ–å¼€å‘ï¼Œå‡å°‘å‡ºé”™ï¼Œæ–¹ä¾¿ç»„å†…å¼€å‘äººå‘˜ä¹‹é—´çš„é…åˆã€‚</p><h3 id="SpringMVCå’ŒServletçš„åŒºåˆ«ä¸è”ç³»"><a href="#SpringMVCå’ŒServletçš„åŒºåˆ«ä¸è”ç³»" class="headerlink" title="SpringMVCå’ŒServletçš„åŒºåˆ«ä¸è”ç³»"></a>SpringMVCå’ŒServletçš„åŒºåˆ«ä¸è”ç³»</h3><ul><li><p>Servletï¼šæ€§èƒ½æœ€å¥½ï¼Œå¤„ç†HTTPè¯·æ±‚çš„æ ‡å‡†å’Œè§„èŒƒã€‚</p></li><li><p>SpringMVCï¼šå¼€å‘æ•ˆç‡é«˜ï¼ˆå¥½å¤šå…±æ€§çš„ä¸œè¥¿éƒ½å°è£…å¥½äº†ï¼Œæ˜¯å¯¹Servletçš„å°è£…ï¼Œæ ¸å¿ƒçš„DispatcherServletæœ€ç»ˆç»§æ‰¿è‡ªHttpServletï¼‰</p></li></ul><p>è¿™ä¸¤è€…çš„å…³ç³»ï¼Œå°±å¦‚åŒMyBatiså’ŒJDBCï¼Œä¸€ä¸ªæ€§èƒ½å¥½ï¼Œä¸€ä¸ªå¼€å‘æ•ˆç‡é«˜ï¼Œæ˜¯å¯¹å¦ä¸€ä¸ªçš„å°è£…ã€‚</p><h3 id="Controllerå±‚ç¤ºä¾‹"><a href="#Controllerå±‚ç¤ºä¾‹" class="headerlink" title="Controllerå±‚ç¤ºä¾‹"></a>Controllerå±‚ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    IUserService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/login.do"</span>, method = &#123;RequestMethod.GET&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        User result = service.login(user);</span><br><span class="line">        <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:/pages/success.html"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:/pages/error.html"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><center>ğŸ‘€å¼€å‘è¿‡ç¨‹è‚‰çœ¼å¯è§çš„ç®€ä»‹â™¥</center>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> JavaWeb </tag>
            
            <tag> SpringMVC </tag>
            
            <tag> Servlet </tag>
            
            <tag> Tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLç¬”è®°</title>
      <link href="/2022/09/07/MySql/"/>
      <url>/2022/09/07/MySql/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="åŸºç¡€ç¯‡"><a href="#åŸºç¡€ç¯‡" class="headerlink" title="åŸºç¡€ç¯‡"></a>åŸºç¡€ç¯‡</h1><h2 id="é€šç”¨è¯­æ³•åŠåˆ†ç±»"><a href="#é€šç”¨è¯­æ³•åŠåˆ†ç±»" class="headerlink" title="é€šç”¨è¯­æ³•åŠåˆ†ç±»"></a>é€šç”¨è¯­æ³•åŠåˆ†ç±»</h2><ul><li>DDL: æ•°æ®å®šä¹‰è¯­è¨€ï¼Œç”¨æ¥å®šä¹‰æ•°æ®åº“å¯¹è±¡ï¼ˆæ•°æ®åº“ã€è¡¨ã€å­—æ®µï¼‰</li><li>DML: æ•°æ®æ“ä½œè¯­è¨€ï¼Œç”¨æ¥å¯¹æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹</li><li>DQL: æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­è¡¨çš„è®°å½•</li><li>DCL: æ•°æ®æ§åˆ¶è¯­è¨€ï¼Œç”¨æ¥åˆ›å»ºæ•°æ®åº“ç”¨æˆ·ã€æ§åˆ¶æ•°æ®åº“çš„æ§åˆ¶æƒé™</li></ul><h3 id="DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰"><a href="#DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰" class="headerlink" title="DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰"></a>DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰</h3><p>æ•°æ®å®šä¹‰è¯­è¨€</p><h4 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h4><p>æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“ï¼š<br><code>SHOW DATABASES;</code><br>æŸ¥è¯¢å½“å‰æ•°æ®åº“ï¼š<br><code>SELECT DATABASE();</code><br>åˆ›å»ºæ•°æ®åº“ï¼š<br><code>CREATE DATABASE [ IF NOT EXISTS ] æ•°æ®åº“å [ DEFAULT CHARSET å­—ç¬¦é›†] [COLLATE æ’åºè§„åˆ™ ];</code><br>åˆ é™¤æ•°æ®åº“ï¼š<br><code>DROP DATABASE [ IF EXISTS ] æ•°æ®åº“å;</code><br>ä½¿ç”¨æ•°æ®åº“ï¼š<br><code>USE æ•°æ®åº“å;</code></p><h5 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h5><ul><li>UTF8å­—ç¬¦é›†é•¿åº¦ä¸º3å­—èŠ‚ï¼Œæœ‰äº›ç¬¦å·å 4å­—èŠ‚ï¼Œæ‰€ä»¥æ¨èç”¨utf8mb4å­—ç¬¦é›†</li></ul><h4 id="è¡¨æ“ä½œ"><a href="#è¡¨æ“ä½œ" class="headerlink" title="è¡¨æ“ä½œ"></a>è¡¨æ“ä½œ</h4><p>æŸ¥è¯¢å½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨ï¼š<br><code>SHOW TABLES;</code><br>æŸ¥è¯¢è¡¨ç»“æ„ï¼š<br><code>DESC è¡¨å;</code><br>æŸ¥è¯¢æŒ‡å®šè¡¨çš„å»ºè¡¨è¯­å¥ï¼š<br><code>SHOW CREATE TABLE è¡¨å;</code></p><p>åˆ›å»ºè¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE è¡¨å(</span><br><span class="line">å­—æ®µ1 å­—æ®µ1ç±»å‹ [COMMENT å­—æ®µ1æ³¨é‡Š],</span><br><span class="line">å­—æ®µ2 å­—æ®µ2ç±»å‹ [COMMENT å­—æ®µ2æ³¨é‡Š],</span><br><span class="line">å­—æ®µ3 å­—æ®µ3ç±»å‹ [COMMENT å­—æ®µ3æ³¨é‡Š],</span><br><span class="line">...</span><br><span class="line">å­—æ®µn å­—æ®µnç±»å‹ [COMMENT å­—æ®µnæ³¨é‡Š]</span><br><span class="line">)[ COMMENT è¡¨æ³¨é‡Š ];</span><br></pre></td></tr></table></figure><p><strong>æœ€åä¸€ä¸ªå­—æ®µåé¢æ²¡æœ‰é€—å·</strong></p><p>æ·»åŠ å­—æ®µï¼š<br><code>ALTER TABLE è¡¨å ADD å­—æ®µå ç±»å‹(é•¿åº¦) [COMMENT æ³¨é‡Š] [çº¦æŸ];</code><br>ä¾‹ï¼š<code>ALTER TABLE emp ADD nickname varchar(20) COMMENT &#39;æ˜µç§°&#39;;</code></p><p>ä¿®æ”¹æ•°æ®ç±»å‹ï¼š<br><code>ALTER TABLE è¡¨å MODIFY å­—æ®µå æ–°æ•°æ®ç±»å‹(é•¿åº¦);</code><br>ä¿®æ”¹å­—æ®µåå’Œå­—æ®µç±»å‹ï¼š<br><code>ALTER TABLE è¡¨å CHANGE æ—§å­—æ®µå æ–°å­—æ®µå ç±»å‹(é•¿åº¦) [COMMENT æ³¨é‡Š] [çº¦æŸ];</code><br>ä¾‹ï¼šå°†empè¡¨çš„nicknameå­—æ®µä¿®æ”¹ä¸ºusernameï¼Œç±»å‹ä¸ºvarchar(30)<br><code>ALTER TABLE emp CHANGE nickname username varchar(30) COMMENT &#39;æ˜µç§°&#39;;</code></p><p>åˆ é™¤å­—æ®µï¼š<br><code>ALTER TABLE è¡¨å DROP å­—æ®µå;</code></p><p>ä¿®æ”¹è¡¨åï¼š<br><code>ALTER TABLE è¡¨å RENAME TO æ–°è¡¨å</code></p><p>åˆ é™¤è¡¨ï¼š<br><code>DROP TABLE [IF EXISTS] è¡¨å;</code><br>åˆ é™¤è¡¨ï¼Œå¹¶é‡æ–°åˆ›å»ºè¯¥è¡¨ï¼š<br><code>TRUNCATE TABLE è¡¨å;</code></p><h3 id="DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰"><a href="#DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰" class="headerlink" title="DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰"></a>DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰</h3><h4 id="æ·»åŠ æ•°æ®"><a href="#æ·»åŠ æ•°æ®" class="headerlink" title="æ·»åŠ æ•°æ®"></a>æ·»åŠ æ•°æ®</h4><p>æŒ‡å®šå­—æ®µï¼š<br><code>INSERT INTO è¡¨å (å­—æ®µå1, å­—æ®µå2, ...) VALUES (å€¼1, å€¼2, ...);</code><br>å…¨éƒ¨å­—æ®µï¼š<br><code>INSERT INTO è¡¨å VALUES (å€¼1, å€¼2, ...);</code></p><p>æ‰¹é‡æ·»åŠ æ•°æ®ï¼š<br><code>INSERT INTO è¡¨å (å­—æ®µå1, å­—æ®µå2, ...) VALUES (å€¼1, å€¼2, ...), (å€¼1, å€¼2, ...), (å€¼1, å€¼2, ...);</code><br><code>INSERT INTO è¡¨å VALUES (å€¼1, å€¼2, ...), (å€¼1, å€¼2, ...), (å€¼1, å€¼2, ...);</code></p><h5 id="æ³¨æ„äº‹é¡¹-1"><a href="#æ³¨æ„äº‹é¡¹-1" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h5><ul><li>å­—ç¬¦ä¸²å’Œæ—¥æœŸç±»å‹æ•°æ®åº”è¯¥åŒ…å«åœ¨å¼•å·ä¸­</li><li>æ’å…¥çš„æ•°æ®å¤§å°åº”è¯¥åœ¨å­—æ®µçš„è§„å®šèŒƒå›´å†…</li></ul><h4 id="æ›´æ–°å’Œåˆ é™¤æ•°æ®"><a href="#æ›´æ–°å’Œåˆ é™¤æ•°æ®" class="headerlink" title="æ›´æ–°å’Œåˆ é™¤æ•°æ®"></a>æ›´æ–°å’Œåˆ é™¤æ•°æ®</h4><p>ä¿®æ”¹æ•°æ®ï¼š<br><code>UPDATE è¡¨å SET å­—æ®µå1 = å€¼1, å­—æ®µå2 = å€¼2, ... [ WHERE æ¡ä»¶ ];</code><br>ä¾‹ï¼š<br><code>UPDATE emp SET name = &#39;Jack&#39; WHERE id = 1;</code></p><p>åˆ é™¤æ•°æ®ï¼š<br><code>DELETE FROM è¡¨å [ WHERE æ¡ä»¶ ];</code></p><h3 id="DQLï¼ˆæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰"><a href="#DQLï¼ˆæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰" class="headerlink" title="DQLï¼ˆæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰"></a>DQLï¼ˆæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰</h3><p>è¯­æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">å­—æ®µåˆ—è¡¨</span><br><span class="line">FROM</span><br><span class="line">è¡¨åå­—æ®µ</span><br><span class="line">WHERE</span><br><span class="line">æ¡ä»¶åˆ—è¡¨</span><br><span class="line">GROUP BY</span><br><span class="line">åˆ†ç»„å­—æ®µåˆ—è¡¨</span><br><span class="line">HAVING</span><br><span class="line">åˆ†ç»„åçš„æ¡ä»¶åˆ—è¡¨</span><br><span class="line">ORDER BY</span><br><span class="line">æ’åºå­—æ®µåˆ—è¡¨</span><br><span class="line">LIMIT</span><br><span class="line">åˆ†é¡µå‚æ•°</span><br></pre></td></tr></table></figure><h4 id="åŸºç¡€æŸ¥è¯¢"><a href="#åŸºç¡€æŸ¥è¯¢" class="headerlink" title="åŸºç¡€æŸ¥è¯¢"></a>åŸºç¡€æŸ¥è¯¢</h4><p>æŸ¥è¯¢å¤šä¸ªå­—æ®µï¼š<br><code>SELECT å­—æ®µ1, å­—æ®µ2, å­—æ®µ3, ... FROM è¡¨å;</code><br><code>SELECT * FROM è¡¨å;</code></p><p>è®¾ç½®åˆ«åï¼š<br><code>SELECT å­—æ®µ1 [ AS åˆ«å1 ], å­—æ®µ2 [ AS åˆ«å2 ], å­—æ®µ3 [ AS åˆ«å3 ], ... FROM è¡¨å;</code><br><code>SELECT å­—æ®µ1 [ åˆ«å1 ], å­—æ®µ2 [ åˆ«å2 ], å­—æ®µ3 [ åˆ«å3 ], ... FROM è¡¨å;</code></p><p>å»é™¤é‡å¤è®°å½•ï¼š<br><code>SELECT DISTINCT å­—æ®µåˆ—è¡¨ FROM è¡¨å;</code></p><p>è½¬ä¹‰ï¼š<br><code>SELECT * FROM è¡¨å WHERE name LIKE &#39;/_å¼ ä¸‰&#39; ESCAPE &#39;/&#39;</code><br>/ ä¹‹åçš„_ä¸ä½œä¸ºé€šé…ç¬¦</p><h4 id="æ¡ä»¶æŸ¥è¯¢"><a href="#æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="æ¡ä»¶æŸ¥è¯¢"></a>æ¡ä»¶æŸ¥è¯¢</h4><p>è¯­æ³•ï¼š<br><code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å WHERE æ¡ä»¶åˆ—è¡¨;</code></p><p>æ¡ä»¶ï¼š</p><table><thead><tr><th>æ¯”è¾ƒè¿ç®—ç¬¦</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>&gt;</td><td>å¤§äº</td></tr><tr><td>&gt;=</td><td>å¤§äºç­‰äº</td></tr><tr><td>&lt;</td><td>å°äº</td></tr><tr><td>&lt;=</td><td>å°äºç­‰äº</td></tr><tr><td>=</td><td>ç­‰äº</td></tr><tr><td>&lt;&gt; æˆ– !=</td><td>ä¸ç­‰äº</td></tr><tr><td>BETWEEN â€¦ AND â€¦</td><td>åœ¨æŸä¸ªèŒƒå›´å†…ï¼ˆå«æœ€å°ã€æœ€å¤§å€¼ï¼‰</td></tr><tr><td>IN(â€¦)</td><td>åœ¨inä¹‹åçš„åˆ—è¡¨ä¸­çš„å€¼ï¼Œå¤šé€‰ä¸€</td></tr><tr><td>LIKE å ä½ç¬¦</td><td>æ¨¡ç³ŠåŒ¹é…ï¼ˆ_åŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œ%åŒ¹é…ä»»æ„ä¸ªå­—ç¬¦ï¼‰</td></tr><tr><td>IS NULL</td><td>æ˜¯NULL</td></tr></tbody></table><table><thead><tr><th>é€»è¾‘è¿ç®—ç¬¦</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>AND æˆ– &amp;&amp;</td><td>å¹¶ä¸”ï¼ˆå¤šä¸ªæ¡ä»¶åŒæ—¶æˆç«‹ï¼‰</td></tr><tr><td>OR æˆ– &#124;&#124;</td><td>æˆ–è€…ï¼ˆå¤šä¸ªæ¡ä»¶ä»»æ„ä¸€ä¸ªæˆç«‹ï¼‰</td></tr><tr><td>NOT æˆ– !</td><td>éï¼Œä¸æ˜¯</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">-- å¹´é¾„ç­‰äº30</span><br><span class="line">select * from employee where age = 30;</span><br><span class="line">-- å¹´é¾„å°äº30</span><br><span class="line">select * from employee where age &lt; 30;</span><br><span class="line">-- å°äºç­‰äº</span><br><span class="line">select * from employee where age &lt;= 30;</span><br><span class="line">-- æ²¡æœ‰èº«ä»½è¯</span><br><span class="line">select * from employee where idcard is null or idcard = &apos;&apos;;</span><br><span class="line">-- æœ‰èº«ä»½è¯</span><br><span class="line">select * from employee where idcard;</span><br><span class="line">select * from employee where idcard is not null;</span><br><span class="line">-- ä¸ç­‰äº</span><br><span class="line">select * from employee where age != 30;</span><br><span class="line">-- å¹´é¾„åœ¨20åˆ°30ä¹‹é—´</span><br><span class="line">select * from employee where age between 20 and 30;</span><br><span class="line">select * from employee where age &gt;= 20 and age &lt;= 30;</span><br><span class="line">-- ä¸‹é¢è¯­å¥ä¸æŠ¥é”™ï¼Œä½†æŸ¥ä¸åˆ°ä»»ä½•ä¿¡æ¯</span><br><span class="line">select * from employee where age between 30 and 20;</span><br><span class="line">-- æ€§åˆ«ä¸ºå¥³ä¸”å¹´é¾„å°äº30</span><br><span class="line">select * from employee where age &lt; 30 and gender = &apos;å¥³&apos;;</span><br><span class="line">-- å¹´é¾„ç­‰äº25æˆ–30æˆ–35</span><br><span class="line">select * from employee where age = 25 or age = 30 or age = 35;</span><br><span class="line">select * from employee where age in (25, 30, 35);</span><br><span class="line">-- å§“åä¸ºä¸¤ä¸ªå­—</span><br><span class="line">select * from employee where name like &apos;__&apos;;</span><br><span class="line">-- èº«ä»½è¯æœ€åä¸ºX</span><br><span class="line">select * from employee where idcard like &apos;%X&apos;;</span><br></pre></td></tr></table></figure><h4 id="èšåˆæŸ¥è¯¢ï¼ˆèšåˆå‡½æ•°ï¼‰"><a href="#èšåˆæŸ¥è¯¢ï¼ˆèšåˆå‡½æ•°ï¼‰" class="headerlink" title="èšåˆæŸ¥è¯¢ï¼ˆèšåˆå‡½æ•°ï¼‰"></a>èšåˆæŸ¥è¯¢ï¼ˆèšåˆå‡½æ•°ï¼‰</h4><p>å¸¸è§èšåˆå‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>count</td><td>ç»Ÿè®¡æ•°é‡</td></tr><tr><td>max</td><td>æœ€å¤§å€¼</td></tr><tr><td>min</td><td>æœ€å°å€¼</td></tr><tr><td>avg</td><td>å¹³å‡å€¼</td></tr><tr><td>sum</td><td>æ±‚å’Œ</td></tr></tbody></table><p>è¯­æ³•ï¼š<br><code>SELECT èšåˆå‡½æ•°(å­—æ®µåˆ—è¡¨) FROM è¡¨å;</code><br>ä¾‹ï¼š<br><code>SELECT count(id) from employee where workaddress = &quot;å¹¿ä¸œçœ&quot;;</code></p><h4 id="åˆ†ç»„æŸ¥è¯¢"><a href="#åˆ†ç»„æŸ¥è¯¢" class="headerlink" title="åˆ†ç»„æŸ¥è¯¢"></a>åˆ†ç»„æŸ¥è¯¢</h4><p>è¯­æ³•ï¼š<br><code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å [ WHERE æ¡ä»¶ ] GROUP BY åˆ†ç»„å­—æ®µå [ HAVING åˆ†ç»„åçš„è¿‡æ»¤æ¡ä»¶ ];</code></p><p>where å’Œ having çš„åŒºåˆ«ï¼š</p><ul><li>æ‰§è¡Œæ—¶æœºä¸åŒï¼šwhereæ˜¯åˆ†ç»„ä¹‹å‰è¿›è¡Œè¿‡æ»¤ï¼Œä¸æ»¡è¶³whereæ¡ä»¶ä¸å‚ä¸åˆ†ç»„ï¼›havingæ˜¯åˆ†ç»„åå¯¹ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚</li><li>åˆ¤æ–­æ¡ä»¶ä¸åŒï¼šwhereä¸èƒ½å¯¹èšåˆå‡½æ•°è¿›è¡Œåˆ¤æ–­ï¼Œè€Œhavingå¯ä»¥ã€‚</li></ul><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- æ ¹æ®æ€§åˆ«åˆ†ç»„ï¼Œç»Ÿè®¡ç”·æ€§å’Œå¥³æ€§æ•°é‡ï¼ˆåªæ˜¾ç¤ºåˆ†ç»„æ•°é‡ï¼Œä¸æ˜¾ç¤ºå“ªä¸ªæ˜¯ç”·å“ªä¸ªæ˜¯å¥³ï¼‰</span><br><span class="line">select count(*) from employee group by gender;</span><br><span class="line">-- æ ¹æ®æ€§åˆ«åˆ†ç»„ï¼Œç»Ÿè®¡ç”·æ€§å’Œå¥³æ€§æ•°é‡</span><br><span class="line">select gender, count(*) from employee group by gender;</span><br><span class="line">-- æ ¹æ®æ€§åˆ«åˆ†ç»„ï¼Œç»Ÿè®¡ç”·æ€§å’Œå¥³æ€§çš„å¹³å‡å¹´é¾„</span><br><span class="line">select gender, avg(age) from employee group by gender;</span><br><span class="line">-- å¹´é¾„å°äº45ï¼Œå¹¶æ ¹æ®å·¥ä½œåœ°å€åˆ†ç»„</span><br><span class="line">select workaddress, count(*) from employee where age &lt; 45 group by workaddress;</span><br><span class="line">-- å¹´é¾„å°äº45ï¼Œå¹¶æ ¹æ®å·¥ä½œåœ°å€åˆ†ç»„ï¼Œè·å–å‘˜å·¥æ•°é‡å¤§äºç­‰äº3çš„å·¥ä½œåœ°å€</span><br><span class="line">select workaddress, count(*) address_count from employee where age &lt; 45 group by workaddress having address_count &gt;= 3;</span><br></pre></td></tr></table></figure><h5 id="æ³¨æ„äº‹é¡¹-2"><a href="#æ³¨æ„äº‹é¡¹-2" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h5><ul><li>æ‰§è¡Œé¡ºåºï¼šwhere &gt; èšåˆå‡½æ•° &gt; having</li><li>åˆ†ç»„ä¹‹åï¼ŒæŸ¥è¯¢çš„å­—æ®µä¸€èˆ¬ä¸ºèšåˆå‡½æ•°å’Œåˆ†ç»„å­—æ®µï¼ŒæŸ¥è¯¢å…¶ä»–å­—æ®µæ— ä»»ä½•æ„ä¹‰</li></ul><h4 id="æ’åºæŸ¥è¯¢"><a href="#æ’åºæŸ¥è¯¢" class="headerlink" title="æ’åºæŸ¥è¯¢"></a>æ’åºæŸ¥è¯¢</h4><p>è¯­æ³•ï¼š<br><code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å ORDER BY å­—æ®µ1 æ’åºæ–¹å¼1, å­—æ®µ2 æ’åºæ–¹å¼2;</code></p><p>æ’åºæ–¹å¼ï¼š</p><ul><li>ASC: å‡åºï¼ˆé»˜è®¤ï¼‰</li><li>DESC: é™åº</li></ul><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- æ ¹æ®å¹´é¾„å‡åºæ’åº</span><br><span class="line">SELECT * FROM employee ORDER BY age ASC;</span><br><span class="line">SELECT * FROM employee ORDER BY age;</span><br><span class="line">-- ä¸¤å­—æ®µæ’åºï¼Œæ ¹æ®å¹´é¾„å‡åºæ’åºï¼Œå…¥èŒæ—¶é—´é™åºæ’åº</span><br><span class="line">SELECT * FROM employee ORDER BY age ASC, entrydate DESC;</span><br></pre></td></tr></table></figure><h5 id="æ³¨æ„äº‹é¡¹-3"><a href="#æ³¨æ„äº‹é¡¹-3" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h5><p>å¦‚æœæ˜¯å¤šå­—æ®µæ’åºï¼Œå½“ç¬¬ä¸€ä¸ªå­—æ®µå€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šæ ¹æ®ç¬¬äºŒä¸ªå­—æ®µè¿›è¡Œæ’åº</p><h4 id="åˆ†é¡µæŸ¥è¯¢"><a href="#åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢"></a>åˆ†é¡µæŸ¥è¯¢</h4><p>è¯­æ³•ï¼š<br><code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å LIMIT èµ·å§‹ç´¢å¼•, æŸ¥è¯¢è®°å½•æ•°;</code></p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢ç¬¬ä¸€é¡µæ•°æ®ï¼Œå±•ç¤º10æ¡</span><br><span class="line">SELECT * FROM employee LIMIT 0, 10;</span><br><span class="line">-- æŸ¥è¯¢ç¬¬äºŒé¡µ</span><br><span class="line">SELECT * FROM employee LIMIT 10, 10;</span><br></pre></td></tr></table></figure><h5 id="æ³¨æ„äº‹é¡¹-4"><a href="#æ³¨æ„äº‹é¡¹-4" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h5><ul><li>èµ·å§‹ç´¢å¼•ä»0å¼€å§‹ï¼Œèµ·å§‹ç´¢å¼• = ï¼ˆæŸ¥è¯¢é¡µç  - 1ï¼‰ * æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</li><li>åˆ†é¡µæŸ¥è¯¢æ˜¯æ•°æ®åº“çš„æ–¹è¨€ï¼Œä¸åŒæ•°æ®åº“æœ‰ä¸åŒå®ç°ï¼ŒMySQLæ˜¯LIMIT</li><li>å¦‚æœæŸ¥è¯¢çš„æ˜¯ç¬¬ä¸€é¡µæ•°æ®ï¼Œèµ·å§‹ç´¢å¼•å¯ä»¥çœç•¥ï¼Œç›´æ¥ç®€å†™ LIMIT 10</li></ul><h4 id="DQLæ‰§è¡Œé¡ºåº"><a href="#DQLæ‰§è¡Œé¡ºåº" class="headerlink" title="DQLæ‰§è¡Œé¡ºåº"></a>DQLæ‰§è¡Œé¡ºåº</h4><p>FROM -&gt; WHERE -&gt; GROUP BY -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT</p><h3 id="DCL"><a href="#DCL" class="headerlink" title="DCL"></a>DCL</h3><h4 id="ç®¡ç†ç”¨æˆ·"><a href="#ç®¡ç†ç”¨æˆ·" class="headerlink" title="ç®¡ç†ç”¨æˆ·"></a>ç®¡ç†ç”¨æˆ·</h4><p>æŸ¥è¯¢ç”¨æˆ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">USER mysql;</span><br><span class="line">SELECT * FROM user;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºç”¨æˆ·:<br><code>CREATE USER &#39;ç”¨æˆ·å&#39;@&#39;ä¸»æœºå&#39; IDENTIFIED BY &#39;å¯†ç &#39;;</code></p><p>ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼š<br><code>ALTER USER &#39;ç”¨æˆ·å&#39;@&#39;ä¸»æœºå&#39; IDENTIFIED WITH mysql_native_password BY &#39;æ–°å¯†ç &#39;;</code></p><p>åˆ é™¤ç”¨æˆ·ï¼š<br><code>DROP USER &#39;ç”¨æˆ·å&#39;@&#39;ä¸»æœºå&#39;;</code></p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- åˆ›å»ºç”¨æˆ·testï¼Œåªèƒ½åœ¨å½“å‰ä¸»æœºlocalhostè®¿é—®</span><br><span class="line">create user &apos;test&apos;@&apos;localhost&apos; identified by &apos;123456&apos;;</span><br><span class="line">-- åˆ›å»ºç”¨æˆ·testï¼Œèƒ½åœ¨ä»»æ„ä¸»æœºè®¿é—®</span><br><span class="line">create user &apos;test&apos;@&apos;%&apos; identified by &apos;123456&apos;;</span><br><span class="line">create user &apos;test&apos; identified by &apos;123456&apos;;</span><br><span class="line">-- ä¿®æ”¹å¯†ç </span><br><span class="line">alter user &apos;test&apos;@&apos;localhost&apos; identified with mysql_native_password by &apos;1234&apos;;</span><br><span class="line">-- åˆ é™¤ç”¨æˆ·</span><br><span class="line">drop user &apos;test&apos;@&apos;localhost&apos;;</span><br></pre></td></tr></table></figure><h5 id="æ³¨æ„äº‹é¡¹-5"><a href="#æ³¨æ„äº‹é¡¹-5" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h5><ul><li>ä¸»æœºåå¯ä»¥ä½¿ç”¨ % é€šé…</li></ul><h4 id="æƒé™æ§åˆ¶"><a href="#æƒé™æ§åˆ¶" class="headerlink" title="æƒé™æ§åˆ¶"></a>æƒé™æ§åˆ¶</h4><p>å¸¸ç”¨æƒé™ï¼š</p><table><thead><tr><th>æƒé™</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ALL, ALL PRIVILEGES</td><td>æ‰€æœ‰æƒé™</td></tr><tr><td>SELECT</td><td>æŸ¥è¯¢æ•°æ®</td></tr><tr><td>INSERT</td><td>æ’å…¥æ•°æ®</td></tr><tr><td>UPDATE</td><td>ä¿®æ”¹æ•°æ®</td></tr><tr><td>DELETE</td><td>åˆ é™¤æ•°æ®</td></tr><tr><td>ALTER</td><td>ä¿®æ”¹è¡¨</td></tr><tr><td>DROP</td><td>åˆ é™¤æ•°æ®åº“/è¡¨/è§†å›¾</td></tr><tr><td>CREATE</td><td>åˆ›å»ºæ•°æ®åº“/è¡¨</td></tr></tbody></table><p>æ›´å¤šæƒé™è¯·çœ‹<a href="#æƒé™ä¸€è§ˆè¡¨" title="æƒé™ä¸€è§ˆè¡¨">æƒé™ä¸€è§ˆè¡¨</a></p><p>æŸ¥è¯¢æƒé™ï¼š<br><code>SHOW GRANTS FOR &#39;ç”¨æˆ·å&#39;@&#39;ä¸»æœºå&#39;;</code></p><p>æˆäºˆæƒé™ï¼š<br><code>GRANT æƒé™åˆ—è¡¨ ON æ•°æ®åº“å.è¡¨å TO &#39;ç”¨æˆ·å&#39;@&#39;ä¸»æœºå&#39;;</code></p><p>æ’¤é”€æƒé™ï¼š<br><code>REVOKE æƒé™åˆ—è¡¨ ON æ•°æ®åº“å.è¡¨å FROM &#39;ç”¨æˆ·å&#39;@&#39;ä¸»æœºå&#39;;</code></p><h5 id="æ³¨æ„äº‹é¡¹-6"><a href="#æ³¨æ„äº‹é¡¹-6" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h5><ul><li>å¤šä¸ªæƒé™ç”¨é€—å·åˆ†éš”</li><li>æˆæƒæ—¶ï¼Œæ•°æ®åº“åå’Œè¡¨åå¯ä»¥ç”¨ * è¿›è¡Œé€šé…ï¼Œä»£è¡¨æ‰€æœ‰</li></ul><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><ul><li>å­—ç¬¦ä¸²å‡½æ•°</li><li>æ•°å€¼å‡½æ•°</li><li>æ—¥æœŸå‡½æ•°</li><li>æµç¨‹å‡½æ•°</li></ul><h3 id="å­—ç¬¦ä¸²å‡½æ•°"><a href="#å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²å‡½æ•°"></a>å­—ç¬¦ä¸²å‡½æ•°</h3><p>å¸¸ç”¨å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>CONCAT(s1, s2, â€¦, sn)</td><td>å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå°†s1, s2, â€¦, snæ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</td></tr><tr><td>LOWER(str)</td><td>å°†å­—ç¬¦ä¸²å…¨éƒ¨è½¬ä¸ºå°å†™</td></tr><tr><td>UPPER(str)</td><td>å°†å­—ç¬¦ä¸²å…¨éƒ¨è½¬ä¸ºå¤§å†™</td></tr><tr><td>LPAD(str, n, pad)</td><td>å·¦å¡«å……ï¼Œç”¨å­—ç¬¦ä¸²padå¯¹strçš„å·¦è¾¹è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°nä¸ªå­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>RPAD(str, n, pad)</td><td>å³å¡«å……ï¼Œç”¨å­—ç¬¦ä¸²padå¯¹strçš„å³è¾¹è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°nä¸ªå­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>TRIM(str)</td><td>å»æ‰å­—ç¬¦ä¸²å¤´éƒ¨å’Œå°¾éƒ¨çš„ç©ºæ ¼</td></tr><tr><td>SUBSTRING(str, start, len)</td><td>è¿”å›ä»å­—ç¬¦ä¸²strä»startä½ç½®èµ·çš„lenä¸ªé•¿åº¦çš„å­—ç¬¦ä¸²</td></tr></tbody></table><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- æ‹¼æ¥</span><br><span class="line">SELECT CONCAT(&apos;Hello&apos;, &apos;World&apos;);</span><br><span class="line">-- å°å†™</span><br><span class="line">SELECT LOWER(&apos;Hello&apos;);</span><br><span class="line">-- å¤§å†™</span><br><span class="line">SELECT UPPER(&apos;Hello&apos;);</span><br><span class="line">-- å·¦å¡«å……</span><br><span class="line">SELECT LPAD(&apos;01&apos;, 5, &apos;-&apos;);</span><br><span class="line">-- å³å¡«å……</span><br><span class="line">SELECT RPAD(&apos;01&apos;, 5, &apos;-&apos;);</span><br><span class="line">-- å»é™¤ç©ºæ ¼</span><br><span class="line">SELECT TRIM(&apos; Hello World &apos;);</span><br><span class="line">-- åˆ‡ç‰‡ï¼ˆèµ·å§‹ç´¢å¼•ä¸º1ï¼‰</span><br><span class="line">SELECT SUBSTRING(&apos;Hello World&apos;, 1, 5);</span><br></pre></td></tr></table></figure><h3 id="æ•°å€¼å‡½æ•°"><a href="#æ•°å€¼å‡½æ•°" class="headerlink" title="æ•°å€¼å‡½æ•°"></a>æ•°å€¼å‡½æ•°</h3><p>å¸¸è§å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>CEIL(x)</td><td>å‘ä¸Šå–æ•´</td></tr><tr><td>FLOOR(x)</td><td>å‘ä¸‹å–æ•´</td></tr><tr><td>MOD(x, y)</td><td>è¿”å›x/yçš„æ¨¡</td></tr><tr><td>RAND()</td><td>è¿”å›0~1å†…çš„éšæœºæ•°</td></tr><tr><td>ROUND(x, y)</td><td>æ±‚å‚æ•°xçš„å››èˆäº”å…¥å€¼ï¼Œä¿ç•™yä½å°æ•°</td></tr></tbody></table><h3 id="æ—¥æœŸå‡½æ•°"><a href="#æ—¥æœŸå‡½æ•°" class="headerlink" title="æ—¥æœŸå‡½æ•°"></a>æ—¥æœŸå‡½æ•°</h3><p>å¸¸ç”¨å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>CURDATE()</td><td>è¿”å›å½“å‰æ—¥æœŸ</td></tr><tr><td>CURTIME()</td><td>è¿”å›å½“å‰æ—¶é—´</td></tr><tr><td>NOW()</td><td>è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´</td></tr><tr><td>YEAR(date)</td><td>è·å–æŒ‡å®šdateçš„å¹´ä»½</td></tr><tr><td>MONTH(date)</td><td>è·å–æŒ‡å®šdateçš„æœˆä»½</td></tr><tr><td>DAY(date)</td><td>è·å–æŒ‡å®šdateçš„æ—¥æœŸ</td></tr><tr><td>DATE_ADD(date, INTERVAL expr type)</td><td>è¿”å›ä¸€ä¸ªæ—¥æœŸ/æ—¶é—´å€¼åŠ ä¸Šä¸€ä¸ªæ—¶é—´é—´éš”expråçš„æ—¶é—´å€¼</td></tr><tr><td>DATEDIFF(date1, date2)</td><td>è¿”å›èµ·å§‹æ—¶é—´date1å’Œç»“æŸæ—¶é—´date2ä¹‹é—´çš„å¤©æ•°</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- DATE_ADD</span><br><span class="line">SELECT DATE_ADD(NOW(), INTERVAL 70 YEAR);</span><br></pre></td></tr></table></figure><h3 id="æµç¨‹å‡½æ•°"><a href="#æµç¨‹å‡½æ•°" class="headerlink" title="æµç¨‹å‡½æ•°"></a>æµç¨‹å‡½æ•°</h3><p>å¸¸ç”¨å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>IF(value, t, f)</td><td>å¦‚æœvalueä¸ºtrueï¼Œåˆ™è¿”å›tï¼Œå¦åˆ™è¿”å›f</td></tr><tr><td>IFNULL(value1, value2)</td><td>å¦‚æœvalue1ä¸ä¸ºç©ºï¼Œè¿”å›value1ï¼Œå¦åˆ™è¿”å›value2</td></tr><tr><td>CASE WHEN [ val1 ] THEN [ res1 ] â€¦ ELSE [ default ] END</td><td>å¦‚æœval1ä¸ºtrueï¼Œè¿”å›res1ï¼Œâ€¦ å¦åˆ™è¿”å›defaulté»˜è®¤å€¼</td></tr><tr><td>CASE [ expr ] WHEN [ val1 ] THEN [ res1 ] â€¦ ELSE [ default ] END</td><td>å¦‚æœexprçš„å€¼ç­‰äºval1ï¼Œè¿”å›res1ï¼Œâ€¦ å¦åˆ™è¿”å›defaulté»˜è®¤å€¼</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">name,</span><br><span class="line">(case when age &gt; 30 then &apos;ä¸­å¹´&apos; else &apos;é’å¹´&apos; end)</span><br><span class="line">from employee;</span><br><span class="line">select</span><br><span class="line">name,</span><br><span class="line">(case workaddress when &apos;åŒ—äº¬å¸‚&apos; then &apos;ä¸€çº¿åŸå¸‚&apos; when &apos;ä¸Šæµ·å¸‚&apos; then &apos;ä¸€çº¿åŸå¸‚&apos; else &apos;äºŒçº¿åŸå¸‚&apos; end) as &apos;å·¥ä½œåœ°å€&apos;</span><br><span class="line">from employee;</span><br></pre></td></tr></table></figure><h2 id="çº¦æŸ"><a href="#çº¦æŸ" class="headerlink" title="çº¦æŸ"></a>çº¦æŸ</h2><p>åˆ†ç±»ï¼š</p><table><thead><tr><th>çº¦æŸ</th><th>æè¿°</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>éç©ºçº¦æŸ</td><td>é™åˆ¶è¯¥å­—æ®µçš„æ•°æ®ä¸èƒ½ä¸ºnull</td><td>NOT NULL</td></tr><tr><td>å”¯ä¸€çº¦æŸ</td><td>ä¿è¯è¯¥å­—æ®µçš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯å”¯ä¸€ã€ä¸é‡å¤çš„</td><td>UNIQUE</td></tr><tr><td>ä¸»é”®çº¦æŸ</td><td>ä¸»é”®æ˜¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ ‡è¯†ï¼Œè¦æ±‚éç©ºä¸”å”¯ä¸€</td><td>PRIMARY KEY</td></tr><tr><td>é»˜è®¤çº¦æŸ</td><td>ä¿å­˜æ•°æ®æ—¶ï¼Œå¦‚æœæœªæŒ‡å®šè¯¥å­—æ®µçš„å€¼ï¼Œåˆ™é‡‡ç”¨é»˜è®¤å€¼</td><td>DEFAULT</td></tr><tr><td>æ£€æŸ¥çº¦æŸï¼ˆ8.0.1ç‰ˆæœ¬åï¼‰</td><td>ä¿è¯å­—æ®µå€¼æ»¡è¶³æŸä¸€ä¸ªæ¡ä»¶</td><td>CHECK</td></tr><tr><td>å¤–é”®çº¦æŸ</td><td>ç”¨æ¥è®©ä¸¤å¼ å›¾çš„æ•°æ®ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§</td><td>FOREIGN KEY</td></tr></tbody></table><p>çº¦æŸæ˜¯ä½œç”¨äºè¡¨ä¸­å­—æ®µä¸Šçš„ï¼Œå¯ä»¥å†åˆ›å»ºè¡¨/ä¿®æ”¹è¡¨çš„æ—¶å€™æ·»åŠ çº¦æŸã€‚</p><h3 id="å¸¸ç”¨çº¦æŸ"><a href="#å¸¸ç”¨çº¦æŸ" class="headerlink" title="å¸¸ç”¨çº¦æŸ"></a>å¸¸ç”¨çº¦æŸ</h3><table><thead><tr><th>çº¦æŸæ¡ä»¶</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>ä¸»é”®</td><td>PRIMARY KEY</td></tr><tr><td>è‡ªåŠ¨å¢é•¿</td><td>AUTO_INCREMENT</td></tr><tr><td>ä¸ä¸ºç©º</td><td>NOT NULL</td></tr><tr><td>å”¯ä¸€</td><td>UNIQUE</td></tr><tr><td>é€»è¾‘æ¡ä»¶</td><td>CHECK</td></tr><tr><td>é»˜è®¤å€¼</td><td>DEFAULT</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">name varchar(10) not null unique,</span><br><span class="line">age int check(age &gt; 0 and age &lt; 120),</span><br><span class="line">status char(1) default &apos;1&apos;,</span><br><span class="line">gender char(1)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="å¤–é”®çº¦æŸ"><a href="#å¤–é”®çº¦æŸ" class="headerlink" title="å¤–é”®çº¦æŸ"></a>å¤–é”®çº¦æŸ</h3><p>æ·»åŠ å¤–é”®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE è¡¨å(</span><br><span class="line">å­—æ®µå å­—æ®µç±»å‹,</span><br><span class="line">...</span><br><span class="line">[CONSTRAINT] [å¤–é”®åç§°] FOREIGN KEY(å¤–é”®å­—æ®µå) REFERENCES ä¸»è¡¨(ä¸»è¡¨åˆ—å)</span><br><span class="line">);</span><br><span class="line">ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®åç§° FOREIGN KEY (å¤–é”®å­—æ®µå) REFERENCES ä¸»è¡¨(ä¸»è¡¨åˆ—å);</span><br><span class="line"></span><br><span class="line">-- ä¾‹å­</span><br><span class="line">alter table emp add constraint fk_emp_dept_id foreign key(dept_id) references dept(id);</span><br></pre></td></tr></table></figure><p>åˆ é™¤å¤–é”®ï¼š<br><code>ALTER TABLE è¡¨å DROP FOREIGN KEY å¤–é”®å;</code></p><h4 id="åˆ é™¤-æ›´æ–°è¡Œä¸º"><a href="#åˆ é™¤-æ›´æ–°è¡Œä¸º" class="headerlink" title="åˆ é™¤/æ›´æ–°è¡Œä¸º"></a>åˆ é™¤/æ›´æ–°è¡Œä¸º</h4><table><thead><tr><th>è¡Œä¸º</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>NO ACTION</td><td>å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™ä¸å…è®¸åˆ é™¤/æ›´æ–°ï¼ˆä¸RESTRICTä¸€è‡´ï¼‰</td></tr><tr><td>RESTRICT</td><td>å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™ä¸å…è®¸åˆ é™¤/æ›´æ–°ï¼ˆä¸NO ACTIONä¸€è‡´ï¼‰</td></tr><tr><td>CASCADE</td><td>å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™ä¹Ÿåˆ é™¤/æ›´æ–°å¤–é”®åœ¨å­è¡¨ä¸­çš„è®°å½•</td></tr><tr><td>SET NULL</td><td>å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™è®¾ç½®å­è¡¨ä¸­è¯¥å¤–é”®å€¼ä¸ºnullï¼ˆè¦æ±‚è¯¥å¤–é”®å…è®¸ä¸ºnullï¼‰</td></tr><tr><td>SET DEFAULT</td><td>çˆ¶è¡¨æœ‰å˜æ›´æ—¶ï¼Œå­è¡¨å°†å¤–é”®è®¾ä¸ºä¸€ä¸ªé»˜è®¤å€¼ï¼ˆInnodbä¸æ”¯æŒï¼‰</td></tr></tbody></table><p>æ›´æ”¹åˆ é™¤/æ›´æ–°è¡Œä¸ºï¼š<br><code>ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®åç§° FOREIGN KEY (å¤–é”®å­—æ®µ) REFERENCES ä¸»è¡¨å(ä¸»è¡¨å­—æ®µå) ON UPDATE è¡Œä¸º ON DELETE è¡Œä¸º;</code></p><h2 id="å¤šè¡¨æŸ¥è¯¢"><a href="#å¤šè¡¨æŸ¥è¯¢" class="headerlink" title="å¤šè¡¨æŸ¥è¯¢"></a>å¤šè¡¨æŸ¥è¯¢</h2><h3 id="å¤šè¡¨å…³ç³»"><a href="#å¤šè¡¨å…³ç³»" class="headerlink" title="å¤šè¡¨å…³ç³»"></a>å¤šè¡¨å…³ç³»</h3><ul><li>ä¸€å¯¹å¤šï¼ˆå¤šå¯¹ä¸€ï¼‰</li><li>å¤šå¯¹å¤š</li><li>ä¸€å¯¹ä¸€</li></ul><h4 id="ä¸€å¯¹å¤š"><a href="#ä¸€å¯¹å¤š" class="headerlink" title="ä¸€å¯¹å¤š"></a>ä¸€å¯¹å¤š</h4><p>æ¡ˆä¾‹ï¼šéƒ¨é—¨ä¸å‘˜å·¥<br>å…³ç³»ï¼šä¸€ä¸ªéƒ¨é—¨å¯¹åº”å¤šä¸ªå‘˜å·¥ï¼Œä¸€ä¸ªå‘˜å·¥å¯¹åº”ä¸€ä¸ªéƒ¨é—¨<br>å®ç°ï¼šåœ¨å¤šçš„ä¸€æ–¹å»ºç«‹å¤–é”®ï¼ŒæŒ‡å‘ä¸€çš„ä¸€æ–¹çš„ä¸»é”®</p><h4 id="å¤šå¯¹å¤š"><a href="#å¤šå¯¹å¤š" class="headerlink" title="å¤šå¯¹å¤š"></a>å¤šå¯¹å¤š</h4><p>æ¡ˆä¾‹ï¼šå­¦ç”Ÿä¸è¯¾ç¨‹<br>å…³ç³»ï¼šä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰å¤šé—¨è¯¾ç¨‹ï¼Œä¸€é—¨è¯¾ç¨‹ä¹Ÿå¯ä»¥ä¾›å¤šä¸ªå­¦ç”Ÿé€‰ä¿®<br>å®ç°ï¼šå»ºç«‹ç¬¬ä¸‰å¼ ä¸­é—´è¡¨ï¼Œä¸­é—´è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªå¤–é”®ï¼Œåˆ†åˆ«å…³è”ä¸¤æ–¹ä¸»é”®</p><h4 id="ä¸€å¯¹ä¸€"><a href="#ä¸€å¯¹ä¸€" class="headerlink" title="ä¸€å¯¹ä¸€"></a>ä¸€å¯¹ä¸€</h4><p>æ¡ˆä¾‹ï¼šç”¨æˆ·ä¸ç”¨æˆ·è¯¦æƒ…<br>å…³ç³»ï¼šä¸€å¯¹ä¸€å…³ç³»ï¼Œå¤šç”¨äºå•è¡¨æ‹†åˆ†ï¼Œå°†ä¸€å¼ è¡¨çš„åŸºç¡€å­—æ®µæ”¾åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œå…¶ä»–è¯¦æƒ…å­—æ®µæ”¾åœ¨å¦ä¸€å¼ è¡¨ä¸­ï¼Œä»¥æå‡æ“ä½œæ•ˆç‡<br>å®ç°ï¼šåœ¨ä»»æ„ä¸€æ–¹åŠ å…¥å¤–é”®ï¼Œå…³è”å¦å¤–ä¸€æ–¹çš„ä¸»é”®ï¼Œå¹¶ä¸”è®¾ç½®å¤–é”®ä¸ºå”¯ä¸€çš„ï¼ˆUNIQUEï¼‰</p><h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><p>åˆå¹¶æŸ¥è¯¢ï¼ˆç¬›å¡å°”ç§¯ï¼Œä¼šå±•ç¤ºæ‰€æœ‰ç»„åˆç»“æœï¼‰ï¼š<br><code>select * from employee, dept;</code></p><blockquote><p>ç¬›å¡å°”ç§¯ï¼šä¸¤ä¸ªé›†åˆAé›†åˆå’ŒBé›†åˆçš„æ‰€æœ‰ç»„åˆæƒ…å†µï¼ˆåœ¨å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œéœ€è¦æ¶ˆé™¤æ— æ•ˆçš„ç¬›å¡å°”ç§¯ï¼‰</p></blockquote><p>æ¶ˆé™¤æ— æ•ˆç¬›å¡å°”ç§¯ï¼š<br><code>select * from employee, dept where employee.dept = dept.id;</code></p><h3 id="å†…è¿æ¥æŸ¥è¯¢"><a href="#å†…è¿æ¥æŸ¥è¯¢" class="headerlink" title="å†…è¿æ¥æŸ¥è¯¢"></a>å†…è¿æ¥æŸ¥è¯¢</h3><p>å†…è¿æ¥æŸ¥è¯¢çš„æ˜¯ä¸¤å¼ è¡¨äº¤é›†çš„éƒ¨åˆ†</p><p>éšå¼å†…è¿æ¥ï¼š<br><code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1, è¡¨2 WHERE æ¡ä»¶ ...;</code></p><p>æ˜¾å¼å†…è¿æ¥ï¼š<br><code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 [ INNER ] JOIN è¡¨2 ON è¿æ¥æ¡ä»¶ ...;</code></p><p>æ˜¾å¼æ€§èƒ½æ¯”éšå¼é«˜</p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢å‘˜å·¥å§“åï¼ŒåŠå…³è”çš„éƒ¨é—¨çš„åç§°</span><br><span class="line">-- éšå¼</span><br><span class="line">select e.name, d.name from employee as e, dept as d where e.dept = d.id;</span><br><span class="line">-- æ˜¾å¼</span><br><span class="line">select e.name, d.name from employee as e inner join dept as d on e.dept = d.id;</span><br></pre></td></tr></table></figure><h3 id="å¤–è¿æ¥æŸ¥è¯¢"><a href="#å¤–è¿æ¥æŸ¥è¯¢" class="headerlink" title="å¤–è¿æ¥æŸ¥è¯¢"></a>å¤–è¿æ¥æŸ¥è¯¢</h3><p>å·¦å¤–è¿æ¥ï¼š<br>æŸ¥è¯¢å·¦è¡¨æ‰€æœ‰æ•°æ®ï¼Œä»¥åŠä¸¤å¼ è¡¨äº¤é›†éƒ¨åˆ†æ•°æ®<br><code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 LEFT [ OUTER ] JOIN è¡¨2 ON æ¡ä»¶ ...;</code><br>ç›¸å½“äºæŸ¥è¯¢è¡¨1çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…å«è¡¨1å’Œè¡¨2äº¤é›†éƒ¨åˆ†æ•°æ®</p><p>å³å¤–è¿æ¥ï¼š<br>æŸ¥è¯¢å³è¡¨æ‰€æœ‰æ•°æ®ï¼Œä»¥åŠä¸¤å¼ è¡¨äº¤é›†éƒ¨åˆ†æ•°æ®<br><code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 RIGHT [ OUTER ] JOIN è¡¨2 ON æ¡ä»¶ ...;</code></p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- å·¦</span><br><span class="line">select e.*, d.name from employee as e left outer join dept as d on e.dept = d.id;</span><br><span class="line">select d.name, e.* from dept d left outer join emp e on e.dept = d.id;  -- è¿™æ¡è¯­å¥ä¸ä¸‹é¢çš„è¯­å¥æ•ˆæœä¸€æ ·</span><br><span class="line">-- å³</span><br><span class="line">select d.name, e.* from employee as e right outer join dept as d on e.dept = d.id;</span><br></pre></td></tr></table></figure><p>å·¦è¿æ¥å¯ä»¥æŸ¥è¯¢åˆ°æ²¡æœ‰deptçš„employeeï¼Œå³è¿æ¥å¯ä»¥æŸ¥è¯¢åˆ°æ²¡æœ‰employeeçš„dept</p><h3 id="è‡ªè¿æ¥æŸ¥è¯¢"><a href="#è‡ªè¿æ¥æŸ¥è¯¢" class="headerlink" title="è‡ªè¿æ¥æŸ¥è¯¢"></a>è‡ªè¿æ¥æŸ¥è¯¢</h3><p>å½“å‰è¡¨ä¸è‡ªèº«çš„è¿æ¥æŸ¥è¯¢ï¼Œè‡ªè¿æ¥å¿…é¡»ä½¿ç”¨è¡¨åˆ«å</p><p>è¯­æ³•ï¼š<br><code>SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨A åˆ«åA JOIN è¡¨A åˆ«åB ON æ¡ä»¶ ...;</code></p><p>è‡ªè¿æ¥æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯å†…è¿æ¥æŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤–è¿æ¥æŸ¥è¯¢</p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢å‘˜å·¥åŠå…¶æ‰€å±é¢†å¯¼çš„åå­—</span><br><span class="line">select a.name, b.name from employee a, employee b where a.manager = b.id;</span><br><span class="line">-- æ²¡æœ‰é¢†å¯¼çš„ä¹ŸæŸ¥è¯¢å‡ºæ¥</span><br><span class="line">select a.name, b.name from employee a left join employee b on a.manager = b.id;</span><br></pre></td></tr></table></figure><h3 id="è”åˆæŸ¥è¯¢-union-union-all"><a href="#è”åˆæŸ¥è¯¢-union-union-all" class="headerlink" title="è”åˆæŸ¥è¯¢ union, union all"></a>è”åˆæŸ¥è¯¢ union, union all</h3><p>æŠŠå¤šæ¬¡æŸ¥è¯¢çš„ç»“æœåˆå¹¶ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æŸ¥è¯¢é›†</p><p>è¯­æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨A ...</span><br><span class="line">UNION [ALL]</span><br><span class="line">SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨B ...</span><br></pre></td></tr></table></figure><h4 id="æ³¨æ„äº‹é¡¹-7"><a href="#æ³¨æ„äº‹é¡¹-7" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><ul><li>UNION ALL ä¼šæœ‰é‡å¤ç»“æœï¼ŒUNION ä¸ä¼š</li><li>è”åˆæŸ¥è¯¢æ¯”ä½¿ç”¨oræ•ˆç‡é«˜ï¼Œä¸ä¼šä½¿ç´¢å¼•å¤±æ•ˆ</li></ul><h3 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h3><p>SQLè¯­å¥ä¸­åµŒå¥—SELECTè¯­å¥ï¼Œç§°è°“åµŒå¥—æŸ¥è¯¢ï¼Œåˆç§°å­æŸ¥è¯¢ã€‚<br><code>SELECT * FROM t1 WHERE column1 = ( SELECT column1 FROM t2);</code><br><strong>å­æŸ¥è¯¢å¤–éƒ¨çš„è¯­å¥å¯ä»¥æ˜¯ INSERT / UPDATE / DELETE / SELECT çš„ä»»ä½•ä¸€ä¸ª</strong></p><p>æ ¹æ®å­æŸ¥è¯¢ç»“æœå¯ä»¥åˆ†ä¸ºï¼š</p><ul><li>æ ‡é‡å­æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ç»“æœä¸ºå•ä¸ªå€¼ï¼‰</li><li>åˆ—å­æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ç»“æœä¸ºä¸€åˆ—ï¼‰</li><li>è¡Œå­æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ç»“æœä¸ºä¸€è¡Œï¼‰</li><li>è¡¨å­æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ç»“æœä¸ºå¤šè¡Œå¤šåˆ—ï¼‰</li></ul><p>æ ¹æ®å­æŸ¥è¯¢ä½ç½®å¯åˆ†ä¸ºï¼š</p><ul><li>WHERE ä¹‹å</li><li>FROM ä¹‹å</li><li>SELECT ä¹‹å</li></ul><h4 id="æ ‡é‡å­æŸ¥è¯¢"><a href="#æ ‡é‡å­æŸ¥è¯¢" class="headerlink" title="æ ‡é‡å­æŸ¥è¯¢"></a>æ ‡é‡å­æŸ¥è¯¢</h4><p>å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯å•ä¸ªå€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€æ—¥æœŸç­‰ï¼‰ã€‚<br>å¸¸ç”¨æ“ä½œç¬¦ï¼š- &lt; &gt; &gt; &gt;= &lt; &lt;=</p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢é”€å”®éƒ¨æ‰€æœ‰å‘˜å·¥</span><br><span class="line">select id from dept where name = &apos;é”€å”®éƒ¨&apos;;</span><br><span class="line">-- æ ¹æ®é”€å”®éƒ¨éƒ¨é—¨IDï¼ŒæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</span><br><span class="line">select * from employee where dept = 4;</span><br><span class="line">-- åˆå¹¶ï¼ˆå­æŸ¥è¯¢ï¼‰</span><br><span class="line">select * from employee where dept = (select id from dept where name = &apos;é”€å”®éƒ¨&apos;);</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢xxxå…¥èŒä¹‹åçš„å‘˜å·¥ä¿¡æ¯</span><br><span class="line">select * from employee where entrydate &gt; (select entrydate from employee where name = &apos;xxx&apos;);</span><br></pre></td></tr></table></figure><h4 id="åˆ—å­æŸ¥è¯¢"><a href="#åˆ—å­æŸ¥è¯¢" class="headerlink" title="åˆ—å­æŸ¥è¯¢"></a>åˆ—å­æŸ¥è¯¢</h4><p>è¿”å›çš„ç»“æœæ˜¯ä¸€åˆ—ï¼ˆå¯ä»¥æ˜¯å¤šè¡Œï¼‰ã€‚</p><p>å¸¸ç”¨æ“ä½œç¬¦ï¼š</p><table><thead><tr><th>æ“ä½œç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td>IN</td><td>åœ¨æŒ‡å®šçš„é›†åˆèŒƒå›´å†…ï¼Œå¤šé€‰ä¸€</td></tr><tr><td>NOT IN</td><td>ä¸åœ¨æŒ‡å®šçš„é›†åˆèŒƒå›´å†…</td></tr><tr><td>ANY</td><td>å­æŸ¥è¯¢è¿”å›åˆ—è¡¨ä¸­ï¼Œæœ‰ä»»æ„ä¸€ä¸ªæ»¡è¶³å³å¯</td></tr><tr><td>SOME</td><td>ä¸ANYç­‰åŒï¼Œä½¿ç”¨SOMEçš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ANY</td></tr><tr><td>ALL</td><td>å­æŸ¥è¯¢è¿”å›åˆ—è¡¨çš„æ‰€æœ‰å€¼éƒ½å¿…é¡»æ»¡è¶³</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢é”€å”®éƒ¨å’Œå¸‚åœºéƒ¨çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯</span><br><span class="line">select * from employee where dept in (select id from dept where name = &apos;é”€å”®éƒ¨&apos; or name = &apos;å¸‚åœºéƒ¨&apos;);</span><br><span class="line">-- æŸ¥è¯¢æ¯”è´¢åŠ¡éƒ¨æ‰€æœ‰äººå·¥èµ„éƒ½é«˜çš„å‘˜å·¥ä¿¡æ¯</span><br><span class="line">select * from employee where salary &gt; all(select salary from employee where dept = (select id from dept where name = &apos;è´¢åŠ¡éƒ¨&apos;));</span><br><span class="line">-- æŸ¥è¯¢æ¯”ç ”å‘éƒ¨ä»»æ„ä¸€äººå·¥èµ„é«˜çš„å‘˜å·¥ä¿¡æ¯</span><br><span class="line">select * from employee where salary &gt; any (select salary from employee where dept = (select id from dept where name = &apos;ç ”å‘éƒ¨&apos;));</span><br></pre></td></tr></table></figure><h4 id="è¡Œå­æŸ¥è¯¢"><a href="#è¡Œå­æŸ¥è¯¢" class="headerlink" title="è¡Œå­æŸ¥è¯¢"></a>è¡Œå­æŸ¥è¯¢</h4><p>è¿”å›çš„ç»“æœæ˜¯ä¸€è¡Œï¼ˆå¯ä»¥æ˜¯å¤šåˆ—ï¼‰ã€‚<br>å¸¸ç”¨æ“ä½œç¬¦ï¼š=, &lt;, &gt;, IN, NOT IN</p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢ä¸xxxçš„è–ªèµ„åŠç›´å±é¢†å¯¼ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯</span><br><span class="line">select * from employee where (salary, manager) = (12500, 1);</span><br><span class="line">select * from employee where (salary, manager) = (select salary, manager from employee where name = &apos;xxx&apos;);</span><br></pre></td></tr></table></figure><h4 id="è¡¨å­æŸ¥è¯¢"><a href="#è¡¨å­æŸ¥è¯¢" class="headerlink" title="è¡¨å­æŸ¥è¯¢"></a>è¡¨å­æŸ¥è¯¢</h4><p>è¿”å›çš„ç»“æœæ˜¯å¤šè¡Œå¤šåˆ—<br>å¸¸ç”¨æ“ä½œç¬¦ï¼šIN</p><p>ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢ä¸xxx1ï¼Œxxx2çš„èŒä½å’Œè–ªèµ„ç›¸åŒçš„å‘˜å·¥</span><br><span class="line">select * from employee where (job, salary) in (select job, salary from employee where name = &apos;xxx1&apos; or name = &apos;xxx2&apos;);</span><br><span class="line">-- æŸ¥è¯¢å…¥èŒæ—¥æœŸæ˜¯2006-01-01ä¹‹åçš„å‘˜å·¥ï¼ŒåŠå…¶éƒ¨é—¨ä¿¡æ¯</span><br><span class="line">select e.*, d.* from (select * from employee where entrydate &gt; &apos;2006-01-01&apos;) as e left join dept as d on e.dept = d.id;</span><br></pre></td></tr></table></figure><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><p>äº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><p>åŸºæœ¬æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- 1. æŸ¥è¯¢å¼ ä¸‰è´¦æˆ·ä½™é¢</span><br><span class="line">select * from account where name = &apos;å¼ ä¸‰&apos;;</span><br><span class="line">-- 2. å°†å¼ ä¸‰è´¦æˆ·ä½™é¢-1000</span><br><span class="line">update account set money = money - 1000 where name = &apos;å¼ ä¸‰&apos;;</span><br><span class="line">-- æ­¤è¯­å¥å‡ºé”™åå¼ ä¸‰é’±å‡å°‘ä½†æ˜¯æå››é’±æ²¡æœ‰å¢åŠ </span><br><span class="line">æ¨¡æ‹Ÿsqlè¯­å¥é”™è¯¯</span><br><span class="line">-- 3. å°†æå››è´¦æˆ·ä½™é¢+1000</span><br><span class="line">update account set money = money + 1000 where name = &apos;æå››&apos;;</span><br><span class="line"></span><br><span class="line">-- æŸ¥çœ‹äº‹åŠ¡æäº¤æ–¹å¼</span><br><span class="line">SELECT @@AUTOCOMMIT;</span><br><span class="line">-- è®¾ç½®äº‹åŠ¡æäº¤æ–¹å¼ï¼Œ1ä¸ºè‡ªåŠ¨æäº¤ï¼Œ0ä¸ºæ‰‹åŠ¨æäº¤ï¼Œè¯¥è®¾ç½®åªå¯¹å½“å‰ä¼šè¯æœ‰æ•ˆ</span><br><span class="line">SET @@AUTOCOMMIT = 0;</span><br><span class="line">-- æäº¤äº‹åŠ¡</span><br><span class="line">COMMIT;</span><br><span class="line">-- å›æ»šäº‹åŠ¡</span><br><span class="line">ROLLBACK;</span><br><span class="line"></span><br><span class="line">-- è®¾ç½®æ‰‹åŠ¨æäº¤åä¸Šé¢ä»£ç æ”¹ä¸ºï¼š</span><br><span class="line">select * from account where name = &apos;å¼ ä¸‰&apos;;</span><br><span class="line">update account set money = money - 1000 where name = &apos;å¼ ä¸‰&apos;;</span><br><span class="line">update account set money = money + 1000 where name = &apos;æå››&apos;;</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure><p>æ“ä½œæ–¹å¼äºŒï¼š</p><p>å¼€å¯äº‹åŠ¡ï¼š<br><code>START TRANSACTION æˆ– BEGIN TRANSACTION;</code><br>æäº¤äº‹åŠ¡ï¼š<br><code>COMMIT;</code><br>å›æ»šäº‹åŠ¡ï¼š<br><code>ROLLBACK;</code></p><p>æ“ä½œå®ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">start transaction;</span><br><span class="line">select * from account where name = &apos;å¼ ä¸‰&apos;;</span><br><span class="line">update account set money = money - 1000 where name = &apos;å¼ ä¸‰&apos;;</span><br><span class="line">update account set money = money + 1000 where name = &apos;æå››&apos;;</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure><h3 id="å››å¤§ç‰¹æ€§ACID"><a href="#å››å¤§ç‰¹æ€§ACID" class="headerlink" title="å››å¤§ç‰¹æ€§ACID"></a>å››å¤§ç‰¹æ€§ACID</h3><ul><li>åŸå­æ€§(Atomicity)ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œä½†æ„¿ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</li><li>ä¸€è‡´æ€§(Consistency)ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€</li><li>éš”ç¦»æ€§(Isolation)ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œ</li><li>æŒä¹…æ€§(Durability)ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„</li></ul><h3 id="å¹¶å‘äº‹åŠ¡"><a href="#å¹¶å‘äº‹åŠ¡" class="headerlink" title="å¹¶å‘äº‹åŠ¡"></a>å¹¶å‘äº‹åŠ¡</h3><table><thead><tr><th>é—®é¢˜</th><th>æè¿°</th></tr></thead><tbody><tr><td>è„è¯»</td><td>ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤çš„æ•°æ®</td></tr><tr><td>ä¸å¯é‡å¤è¯»</td><td>ä¸€ä¸ªäº‹åŠ¡å…ˆåè¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸åŒ</td></tr><tr><td>å¹»è¯»</td><td>ä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ²¡æœ‰å¯¹åº”çš„æ•°æ®è¡Œï¼Œä½†æ˜¯å†æ’å…¥æ•°æ®æ—¶ï¼Œåˆå‘ç°è¿™è¡Œæ•°æ®å·²ç»å­˜åœ¨</td></tr></tbody></table><blockquote><p>è¿™ä¸‰ä¸ªé—®é¢˜çš„è¯¦ç»†æ¼”ç¤ºï¼š<a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=55cd" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1Kr4y1i7ru?p=55cd</a> </p></blockquote><p>å¹¶å‘äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th></tr></thead><tbody><tr><td>Read uncommitted</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Read committed</td><td>Ã—</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Repeatable Read(é»˜è®¤)</td><td>Ã—</td><td>Ã—</td><td>âˆš</td></tr><tr><td>Serializable</td><td>Ã—</td><td>Ã—</td><td>Ã—</td></tr></tbody></table><ul><li>âˆšè¡¨ç¤ºåœ¨å½“å‰éš”ç¦»çº§åˆ«ä¸‹è¯¥é—®é¢˜ä¼šå‡ºç°</li><li>Serializable æ€§èƒ½æœ€ä½ï¼›Read uncommitted æ€§èƒ½æœ€é«˜ï¼Œæ•°æ®å®‰å…¨æ€§æœ€å·®</li></ul><p>æŸ¥çœ‹äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š<br><code>SELECT @@TRANSACTION_ISOLATION;</code><br>è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š<br><code>SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE };</code><br>SESSION æ˜¯ä¼šè¯çº§åˆ«ï¼Œè¡¨ç¤ºåªé’ˆå¯¹å½“å‰ä¼šè¯æœ‰æ•ˆï¼ŒGLOBAL è¡¨ç¤ºå¯¹æ‰€æœ‰ä¼šè¯æœ‰æ•ˆ</p><h1 id="è¿›é˜¶ç¯‡"><a href="#è¿›é˜¶ç¯‡" class="headerlink" title="è¿›é˜¶ç¯‡"></a>è¿›é˜¶ç¯‡</h1><h2 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h2><p>MySQLä½“ç³»ç»“æ„ï¼š</p><p><img src="https://dhc.pythonanywhere.com/media/editor/MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84_20220315034329549927.png" alt="ç»“æ„å›¾" title="ç»“æ„å›¾"><br><img src="https://dhc.pythonanywhere.com/media/editor/MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%B1%82%E7%BA%A7%E5%90%AB%E4%B9%89_20220315034359342837.png" alt="å±‚çº§æè¿°" title="å±‚çº§æè¿°"></p><p>å­˜å‚¨å¼•æ“å°±æ˜¯å­˜å‚¨æ•°æ®ã€å»ºç«‹ç´¢å¼•ã€æ›´æ–°/æŸ¥è¯¢æ•°æ®ç­‰æŠ€æœ¯çš„å®ç°æ–¹å¼ã€‚å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨è€Œä¸æ˜¯åŸºäºåº“çš„ï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“ä¹Ÿå¯ä»¥è¢«ç§°ä¸ºè¡¨å¼•æ“ã€‚<br>é»˜è®¤å­˜å‚¨å¼•æ“æ˜¯InnoDBã€‚</p><p>ç›¸å…³æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢å»ºè¡¨è¯­å¥</span><br><span class="line">show create table account;</span><br><span class="line">-- å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“</span><br><span class="line">CREATE TABLE è¡¨å(</span><br><span class="line">...</span><br><span class="line">) ENGINE=INNODB;</span><br><span class="line">-- æŸ¥çœ‹å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“</span><br><span class="line">show engines;</span><br></pre></td></tr></table></figure><h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><p>InnoDB æ˜¯ä¸€ç§å…¼é¡¾é«˜å¯é æ€§å’Œé«˜æ€§èƒ½çš„é€šç”¨å­˜å‚¨å¼•æ“ï¼Œåœ¨ MySQL 5.5 ä¹‹åï¼ŒInnoDB æ˜¯é»˜è®¤çš„ MySQL å¼•æ“ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>DML æ“ä½œéµå¾ª ACID æ¨¡å‹ï¼Œæ”¯æŒ<strong>äº‹åŠ¡</strong></li><li><strong>è¡Œçº§é”</strong>ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½</li><li>æ”¯æŒ<strong>å¤–é”®</strong>çº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§</li></ul><p>æ–‡ä»¶ï¼š</p><ul><li>xxx.ibd: xxxä»£è¡¨è¡¨åï¼ŒInnoDB å¼•æ“çš„æ¯å¼ è¡¨éƒ½ä¼šå¯¹åº”è¿™æ ·ä¸€ä¸ªè¡¨ç©ºé—´æ–‡ä»¶ï¼Œå­˜å‚¨è¯¥è¡¨çš„è¡¨ç»“æ„ï¼ˆfrmã€sdiï¼‰ã€æ•°æ®å’Œç´¢å¼•ã€‚</li></ul><p>å‚æ•°ï¼šinnodb_file_per_tableï¼Œå†³å®šå¤šå¼ è¡¨å…±äº«ä¸€ä¸ªè¡¨ç©ºé—´è¿˜æ˜¯æ¯å¼ è¡¨å¯¹åº”ä¸€ä¸ªè¡¨ç©ºé—´</p><p>çŸ¥è¯†ç‚¹ï¼š</p><p>æŸ¥çœ‹ Mysql å˜é‡ï¼š<br><code>show variables like &#39;innodb_file_per_table&#39;;</code></p><p>ä»idbæ–‡ä»¶æå–è¡¨ç»“æ„æ•°æ®ï¼š<br>ï¼ˆåœ¨cmdè¿è¡Œï¼‰<br><code>ibd2sdi xxx.ibd</code></p><p>InnoDB é€»è¾‘å­˜å‚¨ç»“æ„ï¼š<br><img src="https://dhc.pythonanywhere.com/media/editor/%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84_20220316030616590001.png" alt="InnoDBé€»è¾‘å­˜å‚¨ç»“æ„" title="InnoDBé€»è¾‘å­˜å‚¨ç»“æ„"></p><h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h3><p>MyISAM æ˜¯ MySQL æ—©æœŸçš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®</li><li>æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”</li><li>è®¿é—®é€Ÿåº¦å¿«</li></ul><p>æ–‡ä»¶ï¼š</p><ul><li>xxx.sdi: å­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯</li><li>xxx.MYD: å­˜å‚¨æ•°æ®</li><li>xxx.MYI: å­˜å‚¨ç´¢å¼•</li></ul><h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><p>Memory å¼•æ“çš„è¡¨æ•°æ®æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œå—ç¡¬ä»¶é—®é¢˜ã€æ–­ç”µé—®é¢˜çš„å½±å“ï¼Œåªèƒ½å°†è¿™äº›è¡¨ä½œä¸ºä¸´æ—¶è¡¨æˆ–ç¼“å­˜ä½¿ç”¨ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦å¿«</li><li>hashç´¢å¼•ï¼ˆé»˜è®¤ï¼‰</li></ul><p>æ–‡ä»¶ï¼š</p><ul><li>xxx.sdi: å­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯</li></ul><h3 id="å­˜å‚¨å¼•æ“ç‰¹ç‚¹"><a href="#å­˜å‚¨å¼•æ“ç‰¹ç‚¹" class="headerlink" title="å­˜å‚¨å¼•æ“ç‰¹ç‚¹"></a>å­˜å‚¨å¼•æ“ç‰¹ç‚¹</h3><table><thead><tr><th>ç‰¹ç‚¹</th><th>InnoDB</th><th>MyISAM</th><th>Memory</th></tr></thead><tbody><tr><td>å­˜å‚¨é™åˆ¶</td><td>64TB</td><td>æœ‰</td><td>æœ‰</td></tr><tr><td>äº‹åŠ¡å®‰å…¨</td><td>æ”¯æŒ</td><td>-</td><td>-</td></tr><tr><td>é”æœºåˆ¶</td><td>è¡Œé”</td><td>è¡¨é”</td><td>è¡¨é”</td></tr><tr><td>B+treeç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>Hashç´¢å¼•</td><td>-</td><td>-</td><td>æ”¯æŒ</td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>æ”¯æŒï¼ˆ5.6ç‰ˆæœ¬ä¹‹åï¼‰</td><td>æ”¯æŒ</td><td>-</td></tr><tr><td>ç©ºé—´ä½¿ç”¨</td><td>é«˜</td><td>ä½</td><td>N/A</td></tr><tr><td>å†…å­˜ä½¿ç”¨</td><td>é«˜</td><td>ä½</td><td>ä¸­ç­‰</td></tr><tr><td>æ‰¹é‡æ’å…¥é€Ÿåº¦</td><td>ä½</td><td>é«˜</td><td>é«˜</td></tr><tr><td>æ”¯æŒå¤–é”®</td><td>æ”¯æŒ</td><td>-</td><td>-</td></tr></tbody></table><h3 id="å­˜å‚¨å¼•æ“çš„é€‰æ‹©"><a href="#å­˜å‚¨å¼•æ“çš„é€‰æ‹©" class="headerlink" title="å­˜å‚¨å¼•æ“çš„é€‰æ‹©"></a>å­˜å‚¨å¼•æ“çš„é€‰æ‹©</h3><p>åœ¨é€‰æ‹©å­˜å‚¨å¼•æ“æ—¶ï¼Œåº”è¯¥æ ¹æ®åº”ç”¨ç³»ç»Ÿçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚å¯¹äºå¤æ‚çš„åº”ç”¨ç³»ç»Ÿï¼Œè¿˜å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©å¤šç§å­˜å‚¨å¼•æ“è¿›è¡Œç»„åˆã€‚</p><ul><li>InnoDB: å¦‚æœåº”ç”¨å¯¹äº‹ç‰©çš„å®Œæ•´æ€§æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ•°æ®æ“ä½œé™¤äº†æ’å…¥å’ŒæŸ¥è¯¢ä¹‹å¤–ï¼Œè¿˜åŒ…å«å¾ˆå¤šçš„æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œåˆ™ InnoDB æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©</li><li>MyISAM: å¦‚æœåº”ç”¨æ˜¯ä»¥è¯»æ“ä½œå’Œæ’å…¥æ“ä½œä¸ºä¸»ï¼Œåªæœ‰å¾ˆå°‘çš„æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œå¹¶ä¸”å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§ã€å¹¶å‘æ€§è¦æ±‚ä¸é«˜ï¼Œé‚£è¿™ä¸ªå­˜å‚¨å¼•æ“æ˜¯éå¸¸åˆé€‚çš„ã€‚</li><li>Memory: å°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œé€šå¸¸ç”¨äºä¸´æ—¶è¡¨åŠç¼“å­˜ã€‚Memory çš„ç¼ºé™·æ˜¯å¯¹è¡¨çš„å¤§å°æœ‰é™åˆ¶ï¼Œå¤ªå¤§çš„è¡¨æ— æ³•ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸”æ— æ³•ä¿éšœæ•°æ®çš„å®‰å…¨æ€§</li></ul><p>ç”µå•†ä¸­çš„è¶³è¿¹å’Œè¯„è®ºé€‚åˆä½¿ç”¨ MyISAM å¼•æ“ï¼Œç¼“å­˜é€‚åˆä½¿ç”¨ Memory å¼•æ“ã€‚</p><h2 id="æ€§èƒ½åˆ†æ"><a href="#æ€§èƒ½åˆ†æ" class="headerlink" title="æ€§èƒ½åˆ†æ"></a>æ€§èƒ½åˆ†æ</h2><h3 id="æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡"><a href="#æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡" class="headerlink" title="æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡"></a>æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡</h3><p>æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„ INSERT, UPDATE, DELETE, SELECT è®¿é—®é¢‘æ¬¡ï¼š<br><code>SHOW GLOBAL STATUS LIKE &#39;Com_______&#39;;</code> æˆ–è€… <code>SHOW SESSION STATUS LIKE &#39;Com_______&#39;;</code><br>ä¾‹ï¼š<code>show global status like &#39;Com_______&#39;</code></p><h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="æ…¢æŸ¥è¯¢æ—¥å¿—"></a>æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šå‚æ•°ï¼ˆlong_query_timeï¼Œå•ä½ï¼šç§’ï¼Œé»˜è®¤10ç§’ï¼‰çš„æ‰€æœ‰SQLè¯­å¥çš„æ—¥å¿—ã€‚<br>MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ²¡æœ‰å¼€å¯ï¼Œéœ€è¦åœ¨MySQLçš„é…ç½®æ–‡ä»¶ï¼ˆ/etc/my.cnfï¼‰ä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯ï¼š<br>    # å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å¼€å…³<br>    slow_query_log=1<br>    # è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ—¶é—´ä¸º2ç§’ï¼ŒSQLè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡2ç§’ï¼Œå°±ä¼šè§†ä¸ºæ…¢æŸ¥è¯¢ï¼Œè®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—<br>    long_query_time=2</p><p>æ›´æ”¹åè®°å¾—é‡å¯MySQLæœåŠ¡ï¼Œæ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š/var/lib/mysql/localhost-slow.log</p><p>æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—å¼€å…³çŠ¶æ€ï¼š<br><code>show variables like &#39;slow_query_log&#39;;</code></p><h3 id="profile"><a href="#profile" class="headerlink" title="profile"></a>profile</h3><p>show profile èƒ½åœ¨åšSQLä¼˜åŒ–æ—¶å¸®æˆ‘ä»¬äº†è§£æ—¶é—´éƒ½è€—è´¹åœ¨å“ªé‡Œã€‚é€šè¿‡ have_profiling å‚æ•°ï¼Œèƒ½çœ‹åˆ°å½“å‰ MySQL æ˜¯å¦æ”¯æŒ profile æ“ä½œï¼š<br><code>SELECT @@have_profiling;</code><br>profiling é»˜è®¤å…³é—­ï¼Œå¯ä»¥é€šè¿‡setè¯­å¥åœ¨session/globalçº§åˆ«å¼€å¯ profilingï¼š<br><code>SET profiling = 1;</code><br>æŸ¥çœ‹æ‰€æœ‰è¯­å¥çš„è€—æ—¶ï¼š<br><code>show profiles;</code><br>æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥å„ä¸ªé˜¶æ®µçš„è€—æ—¶ï¼š<br><code>show profile for query query_id;</code><br>æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥CPUçš„ä½¿ç”¨æƒ…å†µ<br><code>show profile cpu for query query_id;</code></p><h3 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h3><p>EXPLAIN æˆ–è€… DESC å‘½ä»¤è·å– MySQL å¦‚ä½•æ‰§è¡Œ SELECT è¯­å¥çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ¨ SELECT è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­è¡¨å¦‚ä½•è¿æ¥å’Œè¿æ¥çš„é¡ºåºã€‚<br>è¯­æ³•ï¼š<br>    # ç›´æ¥åœ¨selectè¯­å¥ä¹‹å‰åŠ ä¸Šå…³é”®å­— explain / desc<br>    EXPLAIN SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å HWERE æ¡ä»¶;</p><p>EXPLAIN å„å­—æ®µå«ä¹‰ï¼š</p><ul><li>idï¼šselect æŸ¥è¯¢çš„åºåˆ—å·ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œ select å­å¥æˆ–è€…æ“ä½œè¡¨çš„é¡ºåºï¼ˆidç›¸åŒï¼Œæ‰§è¡Œé¡ºåºä»ä¸Šåˆ°ä¸‹ï¼›idä¸åŒï¼Œå€¼è¶Šå¤§è¶Šå…ˆæ‰§è¡Œï¼‰</li><li>select_typeï¼šè¡¨ç¤º SELECT çš„ç±»å‹ï¼Œå¸¸è§å–å€¼æœ‰ SIMPLEï¼ˆç®€å•è¡¨ï¼Œå³ä¸é€‚ç”¨è¡¨è¿æ¥æˆ–è€…å­æŸ¥è¯¢ï¼‰ã€PRIMARYï¼ˆä¸»æŸ¥è¯¢ï¼Œå³å¤–å±‚çš„æŸ¥è¯¢ï¼‰ã€UNIONï¼ˆUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„æŸ¥è¯¢è¯­å¥ï¼‰ã€SUBQUERYï¼ˆSELECT/WHEREä¹‹ååŒ…å«äº†å­æŸ¥è¯¢ï¼‰ç­‰</li><li>typeï¼šè¡¨ç¤ºè¿æ¥ç±»å‹ï¼Œæ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿æ¥ç±»å‹ä¸º NULLã€systemã€constã€eq_refã€refã€rangeã€indexã€all</li><li>possible_keyï¼šå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸Šçš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ª</li><li>Keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸º NULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•</li><li>Key_lenï¼šè¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œè¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½</li><li>rowsï¼šMySQLè®¤ä¸ºå¿…é¡»è¦æ‰§è¡Œçš„è¡Œæ•°ï¼Œåœ¨InnoDBå¼•æ“çš„è¡¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œå¯èƒ½å¹¶ä¸æ€»æ˜¯å‡†ç¡®çš„</li><li>filteredï¼šè¡¨ç¤ºè¿”å›ç»“æœçš„è¡Œæ•°å éœ€è¯»å–è¡Œæ•°çš„ç™¾åˆ†æ¯”ï¼Œfilteredçš„å€¼è¶Šå¤§è¶Šå¥½</li></ul><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><p>ç´¢å¼•æ˜¯å¸®åŠ© MySQL <strong>é«˜æ•ˆè·å–æ•°æ®</strong>çš„<strong>æ•°æ®ç»“æ„ï¼ˆæœ‰åºï¼‰</strong>ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥è¯¢ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚</p><p>ä¼˜ç¼ºç‚¹ï¼š</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>æé«˜æ•°æ®æ£€ç´¢æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬</li><li>é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½CPUçš„æ¶ˆè€—</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„</li><li>ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢æ•ˆç‡ï¼Œä½†é™ä½äº†æ›´æ–°çš„é€Ÿåº¦ï¼Œæ¯”å¦‚ INSERTã€UPDATEã€DELETE</li></ul><h3 id="ç´¢å¼•ç»“æ„"><a href="#ç´¢å¼•ç»“æ„" class="headerlink" title="ç´¢å¼•ç»“æ„"></a>ç´¢å¼•ç»“æ„</h3><table><thead><tr><th>ç´¢å¼•ç»“æ„</th><th>æè¿°</th></tr></thead><tbody><tr><td>B+Tree</td><td>æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œå¤§éƒ¨åˆ†å¼•æ“éƒ½æ”¯æŒB+æ ‘ç´¢å¼•</td></tr><tr><td>Hash</td><td>åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°ï¼Œåªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢</td></tr><tr><td>R-Tree(ç©ºé—´ç´¢å¼•)</td><td>ç©ºé—´ç´¢å¼•æ˜¯ MyISAM å¼•æ“çš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒå°‘</td></tr><tr><td>Full-Text(å…¨æ–‡ç´¢å¼•)</td><td>æ˜¯ä¸€ç§é€šè¿‡å»ºç«‹å€’æ’ç´¢å¼•ï¼Œå¿«é€ŸåŒ¹é…æ–‡æ¡£çš„æ–¹å¼ï¼Œç±»ä¼¼äº Lucene, Solr, ES</td></tr></tbody></table><table><thead><tr><th>ç´¢å¼•</th><th>InnoDB</th><th>MyISAM</th><th>Memory</th></tr></thead><tbody><tr><td>B+Treeç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>Hashç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>R-Treeç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>Full-text</td><td>5.6ç‰ˆæœ¬åæ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><h4 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h4><p><img src="https://dhc.pythonanywhere.com/media/editor/%E4%BA%8C%E5%8F%89%E6%A0%91_20220316153214227108.png" alt="äºŒå‰æ ‘" title="äºŒå‰æ ‘"></p><p>äºŒå‰æ ‘çš„ç¼ºç‚¹å¯ä»¥ç”¨çº¢é»‘æ ‘æ¥è§£å†³ï¼š<br><img src="https://dhc.pythonanywhere.com/media/editor/%E7%BA%A2%E9%BB%91%E6%A0%91_20220316163142686602.png" alt="çº¢é»‘æ ‘" title="çº¢é»‘æ ‘"><br>çº¢é»‘æ ‘ä¹Ÿå­˜åœ¨å¤§æ•°æ®é‡æƒ…å†µä¸‹ï¼Œå±‚çº§è¾ƒæ·±ï¼Œæ£€ç´¢é€Ÿåº¦æ…¢çš„é—®é¢˜ã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ B-Tree ç»“æ„ã€‚<br>B-Tree (å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘) ä»¥ä¸€æ£µæœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼ŒæŒ‡ä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°ï¼‰ä¸º5ï¼ˆ5é˜¶ï¼‰çš„ b-tree ä¸ºä¾‹ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨4ä¸ªkeyï¼Œ5ä¸ªæŒ‡é’ˆï¼‰</p><p><img src="https://dhc.pythonanywhere.com/media/editor/B-Tree%E7%BB%93%E6%9E%84_20220316163813441163.png" alt="B-Treeç»“æ„" title="B-Treeç»“æ„"></p><blockquote><p>B-Tree çš„æ•°æ®æ’å…¥è¿‡ç¨‹åŠ¨ç”»å‚ç…§ï¼š<a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=68" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1Kr4y1i7ru?p=68</a><br>æ¼”ç¤ºåœ°å€ï¼š<a href="https://www.cs.usfca.edu/~galles/visualization/BTree.html" target="_blank" rel="noopener">https://www.cs.usfca.edu/~galles/visualization/BTree.html</a></p></blockquote><h4 id="B-Tree-1"><a href="#B-Tree-1" class="headerlink" title="B+Tree"></a>B+Tree</h4><p>ç»“æ„å›¾ï¼š</p><p><img src="https://dhc.pythonanywhere.com/media/editor/B+Tree%E7%BB%93%E6%9E%84%E5%9B%BE_20220316170700591277.png" alt="B+Treeç»“æ„å›¾" title="B+Treeç»“æ„å›¾"></p><blockquote><p>æ¼”ç¤ºåœ°å€ï¼š<a href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html" target="_blank" rel="noopener">https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html</a></p></blockquote><p>ä¸ B-Tree çš„åŒºåˆ«ï¼š</p><ul><li>æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹</li><li>å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨</li></ul><p>MySQL ç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„ B+Tree è¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸ B+Tree çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„ B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ã€‚</p><p><img src="https://dhc.pythonanywhere.com/media/editor/%E7%BB%93%E6%9E%84%E5%9B%BE_20220316171730865611.png" alt="MySQL B+Tree ç»“æ„å›¾" title="MySQL B+Tree ç»“æ„å›¾"></p><h4 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h4><p>å“ˆå¸Œç´¢å¼•å°±æ˜¯é‡‡ç”¨ä¸€å®šçš„hashç®—æ³•ï¼Œå°†é”®å€¼æ¢ç®—æˆæ–°çš„hashå€¼ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Šï¼Œç„¶åå­˜å‚¨åœ¨hashè¡¨ä¸­ã€‚<br>å¦‚æœä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰é”®å€¼ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªç›¸åŒçš„æ§½ä½ä¸Šï¼Œä»–ä»¬å°±äº§ç”Ÿäº†hashå†²çªï¼ˆä¹Ÿç§°ä¸ºhashç¢°æ’ï¼‰ï¼Œå¯ä»¥é€šè¿‡é“¾è¡¨æ¥è§£å†³ã€‚</p><p><img src="https://dhc.pythonanywhere.com/media/editor/Hash%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86%E5%9B%BE_20220317143226150679.png" alt="Hashç´¢å¼•åŸç†å›¾" title="Hashç´¢å¼•åŸç†å›¾"></p><p>ç‰¹ç‚¹ï¼š</p><ul><li>Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒï¼ˆ=ã€inï¼‰ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetwwnã€&gt;ã€&lt;ã€â€¦ï¼‰</li><li>æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œ</li><li>æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸åªéœ€è¦ä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥äº†ï¼Œæ•ˆç‡é€šå¸¸è¦é«˜äº B+Tree ç´¢å¼•</li></ul><p>å­˜å‚¨å¼•æ“æ”¯æŒï¼š</p><ul><li>Memory</li><li>InnoDB: å…·æœ‰è‡ªé€‚åº”hashåŠŸèƒ½ï¼Œhashç´¢å¼•æ˜¯å­˜å‚¨å¼•æ“æ ¹æ® B+Tree ç´¢å¼•åœ¨æŒ‡å®šæ¡ä»¶ä¸‹è‡ªåŠ¨æ„å»ºçš„</li></ul><h4 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h4><ol><li>ä¸ºä»€ä¹ˆ InnoDB å­˜å‚¨å¼•æ“é€‰æ‹©ä½¿ç”¨ B+Tree ç´¢å¼•ç»“æ„ï¼Ÿ</li></ol><ul><li>ç›¸å¯¹äºäºŒå‰æ ‘ï¼Œå±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡é«˜</li><li>å¯¹äº B-Treeï¼Œæ— è®ºæ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´ä¸€é¡µä¸­å­˜å‚¨çš„é”®å€¼å‡å°‘ï¼ŒæŒ‡é’ˆä¹Ÿè·Ÿç€å‡å°‘ï¼Œè¦åŒæ ·ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½</li><li>ç›¸å¯¹äº Hash ç´¢å¼•ï¼ŒB+Tree æ”¯æŒèŒƒå›´åŒ¹é…åŠæ’åºæ“ä½œ</li></ul><h3 id="ç´¢å¼•åˆ†ç±»"><a href="#ç´¢å¼•åˆ†ç±»" class="headerlink" title="ç´¢å¼•åˆ†ç±»"></a>ç´¢å¼•åˆ†ç±»</h3><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>ä¸»é”®ç´¢å¼•</td><td>é’ˆå¯¹äºè¡¨ä¸­ä¸»é”®åˆ›å»ºçš„ç´¢å¼•</td><td>é»˜è®¤è‡ªåŠ¨åˆ›å»ºï¼Œåªèƒ½æœ‰ä¸€ä¸ª</td><td>PRIMARY</td></tr><tr><td>å”¯ä¸€ç´¢å¼•</td><td>é¿å…åŒä¸€ä¸ªè¡¨ä¸­æŸæ•°æ®åˆ—ä¸­çš„å€¼é‡å¤</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td>UNIQUE</td></tr><tr><td>å¸¸è§„ç´¢å¼•</td><td>å¿«é€Ÿå®šä½ç‰¹å®šæ•°æ®</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td></td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>å…¨æ–‡ç´¢å¼•æŸ¥æ‰¾çš„æ˜¯æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯æ¯”è¾ƒç´¢å¼•ä¸­çš„å€¼</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td>FULLTEXT</td></tr></tbody></table><p>åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œæ ¹æ®ç´¢å¼•çš„å­˜å‚¨å½¢å¼ï¼Œåˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š</p><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>èšé›†ç´¢å¼•(Clustered Index)</td><td>å°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®</td><td>å¿…é¡»æœ‰ï¼Œè€Œä¸”åªæœ‰ä¸€ä¸ª</td></tr><tr><td>äºŒçº§ç´¢å¼•(Secondary Index)</td><td>å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹å…³è”çš„æ˜¯å¯¹åº”çš„ä¸»é”®</td><td>å¯ä»¥å­˜åœ¨å¤šä¸ª</td></tr></tbody></table><p>æ¼”ç¤ºå›¾ï¼š</p><p><img src="https://dhc.pythonanywhere.com/media/editor/%E5%8E%9F%E7%90%86%E5%9B%BE_20220318194454880073.png" alt="å¤§è‡´åŸç†" title="å¤§è‡´åŸç†"><br><img src="https://dhc.pythonanywhere.com/media/editor/%E6%BC%94%E7%A4%BA%E5%9B%BE_20220319215403721066.png" alt="æ¼”ç¤ºå›¾" title="æ¼”ç¤ºå›¾"></p><p>èšé›†ç´¢å¼•é€‰å–è§„åˆ™ï¼š</p><ul><li>å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œä¸»é”®ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼•</li><li>å¦‚æœä¸å­˜åœ¨ä¸»é”®ï¼Œå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå”¯ä¸€(UNIQUE)ç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼•</li><li>å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®æˆ–æ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™ InnoDB ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª rowid ä½œä¸ºéšè—çš„èšé›†ç´¢å¼•</li></ul><h4 id="æ€è€ƒé¢˜"><a href="#æ€è€ƒé¢˜" class="headerlink" title="æ€è€ƒé¢˜"></a>æ€è€ƒé¢˜</h4><p>1. ä»¥ä¸‹ SQL è¯­å¥ï¼Œå“ªä¸ªæ‰§è¡Œæ•ˆç‡é«˜ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from user where id = 10;</span><br><span class="line">select * from user where name = &apos;Arm&apos;;</span><br><span class="line">-- å¤‡æ³¨ï¼šidä¸ºä¸»é”®ï¼Œnameå­—æ®µåˆ›å»ºçš„æœ‰ç´¢å¼•</span><br></pre></td></tr></table></figure><p>ç­”ï¼šç¬¬ä¸€æ¡è¯­å¥ï¼Œå› ä¸ºç¬¬äºŒæ¡éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œç›¸å½“äºä¸¤ä¸ªæ­¥éª¤ã€‚</p><p>2. InnoDB ä¸»é”®ç´¢å¼•çš„ B+Tree é«˜åº¦ä¸ºå¤šå°‘ï¼Ÿ</p><p>ç­”ï¼šå‡è®¾ä¸€è¡Œæ•°æ®å¤§å°ä¸º1kï¼Œä¸€é¡µä¸­å¯ä»¥å­˜å‚¨16è¡Œè¿™æ ·çš„æ•°æ®ã€‚InnoDB çš„æŒ‡é’ˆå ç”¨6ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œä¸»é”®å‡è®¾ä¸ºbigintï¼Œå ç”¨å­—èŠ‚æ•°ä¸º8.<br>å¯å¾—å…¬å¼ï¼š<code>n * 8 + (n + 1) * 6 = 16 * 1024</code>ï¼Œå…¶ä¸­ 8 è¡¨ç¤º bigint å ç”¨çš„å­—èŠ‚æ•°ï¼Œn è¡¨ç¤ºå½“å‰èŠ‚ç‚¹å­˜å‚¨çš„keyçš„æ•°é‡ï¼Œ(n + 1) è¡¨ç¤ºæŒ‡é’ˆæ•°é‡ï¼ˆæ¯”keyå¤šä¸€ä¸ªï¼‰ã€‚ç®—å‡ºnçº¦ä¸º1170ã€‚</p><p>å¦‚æœæ ‘çš„é«˜åº¦ä¸º2ï¼Œé‚£ä¹ˆä»–èƒ½å­˜å‚¨çš„æ•°æ®é‡å¤§æ¦‚ä¸ºï¼š<code>1171 * 16 = 18736</code>ï¼›<br>å¦‚æœæ ‘çš„é«˜åº¦ä¸º3ï¼Œé‚£ä¹ˆä»–èƒ½å­˜å‚¨çš„æ•°æ®é‡å¤§æ¦‚ä¸ºï¼š<code>1171 * 1171 * 16 = 21939856</code>ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœæœ‰æˆåƒä¸Šä¸‡çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±è¦è€ƒè™‘åˆ†è¡¨ï¼Œæ¶‰åŠè¿ç»´ç¯‡çŸ¥è¯†ã€‚</p><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>åˆ›å»ºç´¢å¼•ï¼š<br><code>CREATE [ UNIQUE | FULLTEXT ] INDEX index_name ON table_name (index_col_name, ...);</code><br>å¦‚æœä¸åŠ  CREATE åé¢ä¸åŠ ç´¢å¼•ç±»å‹å‚æ•°ï¼Œåˆ™åˆ›å»ºçš„æ˜¯å¸¸è§„ç´¢å¼•</p><p>æŸ¥çœ‹ç´¢å¼•ï¼š<br><code>SHOW INDEX FROM table_name;</code></p><p>åˆ é™¤ç´¢å¼•ï¼š<br><code>DROP INDEX index_name ON table_name;</code></p><p>æ¡ˆä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- nameå­—æ®µä¸ºå§“åå­—æ®µï¼Œè¯¥å­—æ®µçš„å€¼å¯èƒ½ä¼šé‡å¤ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»ºç´¢å¼•</span><br><span class="line">create index idx_user_name on tb_user(name);</span><br><span class="line">-- phoneæ‰‹æœºå·å­—æ®µçš„å€¼éç©ºï¼Œä¸”å”¯ä¸€ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»ºå”¯ä¸€ç´¢å¼•</span><br><span class="line">create unique index idx_user_phone on tb_user (phone);</span><br><span class="line">-- ä¸ºprofession, age, statusåˆ›å»ºè”åˆç´¢å¼•</span><br><span class="line">create index idx_user_pro_age_stat on tb_user(profession, age, status);</span><br><span class="line">-- ä¸ºemailå»ºç«‹åˆé€‚çš„ç´¢å¼•æ¥æå‡æŸ¥è¯¢æ•ˆç‡</span><br><span class="line">create index idx_user_email on tb_user(email);</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤ç´¢å¼•</span><br><span class="line">drop index idx_user_email on tb_user;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨è§„åˆ™"><a href="#ä½¿ç”¨è§„åˆ™" class="headerlink" title="ä½¿ç”¨è§„åˆ™"></a>ä½¿ç”¨è§„åˆ™</h3><h4 id="æœ€å·¦å‰ç¼€æ³•åˆ™"><a href="#æœ€å·¦å‰ç¼€æ³•åˆ™" class="headerlink" title="æœ€å·¦å‰ç¼€æ³•åˆ™"></a>æœ€å·¦å‰ç¼€æ³•åˆ™</h4><p>å¦‚æœç´¢å¼•å…³è”äº†å¤šåˆ—ï¼ˆè”åˆç´¢å¼•ï¼‰ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œæœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚<br>å¦‚æœè·³è·ƒæŸä¸€åˆ—ï¼Œç´¢å¼•å°†éƒ¨åˆ†å¤±æ•ˆï¼ˆåé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆï¼‰ã€‚</p><p>è”åˆç´¢å¼•ä¸­ï¼Œå‡ºç°èŒƒå›´æŸ¥è¯¢ï¼ˆ&lt;, &gt;ï¼‰ï¼ŒèŒƒå›´æŸ¥è¯¢å³ä¾§çš„åˆ—ç´¢å¼•å¤±æ•ˆã€‚å¯ä»¥ç”¨&gt;=æˆ–è€…&lt;=æ¥è§„é¿ç´¢å¼•å¤±æ•ˆé—®é¢˜ã€‚</p><h4 id="ç´¢å¼•å¤±æ•ˆæƒ…å†µ"><a href="#ç´¢å¼•å¤±æ•ˆæƒ…å†µ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆæƒ…å†µ"></a>ç´¢å¼•å¤±æ•ˆæƒ…å†µ</h4><ol><li>åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œï¼Œç´¢å¼•å°†å¤±æ•ˆã€‚å¦‚ï¼š<code>explain select * from tb_user where substring(phone, 10, 2) = &#39;15&#39;;</code></li><li>å­—ç¬¦ä¸²ç±»å‹å­—æ®µä½¿ç”¨æ—¶ï¼Œä¸åŠ å¼•å·ï¼Œç´¢å¼•å°†å¤±æ•ˆã€‚å¦‚ï¼š<code>explain select * from tb_user where phone = 17799990015;</code>ï¼Œæ­¤å¤„phoneçš„å€¼æ²¡æœ‰åŠ å¼•å·</li><li>æ¨¡ç³ŠæŸ¥è¯¢ä¸­ï¼Œå¦‚æœä»…ä»…æ˜¯å°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•ä¸ä¼šæ˜¯å¤±æ•ˆï¼›å¦‚æœæ˜¯å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•å¤±æ•ˆã€‚å¦‚ï¼š<code>explain select * from tb_user where profession like &#39;%å·¥ç¨‹&#39;;</code>ï¼Œå‰åéƒ½æœ‰ % ä¹Ÿä¼šå¤±æ•ˆã€‚</li><li>ç”¨ or åˆ†å‰²å¼€çš„æ¡ä»¶ï¼Œå¦‚æœ or å…¶ä¸­ä¸€ä¸ªæ¡ä»¶çš„åˆ—æ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ç”¨åˆ°ã€‚</li><li>å¦‚æœ MySQL è¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚</li></ol><h4 id="SQL-æç¤º"><a href="#SQL-æç¤º" class="headerlink" title="SQL æç¤º"></a>SQL æç¤º</h4><p>æ˜¯ä¼˜åŒ–æ•°æ®åº“çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨SQLè¯­å¥ä¸­åŠ å…¥ä¸€äº›äººä¸ºçš„æç¤ºæ¥è¾¾åˆ°ä¼˜åŒ–æ“ä½œçš„ç›®çš„ã€‚</p><p>ä¾‹å¦‚ï¼Œä½¿ç”¨ç´¢å¼•ï¼š<br><code>explain select * from tb_user use index(idx_user_pro) where profession=&quot;è½¯ä»¶å·¥ç¨‹&quot;;</code><br>ä¸ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼š<br><code>explain select * from tb_user ignore index(idx_user_pro) where profession=&quot;è½¯ä»¶å·¥ç¨‹&quot;;</code><br>å¿…é¡»ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼š<br><code>explain select * from tb_user force index(idx_user_pro) where profession=&quot;è½¯ä»¶å·¥ç¨‹&quot;;</code></p><p>use æ˜¯å»ºè®®ï¼Œå®é™…ä½¿ç”¨å“ªä¸ªç´¢å¼• MySQL è¿˜ä¼šè‡ªå·±æƒè¡¡è¿è¡Œé€Ÿåº¦å»æ›´æ”¹ï¼Œforceå°±æ˜¯æ— è®ºå¦‚ä½•éƒ½å¼ºåˆ¶ä½¿ç”¨è¯¥ç´¢å¼•ã€‚</p><h4 id="è¦†ç›–ç´¢å¼•-amp-å›è¡¨æŸ¥è¯¢"><a href="#è¦†ç›–ç´¢å¼•-amp-å›è¡¨æŸ¥è¯¢" class="headerlink" title="è¦†ç›–ç´¢å¼•&amp;å›è¡¨æŸ¥è¯¢"></a>è¦†ç›–ç´¢å¼•&amp;å›è¡¨æŸ¥è¯¢</h4><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆæŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦è¿”å›çš„åˆ—ï¼Œåœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½æ‰¾åˆ°ï¼‰ï¼Œå‡å°‘ select *ã€‚</p><p>explain ä¸­ extra å­—æ®µå«ä¹‰ï¼š<br><code>using index condition</code>ï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®<br><code>using where; using index;</code>ï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦çš„æ•°æ®éƒ½åœ¨ç´¢å¼•åˆ—ä¸­èƒ½æ‰¾åˆ°ï¼Œæ‰€ä»¥ä¸éœ€è¦å›è¡¨æŸ¥è¯¢</p><p>å¦‚æœåœ¨èšé›†ç´¢å¼•ä¸­ç›´æ¥èƒ½æ‰¾åˆ°å¯¹åº”çš„è¡Œï¼Œåˆ™ç›´æ¥è¿”å›è¡Œæ•°æ®ï¼Œåªéœ€è¦ä¸€æ¬¡æŸ¥è¯¢ï¼Œå“ªæ€•æ˜¯select *ï¼›å¦‚æœåœ¨è¾…åŠ©ç´¢å¼•ä¸­æ‰¾èšé›†ç´¢å¼•ï¼Œå¦‚<code>select id, name from xxx where name=&#39;xxx&#39;;</code>ï¼Œä¹Ÿåªéœ€è¦é€šè¿‡è¾…åŠ©ç´¢å¼•(name)æŸ¥æ‰¾åˆ°å¯¹åº”çš„idï¼Œè¿”å›nameå’Œnameç´¢å¼•å¯¹åº”çš„idå³å¯ï¼Œåªéœ€è¦ä¸€æ¬¡æŸ¥è¯¢ï¼›å¦‚æœæ˜¯é€šè¿‡è¾…åŠ©ç´¢å¼•æŸ¥æ‰¾å…¶ä»–å­—æ®µï¼Œåˆ™éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œå¦‚<code>select id, name, gender from xxx where name=&#39;xxx&#39;;</code></p><p>æ‰€ä»¥å°½é‡ä¸è¦ç”¨<code>select *</code>ï¼Œå®¹æ˜“å‡ºç°å›è¡¨æŸ¥è¯¢ï¼Œé™ä½æ•ˆç‡ï¼Œé™¤éæœ‰è”åˆç´¢å¼•åŒ…å«äº†æ‰€æœ‰å­—æ®µ</p><p>é¢è¯•é¢˜ï¼šä¸€å¼ è¡¨ï¼Œæœ‰å››ä¸ªå­—æ®µï¼ˆid, username, password, statusï¼‰ï¼Œç”±äºæ•°æ®é‡å¤§ï¼Œéœ€è¦å¯¹ä»¥ä¸‹SQLè¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œè¯¥å¦‚ä½•è¿›è¡Œæ‰æ˜¯æœ€ä¼˜æ–¹æ¡ˆï¼š<br><code>select id, username, password from tb_user where username=&#39;itcast&#39;;</code></p><p>è§£ï¼šç»™usernameå’Œpasswordå­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼Œåˆ™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œç›´æ¥è¦†ç›–ç´¢å¼•</p><h4 id="å‰ç¼€ç´¢å¼•"><a href="#å‰ç¼€ç´¢å¼•" class="headerlink" title="å‰ç¼€ç´¢å¼•"></a>å‰ç¼€ç´¢å¼•</h4><p>å½“å­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆvarchar, textç­‰ï¼‰æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šè®©ç´¢å¼•å˜å¾—å¾ˆå¤§ï¼ŒæŸ¥è¯¢æ—¶ï¼Œæµªè´¹å¤§é‡çš„ç£ç›˜IOï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡ï¼Œæ­¤æ—¶å¯ä»¥åªé™å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‰ç¼€ï¼Œå»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»è€Œæé«˜ç´¢å¼•æ•ˆç‡ã€‚</p><p>è¯­æ³•ï¼š<code>create index idx_xxxx on table_name(columnn(n));</code><br>å‰ç¼€é•¿åº¦ï¼šå¯ä»¥æ ¹æ®ç´¢å¼•çš„é€‰æ‹©æ€§æ¥å†³å®šï¼Œè€Œé€‰æ‹©æ€§æ˜¯æŒ‡ä¸é‡å¤çš„ç´¢å¼•å€¼ï¼ˆåŸºæ•°ï¼‰å’Œæ•°æ®è¡¨çš„è®°å½•æ€»æ•°çš„æ¯”å€¼ï¼Œç´¢å¼•é€‰æ‹©æ€§è¶Šé«˜åˆ™æŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼Œå”¯ä¸€ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯1ï¼Œè¿™æ˜¯æœ€å¥½çš„ç´¢å¼•é€‰æ‹©æ€§ï¼Œæ€§èƒ½ä¹Ÿæ˜¯æœ€å¥½çš„ã€‚<br>æ±‚é€‰æ‹©æ€§å…¬å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select count(distinct email) / count(*) from tb_user;</span><br><span class="line">select count(distinct substring(email, 1, 5)) / count(*) from tb_user;</span><br></pre></td></tr></table></figure><p>show index é‡Œé¢çš„sub_partå¯ä»¥çœ‹åˆ°æ¥å–çš„é•¿åº¦</p><h4 id="å•åˆ—ç´¢å¼•-amp-è”åˆç´¢å¼•"><a href="#å•åˆ—ç´¢å¼•-amp-è”åˆç´¢å¼•" class="headerlink" title="å•åˆ—ç´¢å¼•&amp;è”åˆç´¢å¼•"></a>å•åˆ—ç´¢å¼•&amp;è”åˆç´¢å¼•</h4><p>å•åˆ—ç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—<br>è”åˆç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•åŒ…å«äº†å¤šä¸ªåˆ—<br>åœ¨ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œè€ƒè™‘é’ˆå¯¹äºæŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•æ—¶ï¼Œå»ºè®®å»ºç«‹è”åˆç´¢å¼•ï¼Œè€Œéå•åˆ—ç´¢å¼•ã€‚</p><p>å•åˆ—ç´¢å¼•æƒ…å†µï¼š<br><code>explain select id, phone, name from tb_user where phone = &#39;17799990010&#39; and name = &#39;éŸ©ä¿¡&#39;;</code><br>è¿™å¥åªä¼šç”¨åˆ°phoneç´¢å¼•å­—æ®µ</p><h5 id="æ³¨æ„äº‹é¡¹-8"><a href="#æ³¨æ„äº‹é¡¹-8" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h5><ul><li>å¤šæ¡ä»¶è”åˆæŸ¥è¯¢æ—¶ï¼ŒMySQLä¼˜åŒ–å™¨ä¼šè¯„ä¼°å“ªä¸ªå­—æ®µçš„ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼Œä¼šé€‰æ‹©è¯¥ç´¢å¼•å®Œæˆæœ¬æ¬¡æŸ¥è¯¢</li></ul><h3 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h3><ol><li>é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼Œä¸”æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„è¡¨å»ºç«‹ç´¢å¼•</li><li>é’ˆå¯¹äºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼ˆwhereï¼‰ã€æ’åºï¼ˆorder byï¼‰ã€åˆ†ç»„ï¼ˆgroup byï¼‰æ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•</li><li>å°½é‡é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•ï¼Œå°½é‡å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜</li><li>å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µé•¿åº¦è¾ƒé•¿ï¼Œå¯ä»¥é’ˆå¯¹äºå­—æ®µçš„ç‰¹ç‚¹ï¼Œå»ºç«‹å‰ç¼€ç´¢å¼•</li><li>å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå‡å°‘å•åˆ—ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•å¾ˆå¤šæ—¶å€™å¯ä»¥è¦†ç›–ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé¿å…å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</li><li>è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œç´¢å¼•å¹¶ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„çš„ä»£ä»·å°±è¶Šå¤§ï¼Œä¼šå½±å“å¢åˆ æ”¹çš„æ•ˆç‡</li><li>å¦‚æœç´¢å¼•åˆ—ä¸èƒ½å­˜å‚¨NULLå€¼ï¼Œè¯·åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨NOT NULLçº¦æŸå®ƒã€‚å½“ä¼˜åŒ–å™¨çŸ¥é“æ¯åˆ—æ˜¯å¦åŒ…å«NULLå€¼æ—¶ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°ç¡®å®šå“ªä¸ªç´¢å¼•æœ€æœ‰æ•ˆåœ°ç”¨äºæŸ¥è¯¢</li></ol><h2 id="SQL-ä¼˜åŒ–"><a href="#SQL-ä¼˜åŒ–" class="headerlink" title="SQL ä¼˜åŒ–"></a>SQL ä¼˜åŒ–</h2><h3 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h3><p>æ™®é€šæ’å…¥ï¼š</p><ol><li>é‡‡ç”¨æ‰¹é‡æ’å…¥ï¼ˆä¸€æ¬¡æ’å…¥çš„æ•°æ®ä¸å»ºè®®è¶…è¿‡1000æ¡ï¼‰</li><li>æ‰‹åŠ¨æäº¤äº‹åŠ¡</li><li>ä¸»é”®é¡ºåºæ’å…¥</li></ol><p>å¤§æ‰¹é‡æ’å…¥ï¼š<br>å¦‚æœä¸€æ¬¡æ€§éœ€è¦æ’å…¥å¤§æ‰¹é‡æ•°æ®ï¼Œä½¿ç”¨insertè¯­å¥æ’å…¥æ€§èƒ½è¾ƒä½ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨MySQLæ•°æ®åº“æä¾›çš„loadæŒ‡ä»¤æ’å…¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° --local-infileï¼ˆè¿™ä¸€è¡Œåœ¨bash/cmdç•Œé¢è¾“å…¥ï¼‰</span><br><span class="line">mysql --local-infile -u root -p</span><br><span class="line"># è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³</span><br><span class="line">set global local_infile = 1;</span><br><span class="line">select @@local_infile;</span><br><span class="line"># æ‰§è¡ŒloadæŒ‡ä»¤å°†å‡†å¤‡å¥½çš„æ•°æ®ï¼ŒåŠ è½½åˆ°è¡¨ç»“æ„ä¸­</span><br><span class="line">load data local infile &apos;/root/sql1.log&apos; into table &apos;tb_user&apos; fields terminated by &apos;,&apos; lines terminated by &apos;\n&apos;;</span><br></pre></td></tr></table></figure><h3 id="ä¸»é”®ä¼˜åŒ–"><a href="#ä¸»é”®ä¼˜åŒ–" class="headerlink" title="ä¸»é”®ä¼˜åŒ–"></a>ä¸»é”®ä¼˜åŒ–</h3><p>æ•°æ®ç»„ç»‡æ–¹å¼ï¼šåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œè¡¨æ•°æ®éƒ½æ˜¯æ ¹æ®ä¸»é”®é¡ºåºç»„ç»‡å­˜æ”¾çš„ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸ºç´¢å¼•ç»„ç»‡è¡¨ï¼ˆIndex organized table, IOTï¼‰</p><p>é¡µåˆ†è£‚ï¼šé¡µå¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥å¡«å……ä¸€èˆ¬ï¼Œä¹Ÿå¯ä»¥å¡«å……100%ï¼Œæ¯ä¸ªé¡µåŒ…å«äº†2-Nè¡Œæ•°æ®ï¼ˆå¦‚æœä¸€è¡Œæ•°æ®è¿‡å¤§ï¼Œä¼šè¡Œæº¢å‡ºï¼‰ï¼Œæ ¹æ®ä¸»é”®æ’åˆ—ã€‚<br>é¡µåˆå¹¶ï¼šå½“åˆ é™¤ä¸€è¡Œè®°å½•æ—¶ï¼Œå®é™…ä¸Šè®°å½•å¹¶æ²¡æœ‰è¢«ç‰©ç†åˆ é™¤ï¼Œåªæ˜¯è®°å½•è¢«æ ‡è®°ï¼ˆflagedï¼‰ä¸ºåˆ é™¤å¹¶ä¸”å®ƒçš„ç©ºé—´å˜å¾—å…è®¸è¢«å…¶ä»–è®°å½•å£°æ˜ä½¿ç”¨ã€‚å½“é¡µä¸­åˆ é™¤çš„è®°å½•åˆ°è¾¾ MERGE_THRESHOLDï¼ˆé»˜è®¤ä¸ºé¡µçš„50%ï¼‰ï¼ŒInnoDBä¼šå¼€å§‹å¯»æ‰¾æœ€é è¿‘çš„é¡µï¼ˆå‰åï¼‰çœ‹çœ‹æ˜¯å¦å¯ä»¥å°†è¿™ä¸¤ä¸ªé¡µåˆå¹¶ä»¥ä¼˜åŒ–ç©ºé—´ä½¿ç”¨ã€‚</p><p>MERGE_THRESHOLDï¼šåˆå¹¶é¡µçš„é˜ˆå€¼ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®ï¼Œåœ¨åˆ›å»ºè¡¨æˆ–åˆ›å»ºç´¢å¼•æ—¶æŒ‡å®š</p><blockquote><p>æ–‡å­—è¯´æ˜ä¸å¤Ÿæ¸…æ™°æ˜äº†ï¼Œå…·ä½“å¯ä»¥çœ‹è§†é¢‘é‡Œçš„PPTæ¼”ç¤ºè¿‡ç¨‹ï¼š<a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=90" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1Kr4y1i7ru?p=90</a></p></blockquote><p>ä¸»é”®è®¾è®¡åŸåˆ™ï¼š</p><ul><li>æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦</li><li>æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨ AUTO_INCREMENT è‡ªå¢ä¸»é”®</li><li>å°½é‡ä¸è¦ä½¿ç”¨ UUID åšä¸»é”®æˆ–è€…æ˜¯å…¶ä»–çš„è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·</li><li>ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹</li></ul><h3 id="order-byä¼˜åŒ–"><a href="#order-byä¼˜åŒ–" class="headerlink" title="order byä¼˜åŒ–"></a>order byä¼˜åŒ–</h3><ol><li>Using filesortï¼šé€šè¿‡è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶ååœ¨æ’åºç¼“å†²åŒº sort buffer ä¸­å®Œæˆæ’åºæ“ä½œï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åº</li><li>Using indexï¼šé€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜</li></ol><p>å¦‚æœorder byå­—æ®µå…¨éƒ¨ä½¿ç”¨å‡åºæ’åºæˆ–è€…é™åºæ’åºï¼Œåˆ™éƒ½ä¼šèµ°ç´¢å¼•ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå­—æ®µå‡åºæ’åºï¼Œå¦ä¸€ä¸ªå­—æ®µé™åºæ’åºï¼Œåˆ™ä¸ä¼šèµ°ç´¢å¼•ï¼Œexplainçš„extraä¿¡æ¯æ˜¾ç¤ºçš„æ˜¯<code>Using index, Using filesort</code>ï¼Œå¦‚æœè¦ä¼˜åŒ–æ‰Using filesortï¼Œåˆ™éœ€è¦å¦å¤–å†åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¦‚ï¼š<code>create index idx_user_age_phone_ad on tb_user(age asc, phone desc);</code>ï¼Œæ­¤æ—¶ä½¿ç”¨<code>select id, age, phone from tb_user order by age asc, phone desc;</code>ä¼šå…¨éƒ¨èµ°ç´¢å¼•</p><p>æ€»ç»“ï¼š</p><ul><li>æ ¹æ®æ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œå¤šå­—æ®µæ’åºæ—¶ï¼Œä¹Ÿéµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™</li><li>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•</li><li>å¤šå­—æ®µæ’åºï¼Œä¸€ä¸ªå‡åºä¸€ä¸ªé™åºï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„è”åˆç´¢å¼•åœ¨åˆ›å»ºæ—¶çš„è§„åˆ™ï¼ˆASC/DESCï¼‰</li><li>å¦‚æœä¸å¯é¿å…å‡ºç°filesortï¼Œå¤§æ•°æ®é‡æ’åºæ—¶ï¼Œå¯ä»¥é€‚å½“å¢å¤§æ’åºç¼“å†²åŒºå¤§å° sort_buffer_sizeï¼ˆé»˜è®¤256kï¼‰</li></ul><h3 id="group-byä¼˜åŒ–"><a href="#group-byä¼˜åŒ–" class="headerlink" title="group byä¼˜åŒ–"></a>group byä¼˜åŒ–</h3><ul><li>åœ¨åˆ†ç»„æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥æé«˜æ•ˆç‡</li><li>åˆ†ç»„æ“ä½œæ—¶ï¼Œç´¢å¼•çš„ä½¿ç”¨ä¹Ÿæ˜¯æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„</li></ul><p>å¦‚ç´¢å¼•ä¸º<code>idx_user_pro_age_stat</code>ï¼Œåˆ™å¥å¼å¯ä»¥æ˜¯<code>select ... where profession order by age</code>ï¼Œè¿™æ ·ä¹Ÿç¬¦åˆæœ€å·¦å‰ç¼€æ³•åˆ™</p><h3 id="limitä¼˜åŒ–"><a href="#limitä¼˜åŒ–" class="headerlink" title="limitä¼˜åŒ–"></a>limitä¼˜åŒ–</h3><p>å¸¸è§çš„é—®é¢˜å¦‚<code>limit 2000000, 10</code>ï¼Œæ­¤æ—¶éœ€è¦ MySQL æ’åºå‰2000000æ¡è®°å½•ï¼Œä½†ä»…ä»…è¿”å›2000000 - 2000010çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§ã€‚<br>ä¼˜åŒ–æ–¹æ¡ˆï¼šä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»ºè¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢å½¢å¼è¿›è¡Œä¼˜åŒ–</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- æ­¤è¯­å¥è€—æ—¶å¾ˆé•¿</span><br><span class="line">select * from tb_sku limit 9000000, 10;</span><br><span class="line">-- é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å¿«é€Ÿåº¦ï¼Œç›´æ¥é€šè¿‡ä¸»é”®ç´¢å¼•è¿›è¡Œæ’åºåŠæŸ¥è¯¢</span><br><span class="line">select id from tb_sku order by id limit 9000000, 10;</span><br><span class="line">-- ä¸‹é¢çš„è¯­å¥æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º MySQL ä¸æ”¯æŒ in é‡Œé¢ä½¿ç”¨ limit</span><br><span class="line">-- select * from tb_sku where id in (select id from tb_sku order by id limit 9000000, 10);</span><br><span class="line">-- é€šè¿‡è¿è¡¨æŸ¥è¯¢å³å¯å®ç°ç¬¬ä¸€å¥çš„æ•ˆæœï¼Œå¹¶ä¸”èƒ½è¾¾åˆ°ç¬¬äºŒå¥çš„é€Ÿåº¦</span><br><span class="line">select * from tb_sku as s, (select id from tb_sku order by id limit 9000000, 10) as a where s.id = a.id;</span><br></pre></td></tr></table></figure><h3 id="countä¼˜åŒ–"><a href="#countä¼˜åŒ–" class="headerlink" title="countä¼˜åŒ–"></a>countä¼˜åŒ–</h3><p>MyISAM å¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œ count(*) çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜ï¼ˆå‰ææ˜¯ä¸é€‚ç”¨whereï¼‰ï¼›<br>InnoDB åœ¨æ‰§è¡Œ count(*) æ—¶ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶åç´¯è®¡è®¡æ•°ã€‚<br>ä¼˜åŒ–æ–¹æ¡ˆï¼šè‡ªå·±è®¡æ•°ï¼Œå¦‚åˆ›å»ºkey-valueè¡¨å­˜å‚¨åœ¨å†…å­˜æˆ–ç¡¬ç›˜ï¼Œæˆ–è€…æ˜¯ç”¨redis</p><p>countçš„å‡ ç§ç”¨æ³•ï¼š</p><ul><li>å¦‚æœcountå‡½æ•°çš„å‚æ•°ï¼ˆcounté‡Œé¢å†™çš„é‚£ä¸ªå­—æ®µï¼‰ä¸æ˜¯NULLï¼ˆå­—æ®µå€¼ä¸ä¸ºNULLï¼‰ï¼Œç´¯è®¡å€¼å°±åŠ ä¸€ï¼Œæœ€åè¿”å›ç´¯è®¡å€¼</li><li>ç”¨æ³•ï¼šcount(*)ã€count(ä¸»é”®)ã€count(å­—æ®µ)ã€count(1)</li><li>count(ä¸»é”®)è·Ÿcount(*)ä¸€æ ·ï¼Œå› ä¸ºä¸»é”®ä¸èƒ½ä¸ºç©ºï¼›count(å­—æ®µ)åªè®¡ç®—å­—æ®µå€¼ä¸ä¸ºNULLçš„è¡Œï¼›count(1)å¼•æ“ä¼šä¸ºæ¯è¡Œæ·»åŠ ä¸€ä¸ª1ï¼Œç„¶åå°±countè¿™ä¸ª1ï¼Œè¿”å›ç»“æœä¹Ÿè·Ÿcount(*)ä¸€æ ·ï¼›count(null)è¿”å›0</li></ul><p>å„ç§ç”¨æ³•çš„æ€§èƒ½ï¼š</p><ul><li>count(ä¸»é”®)ï¼šInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯è¡Œçš„ä¸»é”®idå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚æ‹¿åˆ°ä¸»é”®åï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ï¼ˆä¸»é”®ä¸å¯èƒ½ä¸ºç©ºï¼‰</li><li>count(å­—æ®µ)ï¼šæ²¡æœ‰not nullçº¦æŸçš„è¯ï¼ŒInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚åˆ¤æ–­æ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullï¼Œè®¡æ•°ç´¯åŠ ï¼›æœ‰not nullçº¦æŸçš„è¯ï¼ŒInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ </li><li>count(1)ï¼šInnoDB å¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚æœåŠ¡å±‚å¯¹äºè¿”å›çš„æ¯ä¸€å±‚ï¼Œæ”¾ä¸€ä¸ªæ•°å­— 1 è¿›å»ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ </li><li>count(*)ï¼šInnoDB å¼•æ“å¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ï¼ŒæœåŠ¡å±‚ç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ </li></ul><p>æŒ‰æ•ˆç‡æ’åºï¼šcount(å­—æ®µ) &lt; count(ä¸»é”®) &lt; count(1) &lt; count(*)ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨ count(*)</p><h3 id="updateä¼˜åŒ–ï¼ˆé¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼‰"><a href="#updateä¼˜åŒ–ï¼ˆé¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼‰" class="headerlink" title="updateä¼˜åŒ–ï¼ˆé¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼‰"></a>updateä¼˜åŒ–ï¼ˆé¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼‰</h3><p>InnoDB çš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é”ï¼Œå¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä¼šä»è¡Œé”å‡çº§ä¸ºè¡¨é”ã€‚</p><p>å¦‚ä»¥ä¸‹ä¸¤æ¡è¯­å¥ï¼š<br><code>update student set no = &#39;123&#39; where id = 1;</code>ï¼Œè¿™å¥ç”±äºidæœ‰ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥åªä¼šé”è¿™ä¸€è¡Œï¼›<br><code>update student set no = &#39;123&#39; where name = &#39;test&#39;;</code>ï¼Œè¿™å¥ç”±äºnameæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šæŠŠæ•´å¼ è¡¨éƒ½é”ä½è¿›è¡Œæ•°æ®æ›´æ–°ï¼Œè§£å†³æ–¹æ³•æ˜¯ç»™nameå­—æ®µæ·»åŠ ç´¢å¼•</p><h1 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h1><h2 id="æ•´å‹"><a href="#æ•´å‹" class="headerlink" title="æ•´å‹"></a>æ•´å‹</h2><table><thead><tr><th>ç±»å‹åç§°</th><th>å–å€¼èŒƒå›´</th><th>å¤§å°</th></tr></thead><tbody><tr><td>TINYINT</td><td>-128ã€œ127</td><td>1ä¸ªå­—èŠ‚</td></tr><tr><td>SMALLINT</td><td>-32768ã€œ32767</td><td>2ä¸ªå®‡èŠ‚</td></tr><tr><td>MEDIUMINT</td><td>-8388608ã€œ8388607</td><td>3ä¸ªå­—èŠ‚</td></tr><tr><td>INT (INTEGHR)</td><td>-2147483648ã€œ2147483647</td><td>4ä¸ªå­—èŠ‚</td></tr><tr><td>BIGINT</td><td>-9223372036854775808ã€œ9223372036854775807</td><td>8ä¸ªå­—èŠ‚</td></tr></tbody></table><p>æ— ç¬¦å·åœ¨æ•°æ®ç±»å‹ååŠ  unsigned å…³é”®å­—ã€‚</p><h2 id="æµ®ç‚¹å‹"><a href="#æµ®ç‚¹å‹" class="headerlink" title="æµ®ç‚¹å‹"></a>æµ®ç‚¹å‹</h2><table><thead><tr><th>ç±»å‹åç§°</th><th>è¯´æ˜</th><th>å­˜å‚¨éœ€æ±‚</th></tr></thead><tbody><tr><td>FLOAT</td><td>å•ç²¾åº¦æµ®ç‚¹æ•°</td><td>4 ä¸ªå­—èŠ‚</td></tr><tr><td>DOUBLE</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°</td><td>8 ä¸ªå­—èŠ‚</td></tr><tr><td>DECIMAL (M, D)ï¼ŒDEC</td><td>å‹ç¼©çš„â€œä¸¥æ ¼â€å®šç‚¹æ•°</td><td>M+2 ä¸ªå­—èŠ‚</td></tr></tbody></table><h2 id="æ—¥æœŸå’Œæ—¶é—´"><a href="#æ—¥æœŸå’Œæ—¶é—´" class="headerlink" title="æ—¥æœŸå’Œæ—¶é—´"></a>æ—¥æœŸå’Œæ—¶é—´</h2><table><thead><tr><th>ç±»å‹åç§°</th><th>æ—¥æœŸæ ¼å¼</th><th>æ—¥æœŸèŒƒå›´</th><th>å­˜å‚¨éœ€æ±‚</th></tr></thead><tbody><tr><td>YEAR</td><td>YYYY</td><td>1901 ~ 2155</td><td>1 ä¸ªå­—èŠ‚</td></tr><tr><td>TIME</td><td>HH:MM:SS</td><td>-838:59:59 ~ 838:59:59</td><td>3 ä¸ªå­—èŠ‚</td></tr><tr><td>DATE</td><td>YYYY-MM-DD</td><td>1000-01-01 ~ 9999-12-3</td><td>3 ä¸ªå­—èŠ‚</td></tr><tr><td>DATETIME</td><td>YYYY-MM-DD HH:MM:SS</td><td>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</td><td>8 ä¸ªå­—èŠ‚</td></tr><tr><td>TIMESTAMP</td><td>YYYY-MM-DD HH:MM:SS</td><td>1980-01-01 00:00:01 UTC ~ 2040-01-19 03:14:07 UTC</td><td>4 ä¸ªå­—èŠ‚</td></tr></tbody></table><h2 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h2><table><thead><tr><th>ç±»å‹åç§°</th><th>è¯´æ˜</th><th>å­˜å‚¨éœ€æ±‚</th></tr></thead><tbody><tr><td>CHAR(M)</td><td>å›ºå®šé•¿åº¦éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>M å­—èŠ‚ï¼Œ1&lt;=M&lt;=255</td></tr><tr><td>VARCHAR(M)</td><td>å˜é•¿éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>L+1å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt; = Må’Œ 1&lt;=M&lt;=255</td></tr><tr><td>TINYTEXT</td><td>éå¸¸å°çš„éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>L+1å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^8</td></tr><tr><td>TEXT</td><td>å°çš„éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>L+2å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^16</td></tr><tr><td>MEDIUMTEXT</td><td>ä¸­ç­‰å¤§å°çš„éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>L+3å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^24</td></tr><tr><td>LONGTEXT</td><td>å¤§çš„éäºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>L+4å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^32</td></tr><tr><td>ENUM</td><td>æšä¸¾ç±»å‹ï¼Œåªèƒ½æœ‰ä¸€ä¸ªæšä¸¾å­—ç¬¦ä¸²å€¼</td><td>1æˆ–2ä¸ªå­—èŠ‚ï¼Œå–å†³äºæšä¸¾å€¼çš„æ•°ç›® (æœ€å¤§å€¼ä¸º65535)</td></tr><tr><td>SET</td><td>ä¸€ä¸ªè®¾ç½®ï¼Œå­—ç¬¦ä¸²å¯¹è±¡å¯ä»¥æœ‰é›¶ä¸ªæˆ– å¤šä¸ªSETæˆå‘˜</td><td>1ã€2ã€3ã€4æˆ–8ä¸ªå­—èŠ‚ï¼Œå–å†³äºé›†åˆ æˆå‘˜çš„æ•°é‡ï¼ˆæœ€å¤š64ä¸ªæˆå‘˜ï¼‰</td></tr></tbody></table><h2 id="äºŒè¿›åˆ¶ç±»å‹"><a href="#äºŒè¿›åˆ¶ç±»å‹" class="headerlink" title="äºŒè¿›åˆ¶ç±»å‹"></a>äºŒè¿›åˆ¶ç±»å‹</h2><table><thead><tr><th>ç±»å‹åç§°</th><th>è¯´æ˜</th><th>å­˜å‚¨éœ€æ±‚</th></tr></thead><tbody><tr><td>BIT(M)</td><td>ä½å­—æ®µç±»å‹</td><td>å¤§çº¦ (M+7)/8 å­—èŠ‚</td></tr><tr><td>BINARY(M)</td><td>å›ºå®šé•¿åº¦äºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>M å­—èŠ‚</td></tr><tr><td>VARBINARY (M)</td><td>å¯å˜é•¿åº¦äºŒè¿›åˆ¶å­—ç¬¦ä¸²</td><td>M+1 å­—èŠ‚</td></tr><tr><td>TINYBLOB (M)</td><td>éå¸¸å°çš„BLOB</td><td>L+1 å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^8</td></tr><tr><td>BLOB (M)</td><td>å° BLOB</td><td>L+2 å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^16</td></tr><tr><td>MEDIUMBLOB (M)</td><td>ä¸­ç­‰å¤§å°çš„BLOB</td><td>L+3 å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^24</td></tr><tr><td>LONGBLOB (M)</td><td>éå¸¸å¤§çš„BLOB</td><td>L+4 å­—èŠ‚ï¼Œåœ¨æ­¤ï¼ŒL&lt;2^32</td></tr></tbody></table><h1 id="æƒé™ä¸€è§ˆè¡¨"><a href="#æƒé™ä¸€è§ˆè¡¨" class="headerlink" title="æƒé™ä¸€è§ˆè¡¨"></a>æƒé™ä¸€è§ˆè¡¨</h1><blockquote><p>å…·ä½“æƒé™çš„ä½œç”¨è¯¦è§<a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html" title="å®˜æ–¹æ–‡æ¡£" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p></blockquote><p>GRANT å’Œ REVOKE å…è®¸çš„é™æ€æƒé™</p><table><thead><tr><th align="left">Privilege</th><th align="left">Grant Table Column</th><th align="left">Context</th></tr></thead><tbody><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_all" target="_blank" rel="noopener"><code>ALL [PRIVILEGES]</code></a></td><td align="left">Synonym for â€œall privilegesâ€</td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_alter" target="_blank" rel="noopener"><code>ALTER</code></a></td><td align="left"><code>Alter_priv</code></td><td align="left">Tables</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_alter-routine" target="_blank" rel="noopener"><code>ALTER ROUTINE</code></a></td><td align="left"><code>Alter_routine_priv</code></td><td align="left">Stored routines</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create" target="_blank" rel="noopener"><code>CREATE</code></a></td><td align="left"><code>Create_priv</code></td><td align="left">Databases, tables, or indexes</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-role" target="_blank" rel="noopener"><code>CREATE ROLE</code></a></td><td align="left"><code>Create_role_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-routine" target="_blank" rel="noopener"><code>CREATE ROUTINE</code></a></td><td align="left"><code>Create_routine_priv</code></td><td align="left">Stored routines</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-tablespace" target="_blank" rel="noopener"><code>CREATE TABLESPACE</code></a></td><td align="left"><code>Create_tablespace_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-temporary-tables" target="_blank" rel="noopener"><code>CREATE TEMPORARY TABLES</code></a></td><td align="left"><code>Create_tmp_table_priv</code></td><td align="left">Tables</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-user" target="_blank" rel="noopener"><code>CREATE USER</code></a></td><td align="left"><code>Create_user_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-view" target="_blank" rel="noopener"><code>CREATE VIEW</code></a></td><td align="left"><code>Create_view_priv</code></td><td align="left">Views</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_delete" target="_blank" rel="noopener"><code>DELETE</code></a></td><td align="left"><code>Delete_priv</code></td><td align="left">Tables</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_drop" target="_blank" rel="noopener"><code>DROP</code></a></td><td align="left"><code>Drop_priv</code></td><td align="left">Databases, tables, or views</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_drop-role" target="_blank" rel="noopener"><code>DROP ROLE</code></a></td><td align="left"><code>Drop_role_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_event" target="_blank" rel="noopener"><code>EVENT</code></a></td><td align="left"><code>Event_priv</code></td><td align="left">Databases</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_execute" target="_blank" rel="noopener"><code>EXECUTE</code></a></td><td align="left"><code>Execute_priv</code></td><td align="left">Stored routines</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_file" target="_blank" rel="noopener"><code>FILE</code></a></td><td align="left"><code>File_priv</code></td><td align="left">File access on server host</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_grant-option" target="_blank" rel="noopener"><code>GRANT OPTION</code></a></td><td align="left"><code>Grant_priv</code></td><td align="left">Databases, tables, or stored routines</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_index" target="_blank" rel="noopener"><code>INDEX</code></a></td><td align="left"><code>Index_priv</code></td><td align="left">Tables</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_insert" target="_blank" rel="noopener"><code>INSERT</code></a></td><td align="left"><code>Insert_priv</code></td><td align="left">Tables or columns</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_lock-tables" target="_blank" rel="noopener"><code>LOCK TABLES</code></a></td><td align="left"><code>Lock_tables_priv</code></td><td align="left">Databases</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_process" target="_blank" rel="noopener"><code>PROCESS</code></a></td><td align="left"><code>Process_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_proxy" target="_blank" rel="noopener"><code>PROXY</code></a></td><td align="left">See <code>proxies_priv</code> table</td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_references" target="_blank" rel="noopener"><code>REFERENCES</code></a></td><td align="left"><code>References_priv</code></td><td align="left">Databases or tables</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_reload" target="_blank" rel="noopener"><code>RELOAD</code></a></td><td align="left"><code>Reload_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-client" target="_blank" rel="noopener"><code>REPLICATION CLIENT</code></a></td><td align="left"><code>Repl_client_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-slave" target="_blank" rel="noopener"><code>REPLICATION SLAVE</code></a></td><td align="left"><code>Repl_slave_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_select" target="_blank" rel="noopener"><code>SELECT</code></a></td><td align="left"><code>Select_priv</code></td><td align="left">Tables or columns</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-databases" target="_blank" rel="noopener"><code>SHOW DATABASES</code></a></td><td align="left"><code>Show_db_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-view" target="_blank" rel="noopener"><code>SHOW VIEW</code></a></td><td align="left"><code>Show_view_priv</code></td><td align="left">Views</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_shutdown" target="_blank" rel="noopener"><code>SHUTDOWN</code></a></td><td align="left"><code>Shutdown_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_super" target="_blank" rel="noopener"><code>SUPER</code></a></td><td align="left"><code>Super_priv</code></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_trigger" target="_blank" rel="noopener"><code>TRIGGER</code></a></td><td align="left"><code>Trigger_priv</code></td><td align="left">Tables</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_update" target="_blank" rel="noopener"><code>UPDATE</code></a></td><td align="left"><code>Update_priv</code></td><td align="left">Tables or columns</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_usage" target="_blank" rel="noopener"><code>USAGE</code></a></td><td align="left">Synonym for â€œno privilegesâ€</td><td align="left">Server administration</td></tr></tbody></table><p>GRANT å’Œ REVOKE å…è®¸çš„åŠ¨æ€æƒé™</p><table><thead><tr><th align="left">Privilege</th><th align="left">Context</th></tr></thead><tbody><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_application-password-admin" target="_blank" rel="noopener"><code>APPLICATION_PASSWORD_ADMIN</code></a></td><td align="left">Dual password administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_audit-abort-exempt" target="_blank" rel="noopener"><code>AUDIT_ABORT_EXEMPT</code></a></td><td align="left">Allow queries blocked by audit log filter</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_audit-admin" target="_blank" rel="noopener"><code>AUDIT_ADMIN</code></a></td><td align="left">Audit log administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_authentication-policy-admin" target="_blank" rel="noopener"><code>AUTHENTICATION_POLICY_ADMIN</code></a></td><td align="left">Authentication administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_backup-admin" target="_blank" rel="noopener"><code>BACKUP_ADMIN</code></a></td><td align="left">Backup administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_binlog-admin" target="_blank" rel="noopener"><code>BINLOG_ADMIN</code></a></td><td align="left">Backup and Replication administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_binlog-encryption-admin" target="_blank" rel="noopener"><code>BINLOG_ENCRYPTION_ADMIN</code></a></td><td align="left">Backup and Replication administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_clone-admin" target="_blank" rel="noopener"><code>CLONE_ADMIN</code></a></td><td align="left">Clone administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_connection-admin" target="_blank" rel="noopener"><code>CONNECTION_ADMIN</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_encryption-key-admin" target="_blank" rel="noopener"><code>ENCRYPTION_KEY_ADMIN</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_firewall-admin" target="_blank" rel="noopener"><code>FIREWALL_ADMIN</code></a></td><td align="left">Firewall administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_firewall-exempt" target="_blank" rel="noopener"><code>FIREWALL_EXEMPT</code></a></td><td align="left">Firewall administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_firewall-user" target="_blank" rel="noopener"><code>FIREWALL_USER</code></a></td><td align="left">Firewall administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-optimizer-costs" target="_blank" rel="noopener"><code>FLUSH_OPTIMIZER_COSTS</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-status" target="_blank" rel="noopener"><code>FLUSH_STATUS</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-tables" target="_blank" rel="noopener"><code>FLUSH_TABLES</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_flush-user-resources" target="_blank" rel="noopener"><code>FLUSH_USER_RESOURCES</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_group-replication-admin" target="_blank" rel="noopener"><code>GROUP_REPLICATION_ADMIN</code></a></td><td align="left">Replication administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_group-replication-stream" target="_blank" rel="noopener"><code>GROUP_REPLICATION_STREAM</code></a></td><td align="left">Replication administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_innodb-redo-log-archive" target="_blank" rel="noopener"><code>INNODB_REDO_LOG_ARCHIVE</code></a></td><td align="left">Redo log archiving administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_ndb-stored-user" target="_blank" rel="noopener"><code>NDB_STORED_USER</code></a></td><td align="left">NDB Cluster</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_passwordless-user-admin" target="_blank" rel="noopener"><code>PASSWORDLESS_USER_ADMIN</code></a></td><td align="left">Authentication administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_persist-ro-variables-admin" target="_blank" rel="noopener"><code>PERSIST_RO_VARIABLES_ADMIN</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-applier" target="_blank" rel="noopener"><code>REPLICATION_APPLIER</code></a></td><td align="left"><code>PRIVILEGE_CHECKS_USER</code> for a replication channel</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-slave-admin" target="_blank" rel="noopener"><code>REPLICATION_SLAVE_ADMIN</code></a></td><td align="left">Replication administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_resource-group-admin" target="_blank" rel="noopener"><code>RESOURCE_GROUP_ADMIN</code></a></td><td align="left">Resource group administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_resource-group-user" target="_blank" rel="noopener"><code>RESOURCE_GROUP_USER</code></a></td><td align="left">Resource group administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_role-admin" target="_blank" rel="noopener"><code>ROLE_ADMIN</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_session-variables-admin" target="_blank" rel="noopener"><code>SESSION_VARIABLES_ADMIN</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_set-user-id" target="_blank" rel="noopener"><code>SET_USER_ID</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-routine" target="_blank" rel="noopener"><code>SHOW_ROUTINE</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_system-user" target="_blank" rel="noopener"><code>SYSTEM_USER</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_system-variables-admin" target="_blank" rel="noopener"><code>SYSTEM_VARIABLES_ADMIN</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_table-encryption-admin" target="_blank" rel="noopener"><code>TABLE_ENCRYPTION_ADMIN</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_version-token-admin" target="_blank" rel="noopener"><code>VERSION_TOKEN_ADMIN</code></a></td><td align="left">Server administration</td></tr><tr><td align="left"><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_xa-recover-admin" target="_blank" rel="noopener"><code>XA_RECOVER_ADMIN</code></a></td><td align="left">Server administration</td></tr></tbody></table><h1 id="å›¾å½¢åŒ–ç•Œé¢å·¥å…·"><a href="#å›¾å½¢åŒ–ç•Œé¢å·¥å…·" class="headerlink" title="å›¾å½¢åŒ–ç•Œé¢å·¥å…·"></a>å›¾å½¢åŒ–ç•Œé¢å·¥å…·</h1><ul><li>Workbench(å…è´¹): <a href="http://dev.mysql.com/downloads/workbench/" target="_blank" rel="noopener">http://dev.mysql.com/downloads/workbench/</a></li><li>navicat(æ”¶è´¹ï¼Œè¯•ç”¨ç‰ˆ30å¤©): <a href="https://www.navicat.com/en/download/navicat-for-mysql" target="_blank" rel="noopener">https://www.navicat.com/en/download/navicat-for-mysql</a></li><li>Sequel Pro(å¼€æºå…è´¹ï¼Œä»…æ”¯æŒMac OS): <a href="http://www.sequelpro.com/" target="_blank" rel="noopener">http://www.sequelpro.com/</a></li><li>HeidiSQL(å…è´¹): <a href="http://www.heidisql.com/" target="_blank" rel="noopener">http://www.heidisql.com/</a></li><li>phpMyAdmin(å…è´¹): <a href="https://www.phpmyadmin.net/" target="_blank" rel="noopener">https://www.phpmyadmin.net/</a></li><li>SQLyog: <a href="https://sqlyog.en.softonic.com/" target="_blank" rel="noopener">https://sqlyog.en.softonic.com/</a></li></ul><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><h1 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h1><ol><li>åœ¨SQLè¯­å¥ä¹‹ååŠ ä¸Š<code>\G</code>ä¼šå°†ç»“æœçš„è¡¨æ ¼å½¢å¼è½¬æ¢æˆè¡Œæ–‡æœ¬å½¢å¼</li><li>æŸ¥çœ‹Mysqlæ•°æ®åº“å ç”¨ç©ºé—´ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT table_schema &quot;Database Name&quot;</span><br><span class="line">     , SUM(data_length + index_length) / (1024 * 1024) &quot;Database Size in MB&quot;</span><br><span class="line">FROM information_schema.TABLES</span><br><span class="line">GROUP BY table_schema;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mavenä¸­çš„dependencieså’ŒdependencyManagementæ ‡ç­¾</title>
      <link href="/2022/09/06/Maven%E4%B8%ADdependence%E5%92%8CdependenceManagement/"/>
      <url>/2022/09/06/Maven%E4%B8%ADdependence%E5%92%8CdependenceManagement/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æœ¬æ–‡ä¸»è¦è®°å½•å­¦ä¹ SSMè¿‡ç¨‹ä¸­å¯¹äºMavençš„pom.xmlæ–‡ä»¶å†…<strong>dependencies</strong>å’Œ<strong>dependencyManagement</strong>ä¸¤ä¸ªæ ‡ç­¾çš„åŒºåˆ«å’Œç†è§£ã€‚</p><p>é—²è¨€å°‘å™ï¼Œç›´å¥”ä¸»é¢˜ğŸ‘‡</p><h2 id="æƒ…æ™¯ä¸€ï¼š"><a href="#æƒ…æ™¯ä¸€ï¼š" class="headerlink" title="æƒ…æ™¯ä¸€ï¼š"></a>æƒ…æ™¯ä¸€ï¼š</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°pomæ–‡ä»¶ä¸­åŒæ—¶åœ¨<strong>dependencies</strong>å’Œ<strong>dependencyManagement</strong>ä¸­å¼•å…¥äº†mysqlä¾èµ–ï¼Œä½†æ˜¯ç‰ˆæœ¬ä¸åŒã€‚</p><center>è¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹é¡¹ç›®çš„å¤–éƒ¨åº“ğŸ‘‡<p><img src="https://img.gejiba.com/images/07d8c055577d9f4a3378869033e9df15.png" alt></p><p>å¯è§åŒæ—¶ä½œç”¨æ—¶ç‰ˆæœ¬ä»¥<strong>dependencies</strong>ä¸­æŒ‡å®šçš„ä¸ºå‡†</p></center><h2 id="æƒ…æ™¯äºŒï¼š"><a href="#æƒ…æ™¯äºŒï¼š" class="headerlink" title="æƒ…æ™¯äºŒï¼š"></a>æƒ…æ™¯äºŒï¼š</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- &lt;version&gt;8.0.25&lt;/version&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤„æˆ‘ä»¬å°†<strong>dependencies</strong>ä¸­çš„<strong>version</strong>æ ‡ç­¾è¿›è¡Œæ³¨é‡Šï¼Œå³ä¸æŒ‡å®šç‰ˆæœ¬ä¿¡æ¯å†è¿›è¡Œè§‚å¯Ÿã€‚</p><center>è¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹é¡¹ç›®çš„å¤–éƒ¨åº“ğŸ‘‡<p><img src="https://img.gejiba.com/images/44c0e5bc68a6c84b0ef1f0d2a5f13fe2.png" alt></p><p>å¯è§ä¸åœ¨<strong>dependencies</strong>ä¸­æŒ‡å®šç‰ˆæœ¬æ—¶ï¼Œå¤–éƒ¨åº“ç‰ˆæœ¬ä»¥<strong>dependencyManagement</strong>ä¸­å®šä¹‰çš„ç‰ˆæœ¬ä¸ºå‡†</p></center><h2 id="æƒ…æ™¯ä¸‰ï¼š"><a href="#æƒ…æ™¯ä¸‰ï¼š" class="headerlink" title="æƒ…æ™¯ä¸‰ï¼š"></a>æƒ…æ™¯ä¸‰ï¼š</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>web-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- &lt;dependencies&gt;</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;8.0.25&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependencies&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤„æˆ‘ä»¬å°†<strong>dependencies</strong>æ ‡ç­¾çš„å…¨éƒ¨å†…å®¹è¿›è¡Œæ³¨é‡Šã€‚</p><center>è¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹é¡¹ç›®çš„å¤–éƒ¨åº“ğŸ‘‡<p><img src="https://img.gejiba.com/images/1c6fd77878b719965c31b7dd0b6fc9bd.png" alt></p><p>å¯è§åœ¨<strong>dependencyManagement</strong>ä¸­ä»…ä»…è¿›è¡Œäº†å¯¹å¤–éƒ¨åº“çš„å£°æ˜è€Œéå¼•ç”¨</p></center><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><ul><li><strong>dependencyManagement</strong>å…¶å®åªæ˜¯ä¸€ä¸ªç®¡ç†jarçš„ä½œç”¨çš„å£°æ˜æ ‡ç­¾,æ˜¯ç®¡ç†jarçš„ç‰ˆæœ¬çš„,å…¶ä»–ä»–çš„ä»€ä¹ˆä½œç”¨éƒ½æ²¡æœ‰,åªæ˜¯å®šä¹‰æ‰¾åˆ°è¯¥jarçš„ä¸‰ç»´åæ ‡,å¹¶ä¸æ˜¯çœŸæ­£çš„å»æ‰§è¡Œä¸‹è½½çš„jarçš„åŠŸèƒ½</li><li>åœ¨<strong>dependencies</strong>ä¸­çš„ä¾èµ–ä¸­å¦‚æœæ²¡æœ‰å£°æ˜jarçš„ç‰ˆæœ¬,å°±åˆ°<strong>dependenciesManagement</strong>ä¸­å»æ‰¾,æ‰¾åˆ°å°±ä½¿ç”¨,æ²¡æœ‰å°±æŠ¥é”™</li><li>åœ¨<strong>dependencies</strong>ä¸­å£°æ˜jarçš„ç‰ˆæœ¬,åˆ™ä½¿ç”¨è¯¥ç‰ˆæœ¬,ä¸ç®¡åœ¨<strong>dependenciesManagement</strong>ä¸­æœ‰æ²¡æœ‰å£°æ˜jarçš„version,éƒ½ä»¥è¯¥jarçš„ç‰ˆæœ¬ä¸ºä¸»</li></ul>]]></content>
      
      
      <categories>
          
          <category> Maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatisâ€”â€”è§£å†³å±æ€§åå’Œæ•°æ®åº“å­—æ®µåä¸ä¸€è‡´é—®é¢˜ï¼ˆæ³¨è§£æ–¹å¼)</title>
      <link href="/2022/09/06/mybatis%E2%80%94%E2%80%94%E8%A7%A3%E5%86%B3%E5%B1%9E%E6%80%A7%E5%90%8D%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E5%90%8D%E4%B8%8D%E4%B8%80%E8%87%B4%E9%97%AE%E9%A2%98%EF%BC%88%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F)/"/>
      <url>/2022/09/06/mybatis%E2%80%94%E2%80%94%E8%A7%A3%E5%86%B3%E5%B1%9E%E6%80%A7%E5%90%8D%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E5%90%8D%E4%B8%8D%E4%B8%80%E8%87%B4%E9%97%AE%E9%A2%98%EF%BC%88%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="æé—®ä¸è§£ç­”ï¼š"><a href="#æé—®ä¸è§£ç­”ï¼š" class="headerlink" title="æé—®ä¸è§£ç­”ï¼š"></a>æé—®ä¸è§£ç­”ï¼š</h2><p><strong>æé—®ï¼š</strong>å½“æˆ‘ä»¬ä½¿ç”¨æ³¨è§£å¼€å‘æ—¶æœ‰æ—¶ä¼šé‡åˆ°æ•°æ®åº“å­—æ®µåä¸å®ä½“ç±»å±æ€§åä¸ä¸€è‡´çš„é—®é¢˜ã€‚xmlæ–¹å¼å¼€å‘å¯ä»¥é€šè¿‡ç»“æœé›†æ˜ å°„çš„æ–¹å¼è§£å†³ï¼Œé‚£æ³¨è§£æ–¹å¼å¼€å‘è¦æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p><strong>è§£ç­”ï¼š</strong>åˆ©ç”¨ <strong>@Results()</strong>æ³¨è§£ï¼</p><p>Resultsæ³¨è§£ä¸­æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„å‚æ•°ï¼Œä¸€ä¸ªæ˜¯idï¼Œå¦ä¸€ä¸ªæ˜¯valueã€‚</p><ul><li><p><strong>id</strong>ï¼šè¿™ä¸ªå‚æ•°çš„ä¸»è¦ä½œç”¨åœ¨äºå”¯ä¸€æ ‡è®°è¿™ä¸ªResultsæ³¨è§£ï¼Œå¦‚æœæ¥å£ä¸­çš„å…¶ä»–æŠ½è±¡æ–¹æ³•ä¹Ÿéœ€è¦é€šè¿‡resultæ³¨è§£æ¥è§£å†³å±æ€§åå’Œæ•°æ®åº“å­—æ®µåä¸ä¸€è‡´é—®é¢˜ï¼Œé‚£ä¹ˆé‡æ–°å†™ä¸€ä¸ªResultsæ³¨è§£å°±å¤ªéº»çƒ¦äº†ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡@ResultMap()æ³¨è§£ä¸­ä¼ å…¥Resultsæ³¨è§£çš„å‚æ•°idæ¥å¼•ç”¨Resultsæ³¨è§£ä¸­çš„å†…å®¹ã€‚</p></li><li><p><strong>value</strong>ï¼šè¿™ä¸ªå‚æ•°ç”¨äºå»ºç«‹å®ä½“ç±»ä¸æ•°æ®åº“è¡¨çš„æ˜ å°„å…³ç³»ï¼Œå…¶ä¸­å¯ä»¥å¡«å†™å¤šä¸ª@Resultæ³¨è§£ï¼Œç”¨æ¥å°†å®ä½“ç±»çš„å±æ€§åå’Œæ•°æ®åº“å­—æ®µåä¸€ä¸€å¯¹åº”ã€‚âš <strong>éœ€è¦æ³¨æ„å¦‚æœæ˜¯ä¸»é”®å­—æ®µï¼Œ@Resultæ³¨è§£ä¸­éœ€è¦è®¾ç½®id=trueã€‚</strong></p></li></ul><h2 id="ä»£ç ç¤ºä¾‹ï¼š"><a href="#ä»£ç ç¤ºä¾‹ï¼š" class="headerlink" title="ä»£ç ç¤ºä¾‹ï¼š"></a>ä»£ç ç¤ºä¾‹ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user"</span>)</span><br><span class="line">    <span class="meta">@Results</span>(id=<span class="string">"aaa"</span>,value=&#123;</span><br><span class="line">            <span class="meta">@Result</span>(id=<span class="keyword">true</span>,column = <span class="string">"id"</span>,property = <span class="string">"userId"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"name"</span>,property = <span class="string">"userName"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(column = <span class="string">"age"</span>,property = <span class="string">"userAge"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">getUsers</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select count(id) from user"</span>)</span><br><span class="line">    <span class="meta">@ResultMap</span>(value=&#123;<span class="string">"aaa"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findTotalUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> MyBatys </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>âœ¨Deep-High-Resolution Representation Learning for Cross-Resolution Person Re-identification</title>
      <link href="/2021/10/07/PSHRNet/"/>
      <url>/2021/10/07/PSHRNet/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><div align="center"><p><a href="https://ieeexplore.ieee.org/document/9591273/authors#citations" target="_blank" rel="noopener"><strong><front size="5">Journal of IEEE TIP (SCI-Q1 Top)</front></strong></a></p><center>G. Zhang, ğŸ‘‰Y. GeğŸ‘ˆ, Z. Dong, H. Wang, Y. Zheng and S. Chen</center><p><img src="https://img.gejiba.com/images/de85252fec31e625fecf220fa7b686b8.png" alt></p></div><h2 id="Contents-ğŸ—’"><a href="#Contents-ğŸ—’" class="headerlink" title="Contents ğŸ—’"></a><a id="contents-">Contents ğŸ—’</a></h2><ul><li><a href="#contents-"><a id="contents-">Contents ğŸ—’</a></a></li><li><a href="#introduction-"><a id="introduction-">Introduction ğŸ—’</a></a></li><li><a href="#usage-"><a id="usage-">Usage ğŸ”§</a></a></li><li><a href="#results-"><a id="result-">Results ğŸ†</a></a></li><li><a href="#acknowledgements-"><a id="acknowledgements-">Acknowledgements ğŸ‘</a></a></li></ul><h2 id="Introduction-ğŸ—’"><a href="#Introduction-ğŸ—’" class="headerlink" title="Introduction ğŸ—’"></a><a id="introduction-">Introduction ğŸ—’</a></h2><p>We propose a Deep High-Resolution Pseudo-Siamese Framework (PS-HRNet) to solve the cross-resolution person re-ID problem. Specifically, in order to restore the resolution of low-resolution images and make reasonable use of different channel information of feature maps, we introduce and innovate VDSR module with channel attention (CA) mechanism, named as VDSR-CA. Then we reform the HRNet by designing a novel representation head to extract discriminating features, named as HRNet-ReID. In addition, a pseudo-siamese framework is constructed to reduce the difference of feature distributions between low-resolution images and high-resolution images. The experimental results on five cross-resolution person datasets verify the effectiveness of our proposed approach. Compared with the state-of-the-art methods, our proposed PS-HRNet improves 3.4%, 6.2%, 2.5%,1.1% and 4.2% at Rank-1 on MLR-Market-1501, MLR-CUHK03, MLR-VIPeR, MLR-DukeMTMC-reID, and CAVIAR datasets, respectively.</p><h2 id="Usage-ğŸ”§"><a href="#Usage-ğŸ”§" class="headerlink" title="Usage ğŸ”§"></a><a id="usage-">Usage ğŸ”§</a></h2><p>We use apex (A PyTorch Extension) a Pytorch extension with NVIDIA-maintained utilities to streamline mixed precision and distributed training. Some of the code here will be included in upstream Pytorch eventually. The intention of Apex is to make up-to-date utilities available to users as quickly as possible.Installation instructions can be found here: <a href="https://github.com/NVIDIA/apex#quick-start">https://github.com/NVIDIA/apex#quick-start</a>.</p><p>We display the process of the algorithm as an ipynb file, you can use jupyter notebook to view and run it.</p><p>You may need HRNet-W32-C ImageNet pretrained models or learn more about HRNet: <a href="https://github.com/HRNet/HRNet-Image-Classification.git">https://github.com/HRNet/HRNet-Image-Classification.git</a>.</p><p>Wanna know more detail of the first phaseï¼Ÿ Check thisï¼š<a href="https://github.com/NUISTGY/Person-re-identification-based-on-HRNet">https://github.com/NUISTGY/Person-re-identification-based-on-HRNet</a></p><h2 id="Results-ğŸ†"><a href="#Results-ğŸ†" class="headerlink" title="Results ğŸ†"></a><a id="result-">Results ğŸ†</a></h2><div align="center"><p><img src="https://img.gejiba.com/images/6670ce1bd1696c28e0fedd4fbefd676f.png" alt></p></div><h2 id="Acknowledgements-ğŸ‘"><a href="#Acknowledgements-ğŸ‘" class="headerlink" title="Acknowledgements ğŸ‘"></a><a id="acknowledgements-">Acknowledgements ğŸ‘</a></h2><ul><li>This code is built on <a href="https://github.com/HRNet/HRNet-Image-Classification">HRNet-Image-Classification</a> and <a href="https://github.com/layumi/Person_reID_baseline_pytorch">Person_reID_baseline_pytorch</a>. We thank the authors for sharing their codes. To the great spirit of open source!</li><li>Thank <a href="https://github.com/dzc2000">Z.Dong</a> and <a href="https://github.com/Rockdow">H.Wang</a>, they are the most important contributors to the related work of the experiment. If you have any questions in the process of testing, you can send them by email or pose issues.</li><li>Thanks for the right to use the GPU workstation provided by Nanyang Technological University.</li></ul>]]></content>
      
      
      <categories>
          
          <category> è¡Œäººé‡è¯†åˆ« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¡Œäººé‡è¯†åˆ« </tag>
            
            <tag> è®ºæ–‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Deep Low-Resolution Person Re-Identificationé˜…è¯»ç¬”è®°</title>
      <link href="/2020/07/15/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0(%E4%B8%80)/"/>
      <url>/2020/07/15/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0(%E4%B8%80)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="æ ‡é¢˜åŠä½œè€…"><a href="#æ ‡é¢˜åŠä½œè€…" class="headerlink" title="æ ‡é¢˜åŠä½œè€…"></a>æ ‡é¢˜åŠä½œè€…</h1><p><img src="https://s3.bmp.ovh/imgs/2022/09/05/aa8ff46d06e6cc07.png" alt></p><h2 id="æ–¹æ³•æ¦‚å†µåŠæ€»ç»“"><a href="#æ–¹æ³•æ¦‚å†µåŠæ€»ç»“" class="headerlink" title="æ–¹æ³•æ¦‚å†µåŠæ€»ç»“"></a>æ–¹æ³•æ¦‚å†µåŠæ€»ç»“</h2><h3 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h3><p><img src="https://s3.bmp.ovh/imgs/2022/09/05/d2fb70f26d148a01.png" alt="æ•´ä½“æ¶æ„"><br>SING CNNç”±SRå­ç½‘(d)å’ŒRe-IDå­ç½‘(e)ä¸¤éƒ¨åˆ†ç»„æˆï¼Œåœ¨æ¨¡å‹è®­ç»ƒä¸­éƒ¨ç½²ä¸‰ä¸ªæµï¼Œåˆ†åˆ«ä»¥LRå›¾åƒ(a)ã€åˆæˆLRå›¾åƒ(b)å’ŒHRå›¾åƒ(c)ä½œä¸ºè¾“å…¥ã€‚ä¸­é—´æµ(b)ä½œä¸ºè¿æ¥å›¾åƒSR (d)å’ŒäººRe-ID (e)å­¦ä¹ ä»»åŠ¡çš„æ¡¥æ¢ã€‚</p><h3 id="æŸå¤±å‡½æ•°æ„å»º"><a href="#æŸå¤±å‡½æ•°æ„å»º" class="headerlink" title="æŸå¤±å‡½æ•°æ„å»º"></a>æŸå¤±å‡½æ•°æ„å»º</h3><p>æŸå¤±å‡½æ•°ç”±<strong>SRæŸå¤±</strong>å’Œ<strong>Re-ID</strong>æŸå¤±è”åˆæ„å»ºï¼Œå…¬å¼å¦‚ä¸‹ï¼š<br><img src="https://s3.bmp.ovh/imgs/2022/09/05/2dfc3dd0e6857260.png" alt="SRæŸå¤±å‡½æ•° "><br><img src="https://s3.bmp.ovh/imgs/2022/09/05/f440a4392562d931.png" alt="Re-IDæŸå¤±å‡½æ•°"><br>L-reidå¼ä¸­ï¼š<br><img src="https://s3.bmp.ovh/imgs/2022/09/05/aed7d2417f060ddb.png" alt=" "><br>æœ€åæ„å»ºè”åˆæŸå¤±å‡½æ•°å¦‚ä¸‹ï¼š<br><img src="https://s3.bmp.ovh/imgs/2022/09/05/194e32f193a83d27.png" alt="è”åˆæŸå¤±å‡½æ•°"></p><h3 id="è®­ç»ƒåŠéªŒè¯"><a href="#è®­ç»ƒåŠéªŒè¯" class="headerlink" title="è®­ç»ƒåŠéªŒè¯"></a>è®­ç»ƒåŠéªŒè¯</h3><p>è®­ç»ƒé˜¶æ®µä¸Šæ–‡å·²å™è¿°ï¼Œä¸»è¦è®²ä¸€ä¸‹éªŒè¯æ—¶çš„æ“ä½œã€‚éªŒè¯æ—¶è¾“å…¥ä¸º2å¼ å›¾ç‰‡ï¼Œåˆ†åˆ«æ¥è‡ªgalleryçš„HRå›¾ç‰‡å’Œprobeçš„LRå›¾ç‰‡ã€‚å¯¹äºHRå›¾ç‰‡ï¼Œç›´æ¥ç»è¿‡Re-IDå­ç½‘æå–ç‰¹å¾ï¼›å¯¹äºLRå›¾ç‰‡ï¼Œéœ€è¦å…ˆè¿›è¡ŒSRå­ç½‘çš„å¢å¼ºå†ç»è¿‡Re-IDæå–ç‰¹å¾ï¼Œæœ€ååº¦é‡L2è·ç¦»ã€‚</p><h3 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p>å‚è€ƒä»¥ä¸‹å››å¼ è¡¨æ ¼ï¼š<br><img src="https://s3.bmp.ovh/imgs/2022/09/05/da5efeb01914b978.png" alt="å’Œç°è¡Œæ–¹æ³•çš„æ¯”è¾ƒ"><br><img src="https://s3.bmp.ovh/imgs/2022/09/05/3d02d144e35fddb2.png" alt="ç»„åˆç½‘ç»œçš„æ¯”è¾ƒ"><br><img src="https://s3.bmp.ovh/imgs/2022/09/05/26de61efb1180638.png" alt="åŠ å…¥è‡ªåˆ¶LRçš„æ•ˆæœ"><br><img src="https://s3.bmp.ovh/imgs/2022/09/05/5bb3aae90e39a19b.png" alt="åŠ å…¥å¤šå°ºåº¦çš„æ•ˆæœ"></p>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¡Œäººé‡è¯†åˆ« </tag>
            
            <tag> è®ºæ–‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®ºæ–‡ç¬”è®°ï¼ˆä¸€ï¼‰</title>
      <link href="/2020/07/14/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2020/07/14/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>CVPR2017</strong></p><h1 id="Re-ranking-Person-Re-identification-with-k-reciprocal-Encoding"><a href="#Re-ranking-Person-Re-identification-with-k-reciprocal-Encoding" class="headerlink" title="Re-ranking Person Re-identification with k-reciprocal Encoding"></a><strong>Re-ranking Person Re-identification with k-reciprocal Encoding</strong></h1><p><img src="https://s1.ax1x.com/2022/09/05/vTREUP.png" alt></p><h1 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h1><p>å½“å°†person re-IDçœ‹ä½œä¸€ä¸ªæ£€ç´¢è¿‡ç¨‹æ—¶ï¼Œre-rankingæ˜¯æé«˜å…¶å‡†ç¡®æ€§çš„å…³é”®æ­¥éª¤ã€‚ç„¶è€Œï¼Œåœ¨re-IDç¤¾åŒºä¸­ï¼Œå¯¹re-rankingçš„åŠªåŠ›æœ‰é™ï¼Œå°¤å…¶æ˜¯é‚£äº›å…¨è‡ªåŠ¨ã€æ— ç›‘ç£çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§k-reciprocalç¼–ç æ–¹æ³•æ¥re-ranking re-IDçš„ç»“æœã€‚æˆ‘ä»¬çš„å‡è®¾æ˜¯ï¼Œå¦‚æœä¸€ä¸ªgalleryå›¾åƒä¸k-reciprocal nearest neighborsä¸­çš„probeæŸ¥è¯¢ç›¸ä¼¼ï¼Œåˆ™æ›´æœ‰å¯èƒ½æ˜¯çœŸæ­£çš„åŒ¹é…ã€‚å…·ä½“åœ°ï¼Œç»™å®šå›¾åƒï¼Œé€šè¿‡å°†å…¶k-reciprocal nearest neighborsç¼–ç ä¸ºå•ä¸ªå‘é‡æ¥è®¡ç®—k-reciprocalç‰¹å¾ï¼Œè¯¥å‘é‡ç”¨äºåœ¨æ°å¡å¾·è·ç¦»ï¼ˆJaccard Distanceï¼šç”¨æ¥è¡¡é‡ä¸¤ä¸ªé›†åˆå·®å¼‚æ€§çš„ä¸€ç§æŒ‡æ ‡ï¼‰ä¸‹re-rankingã€‚æœ€ç»ˆçš„è·ç¦»è®¡ç®—ä¸ºåŸå§‹è·ç¦»å’Œæ°å¡å¾·è·ç¦»çš„ç»„åˆã€‚æˆ‘ä»¬çš„re-rankingæ–¹æ³•ä¸éœ€è¦ä»»ä½•äººå·¥äº¤äº’æˆ–ä»»ä½•æ ‡è®°æ•°æ®ï¼Œå› æ­¤é€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®é›†ã€‚åœ¨å¤§å‹Market-1501ã€CUHK03ã€MARSå’ŒPRWæ•°æ®é›†ä¸Šçš„å®éªŒè¯å®äº†æˆ‘ä»¬æ–¹æ³•çš„æœ‰æ•ˆæ€§ã€‚</p><hr><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>person re-IDæ˜¯è®¡ç®—æœºè§†è§‰ä¸­çš„ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„è¯¾é¢˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œre-IDå¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªæ£€ç´¢é—®é¢˜ã€‚ç»™å®šä¸€ä¸ªprobe personï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨galleryä¸­æœç´¢åŒ…å«å¤„äºè·¨ç›¸æœºæ¨¡å¼ä¸‹çš„ç›¸åŒè¡Œäººçš„å›¾åƒã€‚åœ¨è·å¾—åˆå§‹æ’åºåˆ—è¡¨ä¹‹åï¼Œå¥½çš„å®è·µåŒ…æ‹¬æ·»åŠ re-rankingæ­¥éª¤ï¼ŒæœŸæœ›ç›¸å…³å›¾åƒå°†è·å¾—æ›´é«˜çš„æ’åã€‚å› æ­¤ï¼Œæœ¬æ–‡å°†é‡ç‚¹æ”¾åœ¨re-rankingé—®é¢˜ä¸Šã€‚</p><p>re-rankingä¸»è¦æ˜¯åœ¨é€šç”¨å®ä¾‹æ£€ç´¢generic instance retrieval[5ã€14ã€34ã€35]ä¸­è¿›è¡Œç ”ç©¶ã€‚è®¸å¤šre-rankingä¸»æ–¹æ³•çš„ä¸»è¦ä¼˜ç‚¹æ˜¯å®ƒå¯ä»¥åœ¨ä¸éœ€è¦é¢å¤–è®­ç»ƒæ ·æœ¬çš„æƒ…å†µä¸‹å®ç°ï¼Œå¹¶ä¸”å¯ä»¥åº”ç”¨äºä»»ä½•åˆå§‹rankingç»“æœã€‚</p><p>re-rankingçš„æœ‰æ•ˆæ€§åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºåˆå§‹rankingåˆ—è¡¨initial ranking listçš„è´¨é‡ã€‚è®¸å¤šå…ˆå‰çš„å·¥ä½œåˆ©ç”¨äº†åˆå§‹æ’åºåˆ—è¡¨[5ï¼Œ14ï¼Œ34ï¼Œ35ï¼Œ43ï¼Œ44]ä¸­æ’åé å‰çš„å›¾åƒ(ä¾‹å¦‚k-æœ€è¿‘é‚»ï¼Œk-nearest neighbors)ä¹‹é—´çš„ç›¸ä¼¼å…³ç³»ã€‚ä¸€ä¸ªåŸºæœ¬çš„å‡è®¾æ˜¯ï¼Œå¦‚æœè¿”å›çš„å›¾åƒåœ¨probeçš„kä¸ªæœ€è¿‘é‚»å†…æ’åºï¼Œé‚£ä¹ˆå®ƒå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªçœŸæ­£çš„åŒ¹é…ï¼Œå¯ç”¨äºéšåçš„re-rankingã€‚ç„¶è€Œï¼Œæƒ…å†µå¯èƒ½åç¦»æœ€ä½³æƒ…å†µï¼šé”™è¯¯åŒ¹é…å¾ˆå¯èƒ½åŒ…æ‹¬åœ¨probeçš„kä¸ªæœ€è¿‘é‚»ä¸­ã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾1ä¸­ï¼ŒP1ã€P2ã€P3å’ŒP4æ˜¯4ä¸ªæŸ¥è¯¢å›¾probeçš„çœŸå®åŒ¹é…ï¼Œä½†æ˜¯å®ƒä»¬éƒ½ä¸åŒ…æ‹¬åœ¨top-4ä¸­ã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ°ä¸€äº›é”™è¯¯åŒ¹é…ï¼ˆN1-N6ï¼‰è·å¾—é«˜æ’åã€‚ç»“æœï¼Œç›´æ¥ä½¿ç”¨top-kçš„å›¾åƒå¯èƒ½åœ¨re-rankingç³»ç»Ÿä¸­å¼•å…¥å™ªå£°å¹¶æŸå®³æœ€ç»ˆç»“æœã€‚<br><img src="https://s1.ax1x.com/2022/09/05/vTReC8.png" alt><br>åœ¨æ–‡çŒ®ä¸­ï¼Œk-reciprocal nearest neighbor[14ï¼Œ34]æ˜¯è§£å†³ä¸Šè¿°é—®é¢˜çš„æœ‰æ•ˆæ–¹æ³•ï¼Œå³è¢«é”™è¯¯åŒ¹é…æ±¡æŸ“çš„top-kå›¾åƒã€‚å½“ä¸¤ä¸ªå›¾åƒè¢«ç§°ä¸ºk-reciprocal nearest neighboræ—¶ï¼Œå½“å¦ä¸€ä¸ªå›¾åƒä½œä¸ºprobeæ—¶ï¼Œå®ƒä»¬éƒ½è¢«æ’åˆ°top-kã€‚å› æ­¤ï¼Œk-reciprocal nearest neighborä½œä¸ºä¸¤ä¸ªå›¾åƒæ˜¯å¦æ­£ç¡®åŒ¹é…çš„æ›´ä¸¥æ ¼è§„åˆ™ã€‚åœ¨å›¾1ä¸­ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°probeæ˜¯æ­£ç¡®åŒ¹é…å›¾åƒçš„reciprocal neighborï¼Œè€Œä¸æ˜¯é”™è¯¯åŒ¹é…å›¾åƒçš„reciprocal neighborã€‚è¯¥è§‚å¯Ÿè¯†åˆ«åˆå§‹æ’åºåˆ—è¡¨initial ranking listä¸­çš„æ­£ç¡®åŒ¹é…ï¼Œä»¥æ”¹å–„é‡æ–°æ’åºre-rankingç»“æœã€‚</p><p>åŸºäºä»¥ä¸Šè€ƒè™‘ï¼Œæœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºk-reciprocalç¼–ç çš„re-ID re-rankingæ–¹æ³•ã€‚æˆ‘ä»¬çš„æ–¹æ³•åŒ…æ‹¬ä¸‰ä¸ªæ­¥éª¤ã€‚é¦–å…ˆï¼Œå°†åŠ æƒçš„k-reciprocal neighbor é›†ç¼–ç ä¸ºä¸€ä¸ªå‘é‡ï¼Œå½¢æˆk-reciprocalç‰¹å¾ã€‚ç„¶åï¼Œä¸¤ä¸ªå›¾åƒä¹‹é—´çš„Jaccardè·ç¦»å¯ä»¥é€šè¿‡å®ƒä»¬çš„k-reciprocalç‰¹å¾æ¥è®¡ç®—ã€‚å…¶æ¬¡ï¼Œä¸ºäº†è·å¾—æ›´é²æ£’çš„k-reciprocalç‰¹å¾ï¼Œæˆ‘ä»¬æ”¹è¿›äº†ä¸€ç§å±€éƒ¨æŸ¥è¯¢æ‰©å±•æ–¹æ³•ï¼ˆa local query expansion approachï¼‰ï¼Œä»¥è¿›ä¸€æ­¥æ”¹å–„re-IDæ€§èƒ½ã€‚æœ€åï¼Œæœ€ç»ˆè·ç¦»çš„è®¡ç®—ä¸ºåŸå§‹è·ç¦»å’ŒJaccardè·ç¦»çš„åŠ æƒé›†åˆã€‚éšåï¼Œå®ƒè¢«ç”¨æ¥è·å–re-rankingåˆ—è¡¨ã€‚æ‰€æå‡ºçš„æ–¹æ³•çš„æ¡†æ¶å¦‚å›¾2æ‰€ç¤ºã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæœ¬æ–‡çš„è´¡çŒ®æ˜¯ï¼š</p><ol><li>æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªk-reciprocalç‰¹å¾é€šè¿‡ç¼–ç k-reciprocalç‰¹å¾åˆ°ä¸€ä¸ªå•ä¸€çš„å‘é‡ã€‚é‡re-rankingè¿‡ç¨‹å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡å‘é‡æ¯”è¾ƒæ¥æ‰§è¡Œã€‚</li><li>æˆ‘ä»¬çš„æ–¹æ³•ä¸éœ€è¦ä»»ä½•äººå·¥äº¤äº’æˆ–å¸¦æ ‡æ³¨çš„æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨å’Œæ— ç›‘ç£çš„æ–¹å¼åº”ç”¨äºä»»ä½•äººperson re-ID rankingç»“æœã€‚</li><li>è¯¥æ–¹æ³•æœ‰æ•ˆåœ°æé«˜äº†Market-1501ã€CUHK03ã€MARSå’ŒPRWç­‰æ•°æ®é›†ä¸Šçš„person re-IDæ€§èƒ½ã€‚ç‰¹åˆ«åœ°ï¼Œæˆ‘ä»¬åœ¨rank-1å’ŒmAPä¸Šå®ç°äº†Market-1501çš„æœ€å…ˆè¿›çš„ç²¾åº¦ã€‚<br><img src="https://s1.ax1x.com/2022/09/05/vTRV4f.png" alt></li></ol><h1 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h1><p>æˆ‘ä»¬æ¨èæ„Ÿå…´è¶£çš„è¯»è€…é˜…è¯»[3ï¼Œ50]ä»¥è¯¦ç»†å›é¡¾person re-IDã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬é‡ç‚¹ç ”ç©¶ç”¨äºç›®æ ‡æ£€ç´¢ï¼Œç‰¹åˆ«æ˜¯ç”¨äºre-IDçš„re-rankingæ–¹æ³•ã€‚</p><p><strong>Re-ranking for object retrieval.</strong><br>Re-rankingæ–¹æ³•å·²è¢«æˆåŠŸåœ°ç ”ç©¶ä»¥æé«˜ç›®æ ‡æ£€ç´¢ç²¾åº¦[51]ã€‚è®¸å¤šå·¥ä½œåˆ©ç”¨k-nearest neighborsæ¥æ¢ç´¢ç›¸ä¼¼å…³ç³»æ¥è§£å†³re-rankingé—®é¢˜ã€‚[5]æå‡ºäº†average query expansion (AQE)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šè¿‡å¯¹top-kè¿”å›ç»“æœä¸­çš„å‘é‡è¿›è¡Œå¹³å‡ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„æŸ¥è¯¢å‘é‡ï¼ˆquery vectorï¼‰ï¼Œç”¨äºå¯¹æ•°æ®åº“è¿›è¡Œé‡æ–°æŸ¥è¯¢ã€‚ä¸ºäº†åˆ©ç”¨è¿œç¦»æŸ¥è¯¢å›¾åƒçš„è´Ÿæ ·æœ¬ï¼ŒArandjeloviÄ‡å’ŒZisserman[1]æ”¹è¿›äº†discriminative query expansion (DQE)ï¼Œä½¿ç”¨çº¿æ€§SVMæ¥è·å¾—æƒé‡å‘é‡ã€‚ä»å†³ç­–è¾¹ç•Œçš„è·ç¦»è¢«ç”¨æ¥ä¿®æ”¹åˆå§‹æ’åºè¡¨ï¼ˆinitial ranking listï¼‰ã€‚[35]åˆ©ç”¨åˆå§‹æ’åºè¡¨çš„k-nearest neighborsä½œä¸ºæ–°æŸ¥è¯¢ï¼ˆqueriesï¼‰æ¥ç”Ÿæˆæ–°çš„æ’åºè¡¨ã€‚æ¯ä¸ªå›¾åƒçš„æ–°å¾—åˆ†æ ¹æ®å…¶åœ¨äº§ç”Ÿçš„æ’åºè¡¨ä¸­çš„ä½ç½®æ¥è®¡ç®—ã€‚æœ€è¿‘ï¼Œç¨€ç–ä¸Šä¸‹æ–‡æ¿€æ´»sparse contextual activation (SCA)[2]æå‡ºå°†neighbor setç¼–ç ä¸ºå‘é‡ï¼Œå¹¶é€šè¿‡å¹¿ä¹‰Jaccardè·ç¦»æ¥è¡¨ç¤ºæ ·æœ¬çš„ç›¸ä¼¼æ€§ã€‚ä¸ºäº†é˜²æ­¢é”™è¯¯åŒ¹é…å¯¹top-kå›¾åƒçš„æ±¡æŸ“ï¼Œ[14ï¼Œ34]ä¸­é‡‡ç”¨äº†k-reciprocal nearest neighborsçš„æ¦‚å¿µã€‚åœ¨[14]ä¸­æå‡ºäº†ä¸Šä¸‹æ–‡ä¸ç›¸ä¼¼æ€§åº¦é‡contextual dissimilarity measure (CDM)ï¼Œé€šè¿‡è¿­ä»£æ­£åˆ™åŒ–æ¯ä¸ªç‚¹åˆ°å…¶é‚»åŸŸçš„å¹³å‡è·ç¦»æ¥ç»†åŒ–ç›¸ä¼¼æ€§ã€‚[34]æ­£å¼æå‡ºk-reciprocal nearest neighborsçš„æ¦‚å¿µã€‚k-reciprocal nearest neighborsè¢«è®¤ä¸ºæ˜¯é«˜åº¦ç›¸å…³çš„å€™é€‰ï¼Œç”¨äºæ„é€ é—­é›†ï¼ˆclosed setï¼‰ä»¥re-rankingæ•°æ®é›†çš„å…¶ä½™éƒ¨åˆ†ã€‚æˆ‘ä»¬çš„å·¥ä½œä»ä¸¤ä¸ªæ–¹é¢èƒŒç¦»äº†è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚æˆ‘ä»¬ä¸åƒæ–‡çŒ®[14]é‚£æ ·å¯¹æœ€è¿‘é‚»ï¼ˆnearest neighborhoodï¼‰å…³ç³»è¿›è¡Œå¯¹ç§°åŒ–æ¥ç»†åŒ–ç›¸ä¼¼åº¦ï¼Œä¹Ÿä¸åƒæ–‡çŒ®[34]é‚£æ ·ç›´æ¥å°†k-reciprocal nearest neighborsçœ‹ä½œé«˜é˜¶æ ·æœ¬ã€‚ç›¸åï¼Œæˆ‘ä»¬é€šè¿‡æ¯”è¾ƒä¸¤å¹…å›¾åƒçš„k-reciprocal nearest neighborsæ¥è®¡ç®—å®ƒä»¬ä¹‹é—´çš„æ–°è·ç¦»ã€‚</p><p><strong>Re-ranking for re-ID.</strong><br>å¤§å¤šæ•°ç°æœ‰çš„person re-IDæ–¹æ³•ä¸»è¦é›†ä¸­äºç‰¹å¾è¡¨ç¤º[41ï¼Œ12ï¼Œ23ï¼Œ48ï¼Œ21]æˆ–åº¦é‡å­¦ä¹ [23ï¼Œ17ï¼Œ9ï¼Œ32ï¼Œ45]ã€‚æœ€è¿‘ï¼Œä¸€äº›ç ”ç©¶è€…[10ï¼Œ33ï¼Œ28ï¼Œ24ï¼Œ49ï¼Œ20ï¼Œ11ï¼Œ19ï¼Œ42ï¼Œ44]å·²ç»æ³¨æ„åˆ°åœ¨re-IDç¤¾åŒºä¸­åŸºäºre-rankingçš„æ–¹æ³•ã€‚[20]é€šè¿‡åˆ†ææ¯å¯¹å›¾åƒçš„è¿‘é‚»ï¼ˆnear neighborsï¼‰çš„ç›¸å…³ä¿¡æ¯å’Œç›´æ¥ä¿¡æ¯ï¼Œå»ºç«‹re-rankingæ¨¡å‹ã€‚åœ¨[11]ä¸­ï¼Œé€šè¿‡è”åˆè€ƒè™‘æ’åºåˆ—è¡¨ä¸­çš„å†…å®¹å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå­¦ä¹ æ— ç›‘ç£çš„é‡æ–°æ’åºæ¨¡å‹ï¼Œæœ‰æ•ˆåœ°å»é™¤äº†æ¨¡ç³Šæ ·æœ¬ï¼Œæé«˜äº†re-IDçš„æ€§èƒ½ã€‚[19]æå‡ºä¸€ç§åŒå‘æ’åºï¼ˆbidirectional rankingï¼‰æ–¹æ³•ï¼Œåˆ©ç”¨è®¡ç®—å¾—åˆ°çš„æ–°ç›¸ä¼¼åº¦ä½œä¸ºå†…å®¹ç›¸ä¼¼åº¦å’Œä¸Šä¸‹æ–‡ç›¸ä¼¼åº¦çš„èåˆï¼Œå¯¹åˆå§‹æ’åºè¡¨è¿›è¡Œä¿®æ­£ã€‚æœ€è¿‘ï¼Œåˆ©ç”¨ä¸åŒåŸºçº¿ï¼ˆdifferent baselineï¼‰æ–¹æ³•çš„å…¬å…±æœ€è¿‘é‚»æ¥re-rankingä»»åŠ¡[42ï¼Œ44]ã€‚[42]å°†å…¨å±€ç‰¹å¾å’Œå±€éƒ¨ç‰¹å¾çš„å…¬å…±æœ€è¿‘é‚»ä½œä¸ºæ–°æŸ¥è¯¢ï¼ˆqueriesï¼‰ï¼Œé€šè¿‡é›†åˆå…¨å±€ç‰¹å¾å’Œå±€éƒ¨ç‰¹å¾çš„æ–°æ’åºåˆ—è¡¨æ¥ä¿®æ”¹åˆå§‹æ’åºåˆ—è¡¨ã€‚åœ¨[44]ä¸­ï¼Œåˆ©ç”¨k-nearest neighbor setä»ä¸åŒçš„baselineæ–¹æ³•è®¡ç®—ç›¸ä¼¼åº¦å’Œä¸ç›¸ä¼¼åº¦ï¼Œç„¶åè¿›è¡Œç›¸ä¼¼åº¦å’Œä¸ç›¸ä¼¼åº¦çš„é›†åˆæ¥ä¼˜åŒ–åˆå§‹æ’åºè¡¨ã€‚ä¸Šè¿°æ–¹æ³•åœ¨re-rankingæ–¹é¢ç»§ç»­å–å¾—è¿›å±•ï¼Œæœ‰æœ›ä¸ºå°†æ¥ä»k-nearest neighborså‘ç°è¿›ä¸€æ­¥çš„ä¿¡æ¯ä½œå‡ºè´¡çŒ®ã€‚ç„¶è€Œï¼Œä½¿ç”¨k-nearest neighborsç›´æ¥å®ç°re-rankingå¯èƒ½é™åˆ¶æ•´ä½“æ€§èƒ½ï¼Œå› ä¸ºå¸¸å¸¸åŒ…æ‹¬é”™è¯¯åŒ¹é…ã€‚<strong>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ¬æ–‡ç ”ç©¶äº†k-reciprocal neighborsåœ¨person re-IDä¸­çš„é‡è¦æ€§ï¼Œä»è€Œè®¾è®¡äº†ä¸€ä¸ªç®€å•è€Œæœ‰æ•ˆçš„re-rankingæ–¹æ³•ã€‚</strong></p><h1 id="Proposed-Approach"><a href="#Proposed-Approach" class="headerlink" title="Proposed Approach"></a>Proposed Approach</h1><h3 id="Problem-Definition"><a href="#Problem-Definition" class="headerlink" title="Problem Definition"></a>Problem Definition</h3><p>ç»™å®šæŸ¥è¯¢å›¾åƒ<code>p</code>å’Œ<code>gallery set</code>ï¼ˆåŒ…å«Nå¹…å›¾åƒï¼Œ<code>G = {gi | i = 1, 2, ...N }</code>ï¼‰ï¼Œ<code>p</code>å’Œ<code>gi</code>ä¹‹é—´çš„åŸå§‹è·ç¦»å¯ä»¥ç”¨é©¬æ°è·ç¦»ï¼ˆMahalanobis distanceï¼‰è¡¡é‡ï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vTR9jH.png" alt><br>å…¶ä¸­ï¼Œ<code>xp</code>ä¸ª<code>xg</code>åˆ†åˆ«ä»£è¡¨æŸ¥è¯¢å›¾<code>p</code>å’Œ<strong>æ£€æµ‹é›†gallery</strong>ä¸­<code>gi</code>çš„å¤–è§‚ç‰¹å¾ï¼Œ<code>M</code>æ˜¯åŠæ­£å®šçŸ©é˜µã€‚<br>åˆå§‹æ’åºè¡¨ï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vTRpge.png" alt><br>å¯æ ¹æ®<code>probe p</code>å’Œ<code>gallery gi</code>ä¹‹é—´çš„æˆå¯¹åŸå§‹è·ç¦»å¾—åˆ°ï¼Œå…¶ä¸­ï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vTRPud.png" alt><br>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¯¹<code>L(p,G)</code>è¿›è¡Œ<strong>re-rank</strong>ï¼Œä½¿æ›´å¤šçš„æ­£æ ·æœ¬æ’åœ¨<code>top</code>åˆ—è¡¨ä¸­ï¼Œä»è€Œæé«˜person re-IDçš„æ€§èƒ½ã€‚</p><h3 id="K-reciprocal-Nearest-Neighbors"><a href="#K-reciprocal-Nearest-Neighbors" class="headerlink" title="K -reciprocal Nearest Neighbors"></a>K -reciprocal Nearest Neighbors</h3><p>æˆ‘ä»¬å°†<code>N(p,k)</code>å®šä¹‰ä¸ºä¸€ä¸ªprobe pçš„k-nearest neighborsï¼ˆi.e. æ’åºåˆ—è¡¨çš„top-k samplesï¼‰ï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vTRFHI.png" alt><br>å…¶ä¸­ï¼Œ<code>|.|</code>è¡¨ç¤ºé›†åˆä¸­å€™é€‰çš„æ•°ç›®ã€‚k-reciprocal nearest neighbors <code>R(p, k)</code>å¯ä»¥å®šä¹‰ä¸ºï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vTRAEt.png" alt><br><strong>æ ¹æ®å‰é¢çš„æè¿°ï¼Œk-reciprocal nearest neighborsæ¯”k-nearest neighborså’Œprobe pæ›´ç›¸å…³</strong>ã€‚ç„¶è€Œï¼Œç”±äºç…§æ˜ã€å§¿æ€ã€è§†å›¾å’Œé®æŒ¡çš„å˜åŒ–ï¼Œæ­£æ ·æœ¬å›¾åƒå¯èƒ½è¢«ä»k-nearest neighborsä¸­æ’é™¤ï¼Œå¹¶ä¸”éšåä¸è¢«åŒ…æ‹¬åœ¨k-reciprocal nearest neighborsä¸­ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ ¹æ®ä»¥ä¸‹æ¡ä»¶å°†<code>R(pï¼Œk)</code>ä¸­æ¯ä¸ªå€™é€‰é¡¹çš„<code>1/2 k-reciprocal nearest neighbors</code>å¢é‡åœ°æ·»åŠ åˆ°æ›´é²æ£’çš„é›†åˆ<code>R*(pï¼Œk)</code>ä¸­ï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vTRiDA.png" alt></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è§£å†³person re-IDçš„re-rankingé—®é¢˜ã€‚é€šè¿‡å°†k-reciprocal nearest neighborsç¼–ç ä¸ºå•ä¸ªå‘é‡ï¼Œæˆ‘ä»¬æå‡ºäº†k-reciprocalç‰¹å¾ï¼Œä»è€Œå¯ä»¥é€šè¿‡å‘é‡æ¯”è¾ƒå®¹æ˜“åœ°æ‰§è¡Œre-rankingè¿‡ç¨‹ã€‚ä¸ºäº†ä»ç›¸ä¼¼æ ·æœ¬ä¸­è·å–ç›¸ä¼¼å…³ç³»ï¼Œæå‡ºäº†å±€éƒ¨æ‰©å±•æŸ¥è¯¢ï¼ˆlocal expansion queryï¼‰ä»¥è·å¾—æ›´é²æ£’çš„k-reciprocalç‰¹å¾ã€‚åŸºäºåŸå§‹è·ç¦»å’ŒJaccardè·ç¦»çš„ç»„åˆçš„æœ€ç»ˆè·ç¦»æœ‰æ•ˆåœ°æé«˜äº†å¤šä¸ªå¤§è§„æ¨¡æ•°æ®é›†ä¸Šçš„re-IDæ€§èƒ½ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬çš„æ–¹æ³•æ˜¯å…¨è‡ªåŠ¨å’Œæ— ç›‘ç£çš„ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°ä»»ä½•rankingç»“æœã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¡Œäººé‡è¯†åˆ« </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> å›¾åƒå¤„ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>numpyä¹‹sumå‡½æ•°çš„axiså‚æ•°</title>
      <link href="/2020/03/21/numpy%E4%B8%AD%E7%9A%84axis%E5%8F%82%E6%95%B0/"/>
      <url>/2020/03/21/numpy%E4%B8%AD%E7%9A%84axis%E5%8F%82%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="ç»“è®ºï¼š"><a href="#ç»“è®ºï¼š" class="headerlink" title="ç»“è®ºï¼š"></a>ç»“è®ºï¼š</h1><p>æ²¡æœ‰axiså‚æ•°è¡¨ç¤ºå…¨éƒ¨ç›¸åŠ ï¼Œaxisï¼0è¡¨ç¤ºæŒ‰åˆ—ç›¸åŠ ï¼Œaxisï¼1è¡¨ç¤ºæŒ‰ç…§è¡Œçš„æ–¹å‘ã€‚éªŒè¯å¦‚ä¸‹ï¼š<br><img src="https://5b0988e595225.cdn.sohucs.com/images/20171124/e90ccf3e7386468fa64c8b4bc0e60e5e.png" alt="axis&amp;sum"></p><h1 id="æ¨å¹¿ï¼š"><a href="#æ¨å¹¿ï¼š" class="headerlink" title="æ¨å¹¿ï¼š"></a>æ¨å¹¿ï¼š</h1><p>axis=iè¡¨ç¤ºå¯¹arrayçš„ç¬¬iä¸ªç»´åº¦<strong>å˜åŒ–</strong>çš„æ–¹å‘è¿›è¡Œæ“ä½œï¼</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> numpy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>numpyæ•°ç»„å’Œpythonåˆ—è¡¨çš„åŒºåˆ«</title>
      <link href="/2020/03/21/numpy%E6%95%B0%E7%BB%84%E5%92%8Cpython%E5%88%97%E8%A1%A8%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2020/03/21/numpy%E6%95%B0%E7%BB%84%E5%92%8Cpython%E5%88%97%E8%A1%A8%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><ol><li><p>numpyæ•°ç»„åˆ›å»ºæ—¶æ˜¯å›ºå®šå¤§å°ï¼Œpythonæ•°ç»„ï¼ˆlistï¼‰æ˜¯åŠ¨æ€çš„ã€‚æ›´æ”¹ndarrayçš„å¤§å°å°†åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„å¹¶åˆ é™¤åŸæ¥çš„æ•°ç»„ã€‚</p></li><li><p>å…ƒç´ ç±»å‹åŒºåˆ«ã€‚</p></li><li><p>NumPyæ•°ç»„ä¸­çš„å…ƒç´ éƒ½éœ€è¦å…·æœ‰ç›¸åŒçš„æ•°æ®ç±»å‹ï¼Œå› æ­¤åœ¨å†…å­˜ä¸­çš„å¤§å°ç›¸åŒã€‚</p></li><li><p>pythonçš„Listå¯ä»¥å­˜æ”¾ä¸åŒç±»å‹çš„å…ƒç´ ã€‚</p></li><li><p>ä¾‹å¤–æƒ…å†µï¼šPythonçš„åŸç”Ÿæ•°ç»„é‡ŒåŒ…å«äº†NumPyçš„å¯¹è±¡çš„æ—¶å€™ï¼Œè¿™ç§æƒ…å†µä¸‹å°±å…è®¸ä¸åŒå¤§å°å…ƒç´ çš„æ•°ç»„ã€‚</p></li><li><p>æ•°å­¦æ“ä½œæ‰§è¡Œæ•ˆç‡é«˜äºåŸç”Ÿpython</p></li><li><p>è¶Šæ¥è¶Šå¤šçš„åŸºäºPythonçš„ç§‘å­¦å’Œæ•°å­¦è½¯ä»¶åŒ…ä½¿ç”¨NumPyæ•°ç»„</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> numpy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--java.lang.comparableæ¥å£å®æˆ˜</title>
      <link href="/2020/03/16/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(37)/"/>
      <url>/2020/03/16/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(37)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="ä»£ç å±•ç¤º"><a href="#ä»£ç å±•ç¤º" class="headerlink" title="ä»£ç å±•ç¤º"></a>ä»£ç å±•ç¤º</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> * å®ç°java.lang.comparableæ¥å£å¹¶æµ‹è¯•Array.sort()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Comparable</span>&lt;<span class="title">Employee</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> salary;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> salary,String name)</span></span>&#123;</span><br><span class="line"><span class="keyword">this</span>.id = id;</span><br><span class="line"><span class="keyword">this</span>.salary = salary;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> salary;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Employee o)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(name.compareTo(o.name)!=<span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> name.compareTo(o.name);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (salary&lt;o.salary) </span><br><span class="line"><span class="keyword">return</span> - <span class="number">1</span> ;  </span><br><span class="line"><span class="keyword">if</span> (salary&gt;o.salary)  </span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span> ;  </span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;        </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> Employee[] staff =  <span class="keyword">new</span> Employee[ <span class="number">4</span> ];  </span><br><span class="line">        staff[ <span class="number">0</span> ] =  <span class="keyword">new</span> Employee(<span class="number">001</span>,<span class="number">5000</span>,<span class="string">"harry"</span>);  </span><br><span class="line">        staff[ <span class="number">1</span> ] =  <span class="keyword">new</span> Employee(<span class="number">002</span>,<span class="number">3000</span>,<span class="string">"carl "</span>);  </span><br><span class="line">        staff[ <span class="number">2</span> ] =  <span class="keyword">new</span> Employee(<span class="number">003</span>,<span class="number">4000</span>,<span class="string">"tony "</span>);  </span><br><span class="line">        staff[ <span class="number">3</span> ] =  <span class="keyword">new</span> Employee(<span class="number">004</span>,<span class="number">6000</span>,<span class="string">"carl "</span>);  </span><br><span class="line"></span><br><span class="line">    java.util.Arrays.sort(staff);</span><br><span class="line"><span class="keyword">for</span>(Employee e: staff)  </span><br><span class="line">        System.out.println( <span class="string">"id="</span> +e.getId()+ <span class="string">"  name="</span> +e.getName()+  <span class="string">"  salary="</span> +e.getSalary());  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºç»“æœï¼š</strong><br><img src="https://s3.bmp.ovh/imgs/2022/09/05/8939f59ba6ee01f6.png" alt="java" title="è¿è¡Œç»“æœ"></p><p><strong>ä¸Šè¿°ä»£ç æ˜¯æŸæ¬¡Javaä½œä¸šï¼Œé¢˜ç›®æè¿°å¦‚ä¸‹ï¼š</strong></p><blockquote><p>ç¼–å†™å‘˜å·¥Employeeç±»ï¼ŒåŒ…å«idã€å§“åã€å·¥èµ„salaryç­‰å±æ€§ã€‚ä»¤Employeeç±»å®ç°java.lang.comparableæ¥å£ï¼Œå¹¶å®ç°compareToï¼ˆï¼‰æ–¹æ³•ï¼Œåˆ¶å®šæ¯”è¾ƒè§„åˆ™ã€‚åœ¨æµ‹è¯•ç±»ä¸­åˆ›å»ºå‡ ä¸ªEmployeeå¯¹è±¡ï¼Œåˆ©ç”¨java.util.Arrayç±»ä¸­çš„æ–¹æ³•å¯¹å…¶è¿›è¡Œæ’åºå¹¶æ‰“å°è¾“å‡ºç»“æœã€‚PS:å…³äºæ¯”è¾ƒçš„è§„åˆ™ï¼Œå»ºè®®åˆ†åˆ«æŒ‰ç…§nameå’Œsalaryè¿›è¡Œå‡åºæ’åˆ—ã€‚</p></blockquote><p><strong>é¢˜ç›®å‡ºè‡ªæ¥å£æŠ€æœ¯ä¸€ç« ï¼Œå®åˆ™éš¾ç‚¹ä¸åœ¨æ¥å£æŠ€æœ¯ï¼ŒJavaæ–°æ‰‹åœ¨é˜…è¯»ä¸Šè¿°ä»£ç å¾€å¾€ä¼šæ„Ÿåˆ°å›°æƒ‘ï¼Œæä¸æ‡‚ä¸ºä½•å¯¹compareToçš„è‡ªå®šä¹‰å®ç°ä¼šå½±å“sortæ–¹æ³•çš„æ•ˆæœï¼Ÿ</strong></p><h1 id="Array-Sort"><a href="#Array-Sort" class="headerlink" title="Array.Sort()"></a>Array.Sort()</h1><blockquote><p>å³ä½¿æ˜¯å°ç™½ï¼Œåœ¨é˜…è¯»å®Œä»£ç åï¼Œä¹Ÿåº”è¯¥ä¼šäº§ç”Ÿè¿™æ ·çš„çŒœæµ‹ï¼šline48çš„java.util.Arrays.sort(staff);çš„sortæ–¹æ³•å†…ä¼šä¸ä¼šç”¨åˆ°äº†compareToæ–¹æ³•äº†å‘¢ï¼Ÿ</p></blockquote><p>å¾ˆå¥½çš„çŒœæƒ³ï¼Œè®©æˆ‘ä»¬è¿›å…¥sortï¼ˆï¼‰å†…éƒ¨çœ‹çœ‹ï¼š<br><img src="https://s3.bmp.ovh/imgs/2022/09/05/e82a45de2e7c9fd7.png" alt="java" title="å†…éƒ¨å®ç°"><br>è¿›å…¥sortï¼ˆï¼‰å†…éƒ¨å®ç°åæ ¹æ®å…³é”®ä¿¡æ¯æˆ‘ä»¬åˆèƒ½å¾ˆè½»æ˜“çš„è¿½æº¯åˆ°mergeSortæ–¹æ³•ï¼Œé‚£å°±ç»§ç»­è¿›å…¥mergeSortï¼ˆï¼‰çš„å†…éƒ¨å®ç°ï¼š<br><img src="https://s3.bmp.ovh/imgs/2022/09/05/6e1c7b20b16b9dd9.png" alt="java" title="å†…éƒ¨å®ç°"><br><strong>å¦‚æœä½ çœ‹åˆ°è¿™é‡Œï¼šé‚£ä¹ˆï¼Œæ­å–œä½ èŠ±ç”ŸğŸ¥œï¼Œä½ å‘ç°çš„ç›²ç‚¹ï¼</strong><br>å¾ˆæ˜¾ç„¶ï¼ŒmergeSortå†…éƒ¨çš„æ’åºä¾èµ–äº†å‚ä¸æ’åºçš„å¯¹è±¡çš„ä¸¤ä¸¤æ¯”è¾ƒï¼ˆdest[]æ˜¯å¯¹è±¡æ•°ç»„ï¼‰forå¾ªç¯æœ€é‡Œå±‚åšçš„äº‹æƒ…æ˜¯å°†å¯¹è±¡è½¬æ¢ä¸ºComparebleç±»å‹å¹¶è°ƒç”¨å…¶compareTo()æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦è¢«æ¯”è¾ƒçš„å¯¹è±¡å®ç°Comparableæ¥å£ã€‚æ„Ÿå…´è¶£çš„è¯å¯ä»¥æœä¸€ä¸‹æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œè¿™ç®—å…¶ä¸­ä¸€ä¸ªå…¸å‹çš„åº”ç”¨ï¼Œä¸ªäººè®¤ä¸ºå¹¶ä¸å±äºçº¯æ¥å£æŠ€æœ¯çš„ç¼–ç¨‹é¢˜ã€‚</p><h1 id="Comparableæ¥å£compareToæ–¹æ³•çš„æ€»ç»“"><a href="#Comparableæ¥å£compareToæ–¹æ³•çš„æ€»ç»“" class="headerlink" title="Comparableæ¥å£compareToæ–¹æ³•çš„æ€»ç»“"></a>Comparableæ¥å£compareToæ–¹æ³•çš„æ€»ç»“</h1><p>å…³äºå‡åºè¿˜æ˜¯é™åºçš„é—®é¢˜ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li>æ­£åº</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Test o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.i - o.i;</span><br></pre></td></tr></table></figure><ul><li>é€†åº</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Test o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  o.i-<span class="keyword">this</span>.i ;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Matlabä¹‹ineterp1æ’å€¼</title>
      <link href="/2020/02/21/Matlab%E6%95%B0%E6%A8%A1(1)/"/>
      <url>/2020/02/21/Matlab%E6%95%B0%E6%A8%A1(1)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%ä¸€ç»´æ’å€¼</span></span><br><span class="line"></span><br><span class="line">x = <span class="number">0</span> : <span class="built_in">pi</span>/<span class="number">4</span> : <span class="number">2</span> * <span class="built_in">pi</span>;     <span class="comment">%xçš„æ ·æœ¬å€¼</span></span><br><span class="line">y = <span class="built_in">sin</span>(x);                <span class="comment">%yçš„æ ·æœ¬å€¼</span></span><br><span class="line">xx = <span class="number">0</span> : <span class="number">0.5</span> : <span class="number">2</span> * <span class="built_in">pi</span>;     <span class="comment">%ç›®æ ‡çš„xå€¼</span></span><br><span class="line"><span class="comment">%åˆ†æ®µçº¿æ€§æ’å€¼ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">y1 = interp1(x,y,xx);</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>);<span class="built_in">plot</span>(x,y,<span class="string">'o'</span>,xx,y1,<span class="string">'r'</span>);</span><br><span class="line">title(<span class="string">'åˆ†æ®µçº¿æ€§æ’å€¼'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">%ä¸´è¿‘æ’å€¼</span></span><br><span class="line">y2 = interp1(x,y,xx,<span class="string">'nearnest'</span>);</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>);<span class="built_in">plot</span>(x,y,<span class="string">'o'</span>,xx,y2,<span class="string">'r'</span>);</span><br><span class="line">title(<span class="string">'é‚»è¿‘æ’å€¼'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">%çƒé¢çº¿æ€§æ’å€¼</span></span><br><span class="line">y3 = interp1(x,y,xx,<span class="string">'spline'</span>);</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>);<span class="built_in">plot</span>(x,y,<span class="string">'o'</span>,xx,y3,<span class="string">'r'</span>);</span><br><span class="line">title(<span class="string">'çƒé¢çº¿æ€§æ’å€¼'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">%ä¸‰æ¬¡å¤šé¡¹å¼æ’å€¼</span></span><br><span class="line">y4 = interp1(x,y,xx,<span class="string">'PCHIP'</span>);</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>);<span class="built_in">plot</span>(x,y,<span class="string">'o'</span>,xx,y4,<span class="string">'r'</span>);</span><br><span class="line">title(<span class="string">'ä¸‰æ¬¡å¤šé¡¹å¼æ’å€¼'</span>)</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºç»“æœ</strong></p><p><img src="https://s3.bmp.ovh/imgs/2022/09/05/7f0cd8ca7c6c30fd.png" alt="ans" title="ans"></p>]]></content>
      
      
      <categories>
          
          <category> ç§‘å­¦è®¡ç®— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Matlab </tag>
            
            <tag> æ•°å­¦å»ºæ¨¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Matlabä¹‹äºŒç»´æ’å€¼ï¼šä¼°æµ‹æµ·åº•æŸæ›²é¢åœ°å½¢</title>
      <link href="/2020/02/21/Matlab%E6%95%B0%E6%A8%A1(2)/"/>
      <url>/2020/02/21/Matlab%E6%95%B0%E6%A8%A1(2)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% 2ç»´æ’å€¼ç¤ºä¾‹ï¼šä¼°æµ‹æµ·åº•æŸæ›²é¢åœ°å½¢</span></span><br><span class="line">x = [<span class="number">129</span>,<span class="number">140</span>,<span class="number">103.5</span>,<span class="number">88</span>,<span class="number">185.5</span>,<span class="number">195</span>,<span class="number">105</span>,<span class="number">157.5</span>,<span class="number">107.5</span>,<span class="number">77</span>,<span class="number">81</span>,<span class="number">162</span>,<span class="number">162</span>,<span class="number">117.5</span>];</span><br><span class="line">y = [<span class="number">7.5</span>,<span class="number">141.5</span>,<span class="number">23</span>,<span class="number">147</span>,<span class="number">22.5</span>,<span class="number">137.5</span>,<span class="number">85.5</span>,<span class="number">-6.5</span>,<span class="number">-81</span>,<span class="number">3</span>,<span class="number">56.5</span>,<span class="number">-66.5</span>,<span class="number">84</span>,<span class="number">-33.5</span>];</span><br><span class="line">z = -[<span class="number">4</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">9</span>];</span><br><span class="line">xmm = minmax(x);</span><br><span class="line">ymm = minmax(y);</span><br><span class="line">xi = xmm(<span class="number">1</span>):<span class="number">2.5</span>:xmm(<span class="number">2</span>);</span><br><span class="line">yi = ymm(<span class="number">1</span>):<span class="number">2.5</span>:ymm(<span class="number">2</span>);</span><br><span class="line">z_interp = griddata(x,y,z,xi,yi',<span class="string">'V4'</span>);     <span class="comment">%griddataæ’å€¼åŒinterp2ï¼Œä½†æ˜¯å¯¹æ•°æ®è¦æ±‚ä¸ä¸¥æ ¼</span></span><br><span class="line">surf(xi,yi,z_interp);</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºç»“æœ</strong></p><p><img src="https://s3.bmp.ovh/imgs/2022/09/05/a671546bee229037.png" alt="ans" title="ans"></p><p><img src="https://s3.bmp.ovh/imgs/2022/09/05/b516d0a759d6dc00.png" alt="ans" title="ans"></p><blockquote><p>PS:æ·±åº¦å¤§äº0çš„éƒ¨åˆ†åº”æ‰‹åŠ¨èˆå¼ƒï¼Œè¾¹å€¼åŒºåŸŸçš„äºŒç»´æ’å€¼ä¼šé‡åˆ°é—®é¢˜ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç§‘å­¦è®¡ç®— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Matlab </tag>
            
            <tag> æ•°å­¦å»ºæ¨¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaè‡ªå¢è‡ªå‡è¿ç®—ç¬¦å¤©å‘ç¬”è¯•é¢˜</title>
      <link href="/2020/02/19/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(38)/"/>
      <url>/2020/02/19/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(38)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="é—®ï¼šä¸‹é¢ç¨‹åºè¿è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#é—®ï¼šä¸‹é¢ç¨‹åºè¿è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="é—®ï¼šä¸‹é¢ç¨‹åºè¿è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>é—®ï¼šä¸‹é¢ç¨‹åºè¿è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">    count = count++;</span><br><span class="line">System.out.println(<span class="string">"count = "</span> + count);</span><br></pre></td></tr></table></figure><h2 id="ç­”ï¼šcount-0"><a href="#ç­”ï¼šcount-0" class="headerlink" title="ç­”ï¼šcount = 0"></a><strong>ç­”ï¼šcount = 0</strong></h2><p>é¦–å…ˆ count++ æ˜¯ä¸€ä¸ªæœ‰è¿”å›å€¼çš„è¡¨è¾¾å¼ï¼Œè¿”å›å€¼æ˜¯ count è‡ªåŠ å‰é¢çš„å€¼ï¼Œjava å¯¹è‡ªåŠ å¤„ç†çš„æµç¨‹æ˜¯å…ˆæŠŠ count çš„å€¼ï¼ˆä¸æ˜¯å¼•ç”¨ï¼‰ï¼Œæ‹·è´åˆ°ä¸€ä¸ªä¸´æ—¶å˜é‡åŒºï¼Œç„¶åå¯¹ count å˜é‡åŠ  1ï¼Œæ¥ç€è¿”å›ä¸´æ—¶å˜é‡åŒºçš„å€¼ã€‚</p><p>æ‰€ä»¥ä¸Šé¢ä»£ç ä¸­ç¬¬ä¸€æ¬¡å¾ªç¯æ‰§è¡Œçš„æ­¥éª¤æ˜¯ JVM æŠŠ count çš„å€¼ï¼ˆ0ï¼‰æ‹·è´åˆ°ä¸´æ—¶å˜é‡åŒºï¼Œç„¶å count å€¼åŠ  1ï¼Œè¿™æ—¶ count çš„å€¼æ˜¯ 1ï¼Œæ¥ç€è¿”å›ä¸´æ—¶å˜é‡åŒºçš„å€¼ï¼ˆå€¼è¿˜æ˜¯ 0ï¼‰ï¼Œæœ€åèµ‹å€¼ç»™ countï¼Œæ­¤æ—¶ count å€¼è¢«é‡ç½®æˆ 0ã€‚æ‰€ä»¥ä¸Šé¢ä»£ç è¯­å¥ï¼Œcount = count++å¯ä»¥æŒ‰ç…§å¦‚ä¸‹ä»£ç æ¥ç†è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">autoAdd</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = count;</span><br><span class="line">    count = coutn + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡å¾ªç¯å count çš„å€¼è¿˜æ˜¯ 0ï¼Œå…¶ä»– 99 æ¬¡çš„å¾ªç¯ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæœ€ç»ˆå¯¼è‡´ count çš„å€¼å§‹ç»ˆæ²¡å˜ï¼Œä»»ç„¶ä¿æŒæœ€åˆçš„çŠ¶æ€ï¼Œå¦‚æœæƒ³è¦æ‰“å° 100ï¼Œåˆ™æŠŠè¯­å¥count = count++æ”¹ä¸ºcount++å³å¯ã€‚<strong>ä¸è¿‡è¿™ä¸ªé—®é¢˜åœ¨ä¸åŒçš„è¯­è¨€ç¯å¢ƒä¸­æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨ c++ ä¸­count = count++ä¸count++æ˜¯ç­‰æ•ˆçš„ï¼Œä½†åœ¨ Java ä¸­æ˜¯ä¸ç­‰æ•ˆçš„ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
            <tag> å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--Stringç±»åˆè¯†</title>
      <link href="/2020/02/19/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(39)/"/>
      <url>/2020/02/19/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(39)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.nuistgy.teststring;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•å­—ç¬¦ä¸²ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestString</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">String str = <span class="string">"abc"</span>;</span><br><span class="line">String str1 = <span class="keyword">new</span> String(<span class="string">"def"</span>);</span><br><span class="line">String str2 = <span class="string">"abc"</span>+<span class="string">"def"</span>;</span><br><span class="line">String str3 = <span class="string">"1"</span>+<span class="number">1</span>;</span><br><span class="line">System.out.println(str3);</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">String str4 = <span class="string">"xyz"</span>;</span><br><span class="line">String str5 = <span class="string">"xyz"</span>;</span><br><span class="line">String str6 = <span class="keyword">new</span> String(<span class="string">"xyz"</span>);</span><br><span class="line">System.out.println(str4==str5);<span class="comment">//è¾“å‡ºtrue</span></span><br><span class="line">System.out.println(str5==str6);<span class="comment">//è¾“å‡ºfalse</span></span><br><span class="line">System.out.println(str5.equals(str6));<span class="comment">//è¾“å‡ºtrue</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å…³äºStringç±»æ—¢æ²¡ä»€ä¹ˆå¥½è®²çš„åˆæœ‰å¤ªå¤šä¸œè¥¿å¯è®²ï¼Œå› ä¸ºç›¸å…³çŸ¥è¯†ç‚¹å¾ˆå¤šã€å¾ˆç»†å°ï¼Œå»ºè®®é€‚åˆé…åˆdocumentä½¿ç”¨ã€‚åšå®¢é‡Œä»…æ¨é€ä¸€äº›å¿…è¦çš„ä»¥åŠå­¦ä¹ ä¸­åº”å€¼å¾—æ³¨æ„çš„çŸ¥è¯†ç‚¹ï¼Œåç»­ä¹Ÿä¼šè¿›è¡Œè¡¥å……ã€‚</p></blockquote><p>å…³äºä¸Šè¿°ä»£ç ï¼Œæ³¨æ„ä¸‰ç‚¹ï¼šâ€œ+â€å·çš„ä½œç”¨æ˜¯å……å½“å­—ç¬¦ä¸²è¿æ¥ç¬¦ï¼›str4å’Œstr5å‡æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± çš„åŒä¸€ä¸ªå­—ç¬¦ä¸²â€œxyzâ€ï¼Œä½†æ˜¯new Stringå¾—åˆ°çš„å­—ç¬¦ä¸²å¯¹è±¡æ˜¯ä¸€ä¸ªå…¨æ–°çš„ï¼Œæ•…â€œ==â€åˆ¤åˆ«ä¸ºfalseï¼›equalsç”¨æ¥å¯¹å­—ç¬¦ä¸²å†…å®¹ä½œæ¯”è¾ƒï¼Œ==æ˜¯å¯¹åœ°å€åšæ¯”è¾ƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--æ•°ç»„ç”¨æ³•(2)</title>
      <link href="/2020/01/31/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(36)/"/>
      <url>/2020/01/31/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(36)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•æ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•ä¸‰ç§åˆå§‹åŒ–æ–¹æ³•å’Œforeachéå†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> com.github.nuistgy.testarray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test02</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//é™æ€åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">int</span> a[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">Student stu[] = &#123;<span class="keyword">new</span> Student(<span class="number">1001</span>,<span class="string">"Mark"</span>),</span><br><span class="line"> <span class="keyword">new</span> Student(<span class="number">1002</span>,<span class="string">"Jhon"</span>),</span><br><span class="line"> <span class="keyword">new</span> Student(<span class="number">1003</span>,<span class="string">"Jack"</span>)</span><br><span class="line"> &#125;;</span><br><span class="line">  <span class="comment">//é»˜è®¤åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">int</span> b[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];<span class="comment">//é»˜è®¤æ˜¯0</span></span><br><span class="line"><span class="keyword">boolean</span> bool[] = <span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">3</span>];<span class="comment">//é»˜è®¤æ˜¯false</span></span><br><span class="line">String s[] = <span class="keyword">new</span> String[<span class="number">3</span>];<span class="comment">//é»˜è®¤æ˜¯null</span></span><br><span class="line">Student stu_[] = <span class="keyword">new</span> Student[<span class="number">3</span>]; <span class="comment">//é»˜è®¤æ˜¯null</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//åŠ¨æ€åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">int</span> c[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br><span class="line">c[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">c[<span class="number">1</span>] = <span class="number">2</span>;</span><br><span class="line">c[<span class="number">2</span>] = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//foreachéå†.æ³¨æ„ï¼šforeachä¸ç”¨äºå†™æ“ä½œï¼Œåªç”¨äºè¯»æ“ä½œ</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> m :c) &#123;</span><br><span class="line">System.out.println(m);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"><span class="keyword">private</span> String  name;</span><br><span class="line"></span><br><span class="line">Student(<span class="keyword">int</span> id,String name)&#123;</span><br><span class="line"><span class="keyword">this</span>.id = id;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--superç”¨æ³•(1)</title>
      <link href="/2020/01/30/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(33)/"/>
      <url>/2020/01/30/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(33)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•superç”¨æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> * superæ˜¯å¯¹ç›´æ¥çˆ¶ç±»çš„å¼•ç”¨ï¼Œå¯ä»¥é€šè¿‡superæ¥è®¿é—®è¢«å­ç±»è¦†ç›–çš„çˆ¶ç±»çš„æ–¹æ³•æˆ–å±æ€§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡æ ¸å¿ƒ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSuper</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">new</span> ChildClass().func();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FatherClass</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">value = <span class="number">100</span>;</span><br><span class="line">System.out.println(<span class="string">"FatherClass.value="</span>+value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildClass</span> <span class="keyword">extends</span> <span class="title">FatherClass</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> value;<span class="comment">//è¦†ç›–äº†çˆ¶ç±»çš„valueå±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;<span class="comment">//é‡å†™äº†çˆ¶ç±»funcï¼ˆï¼‰æ–¹æ³•</span></span><br><span class="line"><span class="keyword">super</span>.func();<span class="comment">//è°ƒç”¨çˆ¶ç±»value</span></span><br><span class="line">value = <span class="number">200</span>;<span class="comment">//æŒ‡å­ç±»çš„value</span></span><br><span class="line">System.out.println(<span class="string">"ChildClass.value="</span>+value);</span><br><span class="line">System.out.println(<span class="keyword">super</span>.value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--superç”¨æ³•(2)</title>
      <link href="/2020/01/30/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(34)/"/>
      <url>/2020/01/30/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(34)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•superç”¨æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡æ ¸å¿ƒ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSuper1</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"åˆ›å»ºä¸€ä¸ªChildå¯¹è±¡ï¼š"</span>);</span><br><span class="line"><span class="keyword">new</span> ChildClass_();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FatherClass_</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FatherClass_</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//super();</span></span><br><span class="line">System.out.println(<span class="string">"åˆ›å»ºFatherClass_"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildClass_</span> <span class="keyword">extends</span> <span class="title">FatherClass_</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ChildClass_</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//super();</span></span><br><span class="line">  <span class="comment">//æ‰€æœ‰æ„é€ æ–¹æ³•ç¬¬ä¸€å¥éƒ½æ˜¯super();ä¸åŠ ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ·»åŠ </span></span><br><span class="line">System.out.println(<span class="string">"åˆ›å»ºChildClass_"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ¬ä¾‹ç»§æ‰¿æ ‘ä¸ºï¼šObjectï¼ˆé¡¶ç«¯ï¼‰--&gt;FatherClass_--&gt;ChildClass_ï¼ˆåº•ç«¯ï¼‰</span></span><br><span class="line"><span class="comment">//ç±»çš„ç»§æ‰¿éƒ½æ˜¯å…ˆä¸€æ­¥ä¸€æ­¥å‘ä¸Šè¿½æº¯åˆ°ç»§æ‰¿æ ‘é¡¶ç«¯ï¼Œå†ä»é¡¶ç«¯å‘åº•ç«¯ä¸€ä¸ªä¸€ä¸ªè°ƒç”¨ç±»æ„é€ å™¨ï¼Œå®Œæˆåˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--superç”¨æ³•(2)</title>
      <link href="/2020/01/30/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(35)/"/>
      <url>/2020/01/30/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(35)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•superç”¨æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡æ ¸å¿ƒ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSuper1</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"åˆ›å»ºä¸€ä¸ªChildå¯¹è±¡ï¼š"</span>);</span><br><span class="line"><span class="keyword">new</span> ChildClass_();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FatherClass_</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FatherClass_</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//super();</span></span><br><span class="line">System.out.println(<span class="string">"åˆ›å»ºFatherClass_"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildClass_</span> <span class="keyword">extends</span> <span class="title">FatherClass_</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ChildClass_</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//super();</span></span><br><span class="line">  <span class="comment">//æ‰€æœ‰æ„é€ æ–¹æ³•ç¬¬ä¸€å¥éƒ½æ˜¯super();ä¸åŠ ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ·»åŠ </span></span><br><span class="line">System.out.println(<span class="string">"åˆ›å»ºChildClass_"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ¬ä¾‹ç»§æ‰¿æ ‘ä¸ºï¼šObjectï¼ˆé¡¶ç«¯ï¼‰--&gt;FatherClass_--&gt;ChildClass_ï¼ˆåº•ç«¯ï¼‰</span></span><br><span class="line"><span class="comment">//ç±»çš„ç»§æ‰¿éƒ½æ˜¯å…ˆä¸€æ­¥ä¸€æ­¥å‘ä¸Šè¿½æº¯åˆ°ç»§æ‰¿æ ‘é¡¶ç«¯ï¼Œå†ä»é¡¶ç«¯å‘åº•ç«¯ä¸€ä¸ªä¸€ä¸ªè°ƒç”¨ç±»æ„é€ å™¨ï¼Œå®Œæˆåˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å¤šæ€ä¸å¯¹è±¡è½¬å‹</title>
      <link href="/2020/01/29/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(32)/"/>
      <url>/2020/01/29/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(32)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•å¤šæ€ä¸å¯¹è±¡è½¬å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> * å¤šæ€ä¸‰è¦ç´ ï¼šç»§æ‰¿ã€é‡å†™ã€çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * å¯¹è±¡è½¬å‹å…³é”®ç‚¹ï¼šå­ç±»è½¬å‘çˆ¶ç±»æ˜¯è‡ªåŠ¨è½¬å‹ã€çˆ¶ç±»è½¬å‘å­ç±»æ˜¯å¼ºåˆ¶è½¬å‹ã€ç›´ç³»å¯è½¬å‹ã€å…„å¼Ÿç³»äº’è½¬å¯é€šè¿‡ç¼–è¯‘ä½†æ˜¯è¿è¡ŒæŠ¥é”™ã€ç¼–è¯‘é˜¶æ®µæŒ‰è¡¨é¢ç±»å‹ã€è¿è¡Œé˜¶æ®µæŒ‰æœ¬è´¨ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡æ ¸å¿ƒ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPolyf</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Animal a = <span class="keyword">new</span> Animal();</span><br><span class="line">Animal d_ = <span class="keyword">new</span> Dog();<span class="comment">//d_æœ¬è´¨è¿˜æ˜¯Dogç±»å¯¹è±¡å˜é‡ï¼ˆè‡ªåŠ¨è½¬å‹ï¼‰,ä½†ç¼–è¯‘ç¯èŠ‚æš‚å®šä¸ºAnimalç±»</span></span><br><span class="line">Animal c_ = <span class="keyword">new</span> Cat();<span class="comment">//c_æœ¬è´¨è¿˜æ˜¯Catç±»å¯¹è±¡å˜é‡ï¼ˆè‡ªåŠ¨è½¬å‹ï¼‰,ä½†ç¼–è¯‘ç¯èŠ‚æš‚å®šä¸ºAnimalç±»</span></span><br><span class="line">Dog d = <span class="keyword">new</span> Dog();</span><br><span class="line">Cat c = <span class="keyword">new</span> Cat();</span><br><span class="line"></span><br><span class="line">d_.x = <span class="number">1</span>;<span class="comment">//ä¸æŠ¥é”™,ç¼–è¯‘ç¯èŠ‚æš‚å®šd_æ˜¯Animalç±»ï¼Œæ‹¥æœ‰Animalç±»çš„æˆå‘˜å˜é‡</span></span><br><span class="line">  <span class="comment">//d_.y = 1;//æŠ¥é”™,ç¼–è¯‘ç¯èŠ‚æš‚å®šd_æ˜¯Animalç±»ï¼Œæ— æ³•æ‹¥æœ‰Dogç±»çš„æˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line">Dog _d = (Dog)d_;<span class="comment">//ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå°†Animalç±»çš„d_è½¬ä¸ºDogç±»</span></span><br><span class="line">_d.y = <span class="number">1</span>;<span class="comment">//è½¬å‹åå¯ä»¥ä½¿ç”¨Dogç±»çš„æˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line">Dog _d_ = (Dog)c_;<span class="comment">//ç¼–è¯‘é€šè¿‡ï¼ŒJVMè¿è¡Œæ—¶æŠ¥é”™</span></span><br><span class="line">_d_.y = <span class="number">1</span>;<span class="comment">//ç¼–è¯‘é€šè¿‡ï¼ŒJVMè¿è¡Œæ—¶æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//å½“ä¼ å…¥å­ç±»å¯¹è±¡çš„å¼•ç”¨d,c,d_,c_å‘ç”Ÿå¤šæ€ï¼š</span></span><br><span class="line">animalCry(a);</span><br><span class="line">animalCry(d_);<span class="comment">//åœ¨è¿è¡Œç¯èŠ‚JVMä¼šè‡ªåŠ¨è¯†åˆ«å‡ºd_æœ¬è´¨æ˜¯Dogç±»ï¼Œä»è€Œå®Œæˆå¤šæ€</span></span><br><span class="line">animalCry(c_);<span class="comment">//åœ¨è¿è¡Œç¯èŠ‚JVMä¼šè‡ªåŠ¨è¯†åˆ«å‡ºc_æœ¬è´¨æ˜¯Catç±»ï¼Œä»è€Œå®Œæˆå¤šæ€</span></span><br><span class="line">animalCry(d);</span><br><span class="line">animalCry(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">animalCry</span><span class="params">(Animal a<span class="comment">/*è¿™é‡Œä¸€å®šè¦æ˜¯çˆ¶ç±»å¼•ç”¨*/</span>)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//å¤šæ€æœºåˆ¶å®ç°äº†ä»£ç çš„é‡ç”¨ä¸ç²¾ç®€</span></span><br><span class="line">a.shout();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Animal shout!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;<span class="comment">//ç»§æ‰¿</span></span><br><span class="line"><span class="keyword">int</span> y;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Dog shout!"</span>);<span class="comment">//é‡å†™</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;<span class="comment">//ç»§æ‰¿</span></span><br><span class="line"><span class="keyword">int</span> z;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Cat shout!"</span>);<span class="comment">//é‡å†™</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>å¤šæ€çš„æ³¨æ„äº‹é¡¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">father</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">son</span> <span class="keyword">extends</span> <span class="title">father</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">special</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        father o = <span class="keyword">new</span> son();</span><br><span class="line">        </span><br><span class="line">        o.show();</span><br><span class="line">        System.out.println(o.x);</span><br><span class="line">        <span class="comment">// o.special(); ERROR</span></span><br><span class="line"></span><br><span class="line">        son s = (son)o;</span><br><span class="line">        </span><br><span class="line">        s.show();</span><br><span class="line">        System.out.println(s.x);</span><br><span class="line">        s.special();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>å¯¹äºæ–¹æ³•çš„è°ƒç”¨ï¼Œç¼–è¯‘æ—¶ä»¥å·¦è¾¹å¼•ç”¨ç±»å‹æœ‰çš„ä¸ºå‡†ï¼Œè¿è¡Œæ—¶ä»¥å…·ä½“ç»‘å®šçš„å¯¹è±¡ç±»å‹ä¸ºå‡†</li><li>å¯¹äºå˜é‡çš„è°ƒç”¨ï¼Œç¼–è¯‘æ—¶ä»¥å·¦è¾¹å¼•ç”¨ç±»å‹æœ‰çš„ä¸ºå‡†ï¼Œè¿è¡Œæ—¶ä¹Ÿä»¥å·¦è¾¹çš„å¼•ç”¨ç±»å‹ä¸ºå‡†</li><li>å¯ä»¥é€šè¿‡å¼ºè½¬çš„æ–¹å¼å°†æŒ‡å‘å­ç±»å¯¹è±¡çš„çˆ¶ç±»å¼•ç”¨è½¬å›å­ç±»å¼•ç”¨ï¼Œè½¬å›åçš„å¼•ç”¨æ”¯æŒè®¿é—®å­ç±»ç‰¹æœ‰çš„æ–¹æ³•</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--staticå…³é”®å­—</title>
      <link href="/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(26)/"/>
      <url>/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(26)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•staticå…³é”®å­—</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStatic</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a;</span><br><span class="line"><span class="keyword">int</span> b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> x;<span class="comment">//å±äºç±»è€Œä¸å±äºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> y;<span class="comment">//å±äºç±»è€Œä¸å±äºå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func1</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//æ™®é€šæˆå‘˜æ–¹æ³•å¯ä»¥è°ƒç”¨ç±»çš„æ™®é€šæˆå‘˜å˜é‡å’Œstaticå˜é‡å’Œstaticæ–¹æ³•</span></span><br><span class="line">System.out.println(a);</span><br><span class="line">System.out.println(b);</span><br><span class="line">System.out.println(x);</span><br><span class="line">System.out.println(y);</span><br><span class="line">System.out.println(<span class="string">"æ™®é€šæˆå‘˜æ–¹æ³•func1"</span>);</span><br><span class="line">func2();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">func2</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//å±äºç±»è€Œä¸å±äºå¯¹è±¡</span></span><br><span class="line"><span class="comment">//ä¸å¯åœ¨staticæ–¹æ³•è°ƒç”¨this.aæˆ–this.bæˆ–this.func1()</span></span><br><span class="line"><span class="comment">//staticæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸä¸ç±»ç›¸åŒï¼Œæ—©äºå¯¹è±¡çš„è¯ç”Ÿï¼Œè€Œæ™®é€šæˆå‘˜å˜é‡æ˜¯å±äºå¯¹è±¡çš„ï¼Œæ‰€ä»¥staticæ–¹æ³•æ— æ³•è°ƒç”¨æ™®é€šæˆå‘˜å˜é‡</span></span><br><span class="line">System.out.println(<span class="string">"staticæˆå‘˜æ–¹æ³•func2"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">TestStatic obj = <span class="keyword">new</span> TestStatic();</span><br><span class="line">x = <span class="number">1</span>;<span class="comment">//å¯ä»¥ä¸é€šè¿‡å¯¹è±¡ç›´æ¥è°ƒç”¨staticæˆå‘˜å˜é‡</span></span><br><span class="line">System.out.println(x);<span class="comment">//å¯ä»¥ä¸é€šè¿‡å¯¹è±¡ç›´æ¥è°ƒç”¨staticæˆå‘˜å˜é‡</span></span><br><span class="line">System.out.println(TestStatic.x);<span class="comment">//å¯ä»¥é€šè¿‡å¯¹è±¡è°ƒç”¨staticæˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line">func2();<span class="comment">//å¯ä»¥ä¸é€šè¿‡å¯¹è±¡ç›´æ¥è°ƒç”¨staticæˆå‘˜æ–¹æ³•</span></span><br><span class="line">TestStatic.func2();<span class="comment">//å¯ä»¥é€šè¿‡å¯¹è±¡è°ƒç”¨staticæˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line">TestStatic obj1 = <span class="keyword">new</span> TestStatic();</span><br><span class="line">TestStatic.x ++;</span><br><span class="line">System.out.println(TestStatic.x);</span><br><span class="line"><span class="comment">//é™æ€å˜é‡çš„æ”¹å˜ç›¸å½“äºæ˜¯å¯¹ç±»æ¨¡æ¿çš„æ”¹å˜ï¼Œä¼šå¯¹å…¶ä»–å¯¹è±¡äº§ç”Ÿå½±å“ï¼Œ</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--æŠ½è±¡ç±»</title>
      <link href="/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(27)/"/>
      <url>/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(27)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•æŠ½è±¡ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> com.github.nuistgy.testabstract;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="comment">//æœ‰æŠ½è±¡æ–¹æ³•å¿…é¡»æ˜¯æŠ½è±¡ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="comment">//æŠ½è±¡æ–¹æ³•æ²¡æœ‰å®ç°è¿‡ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">breath</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//æŠ½è±¡ç±»å¯ä»¥åŒ…å«æ™®é€šæ–¹æ³•æˆ–é™æ€æ–¹æ³•</span></span><br><span class="line">System.out.println(<span class="string">"å‘¼å¸ï¼"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> a;</span><br><span class="line"><span class="keyword">int</span> b;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//Animal a = new Animal();æŠ½è±¡ç±»æ— æ³•å®ä¾‹åŒ–</span></span><br><span class="line">Animal.breath();  <span class="comment">//æŠ½è±¡ç±»çš„æ™®é€šé™æ€æ–¹æ³•å¯ä»¥ç›´æ¥ä½¿ç”¨</span></span><br><span class="line">Animal.a = <span class="number">1</span>;  <span class="comment">//æŠ½è±¡ç±»çš„æ™®é€šé™æ€æˆå‘˜å˜é‡å¯ä»¥ç›´æ¥ä½¿ç”¨</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"æ±ªæ±ªï¼"</span>);</span><br><span class="line"><span class="comment">//å­ç±»å¿…é¡»å¯¹çˆ¶ç±»æŠ½è±¡æ–¹æ³•è¿›è¡Œå®ç°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*æ€»ç»“ï¼š</span></span><br><span class="line"><span class="comment"> * æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»å¿…é¡»å®šä¹‰ä¸ºæŠ½è±¡ç±»</span></span><br><span class="line"><span class="comment"> * æŠ½è±¡ç±»å¯ä»¥åŒ…å«å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ï¼Œä½†æ˜¯ä¸èƒ½è¢«å®ä¾‹åŒ–</span></span><br><span class="line"><span class="comment"> * æ™®é€šå±æ€§å’Œæ–¹æ³•åªèƒ½è¢«å­ç±»è°ƒç”¨ï¼Œé™æ€æ–¹æ³•æˆ–å±æ€§å¯ä»¥ç›´æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> * æŠ½è±¡æ–¹æ³•å¿…é¡»è¢«å­ç±»å®ç°</span></span><br><span class="line"><span class="comment"> * æŠ½è±¡ç±»çš„æ„ä¹‰åœ¨äºä¸ºå­ç±»æä¾›ç»Ÿä¸€çš„ã€è§„èŒƒçš„æ¨¡æ¿</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--ç»§æ‰¿</title>
      <link href="/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(28)/"/>
      <url>/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(28)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•ç»§æ‰¿</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡æ ¸å¿ƒ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestExtends</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Student stu = <span class="keyword">new</span> Student();</span><br><span class="line">Student stu_ = <span class="keyword">new</span> Student(<span class="string">"Max"</span>,<span class="number">170</span>,<span class="string">"C++"</span>);</span><br><span class="line">  <span class="comment">//stuæ‹¥æœ‰Personç±»æ‰€ä»¥å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line">stu.name = <span class="string">"Jack"</span>;</span><br><span class="line">stu.height = <span class="number">180</span>;</span><br><span class="line">stu.major = <span class="string">"JAVA"</span>;</span><br><span class="line">stu.breath();</span><br><span class="line"></span><br><span class="line">System.out.println(stu <span class="keyword">instanceof</span> Student);</span><br><span class="line">System.out.println(stu <span class="keyword">instanceof</span> Person);</span><br><span class="line">System.out.println(stu <span class="keyword">instanceof</span> Object);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> height;</span><br><span class="line">String name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">breath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"å‘¼å¸"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//int height;</span></span><br><span class="line"><span class="comment">//String name;</span></span><br><span class="line">String major;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name,<span class="keyword">int</span> height,String major)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line"><span class="keyword">this</span>.height = height;</span><br><span class="line"><span class="keyword">this</span>.major = major;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">study</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"å­¦ä¹ "</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*public void breath() &#123;</span></span><br><span class="line"><span class="comment">*System.out.println("å‘¼å¸");</span></span><br><span class="line"><span class="comment">*&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*çˆ¶ç±»ä¹Ÿå«è¶…ç±»æˆ–åŸºç±»</span></span><br><span class="line"><span class="comment">*æ²¡æœ‰å¤šç»§æ‰¿ï¼Œåªæœ‰å•ç»§æ‰¿</span></span><br><span class="line"><span class="comment">*æ¥å£æŠ€æœ¯æœ‰å¤šç»§æ‰¿</span></span><br><span class="line"><span class="comment">*javaä¸­åªæœ‰å…±æœ‰ç»§æ‰¿</span></span><br><span class="line"><span class="comment">*å­ç±»å¯ä»¥å¾—åˆ°çˆ¶ç±»çš„å…¨éƒ¨å±æ€§å’Œæ–¹æ³•ï¼ˆæ„é€ æ–¹æ³•é™¤å¤–ï¼‰ï¼Œä½†ä¸è§å¾—éƒ½å¯ä»¥ä½¿ç”¨</span></span><br><span class="line"><span class="comment">*å¦‚æœæ²¡æœ‰ä½¿ç”¨extendsç»§æ‰¿åˆ™é»˜è®¤æ˜¯ç»§æ‰¿äº†java.lang.Object</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--é‡å†™</title>
      <link href="/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(29)/"/>
      <url>/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(29)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•é‡å†™</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡æ ¸å¿ƒ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestOverride</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Airplane obj = <span class="keyword">new</span> Airplane();</span><br><span class="line">obj.run();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transportation</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Running"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">whoIsPsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Person();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Airplane</span> <span class="keyword">extends</span> <span class="title">Transportation</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Flying"</span>);</span><br><span class="line"><span class="comment">//é‡å†™äº†çˆ¶ç±»çš„run()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Student <span class="title">whoIsPsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Student();</span><br><span class="line"><span class="comment">//é‡å†™äº†çˆ¶ç±»çš„whoIsPsg()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* public Student whoIsPsg() &#123;</span></span><br><span class="line"><span class="comment">*return new Student();</span></span><br><span class="line"><span class="comment">*//é‡å†™äº†çˆ¶ç±»çš„whoIsPsg()</span></span><br><span class="line"><span class="comment">*&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * public Object whoIsPsg() &#123;</span></span><br><span class="line"><span class="comment"> *return new Object();</span></span><br><span class="line"><span class="comment"> *//é‡å†™äº†çˆ¶ç±»çš„whoIsPsg()ä½†æŠ¥é”™</span></span><br><span class="line"><span class="comment"> *&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ„æˆé‡å†™çš„æ¡ä»¶ï¼š</span></span><br><span class="line"><span class="comment"> * å­ç±»ç»§æ‰¿çˆ¶ç±»</span></span><br><span class="line"><span class="comment"> * é‡å†™çš„æ–¹æ³•åï¼Œå½¢å‚åˆ—è¡¨è¦ç›¸åŒ</span></span><br><span class="line"><span class="comment"> * è¿”å›å€¼ç±»å‹å’Œå£°æ˜å¼‚å¸¸çš„ç±»å‹ï¼Œå­ç±»åº”&lt;=çˆ¶ç±»</span></span><br><span class="line"><span class="comment"> * æ–¹æ³•è®¿é—®æƒé™ï¼šå­ç±»&gt;=çˆ¶ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--Objectç±»å¹¶é‡å†™toString</title>
      <link href="/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(30)/"/>
      <url>/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(30)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•Objectç±»å¹¶é‡å†™toString</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡æ ¸å¿ƒ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestObject</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">TestObject obj = <span class="keyword">new</span> TestObject();</span><br><span class="line">System.out.println(obj.toString());</span><br><span class="line"></span><br><span class="line">People ple = <span class="keyword">new</span> People(<span class="string">"Kevin"</span>,<span class="number">18</span>);</span><br><span class="line">System.out.println(ple);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"æµ‹è¯•Overtide Objectç±»çš„toStringæ–¹æ³•"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line">String name;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> name+<span class="string">" å¹´é¾„ï¼š"</span>+age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">People</span><span class="params">(String name,<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line"><span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--finalå…³é”®å­—</title>
      <link href="/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(31)/"/>
      <url>/2020/01/28/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(31)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•finalå…³é”®å­—</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡æ ¸å¿ƒ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFinal</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">A a = <span class="keyword">new</span> A();</span><br><span class="line">B b = <span class="keyword">new</span> B();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//a.a = 2;//æŠ¥é”™ï¼Œfinalä¿®é¥°å˜é‡åˆ™ä¸å¯å˜</span></span><br><span class="line">b.b = <span class="number">2</span>;<span class="comment">//æ— finalä¿®é¥°ï¼Œå¯è‡ªè¡Œèµ‹å€¼</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> /*<span class="keyword">extends</span> <span class="title">A</span>*  æŠ¥é”™ï¼Œ<span class="title">final</span>ä¿®é¥°çš„ç±»æ— æ³•è¢«ç»§æ‰¿*/</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> b;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">double</span> x)</span> </span>&#123;</span><br><span class="line"><span class="comment">//finalä¿®é¥°çš„æ–¹æ³•å¯ä»¥åœ¨æœ¬ç±»ä¸­é‡è½½</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">B</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*public void func(int x) &#123;</span></span><br><span class="line"><span class="comment">*//...</span></span><br><span class="line"><span class="comment">*&#125;</span></span><br><span class="line"><span class="comment">*finalä¿®é¥°çš„æ–¹æ³•æ— æ³•è¢«å­ç±»é‡å†™</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--ç±»å’Œå¯¹è±¡</title>
      <link href="/2020/01/27/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(21)/"/>
      <url>/2020/01/27/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(21)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   *   æµ‹è¯•ç±»å’Œå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªç±»ï¼Œä½†æ˜¯publicä¿®é¥°çš„ç±»åªèƒ½æœ‰ä¸€ä¸ª</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFirstClass</span> </span>&#123;</span><br><span class="line"><span class="comment">//å¼€å§‹å°±ä»¥å­¦ç”Ÿä¸ºå¯¹è±¡åšç¤ºä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å±æ€§</span></span><br><span class="line"><span class="keyword">int</span> id;</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line">String name;</span><br><span class="line">Subjects subject;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">study</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"å­¦ä¹ "</span>+subject.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"ID:"</span>+<span class="keyword">this</span>.id);</span><br><span class="line">System.out.println(<span class="string">"AGE:"</span>+<span class="keyword">this</span>.age);</span><br><span class="line">System.out.println(<span class="string">"NAME:"</span>+<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TestFirstClass()&#123;</span><br><span class="line"><span class="comment">//æ„é€ æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºç±»å¯¹è±¡ï¼Œæ–¹æ³•åä¸ç±»åä¿æŒä¸€è‡´ï¼Œæ— è¿”å›å€¼ï¼Œæ— å‚æ„é€ æ–¹æ³•å¯ç”±ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//mainï¼ˆï¼‰æ–¹æ³•ç¨‹åºæ‰§è¡Œçš„å…¥å£ï¼Œå¿…ä¸å¯å°‘</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">TestFirstClass stu = <span class="keyword">new</span> TestFirstClass();<span class="comment">//è°ƒç”¨æ„é€ æ–¹æ³•åœ¨å †åŒºåˆ›å»ºå¯¹è±¡ï¼Œè¿”å›å¯¹è±¡åœ¨å †åŒºçš„åœ°å€</span></span><br><span class="line">Subjects sub = <span class="keyword">new</span> Subjects();<span class="comment">//è°ƒç”¨æ„é€ æ–¹æ³•åœ¨å †åŒºåˆ›å»ºå¯¹è±¡ï¼Œè¿”å›å¯¹è±¡åœ¨å †åŒºçš„åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹è±¡å±æ€§çš„èµ‹å€¼</span></span><br><span class="line">sub.name = <span class="string">"JAVAè¯¾è®¾"</span>;</span><br><span class="line"><span class="comment">//å¯¹è±¡å±æ€§çš„èµ‹å€¼</span></span><br><span class="line">stu.id = <span class="number">12345</span>;</span><br><span class="line">stu.age = <span class="number">20</span>;</span><br><span class="line">stu.name = <span class="string">"è‘›å®‡"</span>;</span><br><span class="line">stu.subject = sub;</span><br><span class="line"></span><br><span class="line">stu.study();<span class="comment">//è°ƒç”¨ç±»æ–¹æ³•</span></span><br><span class="line">stu.show();<span class="comment">//è°ƒç”¨ç±»æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">System.out.println(sub);<span class="comment">//æ‰“å°å¯¹è±¡åœ°å€</span></span><br><span class="line">System.out.println(stu.subject);<span class="comment">//æ‰“å°å¯¹è±¡åœ°å€</span></span><br><span class="line">  <span class="comment">//è§‚å¯Ÿå‘ç°è¾“å‡ºä¸¤ä¸ªå¯¹è±¡åœ°å€ç›¸åŒï¼ŒåŸå› æ˜¯subæ”¾äºå †ä¸­ï¼Œ44è¡Œçš„èµ‹å€¼å®é™…ä¸Šæ˜¯æŠŠsubçš„å †åœ°å€èµ‹å€¼ç»™äº†stu.subject</span></span><br><span class="line">  <span class="comment">//åˆ†æå¯çŸ¥ï¼šsubå’Œstu.subjectéƒ½ä½äºæ ˆåŒºï¼Œéƒ½æŒ‡å‘å †åŒºçš„åŒä¸€ä¸ªå¯¹è±¡åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å­¦ç§‘ç§‘ç›®ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subjects</span></span>&#123;</span><br><span class="line">String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* JAVAå†…å­˜åˆ†æ</span></span><br><span class="line"><span class="comment"> * JAVAä¸­ä¸»è¦æŠŠå†…å­˜åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ ˆã€å †ã€æ–¹æ³•åŒºï¼ˆå…¶ä¸­å †åŒºåŒ…å«æ–¹æ³•åŒºï¼‰</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * æ ˆï¼šJVMä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªæ ˆä¸”æ ˆå±äºçº¿ç¨‹ç§æœ‰ï¼Œæ— æ³•ä¸å…¶ä»–çº¿ç¨‹å…±äº«ï¼›</span></span><br><span class="line"><span class="comment"> *         æ ˆçš„å­˜å‚¨ç‰¹æ€§æ˜¯â€œå…ˆè¿›åå‡ºâ€ï¼›</span></span><br><span class="line"><span class="comment"> *         æ ˆæ˜¯è‡ªåŠ¨åˆ†é…ï¼Œå†…å­˜ç©ºé—´è¿ç»­ï¼Œé€Ÿåº¦å¿«ï¼›</span></span><br><span class="line"><span class="comment"> *         ç¨‹åºä¸­çš„æ¯ä¸ªæ–¹æ³•æ‰§è¡Œæ—¶éƒ½ä¼šåœ¨æ ˆä¸­åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾è¯¥æ–¹æ³•è¿è¡Œæ—¶æ•°æ®ã€å±€éƒ¨å˜é‡ã€å®å‚ã€è¿”å›å€¼ç­‰ä¿¡æ¯ï¼›</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * å †ï¼šå †åŒºå­˜æ”¾åˆ›å»ºå¥½çš„å¯¹è±¡å’Œæ•°ç»„ï¼ˆæ•°ç»„ä¹Ÿæ˜¯å¯¹è±¡ï¼‰ï¼›</span></span><br><span class="line"><span class="comment"> *    JVMåªæœ‰ä¸€ä¸ªå †åŒºï¼Œä¸”è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼›</span></span><br><span class="line"><span class="comment"> *          å †åŒºæ˜¯ä¸€ä¸ªä¸è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œåˆ†é…çµæ´»ï¼Œé€Ÿåº¦æ…¢ï¼›</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * æ–¹æ³•åŒºï¼ˆé™æ€åŒºï¼‰ï¼šæ–¹æ³•åŒºä¹Ÿæ˜¯å †åŒºçš„ä¸€éƒ¨åˆ†ï¼Œåªæœ‰ä¸€ä¸ªï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼›</span></span><br><span class="line"><span class="comment"> * æ–¹æ³•åŒºä¸­å­˜æ”¾ç¨‹åºä¸­ä¸å˜æˆ–å”¯ä¸€çš„å†…å®¹ï¼šç±»ä»£ç ã€é™æ€å˜é‡ã€å¸¸é‡ã€å­—ç¬¦ä¸²ç­‰ï¼›</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--æ„é€ å™¨</title>
      <link href="/2020/01/27/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(22)/"/>
      <url>/2020/01/27/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(22)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æµ‹è¯•æ„é€ å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span></span>&#123;</span><br><span class="line"><span class="keyword">double</span> x,y;</span><br><span class="line"><span class="comment">//æ„é€ æ–¹æ³•åç§°å’Œç±»åå¿…é¡»ä¿æŒä¸€è‡´</span></span><br><span class="line"><span class="comment">//æ„é€ å™¨ä¼šè¿”å›å¯¹è±¡çš„åœ°å€ä½†æ˜¯æ— éœ€æŒ‡å®šè¿”å›å€¼ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨returnè¡¨ç¤ºç»“æŸæ–¹æ³•ä½“</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Point</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.x = x;</span><br><span class="line"><span class="keyword">this</span>.y = y;</span><br><span class="line"><span class="keyword">return</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Point</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//æ— å‚æ„é€ å™¨ï¼Œå¦‚æœæœ‰äº†è‡ªå·±å®šä¹‰çš„æ„é€ å™¨ï¼Œç³»ç»Ÿä¾¿ä¸å†ç”Ÿæˆï¼Œæƒ³è¦æ— å‚æ„é€ å™¨çš„è¯è¿˜å¾—è‡ªå·±å†™ä¸Š</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getDitance</span><span class="params">(Point p)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"ä¼ å…¥å¯¹è±¡çš„åœ°å€ï¼š"</span>+p);</span><br><span class="line"><span class="keyword">return</span> Math.sqrt((<span class="keyword">this</span>.x-p.x)*(<span class="keyword">this</span>.x-p.x)+(<span class="keyword">this</span>.y-p.y)*(<span class="keyword">this</span>.y-p.y));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConstructor</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Point a = <span class="keyword">new</span> Point(<span class="number">3.0</span>,<span class="number">4.0</span>);</span><br><span class="line">Point b = <span class="keyword">new</span> Point(<span class="number">0.0</span>,<span class="number">0.0</span>);</span><br><span class="line">System.out.println(<span class="string">"åˆ›å»ºçš„å¯¹è±¡çš„åœ°å€ï¼š"</span>+b);</span><br><span class="line">System.out.println(a.getDitance(b));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--thisçš„ä½¿ç”¨</title>
      <link href="/2020/01/27/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(23)/"/>
      <url>/2020/01/27/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(23)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•thisçš„ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThis</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a,b,c;</span><br><span class="line"></span><br><span class="line"><span class="comment">//constructor 1</span></span><br><span class="line">TestThis(<span class="keyword">int</span> a,<span class="keyword">int</span> b)&#123;</span><br><span class="line"><span class="keyword">this</span>.a = a;</span><br><span class="line"><span class="keyword">this</span>.b = b;</span><br><span class="line"><span class="comment">//å‘ç”Ÿå˜é‡äºŒä¹‰æ€§æ—¶ï¼Œä½¿ç”¨thiså¯ä»¥æŒ‡ä»£åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//constructor 2</span></span><br><span class="line">TestThis(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> c)&#123;</span><br><span class="line">  <span class="comment">//TestThis(a,b);ä¼šæŠ¥é”™ï¼Œæƒ³åœ¨ç±»æ–¹æ³•ä¸­é‡ç”¨æ„é€ å™¨å¾—ç”¨thisï¼Œå¦‚ä¸‹</span></span><br><span class="line"><span class="keyword">this</span>(a,b);<span class="comment">//è¿™é‡Œç­‰ä»·äºè°ƒç”¨äº†constructor 1ï¼Œä¸”å¿…é¡»ä½äºæ„é€ å™¨çš„ç¬¬ä¸€å¥</span></span><br><span class="line"><span class="keyword">this</span>.c = c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"this is func1 !"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func2</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.func1();</span><br><span class="line">System.out.println(<span class="string">"this is func2 !"</span>);</span><br><span class="line"><span class="comment">//thiså¯ä»¥ç”¨æ¥æŒ‡ä»£è¯¥ç±»çš„æŸä¸ªå¯¹è±¡è‡ªå·±</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">TestThis obj = <span class="keyword">new</span> TestThis(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">obj.func2();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨æ„ï¼Œthisçš„ä½¿ç”¨åŸºæœ¬ä¸Šéƒ½æ˜¯ç¦»ä¸å¼€å¯¹è±¡çš„ï¼Œæ‰€ä»¥è¦çŸ¥é“thisæ˜¯ä¸èƒ½ç”¨äºé™æ€çš„æ–¹æ³•çš„ã€‚</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å‚æ•°ä¼ é€’æœºåˆ¶</title>
      <link href="/2020/01/27/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(24)/"/>
      <url>/2020/01/27/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(24)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•JAVAä¸­çš„å‚æ•°ä¼ é€’æœºåˆ¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestValueTransport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a;</span><br><span class="line"><span class="keyword">int</span> b;</span><br><span class="line"></span><br><span class="line">TestValueTransport (<span class="keyword">int</span> a,<span class="keyword">int</span> b)&#123;</span><br><span class="line"><span class="keyword">this</span>.a = a;</span><br><span class="line"><span class="keyword">this</span>.b = b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testValueTrap</span><span class="params">(TestValueTransport x)</span> </span>&#123;</span><br><span class="line">System.out.println(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">TestValueTransport obj = <span class="keyword">new</span> TestValueTransport(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">TestValueTransport obj_ = obj;</span><br><span class="line"></span><br><span class="line">System.out.println(obj);</span><br><span class="line">System.out.println(obj_);</span><br><span class="line">obj_.testValueTrap(obj_);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡ºä¸‰ä¸ªå¯¹è±¡å˜é‡å¼•ç”¨çš„åœ°å€æ˜¯ç›¸åŒçš„</span></span><br><span class="line"><span class="comment">//è¦èƒ½åŒºåˆ†å¯¹è±¡å˜é‡å’Œå¯¹è±¡çš„åŒºåˆ«ï¼šå¯¹è±¡å˜é‡å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå¯¹è±¡å­˜å‚¨åœ¨å †ä¸­</span></span><br><span class="line"><span class="comment">//ç¤ºä¾‹ä¸­çš„objã€obj_ã€xä¸‰è€…è™½æ˜¯ä¸åŒçš„å¯¹è±¡å˜é‡ï¼Œä½†æ˜¯å§‹ç»ˆæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡çš„åœ°å€</span></span><br><span class="line"><span class="comment">//æ€»ç»“ï¼šJavaä¸­å‚æ•°ä¼ å€¼ä¼ é€’çš„æ˜¯å‚æ•°å€¼çš„å‰¯æœ¬ï¼Œä½†è¦æ˜ç¡®å¯¹äºå¯¹è±¡å˜é‡æ¥è¯´ï¼Œä¼ é€’çš„å‰¯æœ¬å°±æ˜¯å¯¹è±¡çš„åœ°å€ï¼Œæ‰€ä»¥æŒ‡å‘è¿˜æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--é™æ€å¯¼å…¥</title>
      <link href="/2020/01/27/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(25)/"/>
      <url>/2020/01/27/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(25)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æµ‹è¯•é™æ€å¯¼å…¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> é¢å‘å¯¹è±¡;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.PI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStaticImport</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">System.out.print(PI);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é™æ€å¯¼å…¥å…³é”®å­—ï¼šimport static xxx;</span></span><br><span class="line"><span class="comment">//è¦æ±‚å¯¼å…¥çš„ä¸œè¥¿å¿…é¡»æ˜¯é™æ€å±æ€§å¦‚é™æ€æˆå‘˜æ–¹æ³•æˆ–é™æ€å¸¸é‡ç­‰</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å¾ªç¯è¯­å¥ä¸­çš„break</title>
      <link href="/2020/01/26/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(18)/"/>
      <url>/2020/01/26/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(18)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•å¾ªç¯è¯­å¥ä¸­çš„break</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ§åˆ¶è¯­å¥;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBreak</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> i = (<span class="keyword">int</span>)Math.round(<span class="number">100</span>*Math.random());</span><br><span class="line">System.out.println(i);</span><br><span class="line"><span class="keyword">if</span>(i==<span class="number">50</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">total++;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"å¾ªç¯æ¬¡æ•°ä¸ºï¼š"</span>+total);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡ºå¾ªç¯æ¬¡æ•°ä¸º30</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å¾ªç¯è¯­å¥ä¸­çš„continue</title>
      <link href="/2020/01/26/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(19)/"/>
      <url>/2020/01/26/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(19)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•å¾ªç¯ä¸­çš„continue</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ§åˆ¶è¯­å¥;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestContinue</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">100</span>;i++) &#123;</span><br><span class="line"><span class="keyword">if</span>(i%<span class="number">3</span>==<span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//èƒ½è¢«3æ•´é™¤åˆ™è·³è¿‡è¿™æ¬¡å¾ªç¯</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦åˆ™è¾“å‡ºä¸èƒ½è¢«3æ•´é™¤çš„æ•°</span></span><br><span class="line">System.out.print(i+<span class="string">"  "</span>);</span><br><span class="line">count++;</span><br><span class="line"><span class="keyword">if</span>(count%<span class="number">5</span>==<span class="number">0</span>) &#123;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å¾ªç¯è¯­å¥ä¸­æ ‡ç­¾çš„continue</title>
      <link href="/2020/01/26/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(20)/"/>
      <url>/2020/01/26/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(20)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•å¸¦æ ‡ç­¾çš„continue</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ§åˆ¶è¯­å¥;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Javaä¸­ä¿ç•™äº†gotoå…³é”®å­—ä½†å¹¶ä¸å…è®¸ä½¿ç”¨gotoè¯­å¥</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLableContinue</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å°101åˆ°150ä¹‹é—´æ‰€æœ‰è´¨æ•°</span></span><br><span class="line">outer:<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">101</span>;i&lt;=<span class="number">150</span>;i++) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">2</span>;j&lt;i/<span class="number">2</span>;j++) &#123;</span><br><span class="line"><span class="keyword">if</span>(i%j==<span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">continue</span> outer;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(i+<span class="string">" "</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--Ifé€‰æ‹©è¯­å¥</title>
      <link href="/2020/01/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(14)/"/>
      <url>/2020/01/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(14)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Ifé€‰æ‹©è¯­å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ§åˆ¶è¯­å¥;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestIf</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">double</span> x = <span class="number">6</span>*Math.random();</span><br><span class="line"><span class="keyword">int</span> age = (<span class="keyword">int</span>)(<span class="number">80</span>*Math.random());</span><br><span class="line">System.out.println(x);</span><br><span class="line">System.out.println(age);</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////if///////////</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(x &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"Small"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(x &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"Large"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////if-else/////////</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(x &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"Small"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"Large"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">///////Multi-if-else///////</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(age &lt;= <span class="number">15</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"å„¿ç«¥"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(age &lt;= <span class="number">25</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"é’å¹´"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(age &lt;= <span class="number">45</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"ä¸­å¹´"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(age &lt;= <span class="number">80</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"è€å¹´"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--switchå¤šé€‰æ‹©</title>
      <link href="/2020/01/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(15)/"/>
      <url>/2020/01/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(15)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•switchå¤šé€‰æ‹©</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ§åˆ¶è¯­å¥;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSwitch</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = (<span class="keyword">int</span>)(<span class="number">6</span>*Math.random())+<span class="number">1</span>;</span><br><span class="line">System.out.println(<span class="string">"éª°ç‚¹ï¼š"</span>+a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(a) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">System.out.println(<span class="string">"1ç‚¹"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">System.out.println(<span class="string">"2ç‚¹"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">System.out.println(<span class="string">"3ç‚¹"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">System.out.println(<span class="string">"4ç‚¹"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">System.out.println(<span class="string">"5ç‚¹"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">System.out.println(<span class="string">"6ç‚¹"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è‹¥çœç•¥breakåˆ™ä¼šå¾€ä¸‹ä¸€æ¡caseç©¿é€æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--whileå¾ªç¯</title>
      <link href="/2020/01/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(16)/"/>
      <url>/2020/01/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(16)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•while</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ§åˆ¶è¯­å¥;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestWhile</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">/////////////////while/////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//whileçš„å¾ªç¯æ¡ä»¶å¿…é¡»æ˜¯å¸ƒå°”å‹ï¼Œ0æˆ–1æ— æ•ˆ</span></span><br><span class="line"><span class="keyword">while</span>(i &lt;= <span class="number">100</span>) &#123;</span><br><span class="line">sum += i;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(sum);</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////do-while////////////////</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span>;</span><br><span class="line">sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">sum += i;</span><br><span class="line">i++;</span><br><span class="line">&#125;<span class="keyword">while</span>(i &lt;= <span class="number">100</span>);</span><br><span class="line">System.out.println(sum);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--forå¾ªç¯</title>
      <link href="/2020/01/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(17)/"/>
      <url>/2020/01/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(17)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *æµ‹è¯•forå¾ªç¯</span></span><br><span class="line"><span class="comment"> *<span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ§åˆ¶è¯­å¥;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFor</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">100</span>;i++) &#123;</span><br><span class="line">sum+=i;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(sum);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 1. æ‰§è¡Œåˆå§‹åŒ–è¯­å¥ï¼ši=1</span></span><br><span class="line"><span class="comment"> * 2. æ‰§è¡Œåˆ¤æ–­ï¼ši&lt;=100</span></span><br><span class="line"><span class="comment"> * 3. æ‰§è¡Œå¾ªç¯ä½“ï¼šsum+=i</span></span><br><span class="line"><span class="comment"> * 4. æ‰§è¡Œæ­¥è¿›ï¼ši++</span></span><br><span class="line"><span class="comment"> * 5. è¿”å›ç¬¬2æ­¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å­—ç¬¦ä¸²è¿æ¥ç¬¦</title>
      <link href="/2020/01/23/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(10)/"/>
      <url>/2020/01/23/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(10)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•å­—ç¬¦ä¸²è¿æ¥ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestOperator_4</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> b = <span class="number">2</span>;</span><br><span class="line">String c = <span class="string">"3"</span>;</span><br><span class="line">System.out.println(a+b);<span class="comment">//è¾“å‡ºæ•´æ•°3</span></span><br><span class="line">System.out.println(a+c);<span class="comment">//è¾“å‡ºæ•´æ•°1å’Œå­—ç¬¦ä¸²3çš„ç»„åˆ</span></span><br><span class="line">System.out.println(c+a);<span class="comment">//è¾“å‡ºå­—ç¬¦ä¸²3å’Œæ•´æ•°1çš„ç»„åˆ</span></span><br><span class="line">System.out.println(a+b+c);<span class="comment">//è¾“å‡ºæ•´æ•°3å’Œå­—ç¬¦ä¸²3çš„ç»„åˆ</span></span><br><span class="line">System.out.println(c+b+a);<span class="comment">//è¾“å‡ºå­—ç¬¦ä¸²32å’Œæ•´æ•°1çš„ç»„åˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> d = <span class="string">'4'</span>;<span class="comment">//å­—ç¬¦å‹å˜é‡då¯¹åº”çš„4çš„Unicodeç¼–ç ä¸ºU+0034(åå…­è¿›åˆ¶)</span></span><br><span class="line">System.out.println(d);<span class="comment">//è¾“å‡ºå­—ç¬¦4</span></span><br><span class="line">System.out.println(a+d);<span class="comment">//è¾“å‡ºå­—ç¬¦4è½¬åŒ–ä¸ºæ•´æ•°åçš„æ•°å€¼ä¸1çš„å’Œ</span></span><br><span class="line">System.out.println(c+d);<span class="comment">//å°†å­—ç¬¦4çº³å…¥å­—ç¬¦ä¸²c,è¾“å‡ºå­—ç¬¦ä¸²34</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--ä»é”®ç›˜è¯»å…¥æ•°æ®</title>
      <link href="/2020/01/23/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(11)/"/>
      <url>/2020/01/23/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(11)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•ä»é”®ç›˜è¯»å…¥æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestScanner</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Scanner scanner = <span class="keyword">new</span> Scanner(System.in);<span class="comment">//åˆ›å»ºIOæµå¯¹è±¡</span></span><br><span class="line">System.out.println(<span class="string">"è¯·è¾“å…¥å§“åï¼š"</span>);</span><br><span class="line">String name = scanner.nextLine();</span><br><span class="line">System.out.println(<span class="string">"è¯·è¾“å…¥æ€§åˆ«ï¼š"</span>);</span><br><span class="line">String sex = scanner.nextLine();</span><br><span class="line">System.out.println(<span class="string">"è¯·è¾“å…¥IDï¼š"</span>);</span><br><span class="line"><span class="keyword">int</span> age = scanner.nextInt();</span><br><span class="line"></span><br><span class="line">System.out.println(name);</span><br><span class="line">System.out.println(sex);</span><br><span class="line">System.out.println(age);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--æ–¹æ³•</title>
      <link href="/2020/01/23/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(12)/"/>
      <url>/2020/01/23/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(12)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•Javaæ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ§åˆ¶è¯­å¥;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMethod</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//é€šè¿‡å¯¹è±¡è°ƒç”¨æ™®é€šæ–¹æ³•</span></span><br><span class="line">TestMethod obj = <span class="keyword">new</span> TestMethod();</span><br><span class="line">obj.Method_1();</span><br><span class="line">obj.Method_2(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">int</span> total = obj.Method_3(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">System.out.println(total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Method_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"This is Method_1"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Method_2</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> sum = a+b;</span><br><span class="line">System.out.println(sum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Method_3</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> sum = a+b;</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line"><span class="comment">//returnä¸¤ä¸ªä½œç”¨ï¼šç»“æŸæ–¹æ³•çš„è¿è¡Œï¼›è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * è¦ç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * å®å‚çš„æ•°ç›®ï¼Œæ•°æ®ç±»å‹ï¼Œæ¬¡åºå¿…é¡»å’Œå¯¹åº”æ–¹æ³•çš„å½¢å‚åˆ—è¡¨åŒ¹é…</span></span><br><span class="line"><span class="comment"> * Javaä¸­çš„æ™®é€šå‚æ•°ä¼ é€’å‡ä¸ºå€¼ä¼ é€’ </span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--æ–¹æ³•çš„é‡è½½</title>
      <link href="/2020/01/23/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(13)/"/>
      <url>/2020/01/23/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(13)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•æ–¹æ³•çš„é‡è½½</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ§åˆ¶è¯­å¥;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestOverload</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*æ±‚å’Œçš„æ–¹æ³•ï¼Œstaticä¿®é¥°ï¼Œè°ƒç”¨æ—¶æ— éœ€åˆ›å»ºå¯¹è±¡*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> n1,<span class="keyword">int</span> n2)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> sum = n1+n2;</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ–¹æ³•åç›¸åŒï¼Œå‚æ•°ä¸ªæ•°ä¸åŒï¼Œæ„æˆé‡è½½</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> n1,<span class="keyword">int</span> n2,<span class="keyword">int</span> n3)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> sum = n1+n2+n3;</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ–¹æ³•åç›¸åŒï¼Œå‚æ•°ç±»å‹ä¸åŒï¼Œæ„æˆé‡è½½</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">add</span><span class="params">(<span class="keyword">double</span> n1,<span class="keyword">int</span> n2)</span> </span>&#123;</span><br><span class="line"><span class="keyword">double</span> sum = n1+n2;</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ–¹æ³•åç›¸åŒï¼Œå‚æ•°é¡ºåºä¸åŒï¼Œæ„æˆé‡è½½</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> n1,<span class="keyword">double</span> n2)</span> </span>&#123;</span><br><span class="line"><span class="keyword">double</span> sum = n1+n2;</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**æ–¹æ³•åç›¸åŒï¼Œè¿”å›å€¼ç±»å‹ä¸åŒï¼Œæ— æ³•æ„æˆé‡è½½ï¼ŒæŠ¥é”™ï¼ï¼ï¼</span></span><br><span class="line"><span class="comment"> public static double add(int n1,int n2) &#123;</span></span><br><span class="line"><span class="comment">double sum = n1+n2;</span></span><br><span class="line"><span class="comment">return sum;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**æ–¹æ³•åç›¸åŒï¼Œå½¢å‚åä¸åŒï¼Œæ— æ³•æ„æˆé‡è½½ï¼ŒæŠ¥é”™ï¼ï¼ï¼</span></span><br><span class="line"><span class="comment"> public static double add(int n2,int n1) &#123;</span></span><br><span class="line"><span class="comment">double sum = n1+n2;</span></span><br><span class="line"><span class="comment">return sum;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--é€»è¾‘è¿ç®—ç¬¦å’Œä½è¿ç®—ç¬¦</title>
      <link href="/2020/01/23/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(9)/"/>
      <url>/2020/01/23/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(9)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•é€»è¾‘è¿ç®—ç¬¦å’Œä½è¿ç®—ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestOperator_3</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ä¸ï¼š&amp;åŒçœŸåˆ™çœŸï¼Œæœ‰å‡åˆ™å‡</span></span><br><span class="line"><span class="comment"> * æˆ–ï¼š|åŒå‡åˆ™å‡ï¼Œæœ‰çœŸåˆ™çœŸ</span></span><br><span class="line"><span class="comment"> * éï¼šï¼çœŸå‡é¢ å€’</span></span><br><span class="line"><span class="comment"> * å¼‚æˆ–ï¼š^åŒå‡å¼‚çœŸ</span></span><br><span class="line"><span class="comment"> * çŸ­è·¯ä¸ï¼š&amp;&amp;æœ‰å‡åˆ™å‡</span></span><br><span class="line"><span class="comment"> * çŸ­è·¯æˆ–ï¼š||æœ‰çœŸåˆ™çœŸ</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * çŸ­è·¯æ–¹å¼ä»å·¦å‘å³è®¡ç®—ï¼Œè‹¥å·¦è¾¹è¡¨è¾¾å¼è®¡ç®—ç»“æœè¶³å¤Ÿåˆ¤æ–­åˆ™å³è¾¹ä¸è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å–åï¼š~</span></span><br><span class="line"><span class="comment"> * æŒ‰ä½ä¸ï¼š&amp;</span></span><br><span class="line"><span class="comment"> * æŒ‰ä½æˆ–ï¼š|</span></span><br><span class="line"><span class="comment"> * æŒ‰ä½å¼‚æˆ–ï¼š^</span></span><br><span class="line"><span class="comment"> * å·¦ç§»ï¼š&lt;&lt;å·¦ç§»ä¸€ä½ç›¸å½“äºä¹˜2</span></span><br><span class="line"><span class="comment"> * å³ç§»ï¼š&gt;&gt;å³ç§»ä¸€ä½ç›¸å½“äºé™¤2å–å•†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">System.out.println(<span class="number">3</span>&lt;&lt;<span class="number">2</span>);          <span class="comment">//ç›¸å½“äº11å·¦ç§»ä¸¤ä½å˜æˆ1100ï¼Œè¾“å‡º12</span></span><br><span class="line">System.out.println(<span class="number">3</span>&gt;&gt;<span class="number">1</span>);   <span class="comment">//ç›¸å½“äº11å³ç§»ä¸€ä½å˜æˆ1ï¼Œè¾“å‡º1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--ç±»å‹è½¬æ¢</title>
      <link href="/2020/01/22/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(6)/"/>
      <url>/2020/01/22/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(6)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç±»å‹è½¬æ¢çš„è¯¯åŒº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTypeConvertError</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1000000000</span>;<span class="comment">//10äº¿</span></span><br><span class="line"><span class="keyword">int</span> b = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans1 = a*b;</span><br><span class="line">System.out.println(ans1);<span class="comment">//è¡¨è¾¾å¼èŒƒå›´è¶Šç•Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> ans2 = a*b;</span><br><span class="line">System.out.println(ans2);<span class="comment">//è¡¨è¾¾å¼èŒƒå›´è¶Šç•Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> ans3 = a*((<span class="keyword">long</span>)b);</span><br><span class="line">System.out.print(ans3); <span class="comment">//æ­£ç¡®è¾“å‡º</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--ç®—æ•°è¿ç®—ç¬¦</title>
      <link href="/2020/01/22/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(7)/"/>
      <url>/2020/01/22/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(7)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•ç®—æ•°è¿ç®—ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TsetOperator_1</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * æ•´æ•°è¿ç®—ï¼š</span></span><br><span class="line"><span class="comment"> * å¦‚æœæ•´æ•°æ“ä½œæ•°é‡Œæœ‰longï¼Œåˆ™ç»“æœä¹Ÿä¸ºlong</span></span><br><span class="line"><span class="comment"> * æ²¡æœ‰longæ—¶ï¼Œç»“æœä¸ºintã€‚å³ä½¿æ“ä½œæ•°å…¨ä¸ºshortã€byteï¼Œç»“æœä¹Ÿæ˜¯int</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">byte</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span>  b = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">int</span>  ans1 = a+b;</span><br><span class="line">  <span class="comment">//byte ans2 = a+b;  æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> c = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">long</span> ans3 = b+c;</span><br><span class="line">  <span class="comment">//int  ans4 = b+c;  æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * æµ®ç‚¹è¿ç®—ï¼š</span></span><br><span class="line"><span class="comment"> * å¦‚æœæ“ä½œæ•°æ¶‰åŠæµ®ç‚¹æ•°,</span></span><br><span class="line"><span class="comment"> * å¦‚æœä¸¤ä¸ªæµ®ç‚¹æ•°æœ‰ä¸€ä¸ªä¸ºdoubleï¼Œåˆ™ç»“æœä¸ºdouble</span></span><br><span class="line"><span class="comment"> * åªæœ‰ä¸¤ä¸ªæµ®ç‚¹æ•°æ•°éƒ½ä¸ºfloatï¼Œç»“æœæ‰ä¸ºfloat</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">float</span> d = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">float</span> e = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">double</span> f = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">float</span> ans5 = d+e;</span><br><span class="line">        <span class="keyword">double</span> ans6 = d+e;</span><br><span class="line">        <span class="keyword">double</span> ans7 = e+f;</span><br><span class="line">      <span class="comment">//float ans8 = e+f;  æŠ¥é”™</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * æ•´æ•°ä¸æµ®ç‚¹è¿ç®—ï¼š</span></span><br><span class="line"><span class="comment"> * åªè¦æ“ä½œæ•°æ¶‰åŠæµ®ç‚¹æ•°ï¼Œåˆ™å‘æµ®ç‚¹æ•°å…¼å®¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">                           * å–æ¨¡è¿ç®—</span></span><br><span class="line"><span class="comment">                           *ç»“æœï¼ˆä½™æ•°ï¼‰çš„ç¬¦å·ä¸å·¦æ“ä½œæ•°ç›¸åŒ </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="number">9</span>%<span class="number">5</span>);</span><br><span class="line">        System.out.println(-<span class="number">9</span>%<span class="number">5</span>);</span><br><span class="line">        System.out.println(<span class="number">9</span>%-<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--æ¯”è¾ƒè¿ç®—ç¬¦</title>
      <link href="/2020/01/22/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(8)/"/>
      <url>/2020/01/22/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(8)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•æ¯”è¾ƒè¿ç®—ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestOperator_2</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//æ¯”è¾ƒè¿ç®—ç¬¦ä»…æ ¹æ®å˜é‡çš„æ•°å€¼å¤§å°æ¥è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">  <span class="comment">//å¯å‚ä¸æ¯”è¾ƒè¿ç®—çš„æœ‰ï¼šbyte/short/int/long,float/double,char</span></span><br><span class="line">  <span class="comment">//æ¯”è¾ƒè¿ç®—è¿”å›å€¼ä¸ºå¸ƒå°”å€¼ï¼štrueï¼Œfalse</span></span><br><span class="line"><span class="keyword">int</span>   a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">float</span> b = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(a == b) &#123;</span><br><span class="line">System.out.println(<span class="string">"=="</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(a != b) &#123;</span><br><span class="line">System.out.println(<span class="string">"!="</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(a &lt; b) &#123;</span><br><span class="line">System.out.println(<span class="string">"&lt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(a &gt; b) &#123;</span><br><span class="line">System.out.println(<span class="string">"&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--æ³¨é‡Š</title>
      <link href="/2020/01/20/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(1)/"/>
      <url>/2020/01/20/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(1)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Javaæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦; <span class="comment">//è¿™æ˜¯å•è¡Œæ³¨é‡Š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestComment</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args <span class="comment">/*å¤šè¡Œæ³¨é‡Šä¹Ÿå¯ç”¨ä½œè¡Œå†…æ³¨é‡Š*/</span>)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Hello World !"</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å¤šè¡Œæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> * å¤šè¡Œæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> * å¤šè¡Œæ³¨é‡Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--javaæ ‡è¯†ç¬¦</title>
      <link href="/2020/01/20/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(2)/"/>
      <url>/2020/01/20/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(2)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Javaæ ‡è¯†ç¬¦ç”¨æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestIdentifer</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a123 = <span class="number">1</span>;</span><br><span class="line">                             <span class="comment">//int 123a = 2; æ•°å­—ä¸èƒ½æ‰“å¤´</span></span><br><span class="line"><span class="keyword">int</span> $abc = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">int</span> _abc = <span class="number">4</span>; </span><br><span class="line"><span class="keyword">int</span>  å¹´é¾„ = <span class="number">18</span>; <span class="comment">//Javaæ”¯æŒä¸­æ–‡å˜é‡ä½†ä¸å»ºè®®ä½¿ç”¨</span></span><br><span class="line">             <span class="comment">//int public =5;   å…³é”®å­—ä¸èƒ½ä½œä¸ºå˜é‡å»ä½¿ç”¨</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å¸¸é‡</title>
      <link href="/2020/01/20/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(3)/"/>
      <url>/2020/01/20/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(3)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Javaå¸¸é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConstant</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//ageå’Œnameéƒ½æ˜¯å˜é‡ï¼Œæ•°å­—18ã€20å’Œå­—ç¬¦ä¸²â€œGeYuâ€â€œGEYUâ€æ˜¯å­—é¢å¸¸é‡</span></span><br><span class="line"><span class="keyword">int</span> age = <span class="number">18</span>;</span><br><span class="line">age = <span class="number">20</span>;</span><br><span class="line">String name = <span class="string">"GeYu"</span>;</span><br><span class="line">name = <span class="string">"GEYU"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">double</span> PI = <span class="number">3.14</span>;</span><br><span class="line">             <span class="comment">//PI++; æŠ¥é”™ï¼Œfinalå°†PIå®šä¹‰ä¸ºäº†ç¬¦å·å¸¸é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‘½åè§„èŒƒ</span></span><br><span class="line"><span class="comment"> * å¸¸é‡ï¼šå…¨éƒ¨å¤§å†™ï¼Œå¯é…åˆä¸‹åˆ’çº¿ï¼šMAX_VALUE</span></span><br><span class="line"><span class="comment"> * ç±»åï¼šé¦–å­—æ¯å¤§å†™ï¼Œé©¼å³°åŸåˆ™ï¼šHelloWorldã€FatherClass</span></span><br><span class="line"><span class="comment"> * ç±»æˆå‘˜å˜é‡ã€ç±»æ–¹æ³•ï¼šé¦–å­—æ¯å°å†™ï¼Œé©¼å³°åŸåˆ™ï¼šmonthSalaryã€getSalary()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å˜é‡</title>
      <link href="/2020/01/20/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(4)/"/>
      <url>/2020/01/20/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(4)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Javaçš„å˜é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestVariable</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a;</span><br><span class="line"><span class="keyword">long</span> b;</span><br><span class="line"><span class="keyword">double</span> c;</span><br><span class="line">a=<span class="number">1</span>;</span><br><span class="line">b=<span class="number">2</span>;</span><br><span class="line">c=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i,j,k;</span><br><span class="line">i=<span class="number">1</span>;</span><br><span class="line">j=<span class="number">2</span>;</span><br><span class="line">k=<span class="number">3</span>;</span><br><span class="line">i=j=k=<span class="number">4</span>;</span><br><span class="line">    <span class="comment">//i=5,j=6,k=7; è¿™ç§èµ‹å€¼Javaåªå…è®¸åœ¨å˜é‡å®šä¹‰æ—¶å€™è¿›è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n=<span class="number">8</span>,m=<span class="number">9</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå­¦ä¹ ä¹‹è·¯--å­—ç¬¦ç±»å‹å’Œå¸ƒå°”ç±»å‹</title>
      <link href="/2020/01/20/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(5)/"/>
      <url>/2020/01/20/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF(5)/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Javaå­—ç¬¦ç±»å‹å’Œå¸ƒå°”ç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è‘›å®‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPrimitiveDateType</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">char</span> a = <span class="string">'A'</span>;</span><br><span class="line"><span class="keyword">char</span> b =  <span class="string">'ä¸­'</span>;</span><br><span class="line"><span class="keyword">char</span> c = <span class="string">'1'</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å¯¹äºå­—ç¬¦ç±»å‹æ•°æ®ï¼ŒJavaä½¿ç”¨UNICODEç¼–ç è¡¨ç¤º</span></span><br><span class="line"><span class="comment"> * æ¯ä¸ªå­—ç¬¦å 2å­—èŠ‚ </span></span><br><span class="line"><span class="comment"> * å­—ç¬¦ç”¨' '  å­—ç¬¦ä¸²ç”¨" "</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//è½¬ä¹‰å­—ç¬¦</span></span><br><span class="line">System.out.println(<span class="string">'a'</span>+<span class="string">'b'</span>);  <span class="comment">//è¾“å‡º195</span></span><br><span class="line">System.out.println(<span class="string">""</span>+<span class="string">'a'</span>+<span class="string">'b'</span>);  <span class="comment">//è¾“å‡ºab</span></span><br><span class="line">System.out.println(<span class="string">""</span>+<span class="string">'a'</span>+<span class="string">'\''</span>+<span class="string">'b'</span>);  <span class="comment">//è¾“å‡ºa'b</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//æµ‹è¯•å¸ƒå°”ç±»å‹</span></span><br><span class="line">  <span class="comment">//å¸ƒå°”ç±»å‹æ•°æ®å ä¸€ä½è€Œä¸æ˜¯ä¸€å­—èŠ‚ï¼Œä¸”ä¸å¯ä»¥ç”¨'0'æˆ–'1'</span></span><br><span class="line"><span class="keyword">boolean</span> man = <span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">boolean</span> woman = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">if</span>(man) &#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> å­¦ä¹  </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯•ç©YOLOv3å¤šç›®æ ‡æ£€æµ‹</title>
      <link href="/2019/10/24/%E8%AF%95%E7%8E%A9YOLOv3%E5%A4%9A%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/"/>
      <url>/2019/10/24/%E8%AF%95%E7%8E%A9YOLOv3%E5%A4%9A%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="YOLOv3ç®€ä»‹"><a href="#YOLOv3ç®€ä»‹" class="headerlink" title="YOLOv3ç®€ä»‹"></a>YOLOv3ç®€ä»‹</h1><p><img src="https://s1.ax1x.com/2022/09/05/vT2ltK.png" alt></p><p><a href="https://pjreddie.com/darknet/yolo/" target="_blank" rel="noopener">å®˜ç½‘é“¾æ¥</a><br><a href="https://pjreddie.com/media/files/papers/YOLOv3.pdf" target="_blank" rel="noopener">è®ºæ–‡é“¾æ¥</a></p><h1 id="è¿è¡Œç¯å¢ƒæ­å»º"><a href="#è¿è¡Œç¯å¢ƒæ­å»º" class="headerlink" title="è¿è¡Œç¯å¢ƒæ­å»º"></a>è¿è¡Œç¯å¢ƒæ­å»º</h1><p>é¦–å…ˆä¸‹è½½æºç ï¼š<br><strong>æºç ï¼š</strong> <a href="https://github.com/NUISTGY/TensorFlow2.0-Examples/tree/master/4-Object_Detection/YOLOV3">https://github.com/NUISTGY/TensorFlow2.0-Examples/tree/master/4-Object_Detection/YOLOV3</a></p><p>æ¥ç€å®‰è£…ä¾èµ–åº“å’Œè®­ç»ƒå¥½çš„æƒé‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install -r ./docs/requirements.txt</span><br><span class="line">$ wget https://pjreddie.com/media/files/yolov3.weights</span><br></pre></td></tr></table></figure><p>å°†æƒé‡æ–‡ä»¶ç½®äºæºç æ–‡ä»¶å¤¹ç›®å½•ä¸‹å³å¯ã€‚</p><h1 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h1><p>å‰é¢å·²ç»å®Œæˆäº†æ‰€æœ‰çš„å‡†å¤‡å…¬ä½œï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯è¿›è¡Œç›®æ ‡æ£€æµ‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python image_demo.py</span><br><span class="line">$ python video_demo.py # if use camera, set video_path = 0</span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/09/05/vT2KTx.jpg" alt="è¿è¡Œpython image_demo.pyçš„ç»“æœ"></p><h1 id="å°è¯•æ£€æµ‹è‡ªå·±çš„å›¾ç‰‡æˆ–è§†é¢‘"><a href="#å°è¯•æ£€æµ‹è‡ªå·±çš„å›¾ç‰‡æˆ–è§†é¢‘" class="headerlink" title="å°è¯•æ£€æµ‹è‡ªå·±çš„å›¾ç‰‡æˆ–è§†é¢‘"></a>å°è¯•æ£€æµ‹è‡ªå·±çš„å›¾ç‰‡æˆ–è§†é¢‘</h1><p>æƒ³è¦è¯†åˆ«è‡ªå·±çš„å›¾ç‰‡åªéœ€è¦åšå¾ˆå°çš„æ”¹åŠ¨å³å¯ã€‚<br>æ‰“å¼€<code>image_demo.py</code>:<br><img src="https://s1.ax1x.com/2022/09/05/vT2J6H.png" alt><br>å°†22è¡Œimage_pathæ”¹ä¸ºè‡ªå·±å›¾ç‰‡çš„åœ°å€å³å¯ï¼Œè§†é¢‘ç›®æ ‡æ£€æµ‹åŒç†ã€‚</p><p>æœ€åå†è´´ä¸€å¼ ç›®æ ‡æ¯”è¾ƒå¤šçš„ç…§ç‰‡ï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vT2Qk6.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> å›¾åƒå¤„ç† </tag>
            
            <tag> ç›®æ ‡æ£€æµ‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MNISTæ•°æ®é›†çš„ä¸‹è½½ä¸æ•°æ®å¤„ç†</title>
      <link href="/2019/08/28/mnist%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%8B%E8%BD%BD%E4%B8%8E%E5%A4%84%E7%90%86/"/>
      <url>/2019/08/28/mnist%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%8B%E8%BD%BD%E4%B8%8E%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="æºç ï¼ˆpythonï¼‰"><a href="#æºç ï¼ˆpythonï¼‰" class="headerlink" title="æºç ï¼ˆpythonï¼‰"></a>æºç ï¼ˆpythonï¼‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">raise</span> ImportError(<span class="string">'You should use Python 3.x'</span>)</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url_base = <span class="string">'http://yann.lecun.com/exdb/mnist/'</span></span><br><span class="line">key_file = &#123;</span><br><span class="line">    <span class="string">'train_img'</span>:<span class="string">'train-images-idx3-ubyte.gz'</span>,</span><br><span class="line">    <span class="string">'train_label'</span>:<span class="string">'train-labels-idx1-ubyte.gz'</span>,</span><br><span class="line">    <span class="string">'test_img'</span>:<span class="string">'t10k-images-idx3-ubyte.gz'</span>,</span><br><span class="line">    <span class="string">'test_label'</span>:<span class="string">'t10k-labels-idx1-ubyte.gz'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dataset_dir = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">save_file = dataset_dir + <span class="string">"/mnist.pkl"</span></span><br><span class="line"></span><br><span class="line">train_num = <span class="number">60000</span></span><br><span class="line">test_num = <span class="number">10000</span></span><br><span class="line">img_dim = (<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>)</span><br><span class="line">img_size = <span class="number">784</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_download</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    file_path = dataset_dir + <span class="string">"/"</span> + file_name</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> os.path.exists(file_path):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">"Downloading "</span> + file_name + <span class="string">" ... "</span>)</span><br><span class="line">    urllib.request.urlretrieve(url_base + file_name, file_path)</span><br><span class="line">    print(<span class="string">"Done"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_mnist</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> key_file.values():</span><br><span class="line">       _download(v)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_load_label</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    file_path = dataset_dir + <span class="string">"/"</span> + file_name</span><br><span class="line">    </span><br><span class="line">    print(<span class="string">"Converting "</span> + file_name + <span class="string">" to NumPy Array ..."</span>)</span><br><span class="line">    <span class="keyword">with</span> gzip.open(file_path, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            labels = np.frombuffer(f.read(), np.uint8, offset=<span class="number">8</span>)</span><br><span class="line">    print(<span class="string">"Done"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> labels</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_load_img</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    file_path = dataset_dir + <span class="string">"/"</span> + file_name</span><br><span class="line">    </span><br><span class="line">    print(<span class="string">"Converting "</span> + file_name + <span class="string">" to NumPy Array ..."</span>)    </span><br><span class="line">    <span class="keyword">with</span> gzip.open(file_path, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = np.frombuffer(f.read(), np.uint8, offset=<span class="number">16</span>)</span><br><span class="line">    data = data.reshape(<span class="number">-1</span>, img_size)</span><br><span class="line">    print(<span class="string">"Done"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_convert_numpy</span><span class="params">()</span>:</span></span><br><span class="line">    dataset = &#123;&#125;</span><br><span class="line">    dataset[<span class="string">'train_img'</span>] =  _load_img(key_file[<span class="string">'train_img'</span>])</span><br><span class="line">    dataset[<span class="string">'train_label'</span>] = _load_label(key_file[<span class="string">'train_label'</span>])    </span><br><span class="line">    dataset[<span class="string">'test_img'</span>] = _load_img(key_file[<span class="string">'test_img'</span>])</span><br><span class="line">    dataset[<span class="string">'test_label'</span>] = _load_label(key_file[<span class="string">'test_label'</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dataset</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_mnist</span><span class="params">()</span>:</span></span><br><span class="line">    download_mnist()</span><br><span class="line">    dataset = _convert_numpy()</span><br><span class="line">    print(<span class="string">"Creating pickle file ..."</span>)</span><br><span class="line">    <span class="keyword">with</span> open(save_file, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        pickle.dump(dataset, f, <span class="number">-1</span>)</span><br><span class="line">    print(<span class="string">"Done!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_change_one_hot_label</span><span class="params">(X)</span>:</span></span><br><span class="line">    T = np.zeros((X.size, <span class="number">10</span>))</span><br><span class="line">    <span class="keyword">for</span> idx, row <span class="keyword">in</span> enumerate(T):</span><br><span class="line">        row[X[idx]] = <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> T</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_mnist</span><span class="params">(normalize=True, flatten=True, one_hot_label=False)</span>:</span></span><br><span class="line">    <span class="string">"""è¯»å…¥MNISTæ•°æ®é›†</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    normalize : å°†å›¾åƒçš„åƒç´ å€¼æ­£è§„åŒ–ä¸º0.0~1.0</span></span><br><span class="line"><span class="string">    one_hot_label : </span></span><br><span class="line"><span class="string">        one_hot_labelä¸ºTrueçš„æƒ…å†µä¸‹ï¼Œæ ‡ç­¾ä½œä¸ºone-hotæ•°ç»„è¿”å›</span></span><br><span class="line"><span class="string">        one-hotæ•°ç»„æ˜¯æŒ‡[0,0,1,0,0,0,0,0,0,0]è¿™æ ·çš„æ•°ç»„</span></span><br><span class="line"><span class="string">    flatten : æ˜¯å¦å°†å›¾åƒå±•å¼€ä¸ºä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    (è®­ç»ƒå›¾åƒ, è®­ç»ƒæ ‡ç­¾), (æµ‹è¯•å›¾åƒ, æµ‹è¯•æ ‡ç­¾)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(save_file):</span><br><span class="line">        init_mnist()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">with</span> open(save_file, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        dataset = pickle.load(f)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> normalize:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> (<span class="string">'train_img'</span>, <span class="string">'test_img'</span>):</span><br><span class="line">            dataset[key] = dataset[key].astype(np.float32)</span><br><span class="line">            dataset[key] /= <span class="number">255.0</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> one_hot_label:</span><br><span class="line">        dataset[<span class="string">'train_label'</span>] = _change_one_hot_label(dataset[<span class="string">'train_label'</span>])</span><br><span class="line">        dataset[<span class="string">'test_label'</span>] = _change_one_hot_label(dataset[<span class="string">'test_label'</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> flatten:</span><br><span class="line">         <span class="keyword">for</span> key <span class="keyword">in</span> (<span class="string">'train_img'</span>, <span class="string">'test_img'</span>):</span><br><span class="line">            dataset[key] = dataset[key].reshape(<span class="number">-1</span>, <span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (dataset[<span class="string">'train_img'</span>], dataset[<span class="string">'train_label'</span>]), (dataset[<span class="string">'test_img'</span>], dataset[<span class="string">'test_label'</span>]) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    init_mnist()</span><br></pre></td></tr></table></figure><h2 id="load-mnistå‡½æ•°è®²è§£"><a href="#load-mnistå‡½æ•°è®²è§£" class="headerlink" title="load_mnistå‡½æ•°è®²è§£"></a>load_mnistå‡½æ•°è®²è§£</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_mnist</span><span class="params">(normalize=True, flatten=True, one_hot_label=False)</span>:</span></span><br><span class="line">    <span class="string">"""è¯»å…¥MNISTæ•°æ®é›†</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    normalize : å°†å›¾åƒçš„åƒç´ å€¼æ­£è§„åŒ–ä¸º0.0~1.0</span></span><br><span class="line"><span class="string">    one_hot_label : </span></span><br><span class="line"><span class="string">        one_hot_labelä¸ºTrueçš„æƒ…å†µä¸‹ï¼Œæ ‡ç­¾ä½œä¸ºone-hotæ•°ç»„è¿”å›</span></span><br><span class="line"><span class="string">        one-hotæ•°ç»„æ˜¯æŒ‡[0,0,1,0,0,0,0,0,0,0]è¿™æ ·çš„æ•°ç»„</span></span><br><span class="line"><span class="string">    flatten : æ˜¯å¦å°†å›¾åƒå±•å¼€ä¸ºä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    (è®­ç»ƒå›¾åƒ, è®­ç»ƒæ ‡ç­¾), (æµ‹è¯•å›¾åƒ, æµ‹è¯•æ ‡ç­¾)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(save_file):</span><br><span class="line">        init_mnist()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">with</span> open(save_file, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        dataset = pickle.load(f)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> normalize:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> (<span class="string">'train_img'</span>, <span class="string">'test_img'</span>):</span><br><span class="line">            dataset[key] = dataset[key].astype(np.float32)</span><br><span class="line">            dataset[key] /= <span class="number">255.0</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> one_hot_label:</span><br><span class="line">        dataset[<span class="string">'train_label'</span>] = _change_one_hot_label(dataset[<span class="string">'train_label'</span>])</span><br><span class="line">        dataset[<span class="string">'test_label'</span>] = _change_one_hot_label(dataset[<span class="string">'test_label'</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> flatten:</span><br><span class="line">         <span class="keyword">for</span> key <span class="keyword">in</span> (<span class="string">'train_img'</span>, <span class="string">'test_img'</span>):</span><br><span class="line">            dataset[key] = dataset[key].reshape(<span class="number">-1</span>, <span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (dataset[<span class="string">'train_img'</span>], dataset[<span class="string">'train_label'</span>]), (dataset[<span class="string">'test_img'</span>], dataset[<span class="string">'test_label'</span>])</span><br></pre></td></tr></table></figure><p>load_mnistå‡½æ•°ä»¥<strong>â€œ(è®­ç»ƒå›¾åƒ,è®­ç»ƒæ ‡ç­¾),(æµ‹è¯•å›¾åƒ,æµ‹è¯•æ ‡ç­¾)â€</strong>çš„å½¢å¼è¿”å›è¯»å…¥çš„MNISTæ•°æ®ã€‚</p><p>æ­¤å¤–,è¿˜å¯ä»¥åƒ<strong>load_mnist(normalize=True,flatten=True,one_hot_label=False)</strong>è¿™æ ·,è®¾ç½®3ä¸ªå‚æ•°ã€‚</p><ul><li>ç¬¬1ä¸ªå‚æ•°normalizeè®¾ç½®æ˜¯å¦å°†è¾“å…¥å›¾åƒæ­£è§„åŒ–ä¸º0.0-1.0çš„å€¼ã€‚å¦‚æœå°†è¯¥å‚æ•°è®¾ç½®ä¸º False,åˆ™è¾“å…¥å›¾åƒçš„åƒç´ ä¼šä¿æŒåŸæ¥çš„0-255ã€‚</li><li>ç¬¬2ä¸ªå‚æ•° flattenè®¾ç½®æ˜¯å¦å±•å¼€è¾“å…¥å›¾åƒ(å˜æˆä¸€ç»´æ•°ç»„)ã€‚å¦‚æœå°†è¯¥å‚æ•°è®¾ç½®ä¸º False,åˆ™è¾“å…¥å›¾åƒä¸º1Ã—28Ã—28çš„ä¸‰ç»´æ•°ç»„;è‹¥è®¾ç½®ä¸ºTrue,åˆ™è¾“å…¥å›¾åƒä¼šä¿å­˜ä¸ºç”±784ä¸ªå…ƒç´ æ„æˆçš„ä¸€ç»´æ•°ç»„ã€‚</li><li>ç¬¬3ä¸ªå‚æ•°one_hot_labelè®¾ç½®æ˜¯å¦å°†æ ‡ç­¾ä¿å­˜ä¸ºone-hotè¡¨ç¤º(one-hot representation)ã€‚one-hotè¡¨ç¤ºæ˜¯ä»…æ­£ç¡®è§£æ ‡ç­¾ä¸º1,å…¶ä½™çš†ä¸º0çš„æ•°ç»„,å°±åƒ[0,0,1,0,0,0,0,0,0,0]è¿™æ ·ã€‚å½“one_hot_labelä¸ºFaseæ—¶,åªæ˜¯åƒ7ã€2è¿™æ ·ç®€å•ä¿å­˜æ­£ç¡®è§£æ ‡ç­¾;å½“ one_hot_labelä¸ºTrueæ—¶,æ ‡ç­¾åˆ™ä¿å­˜ä¸ºone-hotè¡¨ç¤ºã€‚</li></ul><blockquote><p>PS:æƒ³è·å–å®Œæ•´çš„æ‰‹å†™æ•°å­—è¯†åˆ«æºç è¯·è®¿é—®æˆ‘çš„GitHubï¼š<br><a href="https://github.com/NUISTGY/Codes-of-fish-book.git">https://github.com/NUISTGY/Codes-of-fish-book.git</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®é›† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> æ‰‹å†™è¯†åˆ« </tag>
            
            <tag> MNIST </tag>
            
            <tag> å›¾åƒè¯†åˆ« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»€ä¹ˆæ˜¯MNIST æ•°æ®é›†</title>
      <link href="/2019/08/28/mnist%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BB%8B%E7%BB%8D/"/>
      <url>/2019/08/28/mnist%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>MNIST æ•°æ®é›†å·²ç»æ˜¯ä¸€ä¸ªè¢«â€åš¼çƒ‚â€äº†çš„æ•°æ®é›†, å¾ˆå¤šæ•™ç¨‹éƒ½ä¼šå¯¹å®ƒâ€ä¸‹æ‰‹â€, å‡ ä¹æˆä¸ºä¸€ä¸ª â€œå…¸èŒƒâ€. ä¸è¿‡æœ‰äº›äººå¯èƒ½å¯¹å®ƒè¿˜ä¸æ˜¯å¾ˆäº†è§£, ä¸‹é¢æ¥ä»‹ç»ä¸€ä¸‹.</strong></p><p><img src="https://s1.ax1x.com/2022/09/05/vT2wAP.png" alt="æ‰‹å†™æ•°å­—" title="æ‰‹å†™æ•°å­—"></p><p>MNIST æ•°æ®é›†å¯åœ¨ <a href="http://yann.lecun.com/exdb/mnist/" target="_blank" rel="noopener">http://yann.lecun.com/exdb/mnist/</a> è·å–, å®ƒåŒ…å«äº†å››ä¸ªéƒ¨åˆ†:</p><ul><li>Training set images: train-images-idx3-ubyte.gz (9.9 MB, è§£å‹å 47 MB, åŒ…å« 60,000 ä¸ªæ ·æœ¬)</li><li>Training set labels: train-labels-idx1-ubyte.gz (29 KB, è§£å‹å 60 KB, åŒ…å« 60,000 ä¸ªæ ‡ç­¾)</li><li>Test set images: t10k-images-idx3-ubyte.gz (1.6 MB, è§£å‹å 7.8 MB, åŒ…å« 10,000 ä¸ªæ ·æœ¬)</li><li>Test set labels: t10k-labels-idx1-ubyte.gz (5KB, è§£å‹å 10 KB, åŒ…å« 10,000 ä¸ªæ ‡ç­¾)</li></ul><p><img src="https://s1.ax1x.com/2022/09/05/vT20tf.png" alt="è§£å‹å" title="è§£å‹å"></p><p>MNIST æ•°æ®é›†æ¥è‡ªç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶æ‰€, National Institute of Standards and Technology (NIST). è®­ç»ƒé›† (training set) ç”±æ¥è‡ª 250 ä¸ªä¸åŒäººæ‰‹å†™çš„æ•°å­—æ„æˆ, å…¶ä¸­ 50% æ˜¯é«˜ä¸­å­¦ç”Ÿ, 50% æ¥è‡ªäººå£æ™®æŸ¥å±€ (the Census Bureau) çš„å·¥ä½œäººå‘˜. æµ‹è¯•é›†(test set) ä¹Ÿæ˜¯åŒæ ·æ¯”ä¾‹çš„æ‰‹å†™æ•°å­—æ•°æ®.</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®é›† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ‰‹å†™è¯†åˆ« </tag>
            
            <tag> MNIST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¡Œäººé‡è¯†åˆ«ä»£ç å®æˆ˜ï¼ˆä¸‰ï¼‰</title>
      <link href="/2019/08/24/%E8%A1%8C%E4%BA%BA%E9%87%8D%E8%AF%86%E5%88%AB%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%EF%BC%88%E4%B8%89%EF%BC%89/"/>
      <url>/2019/08/24/%E8%A1%8C%E4%BA%BA%E9%87%8D%E8%AF%86%E5%88%AB%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%EF%BC%88%E4%B8%89%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="ä»£ç æè¿°"><a href="#ä»£ç æè¿°" class="headerlink" title="ä»£ç æè¿°"></a><strong>ä»£ç æè¿°</strong></h1><p><strong>ä»£ç æ¥æºï¼š</strong> <a href="https://github.com/layumi/Person_reID_baseline_pytorch">https://github.com/layumi/Person_reID_baseline_pytorch</a></p><p><code>è¯¦ç»†ä¿¡æ¯å¯è§README.md</code></p><p>å‡†å¤‡å¥½äº†è®­ç»ƒæ•°æ®å’Œç½‘ç»œç»“æ„ï¼Œä¸‹é¢å°±å¯ä»¥è®­ç»ƒäº†ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python train.py --gpu_ids <span class="number">0</span> --name ft_ResNet50 --train_all --batchsize <span class="number">32</span>  --data_dir your_data_path</span><br><span class="line">--gpu_ids which gpu to run.</span><br><span class="line">--name the name of the model.</span><br><span class="line">--data_dir the <span class="built_in">path</span> of the training data.</span><br><span class="line">--train_all using all images to train.</span><br><span class="line">--batchsize batch size.</span><br><span class="line">--erasing_p random erasing probability.</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¢ç©¶ä¸€ä¸‹<code>train.py</code>ä¸­éƒ½åšäº†äº›ä»€ä¹ˆã€‚<br>é¦–å…ˆæ˜¯è¯»å–æ•°æ®å’Œlabelã€‚è¿™é‡Œä½¿ç”¨äº†<code>torch.utils.data.DataLoader</code>, å¯ä»¥è·å¾—ä¸¤ä¸ªè¿­ä»£å™¨<code>dataloaders[&#39;train&#39;]</code> and <code>dataloaders[&#39;val&#39;]</code> æ¥è¯»æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">image_datasets = &#123;&#125;</span><br><span class="line">image_datasets[<span class="string">'train'</span>] = datasets.ImageFolder(os.path.join(data_dir, <span class="string">'train'</span>),</span><br><span class="line">                                         data_transforms[<span class="string">'train'</span>])</span><br><span class="line">image_datasets[<span class="string">'val'</span>] = datasets.ImageFolder(os.path.join(data_dir, <span class="string">'val'</span>),</span><br><span class="line">                                         data_transforms[<span class="string">'val'</span>])</span><br><span class="line"></span><br><span class="line">dataloaders = &#123;x: torch.utils.data.DataLoader(image_datasets[x], batch_size=opt.batchsize,</span><br><span class="line">                                            shuffle=<span class="literal">True</span>, num_workers=<span class="number">8</span>) <span class="comment"># 8 workers may work faster</span></span><br><span class="line">             <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">'train'</span>, <span class="string">'val'</span>]&#125;</span><br><span class="line">dataset_sizes = &#123;x: len(image_datasets[x]) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">'train'</span>, <span class="string">'val'</span>]&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹åˆ™æ˜¯ä¸»è¦çš„ä»£ç æ¥è®­ç»ƒæ¨¡å‹ï¼Œä¸€å…±åªæœ‰20è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Iterate over data.</span></span><br><span class="line">           <span class="keyword">for</span> data <span class="keyword">in</span> dataloaders[phase]:</span><br><span class="line">               <span class="comment"># get a batch of inputs</span></span><br><span class="line">               inputs, labels = data</span><br><span class="line">               now_batch_size,c,h,w = inputs.shape</span><br><span class="line">               <span class="keyword">if</span> now_batch_size&lt;opt.batchsize: <span class="comment"># skip the last batch</span></span><br><span class="line">                   <span class="keyword">continue</span></span><br><span class="line">               <span class="comment"># print(inputs.shape)</span></span><br><span class="line">               <span class="comment"># wrap them in Variable, if gpu is used, we transform the data to cuda.</span></span><br><span class="line">               <span class="keyword">if</span> use_gpu:</span><br><span class="line">                   inputs = Variable(inputs.cuda())</span><br><span class="line">                   labels = Variable(labels.cuda())</span><br><span class="line">               <span class="keyword">else</span>:</span><br><span class="line">                   inputs, labels = Variable(inputs), Variable(labels)</span><br><span class="line"></span><br><span class="line">               <span class="comment"># zero the parameter gradients</span></span><br><span class="line">               optimizer.zero_grad()</span><br><span class="line"></span><br><span class="line">               <span class="comment">#-------- forward --------</span></span><br><span class="line">               outputs = model(inputs)</span><br><span class="line">               _, preds = torch.max(outputs.data, <span class="number">1</span>)</span><br><span class="line">               loss = criterion(outputs, labels)</span><br><span class="line"></span><br><span class="line">               <span class="comment">#-------- backward + optimize --------</span></span><br><span class="line">               <span class="comment"># only if in training phase</span></span><br><span class="line">               <span class="keyword">if</span> phase == <span class="string">'train'</span>:</span><br><span class="line">                   loss.backward()</span><br><span class="line">                   optimizer.step()</span><br></pre></td></tr></table></figure><p>æ¯åè½®ï¼Œéƒ½ä¼šä¿å­˜ç½‘ç»œå’Œæ›´æ–°lossæ›²çº¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> epoch%<span class="number">10</span> == <span class="number">9</span>:</span><br><span class="line">    save_network(model, epoch)</span><br><span class="line">    draw_curve(epoch)</span><br></pre></td></tr></table></figure><p>æ›´å¤šç»†èŠ‚è§train.py</p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¡Œäººé‡è¯†åˆ« </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> å›¾åƒå¤„ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¡Œäººé‡è¯†åˆ«ä»£ç å®æˆ˜ï¼ˆäºŒï¼‰</title>
      <link href="/2019/08/24/%E8%A1%8C%E4%BA%BA%E9%87%8D%E8%AF%86%E5%88%AB%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2019/08/24/%E8%A1%8C%E4%BA%BA%E9%87%8D%E8%AF%86%E5%88%AB%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="ä»£ç æè¿°"><a href="#ä»£ç æè¿°" class="headerlink" title="ä»£ç æè¿°"></a><strong>ä»£ç æè¿°</strong></h1><p><strong>ä»£ç æ¥æºï¼š</strong> <a href="https://github.com/layumi/Person_reID_baseline_pytorch">https://github.com/layumi/Person_reID_baseline_pytorch</a></p><p><code>è¯¦ç»†ä¿¡æ¯å¯è§README.md</code></p><p>è¿™æ¬¡ç ”ç©¶çš„æ˜¯<code>model.py</code>åŸç†æ˜¯åˆ©ç”¨å’Œä¿®æ”¹é¢„è®­ç»ƒæ¨¡å‹ï¼Œä»£ç åŸä½œè€…ä½¿ç”¨çš„æ˜¯<strong>ImageNet</strong>é¢„è®­ç»ƒç½‘ç»œã€‚</p><p>pytorché‡Œå¼•å…¥æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> models</span><br><span class="line">model =models.resnet50(pretrained = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>printï¼ˆmodelï¼‰</code>æŸ¥çœ‹ç½‘ç»œç»“æ„ï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vT2fA0.png" alt></p><p>å®é™…ä½¿ç”¨æ—¶è¦åšä¿®æ”¹ã€‚è€ƒè™‘åˆ°Market1501è®­ç»ƒé›†ä¸­æœ‰751ä¸ªä¸åŒçš„äººï¼Œæ‰€ä»¥è¦æ”¹å˜æ¨¡å‹æ¥è®­ç»ƒReidçš„åˆ†ç±»å™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define the ResNet50-based Model</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ft_net</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, class_num, droprate=<span class="number">0.5</span>, stride=<span class="number">2</span>)</span>:</span></span><br><span class="line">        super(ft_net, self).__init__()</span><br><span class="line">        model_ft = models.resnet50(pretrained=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># avg pooling to global pooling</span></span><br><span class="line">        <span class="keyword">if</span> stride == <span class="number">1</span>:</span><br><span class="line">            model_ft.layer4[<span class="number">0</span>].downsample[<span class="number">0</span>].stride = (<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">            model_ft.layer4[<span class="number">0</span>].conv2.stride = (<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        model_ft.avgpool = nn.AdaptiveAvgPool2d((<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">        self.model = model_ft</span><br><span class="line">        self.classifier = ClassBlock(<span class="number">2048</span>, class_num, droprate)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = self.model.conv1(x)</span><br><span class="line">        x = self.model.bn1(x)</span><br><span class="line">        x = self.model.relu(x)</span><br><span class="line">        x = self.model.maxpool(x)</span><br><span class="line">        x = self.model.layer1(x)</span><br><span class="line">        x = self.model.layer2(x)</span><br><span class="line">        x = self.model.layer3(x)</span><br><span class="line">        x = self.model.layer4(x)</span><br><span class="line">        x = self.model.avgpool(x)</span><br><span class="line">        x = x.view(x.size(<span class="number">0</span>), x.size(<span class="number">1</span>))</span><br><span class="line">        x = self.classifier(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p>æ›´å¤šç»†èŠ‚åœ¨model.pyä¸­ï¼Œé‡Œé¢è¿˜åŒ…å«äº†å…¶ä»–çš„é¢„è®­ç»ƒæ¨¡å‹ä»¥åŠå¯¹åº”çš„ä¿®æ”¹æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¡Œäººé‡è¯†åˆ« </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> å›¾åƒå¤„ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¡Œäººé‡è¯†åˆ«ä»£ç å®æˆ˜ï¼ˆä¸€ï¼‰</title>
      <link href="/2019/08/22/%E8%A1%8C%E4%BA%BA%E9%87%8D%E8%AF%86%E5%88%AB%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2019/08/22/%E8%A1%8C%E4%BA%BA%E9%87%8D%E8%AF%86%E5%88%AB%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="ä»£ç æè¿°"><a href="#ä»£ç æè¿°" class="headerlink" title="ä»£ç æè¿°"></a><strong>ä»£ç æè¿°</strong></h1><p><strong>ä»£ç æ¥æºï¼š</strong> <a href="https://github.com/layumi/Person_reID_baseline_pytorch">https://github.com/layumi/Person_reID_baseline_pytorch</a></p><p><code>è¯¦ç»†ä¿¡æ¯å¯è§README.md</code></p><h1 id="prepare-py-æ–‡ä»¶ç®€å•è®²è§£"><a href="#prepare-py-æ–‡ä»¶ç®€å•è®²è§£" class="headerlink" title="prepare.py æ–‡ä»¶ç®€å•è®²è§£"></a>prepare.py æ–‡ä»¶ç®€å•è®²è§£</h1><p><strong>æ–‡ä»¶ä»£ç ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> shutil <span class="keyword">import</span> copyfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># You only need to change this line to your dataset download path</span></span><br><span class="line">download_path = <span class="string">'C:/Users/è‘›å®‡/å­¦ä¹ /ReId/æ•°æ®é›†/Market-1501-v15.09.15'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(download_path):</span><br><span class="line">    print(<span class="string">'please change the download_path'</span>)</span><br><span class="line"></span><br><span class="line">save_path = download_path + <span class="string">'/pytorch'</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(save_path):</span><br><span class="line">    os.mkdir(save_path)</span><br><span class="line"><span class="comment">#-----------------------------------------</span></span><br><span class="line"><span class="comment">#query</span></span><br><span class="line">query_path = download_path + <span class="string">'/query'</span></span><br><span class="line">query_save_path = download_path + <span class="string">'/pytorch/query'</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(query_save_path):</span><br><span class="line">    os.mkdir(query_save_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(query_path, topdown=<span class="literal">True</span>):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name[<span class="number">-3</span>:]==<span class="string">'jpg'</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        ID  = name.split(<span class="string">'_'</span>)</span><br><span class="line">        src_path = query_path + <span class="string">'/'</span> + name</span><br><span class="line">        dst_path = query_save_path + <span class="string">'/'</span> + ID[<span class="number">0</span>] </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(dst_path):</span><br><span class="line">            os.mkdir(dst_path)</span><br><span class="line">        copyfile(src_path, dst_path + <span class="string">'/'</span> + name)</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------</span></span><br><span class="line"><span class="comment">#multi-query</span></span><br><span class="line">query_path = download_path + <span class="string">'/gt_bbox'</span></span><br><span class="line"><span class="comment"># for dukemtmc-reid, we do not need multi-query</span></span><br><span class="line"><span class="keyword">if</span> os.path.isdir(query_path):</span><br><span class="line">    query_save_path = download_path + <span class="string">'/pytorch/multi-query'</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(query_save_path):</span><br><span class="line">        os.mkdir(query_save_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(query_path, topdown=<span class="literal">True</span>):</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> name[<span class="number">-3</span>:]==<span class="string">'jpg'</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            ID  = name.split(<span class="string">'_'</span>)</span><br><span class="line">            src_path = query_path + <span class="string">'/'</span> + name</span><br><span class="line">            dst_path = query_save_path + <span class="string">'/'</span> + ID[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(dst_path):</span><br><span class="line">                os.mkdir(dst_path)</span><br><span class="line">            copyfile(src_path, dst_path + <span class="string">'/'</span> + name)</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------</span></span><br><span class="line"><span class="comment">#gallery</span></span><br><span class="line">gallery_path = download_path + <span class="string">'/bounding_box_test'</span></span><br><span class="line">gallery_save_path = download_path + <span class="string">'/pytorch/gallery'</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(gallery_save_path):</span><br><span class="line">    os.mkdir(gallery_save_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(gallery_path, topdown=<span class="literal">True</span>):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name[<span class="number">-3</span>:]==<span class="string">'jpg'</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        ID  = name.split(<span class="string">'_'</span>)</span><br><span class="line">        src_path = gallery_path + <span class="string">'/'</span> + name</span><br><span class="line">        dst_path = gallery_save_path + <span class="string">'/'</span> + ID[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(dst_path):</span><br><span class="line">            os.mkdir(dst_path)</span><br><span class="line">        copyfile(src_path, dst_path + <span class="string">'/'</span> + name)</span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------</span></span><br><span class="line"><span class="comment">#train_all</span></span><br><span class="line">train_path = download_path + <span class="string">'/bounding_box_train'</span></span><br><span class="line">train_save_path = download_path + <span class="string">'/pytorch/train_all'</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(train_save_path):</span><br><span class="line">    os.mkdir(train_save_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(train_path, topdown=<span class="literal">True</span>):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name[<span class="number">-3</span>:]==<span class="string">'jpg'</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        ID  = name.split(<span class="string">'_'</span>)</span><br><span class="line">        src_path = train_path + <span class="string">'/'</span> + name</span><br><span class="line">        dst_path = train_save_path + <span class="string">'/'</span> + ID[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(dst_path):</span><br><span class="line">            os.mkdir(dst_path)</span><br><span class="line">        copyfile(src_path, dst_path + <span class="string">'/'</span> + name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------</span></span><br><span class="line"><span class="comment">#train_val</span></span><br><span class="line">train_path = download_path + <span class="string">'/bounding_box_train'</span></span><br><span class="line">train_save_path = download_path + <span class="string">'/pytorch/train'</span></span><br><span class="line">val_save_path = download_path + <span class="string">'/pytorch/val'</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(train_save_path):</span><br><span class="line">    os.mkdir(train_save_path)</span><br><span class="line">    os.mkdir(val_save_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(train_path, topdown=<span class="literal">True</span>):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name[<span class="number">-3</span>:]==<span class="string">'jpg'</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        ID  = name.split(<span class="string">'_'</span>)</span><br><span class="line">        src_path = train_path + <span class="string">'/'</span> + name</span><br><span class="line">        dst_path = train_save_path + <span class="string">'/'</span> + ID[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(dst_path):</span><br><span class="line">            os.mkdir(dst_path)</span><br><span class="line">            dst_path = val_save_path + <span class="string">'/'</span> + ID[<span class="number">0</span>]  <span class="comment">#first image is used as val image</span></span><br><span class="line">            os.mkdir(dst_path)</span><br><span class="line">        copyfile(src_path, dst_path + <span class="string">'/'</span> + name)</span><br></pre></td></tr></table></figure><p><strong>ä»£ç æ¯”è¾ƒå†—é•¿ï¼Œæˆ‘æ€»ç»“ä¸€ä¸‹ã€‚</strong><br>è¿™ä¸ªè„šæœ¬çš„ä½œç”¨æ˜¯å°†åŸå§‹æ•°æ®é›†é‡æ–°æŒ‰å›¾ç‰‡IDåˆ†ç±»ã€‚ä¸»è¦æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨ç³»ç»Ÿå‡½æ•°åŠ ä¹‹å¿…è¦çš„å¾ªç¯åˆ¤æ–­æ¥å®ç°ã€‚å¯ä¸å¿…ç»†ç©¶ã€‚è¿è¡Œä¹‹å‰å…ˆå°†ç¬¬äº”è¡Œ<code>download_path = &#39;C:/Users/è‘›å®‡/å­¦ä¹ /ReId/æ•°æ®é›†/Market-1501-v15.09.15&#39;</code>æ”¹ä¸ºä½ è‡ªå·±çš„åœ°å€ã€‚<br>æŒ‰ç…§åŸä½œè€…çš„ä½¿ç”¨æ•™ç¨‹ï¼Œç¬¬ä¸€æ­¥è¦åšçš„å°±æ˜¯è¿è¡Œprepare.pyæ–‡ä»¶ã€‚<br>è¿è¡Œä¹‹åä¼šå‘ç°åœ¨åŸå…ˆçš„Market1501æ•°æ®é›†ä¸­ï¼ˆè¯¦è§ä¹‹å‰çš„åšå®¢ï¼‰å¤šå‡ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹â€œpytorchâ€,æ‰“å¼€çœ‹çœ‹ï¼š</p><p><img src="https://s1.ax1x.com/2022/09/05/vT2hNV.png" alt></p><p>é‡Œé¢æ˜¯6ä¸ªæ–‡ä»¶å¤¹ï¼š</p><ol><li>galleryä¸­åŒ…å«752ä¸ªæ–‡ä»¶å¤¹é¡¹ç›®ï¼Œå‡æŒ‰IDæ’åºï¼š<img src="https://s1.ax1x.com/2022/09/05/vT24hT.png" alt></li><li>multiä¸­æ˜¯1051ä¸ªæ–‡ä»¶å¤¹é¡¹ç›®ï¼Œä»0001åˆ°1501</li><li>queryä¸­åŒ…å«750ä¸ªæ–‡ä»¶é¡¹ç›®ï¼Œä¸å«0000å’Œ-1</li><li>trainä¸­åŒ…å«751ä¸ªæ–‡ä»¶é¡¹ç›®ï¼Œä¸å«0000å’Œ-1</li><li>train allä¸­åŒ…å«751ä¸ªæ–‡ä»¶é¡¹ç›®ï¼Œä¸å«0000å’Œ-1</li><li>valä¸­åŒ…å«751ä¸ªæ–‡ä»¶é¡¹ç›®ï¼Œä¸å«0000å’Œ-1</li></ol><p>å…·ä½“æƒ…å†µå¯ä»¥è‡ªå·±å°è¯•æ‰“å¼€è§‚å¯Ÿã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¡Œäººé‡è¯†åˆ« </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> å›¾åƒå¤„ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Person Re-identificationæ•°æ®é›†æè¿°â€”â€”Market-1501</title>
      <link href="/2019/07/31/Person%20Re-identification%E6%95%B0%E6%8D%AE%E9%9B%86%E6%8F%8F%E8%BF%B0%E2%80%94%E2%80%94Market-1501/"/>
      <url>/2019/07/31/Person%20Re-identification%E6%95%B0%E6%8D%AE%E9%9B%86%E6%8F%8F%E8%BF%B0%E2%80%94%E2%80%94Market-1501/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="http://changingfond.oss-cn-hangzhou.aliyuncs.com/18-7-12/87140649.jpg" alt></p><h1 id="æ•°æ®é›†ç®€ä»‹"><a href="#æ•°æ®é›†ç®€ä»‹" class="headerlink" title="æ•°æ®é›†ç®€ä»‹"></a>æ•°æ®é›†ç®€ä»‹</h1><p><strong>Market-1501</strong> æ•°æ®é›†åœ¨æ¸…åå¤§å­¦æ ¡å›­ä¸­é‡‡é›†ï¼Œå¤å¤©æ‹æ‘„ï¼Œåœ¨ 2015 å¹´æ„å»ºå¹¶å…¬å¼€ã€‚å®ƒåŒ…æ‹¬ç”±6ä¸ªæ‘„åƒå¤´ï¼ˆå…¶ä¸­5ä¸ªé«˜æ¸…æ‘„åƒå¤´å’Œ1ä¸ªä½æ¸…æ‘„åƒå¤´ï¼‰æ‹æ‘„åˆ°çš„ 1501 ä¸ªè¡Œäººã€32668 ä¸ªæ£€æµ‹åˆ°çš„è¡ŒäººçŸ©å½¢æ¡†ã€‚æ¯ä¸ªè¡Œäººè‡³å°‘ç”±2ä¸ªæ‘„åƒå¤´æ•è·åˆ°ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªæ‘„åƒå¤´ä¸­å¯èƒ½å…·æœ‰å¤šå¼ å›¾åƒã€‚è®­ç»ƒé›†æœ‰ 751 äººï¼ŒåŒ…å« 12,936 å¼ å›¾åƒï¼Œå¹³å‡æ¯ä¸ªäººæœ‰ 17.2 å¼ è®­ç»ƒæ•°æ®ï¼›æµ‹è¯•é›†æœ‰ 750 äººï¼ŒåŒ…å« 19,732 å¼ å›¾åƒï¼Œå¹³å‡æ¯ä¸ªäººæœ‰ 26.3 å¼ æµ‹è¯•æ•°æ®ã€‚3368 å¼ æŸ¥è¯¢å›¾åƒçš„è¡Œäººæ£€æµ‹çŸ©å½¢æ¡†æ˜¯äººå·¥ç»˜åˆ¶çš„ï¼Œè€Œ gallery ä¸­çš„è¡Œäººæ£€æµ‹çŸ©å½¢æ¡†åˆ™æ˜¯ä½¿ç”¨DPMæ£€æµ‹å™¨æ£€æµ‹å¾—åˆ°çš„ã€‚è¯¥æ•°æ®é›†æä¾›çš„å›ºå®šæ•°é‡çš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†å‡å¯ä»¥åœ¨single-shotæˆ–multi-shotæµ‹è¯•è®¾ç½®ä¸‹ä½¿ç”¨ã€‚</p><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>Market-1501<br>ã€€ã€€â”œâ”€â”€ bounding_box_test<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0000_c1s1_000151_01.jpg<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0000_c1s1_000376_03.jpg<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0000_c1s1_001051_02.jpg<br>ã€€ã€€â”œâ”€â”€ bounding_box_train<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0002_c1s1_000451_03.jpg<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0002_c1s1_000551_01.jpg<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0002_c1s1_000801_01.jpg<br>ã€€ã€€â”œâ”€â”€ gt_bbox<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0001_c1s1_001051_00.jpg<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0001_c1s1_009376_00.jpg<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0001_c2s1_001976_00.jpg<br>ã€€ã€€â”œâ”€â”€ gt_query<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0001_c1s1_001051_00_good.mat<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0001_c1s1_001051_00_junk.mat<br>ã€€ã€€â”œâ”€â”€ query<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0001_c1s1_001051_00.jpg<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0001_c2s1_000301_00.jpg<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€â”œâ”€â”€ 0001_c3s1_000551_00.jpg<br>ã€€ã€€â””â”€â”€ readme.txt</p><h2 id="ç›®å½•ä»‹ç»"><a href="#ç›®å½•ä»‹ç»" class="headerlink" title="ç›®å½•ä»‹ç»"></a>ç›®å½•ä»‹ç»</h2><ul><li><strong>â€œbounding_box_testâ€</strong>â€”â€”ç”¨äºæµ‹è¯•é›†çš„ 750 äººï¼ŒåŒ…å« 19,732 å¼ å›¾åƒï¼Œå‰ç¼€ä¸º 0000 è¡¨ç¤ºåœ¨æå–è¿™ 750 äººçš„è¿‡ç¨‹ä¸­DPMæ£€æµ‹é”™çš„å›¾ï¼ˆå¯èƒ½ä¸queryæ˜¯åŒä¸€ä¸ªäººï¼‰ï¼Œ-1 è¡¨ç¤ºæ£€æµ‹å‡ºæ¥å…¶ä»–äººçš„å›¾ï¼ˆä¸åœ¨è¿™ 750 äººä¸­ï¼‰</li></ul><ul><li><p><strong>â€œbounding_box_trainâ€</strong>â€”â€”ç”¨äºè®­ç»ƒé›†çš„ 751 äººï¼ŒåŒ…å« 12,936 å¼ å›¾åƒ</p></li><li><p><strong>â€œqueryâ€</strong>â€”â€”ä¸º 750 äººåœ¨æ¯ä¸ªæ‘„åƒå¤´ä¸­éšæœºé€‰æ‹©ä¸€å¼ å›¾åƒä½œä¸ºqueryï¼Œå› æ­¤ä¸€ä¸ªäººçš„queryæœ€å¤šæœ‰ 6 ä¸ªï¼Œå…±æœ‰ 3,368 å¼ å›¾åƒ</p></li><li><p><strong>â€œgt_queryâ€</strong>â€”â€”matlabæ ¼å¼ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªqueryçš„å“ªäº›å›¾ç‰‡æ˜¯å¥½çš„åŒ¹é…ï¼ˆåŒä¸€ä¸ªäººä¸åŒæ‘„åƒå¤´çš„å›¾åƒï¼‰å’Œä¸å¥½çš„åŒ¹é…ï¼ˆåŒä¸€ä¸ªäººåŒä¸€ä¸ªæ‘„åƒå¤´çš„å›¾åƒæˆ–éåŒä¸€ä¸ªäººçš„å›¾åƒï¼‰</p></li><li><p><strong>â€œgt_bboxâ€</strong>â€”â€”æ‰‹å·¥æ ‡æ³¨çš„bounding boxï¼Œç”¨äºåˆ¤æ–­DPMæ£€æµ‹çš„bounding boxæ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½çš„box</p></li></ul><h2 id="å‘½åè§„åˆ™"><a href="#å‘½åè§„åˆ™" class="headerlink" title="å‘½åè§„åˆ™"></a>å‘½åè§„åˆ™</h2><p><strong>ä»¥ 0001_c1s1_000151_01.jpg ä¸ºä¾‹</strong></p><ul><li>0001 è¡¨ç¤ºæ¯ä¸ªäººçš„æ ‡ç­¾ç¼–å·ï¼Œä»0001åˆ°1501ï¼›</li><li>c1 è¡¨ç¤ºç¬¬ä¸€ä¸ªæ‘„åƒå¤´(camera1)ï¼Œå…±æœ‰6ä¸ªæ‘„åƒå¤´ï¼›</li><li>s1 è¡¨ç¤ºç¬¬ä¸€ä¸ªå½•åƒç‰‡æ®µ(sequece1)ï¼Œæ¯ä¸ªæ‘„åƒæœºéƒ½æœ‰æ•°ä¸ªå½•åƒæ®µï¼›</li><li>000151 è¡¨ç¤º c1s1 çš„ç¬¬000151å¸§å›¾ç‰‡ï¼Œè§†é¢‘å¸§ç‡25fpsï¼›</li><li>01 è¡¨ç¤º c1s1_001051 è¿™ä¸€å¸§ä¸Šçš„ç¬¬1ä¸ªæ£€æµ‹æ¡†ï¼Œç”±äºé‡‡ç”¨DPMæ£€æµ‹å™¨ï¼Œå¯¹äºæ¯ä¸€å¸§ä¸Šçš„è¡Œäººå¯èƒ½ä¼šæ¡†å‡ºå¥½å‡ ä¸ªbboxã€‚00 è¡¨ç¤ºæ‰‹å·¥æ ‡æ³¨æ¡†</li></ul><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><ul><li>Zheng, Liang, et al. â€œScalable Person Re-identification: A Benchmark.â€ IEEE International Conference on Computer Vision IEEE Computer Society, 2015:1116-1124.</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®é›† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¡Œäººé‡è¯†åˆ« </tag>
            
            <tag> æ•°æ®é›† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¡Œäººé‡è¯†åˆ«åˆè¯†</title>
      <link href="/2019/07/31/%E8%A1%8C%E4%BA%BA%E9%87%8D%E8%AF%86%E5%88%AB%E5%88%9D%E8%AF%86/"/>
      <url>/2019/07/31/%E8%A1%8C%E4%BA%BA%E9%87%8D%E8%AF%86%E5%88%AB%E5%88%9D%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://s1.ax1x.com/2022/09/05/vTRHG8.png" alt></p><h1 id="è¡Œäººé‡è¯†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#è¡Œäººé‡è¯†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¡Œäººé‡è¯†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>è¡Œäººé‡è¯†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p><strong>è¡Œäººé‡è¯†åˆ«ï¼ˆPerson re-identificationï¼‰</strong>ä¹Ÿç§°è¡Œäººå†è¯†åˆ«ï¼Œæ˜¯åˆ©ç”¨è®¡ç®—æœºè§†è§‰æŠ€æœ¯åˆ¤æ–­å›¾åƒæˆ–è€…è§†é¢‘åºåˆ—ä¸­æ˜¯å¦å­˜åœ¨ç‰¹å®šè¡Œäººçš„æŠ€æœ¯ã€‚å¹¿æ³›è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå›¾åƒæ£€ç´¢çš„å­é—®é¢˜ã€‚ç»™å®šä¸€ä¸ªç›‘æ§è¡Œäººå›¾åƒï¼Œæ£€ç´¢è·¨è®¾å¤‡ä¸‹çš„è¯¥è¡Œäººå›¾åƒã€‚æ—¨åœ¨å¼¥è¡¥ç›®å‰å›ºå®šçš„æ‘„åƒå¤´çš„è§†è§‰å±€é™ï¼Œå¹¶å¯ä¸è¡Œäººæ£€æµ‹/è¡Œäººè·Ÿè¸ªæŠ€æœ¯ç›¸ç»“åˆï¼Œå¯å¹¿æ³›åº”ç”¨äºæ™ºèƒ½è§†é¢‘ç›‘æ§ã€æ™ºèƒ½å®‰ä¿ç­‰é¢†åŸŸã€‚ç”±äºä¸åŒæ‘„åƒè®¾å¤‡ä¹‹é—´çš„å·®å¼‚ï¼ŒåŒæ—¶è¡Œäººå…¼å…·åˆšæ€§å’ŒæŸ”æ€§çš„ç‰¹æ€§ ï¼Œå¤–è§‚æ˜“å—ç©¿ç€ã€å°ºåº¦ã€é®æŒ¡ã€å§¿æ€å’Œè§†è§’ç­‰å½±å“ï¼Œä½¿å¾—è¡Œäººé‡è¯†åˆ«æˆä¸ºè®¡ç®—æœºè§†è§‰é¢†åŸŸä¸­ä¸€ä¸ªæ—¢å…·æœ‰ç ”ç©¶ä»·å€¼åŒæ—¶åˆæå…·æŒ‘æˆ˜æ€§çš„çƒ­é—¨è¯¾é¢˜ã€‚</p><hr><h1 id="æŠ€æœ¯éš¾ç‚¹"><a href="#æŠ€æœ¯éš¾ç‚¹" class="headerlink" title="æŠ€æœ¯éš¾ç‚¹"></a>æŠ€æœ¯éš¾ç‚¹</h1><ul><li><p><strong>èƒ½ä¸èƒ½ç”¨äººè„¸è¯†åˆ«åšé‡è¯†åˆ«ï¼Ÿ</strong><br>ç†è®ºä¸Šæ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯æœ‰ä¸¤ä¸ªåŸå› å¯¼è‡´äººè„¸è¯†åˆ«è¾ƒéš¾åº”ç”¨ï¼šé¦–å…ˆï¼Œå¹¿æ³›å­˜åœ¨åè„‘å‹ºå’Œä¾§è„¸çš„æƒ…å†µï¼Œåšæ­£è„¸çš„äººè„¸è¯†åˆ«éš¾ã€‚å…¶æ¬¡ï¼Œæ‘„åƒå¤´æ‹æ‘„çš„åƒç´ å¯èƒ½ä¸é«˜ï¼Œå°¤å…¶æ˜¯è¿œæ™¯æ‘„åƒå¤´é‡Œé¢äººè„¸æˆªå‡ºæ¥å¾ˆå¯èƒ½éƒ½æ²¡æœ‰32x32çš„åƒç´ ã€‚æ‰€ä»¥äººè„¸è¯†åˆ«åœ¨å®é™…çš„é‡è¯†åˆ«åº”ç”¨ä¸­å¾ˆå¯èƒ½æœ‰é™ã€‚</p></li><li><p><strong>æœ‰äº›äººé è¡£æœçš„é¢œè‰²å°±å¯ä»¥åˆ¤æ–­å‡ºæ¥äº†ï¼Œè¿˜éœ€è¦è¡Œäººé‡è¯†åˆ«ä¹ˆï¼Ÿ</strong><br>è¡£æœé¢œè‰²ç¡®å®æ˜¯è¡Œäººé‡è¯†åˆ«åšå‡ºåˆ¤æ–­ä¸€ä¸ªé‡è¦å› ç´ ï¼Œä½†å…‰é é¢œè‰²æ˜¯ä¸è¶³çš„ã€‚é¦–å…ˆï¼Œæ‘„åƒå¤´ä¹‹é—´æ˜¯æœ‰è‰²å·®ï¼Œå¹¶ä¸”ä¼šæœ‰å…‰ç…§çš„å½±å“ã€‚å…¶æ¬¡ï¼Œæœ‰æ’è¡«ï¼ˆé¢œè‰²ç›¸ä¼¼ï¼‰çš„äººæ€ä¹ˆåŠï¼Œè¦æ‰¾ç»†èŠ‚ï¼Œä½†æ¯”å¦‚é¢œè‰²ç›´æ–¹å›¾è¿™ç§ç»Ÿè®¡çš„ç‰¹å¾å°±æŠŠç»†èŠ‚ç»™å¿½ç•¥äº†ã€‚åœ¨å¤šä¸ªæ•°æ®é›†ä¸Šçš„æµ‹è¯•è¡¨æ˜ï¼Œå…‰ç”¨é¢œè‰²ç‰¹å¾æ˜¯éš¾ä»¥è¾¾åˆ°50%çš„top1æ­£ç¡®ç‡çš„ã€‚</p></li><li><p><strong>æ€»ç»“</strong>ï¼š</p></li></ul><ol><li>ä¸åŒä¸‹æ‘„åƒå¤´é€ æˆè¡Œäººå¤–è§‚çš„å·¨å¤§å˜åŒ–ï¼›</li><li>ç›®æ ‡é®æŒ¡ï¼ˆOcclusionï¼‰å¯¼è‡´éƒ¨åˆ†ç‰¹å¾ä¸¢å¤±ï¼›</li><li>ä¸åŒçš„ Viewï¼ŒIllumination å¯¼è‡´åŒä¸€ç›®æ ‡çš„ç‰¹å¾å·®å¼‚ï¼›</li><li>ä¸åŒç›®æ ‡è¡£æœé¢œè‰²è¿‘ä¼¼ã€ç‰¹å¾è¿‘ä¼¼å¯¼è‡´åŒºåˆ†åº¦ä¸‹é™ï¼›</li></ol><hr><h1 id="åŸºæœ¬æ–¹æ³•"><a href="#åŸºæœ¬æ–¹æ³•" class="headerlink" title="åŸºæœ¬æ–¹æ³•"></a>åŸºæœ¬æ–¹æ³•</h1><h2 id="åŸºäºéƒ¨ä»¶åŒ¹é…çš„æ–¹æ³•"><a href="#åŸºäºéƒ¨ä»¶åŒ¹é…çš„æ–¹æ³•" class="headerlink" title="åŸºäºéƒ¨ä»¶åŒ¹é…çš„æ–¹æ³•"></a>åŸºäºéƒ¨ä»¶åŒ¹é…çš„æ–¹æ³•</h2><p>** åŸºäºäººä½“åœ¨ä¸‰ç»´ç©ºé—´ä¸­çš„ç»“æ„ï¼ˆç»“æ„ä¿¡æ¯ï¼‰ï¼Œäººä½“å›¾åƒå¯ä»¥è¿›è¡Œåˆ†å‰²ï¼ŒæŒ‰éƒ¨ä»¶æ¥æ‰§è¡ŒåŒ¹é…ã€‚**</p><ul><li>å¸¸è§æ–¹æ¡ˆæ˜¯æ°´å¹³åˆ‡å‰²ï¼Œå°±æ˜¯å°†å›¾åƒåˆ‡ä¸ºå‡ ä¸ªæ°´å¹³çš„æ¡ã€‚ç”±äºäººä½“èº«æå¾€å¾€å·®ä¸å¤šï¼Œæ‰€ä»¥å¯ä»¥ç”¨ç®€å•çš„æ°´å¹³æ¡æ¥åšä¸€ä¸€æ¯”è¾ƒã€‚</li><li>åœ¨é¢†åŸŸä¸­åšåŒ¹é…ï¼Œé‡‡ç”¨çš„æ˜¯ä¸€ä¸ªæ­£æ–¹å½¢çš„é‚»åŸŸã€‚</li><li>å¦ä¸€ä¸ªè¾ƒæ–°çš„æ–¹æ¡ˆæ˜¯å…ˆåœ¨äººä½“ä¸Šæ£€æµ‹éƒ¨ä»¶ï¼ˆæ‰‹ï¼Œè…¿ï¼Œèº¯å¹²ç­‰ç­‰ï¼‰å†è¿›è¡ŒåŒ¹é…ï¼Œè¿™æ ·çš„è¯å¯ä»¥å‡å°‘ä½ç½®çš„è¯¯å·®ï¼Œä½†å¯èƒ½å¼•å…¥æ£€æµ‹éƒ¨ä»¶çš„è¯¯å·®ã€‚</li><li>ç±»ä¼¼LSTMçš„attentionåŒ¹é…ï¼Œä½†å¿…é¡»pairè¾“å…¥ï¼Œæµ‹è¯•æ—¶é—´è¾ƒé•¿ï¼Œä¸é€‚åˆå¿«é€Ÿå›¾åƒæ£€ç´¢ã€‚</li><li>å¦‚å›¾ï¼Œç±»ä¼¼äººè„¸å¯¹é½ï¼Œä½¿ç”¨STN å°†è¡Œäººæ•´ä¸ªå›¾åƒå…ˆåˆ©ç”¨çƒ­åº¦å›¾å¯¹é½ï¼Œå†åŒ¹é…ã€‚<br><img src="https://s1.ax1x.com/2022/09/05/vTR7Pf.png" alt><h2 id="åŸºäºæŸå¤±å‡½æ•°çš„æ–¹æ³•"><a href="#åŸºäºæŸå¤±å‡½æ•°çš„æ–¹æ³•" class="headerlink" title="åŸºäºæŸå¤±å‡½æ•°çš„æ–¹æ³•"></a>åŸºäºæŸå¤±å‡½æ•°çš„æ–¹æ³•</h2></li></ul><p><strong>åŸºäºé«˜å±‚è¯­ä¹‰ä¿¡æ¯ï¼Œè®¾ç½®ä¸€äº›è¾…åŠ©ä»»åŠ¡ï¼Œå¸®åŠ©æ¨¡å‹å­¦ä¹ åˆ°å¥½çš„ç‰¹å¾è¡¨è¾¾ã€‚</strong></p><ul><li>èº«ä»½æŸå¤±ï¼ˆIdentification lossï¼‰ç›´æ¥æ‹¿èº«ä»½labelåšå¤šç±»åˆ†ç±»ã€‚</li><li>é‰´å®šæŸå¤±ï¼ˆVerification lossï¼‰æ¯”è¾ƒä¸¤ä¸ªè¾“å…¥å›¾åƒæ˜¯å¦ä¸ºåŒä¸€äººã€‚</li><li>èº«ä»½æŸå¤±ï¼ˆIdentification lossï¼‰+é‰´å®šæŸå¤±ï¼ˆVerification lossï¼‰ï¼Œå°†ä»¥ä¸Šä¸¤ç§æŸå¤±å‡½æ•°æ··åˆã€‚</li><li>ä¸‰æ ·æœ¬æŸå¤± ï¼ˆTriplet lossï¼‰ ä»¥3ä¸ªæ ·æœ¬ä¸ºä¸€ç»„ï¼ŒåŒä¸€äººçš„å›¾åƒç‰¹å¾è·ç¦»åº”å°äºä¸åŒäººã€‚</li><li>åŠ å…¥å±æ€§ä»»åŠ¡ ï¼ˆattributeï¼‰æ¯”å¦‚åˆ¤æ–­æ˜¯å¦èƒŒåŒ…ï¼Œæ˜¯ç”·ç”Ÿè¿˜æ˜¯å¥³ç”Ÿç­‰ç­‰ã€‚äººä»¬é‡è§é™Œç”Ÿäººä¹Ÿæ˜¯åˆ©ç”¨è¿™äº›å±æ€§æ¥æè¿°ã€‚</li><li>æ•°æ®å¢å¼º æ··åˆå¤šæ•°æ®é›†è®­ç»ƒ ï¼ŒåŠ å…¥è®­ç»ƒé›†ä¸Š ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰ç”Ÿæˆçš„æ•°æ®ï¼Œå¦‚å›¾ï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vTRfrd.png" alt></li></ul><h1 id="è¯†åˆ«æœºåˆ¶"><a href="#è¯†åˆ«æœºåˆ¶" class="headerlink" title="è¯†åˆ«æœºåˆ¶"></a>è¯†åˆ«æœºåˆ¶</h1><p><strong>å¦‚å›¾</strong><br> <img src="https://s1.ax1x.com/2022/09/05/vTR5VI.png" alt><br>é¦–å…ˆè¦åšçš„æ˜¯<strong>Detection</strong>ï¼Œä¹Ÿå°±æ˜¯æ£€æµ‹å‡ºè¡Œäººï¼Œå…¶å®è¿™ä¸€æ­¥æ•°æ®é›†å·²ç»å¸®æˆ‘ä»¬åšåˆ°äº†ï¼Œä¸‹é¢ä»‹ç»æ•°æ®é›†çš„æ—¶å€™ä¼šè®²åˆ°ä¸åŒæ•°æ®é›†é‡‡ç”¨çš„ä¸åŒçš„ç›®æ ‡æ£€æµ‹æ–¹æ³•ä»¥åŠIDçš„æ ‡æ³¨æ–¹å¼ã€‚å‰©ä¸‹çš„éƒ¨åˆ†ï¼Œå°±æ˜¯è¦å»<strong>è®­ç»ƒä¸€ä¸ªç‰¹å¾æå–ç½‘ç»œ</strong>ï¼Œæ ¹æ®ç‰¹å¾æ‰€è®¡ç®—çš„åº¦é‡è·ç¦»å¾—åˆ°æŸå¤±å€¼ï¼Œæˆ‘ä»¬é€‰ç”¨ä¸€ä¸ªä¼˜åŒ–å™¨å»è¿­ä»£æ‰¾åˆ°lossæœ€å°å€¼ï¼Œå¹¶ä¸æ–­æ›´æ–°ç½‘ç»œçš„å‚æ•°è¾¾åˆ°å­¦ä¹ çš„æ•ˆæœã€‚åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”¨å°†è¦æ£€ç´¢çš„å›¾ç‰‡ï¼ˆç§°ä¸º<strong>query</strong>æˆ–è€…<strong>probe</strong>ï¼‰ï¼Œåœ¨<strong>åº•åº“gallery</strong>ä¸­ï¼Œæ ¹æ®è®¡ç®—å‡ºçš„ç‰¹å¾è·ç¦»è¿›è¡Œæ’åºï¼Œé€‰å‡ºæœ€TOPçš„å‡ å¼ å›¾ç‰‡ï¼Œæ¥è¾¾åˆ°ç›®æ ‡æ£€ç´¢çš„ç›®çš„ã€‚</p><p>ä¸‹é¢ä¸¤å¼ å›¾åˆ†åˆ«æ˜¯<strong>è®­ç»ƒé˜¶æ®µ</strong>å’Œ<strong>æµ‹è¯•é˜¶æ®µ</strong>çš„ç¤ºæ„å›¾ï¼š<br> <img src="https://s1.ax1x.com/2022/09/05/vTRrUx.png" alt><br>** è®­ç»ƒé˜¶æ®µ**<br>  <img src="https://s1.ax1x.com/2022/09/05/vTR6PK.png" alt></p><hr><h1 id="è¯„æµ‹æŒ‡æ ‡"><a href="#è¯„æµ‹æŒ‡æ ‡" class="headerlink" title="è¯„æµ‹æŒ‡æ ‡"></a>è¯„æµ‹æŒ‡æ ‡</h1><h2 id="rank-k"><a href="#rank-k" class="headerlink" title="rank-k"></a>rank-k</h2><p><code>ç®—æ³•è¿”å›çš„æ’åºåˆ—è¡¨ä¸­ï¼Œå‰kä½ä¸ºå­˜åœ¨æ£€ç´¢ç›®æ ‡åˆ™ç§°ä¸ºrank-kå‘½ä¸­</code><br><strong>ä¸¾ä¸ªä¾‹å­:</strong><br>å‡å¦‚åœ¨äººè„¸è¯†åˆ«ä¸­ï¼Œåº•åº“ä¸­æœ‰100ä¸ªäººï¼Œç°åœ¨æ¥äº†1ä¸ªå¾…è¯†åˆ«çš„äººè„¸ï¼ˆå‡å¦‚labelä¸ºm1ï¼‰ï¼Œä¸åº•åº“ä¸­çš„äººè„¸æ¯”å¯¹åå°†åº•åº“ä¸­çš„äººè„¸æŒ‰ç…§å¾—åˆ†ä»é«˜åˆ°ä½è¿›è¡Œæ’åºï¼Œæˆ‘ä»¬å‘ç°ï¼š<br>å¦‚æœè¯†åˆ«ç»“æœæ˜¯m1ã€m2ã€m3ã€m4ã€m5â€¦â€¦ï¼Œåˆ™æ­¤æ—¶rank-1çš„æ­£ç¡®ç‡ä¸º100%ï¼›rank-2çš„æ­£ç¡®ç‡ä¹Ÿä¸º100%ï¼›rank-5çš„æ­£ç¡®ç‡ä¹Ÿä¸º100%ï¼›<br>å¦‚æœè¯†åˆ«ç»“æœæ˜¯m2ã€m1ã€m3ã€m4ã€m5â€¦â€¦ï¼Œåˆ™æ­¤æ—¶rank-1çš„æ­£ç¡®ç‡ä¸º0%ï¼›rank-2çš„æ­£ç¡®ç‡ä¸º100%ï¼›rank-5çš„æ­£ç¡®ç‡ä¹Ÿä¸º100%ï¼›<br>å¦‚æœè¯†åˆ«ç»“æœæ˜¯m2ã€m3ã€m4ã€m5ã€m1â€¦â€¦ï¼Œåˆ™æ­¤æ—¶rank-1çš„æ­£ç¡®ç‡ä¸º0%ï¼›rank-2çš„æ­£ç¡®ç‡ä¸º0%ï¼›rank-5çš„æ­£ç¡®ç‡ä¸º100%ï¼›<br>åŒç†ï¼Œå½“å¾…è¯†åˆ«çš„äººè„¸é›†åˆæœ‰å¾ˆå¤šæ—¶ï¼Œåˆ™é‡‡å–å–å¹³å‡å€¼çš„åšæ³•ã€‚ä¾‹å¦‚å¾…è¯†åˆ«äººè„¸æœ‰3ä¸ªï¼ˆå‡å¦‚labelä¸ºm1ï¼Œm2ï¼Œm3ï¼‰ï¼ŒåŒæ ·å¯¹æ¯ä¸€ä¸ªäººè„¸éƒ½æœ‰ä¸€ä¸ªä»é«˜åˆ°ä½çš„å¾—åˆ†ï¼Œ<br><strong>æ¯”å¦‚ï¼š</strong><br>äººè„¸1ç»“æœä¸ºm1ã€m2ã€m3ã€m4ã€m5â€¦â€¦ï¼Œ<br>äººè„¸2ç»“æœä¸ºm2ã€m1ã€m3ã€m4ã€m5â€¦â€¦ï¼Œ<br>äººè„¸3ç»“æœm3ã€m1ã€m2ã€m4ã€m5â€¦â€¦ï¼Œ<br>åˆ™æ­¤æ—¶rank-1çš„æ­£ç¡®ç‡ä¸ºï¼ˆ1+1+1ï¼‰/3=100%ï¼›<br>rank-2çš„æ­£ç¡®ç‡ä¹Ÿä¸ºï¼ˆ1+1+1ï¼‰/3=100%ï¼›<br>rank-5çš„æ­£ç¡®ç‡ä¹Ÿä¸ºï¼ˆ1+1+1ï¼‰/3=100%ï¼›<br><strong>æ¯”å¦‚ï¼š</strong><br>äººè„¸1ç»“æœä¸ºm4ã€m2ã€m3ã€m5ã€m6â€¦â€¦ï¼Œ<br>äººè„¸2ç»“æœä¸ºm1ã€m2ã€m3ã€m4ã€m5â€¦â€¦ï¼Œ<br>äººè„¸3ç»“æœm3ã€m1ã€m2ã€m4ã€m5â€¦â€¦ï¼Œ<br>åˆ™æ­¤æ—¶rank-1çš„æ­£ç¡®ç‡ä¸ºï¼ˆ0+0+1ï¼‰/3=33.33%ï¼›<br>rank-2çš„æ­£ç¡®ç‡ä¸ºï¼ˆ0+1+1ï¼‰/3=66.66%ï¼›<br>rank-5çš„æ­£ç¡®ç‡ä¹Ÿä¸ºï¼ˆ0+1+1ï¼‰/3=66.66%ï¼›</p><h2 id="mAP-mean-average-precision"><a href="#mAP-mean-average-precision" class="headerlink" title="mAP(mean average precision)"></a>mAP(mean average precision)</h2><p>ååº”æ£€ç´¢çš„äººåœ¨æ•°æ®åº“ä¸­æ‰€æœ‰æ­£ç¡®çš„å›¾ç‰‡æ’åœ¨æ’åºåˆ—è¡¨å‰é¢çš„ç¨‹åº¦ï¼Œèƒ½æ›´åŠ å…¨é¢çš„è¡¡é‡ReIDç®—æ³•çš„æ€§èƒ½ã€‚å¦‚ä¸‹å›¾ï¼Œå‡è®¾è¯¥æ£€ç´¢è¡Œäººåœ¨galleryä¸­æœ‰10å¼ å›¾ç‰‡ï¼Œåœ¨æ£€ç´¢çš„listä¸­ä½ç½®ï¼ˆrankï¼‰åˆ†åˆ«ä¸º1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9ï¼Œåˆ™apä¸º(1/ 1 + 2 / 2 + 3 / 3 + 4 / 4 + 5 / 5 + 6 / 6 + 7 / 7 + 8 / 8 + 9 / 9) / 10 = 0.90ï¼›apè¾ƒå¤§æ—¶ï¼Œè¯¥è¡Œäººçš„æ£€ç´¢ç»“æœéƒ½ç›¸å¯¹é å‰ï¼Œå¯¹æ‰€æœ‰queryçš„apå–å¹³å‡å€¼å¾—åˆ°mAP<br> <img src="https://s1.ax1x.com/2022/09/05/vTRc8O.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¡Œäººé‡è¯†åˆ« </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> å›¾åƒå¤„ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºReLUçš„é—®é¢˜&amp;æ€è€ƒ</title>
      <link href="/2019/07/16/%E5%85%B3%E4%BA%8EReLU%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%8A%E6%80%9D%E8%80%83/"/>
      <url>/2019/07/16/%E5%85%B3%E4%BA%8EReLU%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%8A%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>ä»Šå¤©çœ‹å®ŒğŸŸä¹¦åå›å¤´æ‹äº†ä¸€ä¸‹ï¼Œçªç„¶å¯¹ReLUæ¿€æ´»å‡½æ•°äº§ç”Ÿäº†ç–‘é—®ã€‚</strong></p><h2 id="å¼•ä¾‹"><a href="#å¼•ä¾‹" class="headerlink" title="å¼•ä¾‹"></a>å¼•ä¾‹</h2><p><strong>è¯•æƒ³ä¸€ä¸‹æœ‰X1ï¼ŒX2ä¸¤ä¸ªè¾“å…¥ï¼Œå¯¹åº”ä¸‰ä¸ªè¾“å‡ºçš„ç®€æ˜“ç½‘ç»œï¼š</strong></p><p><img src="https://s1.ax1x.com/2022/09/05/vTWizF.png" alt="eg net" title="markdown"></p><p>æ ¹æ®å¯¹åº”æŠŠæƒå€¼Wè®¾ä¸ºW11,W12,W13â€¦W23<br><strong>æ˜¾ç„¶é€šè¿‡çŸ©é˜µè¿ç®—ï¼š</strong></p><blockquote><p>Y1=W11Â·X1+W21Â·X2<br>Y2=W12Â·X1+W22Â·X2<br>Y3=W13Â·X1+W23Â·X2</p></blockquote><p>æ‰€å¾—åˆ°çš„è¡¨è¾¾å¼ä¾æ—§æ˜¯Xçš„<strong>çº¿æ€§è¡¨è¾¾å¼</strong><br>ä¹‹åé€šè¿‡<strong>ReLUå±‚</strong>ï¼ˆè¿™é‡Œå‡è®¾éƒ½&gt;0ï¼‰<br>å› ä¸ºY1ï¼ŒY2ï¼ŒY3ï¼0ï¼Œæ•…è¾“å‡ºä¸å˜ï¼š</p><blockquote><p>Y1=W11Â·X1+W21Â·X2<br>Y2=W12Â·X1+W22Â·X2<br>Y3=W13Â·X1+W23Â·X2</p></blockquote><h2 id="é—®é¢˜æå‡º"><a href="#é—®é¢˜æå‡º" class="headerlink" title="é—®é¢˜æå‡º"></a>é—®é¢˜æå‡º</h2><p>æˆ‘ä»¬çŸ¥é“å¼•å…¥æ¿€æ´»å‡½æ•°çš„ç›®çš„æ˜¯ä¸ºäº†<strong>ä½¿å±‚ç¥ç»ç½‘ç»œè¡¨è¾¾èƒ½åŠ›å°±æ›´åŠ å¼ºå¤§ï¼ˆä¸å†æ˜¯è¾“å…¥çš„çº¿æ€§ç»„åˆï¼Œè€Œæ˜¯å‡ ä¹å¯ä»¥é€¼è¿‘ä»»æ„å‡½æ•°ï¼Œè¯¦è§ä¸Šç¯‡Blogï¼‰</strong>ï¼Œè€Œé€šè¿‡å°å®éªŒå‘ç°ï¼ŒReLUå¥½åƒå¹¶æ²¡æœ‰æ”¹å˜åŸå¼çš„çº¿æ€§ç»“æ„ï¼Œåè€Œæ˜¯åŸå¼è¾“å‡ºã€‚é‚£ä¹ˆæ˜¯å¦æœ‰æ‚–æœºå™¨å­¦ä¹ çš„åŸç†å‘¢ï¼Ÿ</p><h2 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h2><p>é¦–å…ˆè‚¯å®šä¸€ç‚¹ï¼š<strong>ä¸Šé¢çš„å®éªŒç¡®å®åæ˜ äº†ReLUæ²¡æœ‰æ”¹å˜å®éªŒå¯¹è±¡çš„çº¿æ€§ç»“æ„ã€‚</strong></p><h3 id="ä¸‹é¢ç»†è¯´ï¼š"><a href="#ä¸‹é¢ç»†è¯´ï¼š" class="headerlink" title="ä¸‹é¢ç»†è¯´ï¼š"></a>ä¸‹é¢ç»†è¯´ï¼š</h3><p>é¦–å…ˆè§‚å¯Ÿå®éªŒï¼Œå®éªŒçš„åŸºç¡€æ˜¯Y1,Y2,Y3ï¼0è¿™ä¸ªæ¡ä»¶ï¼Œåœ¨è¿™ä¸ªæ¡ä»¶ä¸‹æ˜¾ç„¶æ˜¯ç­‰ä»·äºæ’ç­‰å‡½æ•°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´Yè¢«åŸæ ·åŠ å·¥ã€‚å› ä¸ºåŸæ¥çš„è¡¨è¾¾å¼æ˜¯çº¿æ€§ç»“æ„ï¼Œæ‰€ä»¥æ¿€æ´»ä¹‹åä¾æ—§æ˜¯çº¿æ€§ç»“æ„ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸èƒ½è¯´æ˜ReLUå¯¹å¢å¼ºç¥ç»ç½‘ç»œçš„è¡¨ç°åŠ›æ— ç”¨ã€‚</p><p>äº‹å®æ˜¯ï¼Œå‚ä¸è®­ç»ƒçš„æ•°æ®é¦–å…ˆä¸æ­¢2ä¸ªï¼ˆå‚è€ƒMNISTæ•°æ®é›†ï¼Œè®­ç»ƒè¾“å…¥å°±6ä¸‡ä¸ªï¼‰ï¼Œå…¶æ¬¡å¯¹æƒå€¼wçš„åˆå§‹åŒ–æ˜¯æŒ‰æ ‡å‡†å·®ä¸º0.01çš„é«˜æ–¯åˆ†å¸ƒæ¥è¿›è¡Œçš„ï¼Œ<strong>è¿™å°±è‚¯å®šè¾“å…¥ReLUå±‚çš„æ•°æ®ä¸æ’æ­£</strong>ï¼<br><img src="https://s1.ax1x.com/2022/09/05/vTWkM4.png" alt="é«˜æ–¯åˆ†å¸ƒ" title="Pandao editor.md"><br>è€Œå°äº0çš„åˆ™è¢«èµ‹å€¼0ï¼Œè¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ<strong>çº¿æ€§ç»“æ„è¢«ç ´åï¼</strong></p><p>ç”¨<strong>çŸ›ç›¾æ¨ç†æ³•</strong>æ¥æƒ³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼ˆå‡è®¾ReLUä¸æ”¹å˜çº¿æ€§ç»“æ„ï¼‰ï¼š</p><ul><li>é‚£ä¹ˆåº”æ”¹æ»¡è¶³F(X)=MÂ·Xï¼ˆçŸ©é˜µä¹˜æ³•ï¼‰â€”â€”&gt;ReLU â€”â€”&gt;MÂ·Xâ€”â€”&gt;G(F(X))=NÂ·MÂ·Xâ€”â€”&gt;ReLU â€”â€”&gt;NÂ·MÂ·Xâ€¦</li><li>å¯äº‹å®æ˜¯ï¼šæƒå€¼çš„æ­£æ€æ€§ä¸ä¿è¯æ¯æ¬¡è¾“å…¥éƒ½æ˜¯æ­£å€¼ï¼Œæ‰€ä»¥ä¸­é—´ä¼šå‡ºç°ç­‰äº0çš„æƒ…å†µ</li><li>ä¹Ÿå°±æ˜¯F(X)=MÂ·Xï¼ˆçŸ©é˜µä¹˜æ³•ï¼‰â€”â€”&gt;<strong>ReLU â€”â€”&gt;0â€”â€”&gt;G(0ï¼‰ï¼=NÂ·MÂ·X</strong>â€”â€”&gt;â€¦</li><li>æ˜¾ç„¶çº¿æ€§ä¼ é€’è¢«ä¸­æ–­</li><li>æˆ–è€…è¯´å½¢æˆäº†ä¸€ä¸ªæ–°çš„çº¿æ€§ç©ºé—´ï¼Œæ–°ç©ºé—´ä¸æ’ç­‰çº¿æ€§ç©ºé—´äº’ç›¸æ— æ³•è¡¨ç¤ºï¼Œä½¿æ•´ä¸ªç©ºé—´å‘ˆéçº¿æ€§ç»“æ„</li></ul>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¥ç»ç½‘ç»œ </tag>
            
            <tag> æ¿€æ´»å‡½æ•° </tag>
            
            <tag> ä»£æ•°ç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸŸä¹¦è¸©å‘ï¼ˆä¸€ï¼‰</title>
      <link href="/2018/09/20/%E9%B1%BC%E4%B9%A6%E8%B8%A9%E5%9D%91%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2018/09/20/%E9%B1%BC%E4%B9%A6%E8%B8%A9%E5%9D%91%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="åºŸè¯ä¸å¤šè¯´ï¼Œä¿ºå…ˆè®²ä¸€ä¸‹æ¥é¾™å»è„‰"><a href="#åºŸè¯ä¸å¤šè¯´ï¼Œä¿ºå…ˆè®²ä¸€ä¸‹æ¥é¾™å»è„‰" class="headerlink" title="åºŸè¯ä¸å¤šè¯´ï¼Œä¿ºå…ˆè®²ä¸€ä¸‹æ¥é¾™å»è„‰~"></a>åºŸè¯ä¸å¤šè¯´ï¼Œä¿ºå…ˆè®²ä¸€ä¸‹æ¥é¾™å»è„‰~</h2><p>ä»Šå¤©çœ‹é±¼ä¹¦P108é¡µï¼Œé‡åˆ°ä¸€ä¸ªæƒ³ä¸é€šçš„åœ°æ–¹ï¼Œæˆ‘å…ˆæ”¾ä¸€æ³¢æºç ï¼š<br><del>ï¼ˆä¸äº†è§£çš„å°ä¼™ä¼´çœ‹ä¸Šä¸€ç¯‡åšæ–‡ï¼Œæœ‰æºç è¿æ¥ï¼‰</del></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys, os</span><br><span class="line">sys.path.append(os.pardir)  <span class="comment"># ä¸ºäº†å¯¼å…¥çˆ¶ç›®å½•ä¸­çš„æ–‡ä»¶è€Œè¿›è¡Œçš„è®¾å®š</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> common.functions <span class="keyword">import</span> softmax, cross_entropy_error</span><br><span class="line"><span class="keyword">from</span> common.gradient <span class="keyword">import</span> numerical_gradient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">simpleNet</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.W = np.random.randn(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> np.dot(x, self.W)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(self, x, t)</span>:</span></span><br><span class="line">        z = self.predict(x)</span><br><span class="line">        y = softmax(z)</span><br><span class="line">        loss = cross_entropy_error(y, t)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> loss</span><br><span class="line"></span><br><span class="line">x = np.array([<span class="number">0.6</span>, <span class="number">0.9</span>])</span><br><span class="line">t = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">net = simpleNet()</span><br><span class="line"></span><br><span class="line">f = <span class="keyword">lambda</span> w: net.loss(x, t)</span><br><span class="line">dW = numerical_gradient(f, net.W)</span><br><span class="line"></span><br><span class="line">print(dW)</span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªæ±‚ç¥ç»ç½‘ç»œæ¢¯åº¦ w çš„ç®€å•è„šæœ¬ã€‚</p><p>å¦‚ä½ æ‰€è§ï¼Œæ–‡ä»¶å¤´ä¹Ÿimportäº†è®¸å¤šå¤–éƒ¨å‡½æ•°ï¼Œä¸‹é¢è´´å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å¤–éƒ¨å‡½æ•°ï¼š</p><p><strong>numerical_gradientå‡½æ•°</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">numerical_gradient</span><span class="params">(f, x)</span>:</span></span><br><span class="line">    h = <span class="number">1e-4</span> <span class="comment"># 0.0001</span></span><br><span class="line">    grad = np.zeros_like(x)</span><br><span class="line">    </span><br><span class="line">    it = np.nditer(x, flags=[<span class="string">'multi_index'</span>], op_flags=[<span class="string">'readwrite'</span>])</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> it.finished:</span><br><span class="line">        idx = it.multi_index</span><br><span class="line">        tmp_val = x[idx]</span><br><span class="line">        x[idx] = float(tmp_val) + h</span><br><span class="line">        fxh1 = f(x) <span class="comment"># f(x+h)</span></span><br><span class="line">        </span><br><span class="line">        x[idx] = tmp_val - h </span><br><span class="line">        fxh2 = f(x) <span class="comment"># f(x-h)</span></span><br><span class="line">        grad[idx] = (fxh1 - fxh2) / (<span class="number">2</span>*h)</span><br><span class="line">        </span><br><span class="line">        x[idx] = tmp_val <span class="comment"># è¿˜åŸå€¼</span></span><br><span class="line">        it.iternext()   </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> grad</span><br></pre></td></tr></table></figure><h2 id="ä¸‹é¢è®²è®²è¿™ä¸ªå‘"><a href="#ä¸‹é¢è®²è®²è¿™ä¸ªå‘" class="headerlink" title="ä¸‹é¢è®²è®²è¿™ä¸ªå‘"></a>ä¸‹é¢è®²è®²è¿™ä¸ªå‘</h2><p>å°ä¼™å­ä»¬æ³¨æ„çœ‹ç¬¬ä¸€æ®µä»£ç 28ï¼Œ29ä¸¤è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> w: net.loss(x, t)</span><br><span class="line">dW = numerical_gradient(f, net.W)</span><br></pre></td></tr></table></figure><p>å‡½æ•°fä¸­lambdaè¡¨è¾¾å¼æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæ³¨æ„é‡Œé¢çš„å‚æ•° w ï¼Œä»”ç»†çœ‹ï¼Œä½ ä¼šå‘ç°â€¦â€¦å§æ§½ï¼è¿™ä¸æ²¡jbåµç”¨å—â€¦<br>å¦‚æœä½ è¿™ä¹ˆæƒ³ï¼Œé‚£ä½ è·Ÿå¹´è½»çš„æˆ‘æœ‰çš„ä¸€æ‹¼ï¼Œ<del>too young,too simple</del></p><p>æ¥ç€çœ‹ä¸‹ä¸€è¡Œï¼š<strong>dW = numerical_gradient(f, net.W)</strong>å¾ˆæ˜¾ç„¶è°ƒç”¨äº†<strong>numerical_gradientå‡½æ•°</strong>ï¼Œæ²¡æ¯›ç—…ã€‚ä½†æ˜¯ï¼Œå…„å¼ŸèŒï¼Œè¯·ä»”ç»†çœ‹çœ‹<strong>numerical_gradientå‡½æ•°</strong>å®ç°æœºåˆ¶ï¼Œä½ ä¼šå‘ç°ï¼š</p><blockquote><p>ç¬¬13è¡Œï¼š   fxh1 = f(x)<br>ç¬¬16è¡Œï¼š   fxh2 = f(x)<br>ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p></blockquote><p>çœ‹ä¸å‡ºé—®é¢˜å—ï¼Ÿ<br>æ³¨æ„ï¼šè¿™é‡Œçš„fæ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> w: net.loss(x, t)</span><br></pre></td></tr></table></figure><p>wæ˜¯ä¼ªå‚æ•°ï¼Œæ²¡åµç”¨ï¼Œè€Œxæ˜¯<strong>net.W</strong>â€”â€”ç¥ç»ç½‘ç»œçš„æƒé‡ç»„æˆçš„æ•°ç»„ï¼Œè¿™å°¼ç›é©´å¤´ä¸å¯¹é©¬å˜´æ€ä¹ˆå°±ä¼ ç»™fäº†ï¼Ÿï¼Ÿï¼Ÿè€Œä¸”fä¹Ÿä¸éœ€è¦å‚æ•°å•Šï¼</p><p>æˆ‘æ˜¯å·¦æ€å³æƒ³ä¸€ä¸‹åˆï¼Œåæ¥æœ‰äº†ä¸€ä¸ªçŒœæƒ³æ¥è§£é‡Šè¿™æ®µä»£ç ã€‚</p><h2 id="çŒœæƒ³"><a href="#çŒœæƒ³" class="headerlink" title="çŒœæƒ³"></a>çŒœæƒ³</h2><p>æˆ‘çŒœæƒ³fxh1 = f(x) ï¼Œfxh2 = f(x)æ‹¬å·é‡Œçš„xå¯¹ç¨‹åºæ ¹æœ¬æ²¡åµç”¨ï¼Œäºæ˜¯æˆ‘å¤§èƒ†çš„åˆ æ‰äº†x,å˜æˆï¼š</p><blockquote><p>ç¬¬13è¡Œï¼š   fxh1 = f()<br>ç¬¬16è¡Œï¼š   fxh2 = f()</p></blockquote><p>å½“ç„¶ä¸ºäº†ä¿æŒå…¼å®¹ï¼Œä¹Ÿå¾—æŠŠlambdaè¡¨è¾¾å¼é‚£ä¸ªä¼ªå‚æ•°åˆ äº†ï¼š</p><blockquote><p>f = lambda : net.loss(x, t)</p></blockquote><p>ç„¶åç¼–è¯‘è¿è¡Œï¼Œç»“æœâ€¦tmdå°±å¯¹äº†ï¼Œä½ è‚¯å®šè§‰å¾—è¿™æ˜¯ä¸ªå‘ï¼Œæ²¡é”™ï¼Œæˆ‘å¼€å§‹ä¹Ÿè§‰å¾—æ˜¯å‘ï¼Œå‘æ­»æˆ‘äº†ã€‚<br>åæ¥æµè§ˆäº†åé¢çš„ä»£ç ï¼Œå‘ç°äº†ä¸€äº›ç”¨<strong>numerical_gradientå‡½æ•°</strong>åšæµ‹è¯•è„šæœ¬ï¼Œå…¶ä¸­æµ‹è¯•çš„æ˜¯ä¸€äº›ç®€å•å‡½æ•°çš„æ¢¯åº¦é—®é¢˜ï¼Œæ¶‰åŠåˆ°å˜é‡xæ‰€ä»¥<strong>numerical_gradientå‡½æ•°</strong>çš„xè¦ä¿ç•™ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ç›¸åº”çš„ï¼Œç¥ç»ç½‘ç»œæ±‚æ¢¯åº¦å°±è¦é¡ºç€<strong>numerical_gradientå‡½æ•°</strong>ï¼Œæ²¡å¿…è¦å†å†™ä¸€ä¸ªï¼Œäºæ˜¯å°±åŠ äº†ä¼ªå‚æ•°wä¿è¯å…¼å®¹ã€‚</p><p>æœ€åä¿ºæ·±åˆ»çš„æ˜ç™½ï¼šå®è·µæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†<del>ï¼ˆæ—©è¯•è¯•å°±ä¸ä¼šæµªè´¹é‚£ä¹ˆå¤šæ—¶é—´äº†ï¼‰</del></p><p><img src="http://r.photo.store.qq.com/psb?/V14eJTFY137vJk/5sLv1ifk0X3wKuPoH9lo.XgUnbenkVfUYF4G24tUjTE!/r/dMMAAAAAAAAA" alt="END" title="END"></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘ </tag>
            
            <tag> python </tag>
            
            <tag> ç¥ç»ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºæ¿€æ´»å‡½æ•°çš„ç†è§£</title>
      <link href="/2018/08/19/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2018/08/19/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="ä»€ä¹ˆæ˜¯æ¿€æ´»å‡½æ•°ï¼š"><a href="#ä»€ä¹ˆæ˜¯æ¿€æ´»å‡½æ•°ï¼š" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¿€æ´»å‡½æ•°ï¼š"></a>ä»€ä¹ˆæ˜¯æ¿€æ´»å‡½æ•°ï¼š</h1><p>ä¸‹åˆå­¦å®Œäº†ç¥ç»ç½‘ç»œè¯¯å·®çš„åå‘ä¼ æ’­ï¼Œå¿ƒæ»¡æ„è¶³çœ‹ç€æ»¡å±å¹•åˆšæ’¸å‡ºæ¥çš„Affine,Sigmoid,ReLU,Softmaxâ€¦â€¦çªç„¶,å¿ƒé‡Œå‘å‡ºä¸€å£°ç–‘é—®ï¼š<strong>æ¿€æ´»å‡½æ•°æœ‰ä»€ä¹ˆç”¨ï¼Ÿï¼Ÿï¼Ÿ</strong>æˆ‘æ…Œäº†ï¼Œæˆ‘è¯´ä¸ä¸Šæ¥ï¼Œä½†æ˜¯éšéšçº¦çº¦èƒ½çŸ¥é“è¿™ç©æ„æ˜¯å¹²å˜›çš„ï¼Œæœ¬ç€ä¸€è´¯<del>åˆ¨æ ¹é—®åº•è·‘ä¸ªç¨€çƒ‚</del>çš„ä½œé£,æˆ‘å†³å®šå½»åº•ææ¸…æ¥šï¼</p><h2 id="å¼•ä¾‹"><a href="#å¼•ä¾‹" class="headerlink" title="å¼•ä¾‹"></a>å¼•ä¾‹</h2><p>é¦–å…ˆå›åˆ°æœºå™¨å­¦ä¹ æœ€åˆå§‹çš„é‚£ä¸ªåœ°æ–¹â€”â€“<strong>é€»è¾‘é—¨ï¼ˆæ„ŸçŸ¥æœºè¡¨ç¤ºï¼‰</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸é—¨æ„ŸçŸ¥æœº</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AND</span><span class="params">(x1,x2)</span>:</span></span><br><span class="line">    w1,w2,theta=<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.7</span></span><br><span class="line">    tmp=x1*w1+x2*w2</span><br><span class="line">    <span class="keyword">if</span> tmp&lt;=theta:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> tmp&gt;theta:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#Test</span></span><br><span class="line">AND(<span class="number">0</span>,<span class="number">0</span>)  <span class="comment">#è¾“å‡º0</span></span><br><span class="line">AND(<span class="number">1</span>,<span class="number">0</span>)  <span class="comment">#è¾“å‡º0</span></span><br><span class="line">AND(<span class="number">0</span>,<span class="number">1</span>)  <span class="comment">#è¾“å‡º0</span></span><br><span class="line">AND(<span class="number">1</span>,<span class="number">1</span>)  <span class="comment">#è¾“å‡º1</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æˆ–é—¨æ„ŸçŸ¥æœº</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">OR</span><span class="params">(x1,x2)</span>:</span></span><br><span class="line">    w1,w2,theta=<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.2</span></span><br><span class="line">    tmp=x1*w1+x2*w2</span><br><span class="line">    <span class="keyword">if</span> tmp&lt;=theta:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> tmp&gt;theta:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#Test</span></span><br><span class="line">OR(<span class="number">0</span>,<span class="number">0</span>)  <span class="comment">#è¾“å‡º0</span></span><br><span class="line">OR(<span class="number">1</span>,<span class="number">0</span>)  <span class="comment">#è¾“å‡º1</span></span><br><span class="line">OR(<span class="number">0</span>,<span class="number">1</span>)  <span class="comment">#è¾“å‡º1</span></span><br><span class="line">OR(<span class="number">1</span>,<span class="number">1</span>)  <span class="comment">#è¾“å‡º1</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸éé—¨æ„ŸçŸ¥æœº</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">NAND</span><span class="params">(x1,x2)</span>:</span></span><br><span class="line">    w1,w2,theta=<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.7</span></span><br><span class="line">    tmp=x1*w1+x2*w2</span><br><span class="line">    <span class="keyword">if</span> tmp&lt;=theta:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> tmp&gt;theta:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Test</span></span><br><span class="line">XOR(<span class="number">0</span>,<span class="number">0</span>)  <span class="comment">#è¾“å‡º1</span></span><br><span class="line">XOR(<span class="number">1</span>,<span class="number">0</span>)  <span class="comment">#è¾“å‡º1</span></span><br><span class="line">XOR(<span class="number">0</span>,<span class="number">1</span>)  <span class="comment">#è¾“å‡º1</span></span><br><span class="line">XOR(<span class="number">1</span>,<span class="number">1</span>)  <span class="comment">#è¾“å‡º0</span></span><br></pre></td></tr></table></figure><p>æ¯«æ— æŠ€æœ¯å«é‡ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸ç»†è®²ä»£ç ã€‚</p><p><strong>æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•è¡¨ç¤ºå¼‚æˆ–é—¨ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">XOR</span><span class="params">(x1,x2)</span>:</span></span><br><span class="line">    s1=NAND(x1,x2)</span><br><span class="line">    s2=OR(x1,x2)</span><br><span class="line">    y=AND(s1,s2)</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">XOR(<span class="number">0</span>,<span class="number">0</span>)   <span class="comment">#è¾“å‡º0</span></span><br><span class="line">XOR(<span class="number">1</span>,<span class="number">0</span>)   <span class="comment">#è¾“å‡º1</span></span><br><span class="line">XOR(<span class="number">0</span>,<span class="number">1</span>)   <span class="comment">#è¾“å‡º1</span></span><br><span class="line">XOR(<span class="number">1</span>,<span class="number">1</span>)   <span class="comment">#è¾“å‡º0</span></span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶å¼‚æˆ–é—¨çš„å®ç°å€ŸåŠ©äº†å¦å¤–ä¸‰ä¸ªé—¨ï¼<br>ä¸‹é¢ä»<strong>å‡ ä½•è§’åº¦</strong>ä¸Šçœ‹çœ‹å¼‚æˆ–é—¨ï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vTW3sH.png" alt="å¼‚æˆ–é—¨åŒºåŸŸ" title="markdown"><br><strong>æ˜¾ç„¶ï¼šå¼‚æˆ–é—¨åˆ’åˆ†çš„ç©ºé—´æ˜¯éçº¿æ€§çš„ï¼è€Œå¦å¤–ä¸‰ä¸ªé—¨åˆ’åˆ†éƒ½æ˜¯çº¿æ€§çš„ï¼</strong></p><p>ç°åœ¨å†å›å¤´æ€è€ƒï¼Œå‘ç°é€šè¿‡å¯¹ç®€å•é—¨çš„å åŠ ï¼Œå®ç°äº†éçº¿æ€§åˆ’åˆ†ç©ºé—´çš„å¤æ‚é—¨ï¼</p><h2 id="å›åˆ°ç¥ç»ç½‘ç»œä¸­"><a href="#å›åˆ°ç¥ç»ç½‘ç»œä¸­" class="headerlink" title="å›åˆ°ç¥ç»ç½‘ç»œä¸­"></a>å›åˆ°ç¥ç»ç½‘ç»œä¸­</h2><p>ç¥ç»ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œéšè—å±‚ä¸­ä¸»è¦æ˜¯Affineå±‚å’Œå„ç§æ¿€æ´»å‡½æ•°å±‚ï¼š<br><img src="https://s1.ax1x.com/2022/09/05/vTW8Ld.png" alt="net" title="markdown"><br>ç°åœ¨å‡è®¾æŠŠæ¿€æ´»å‡½æ•°éƒ½åˆ æ‰ï¼Œä¹Ÿå°±æ˜¯è¯´ç»è¿‡ä¸€å±‚ä»¿å°„å˜æ¢åä¸åŠ å¤„ç†ç»§ç»­ä¸‹ä¸€å±‚ä»¿å°„å˜æ¢ã€‚</p><blockquote><p>æ¯”å¦‚ï¼šx-&gt;wÂ·x=y-&gt;wâ€™Â·y=zâ€¦ï¼ˆçŸ©é˜µç‚¹ä¹˜ï¼‰</p></blockquote><p>è¿™æ ·ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶ã€‚</p><blockquote><p>æ³¨æ„ï¼š x-&gt;wÂ·x=y-&gt;wâ€™Â·y=zå°±ç›¸å½“äºz=cx,å…¶ä¸­c=wÂ·wâ€™</p></blockquote><p>è¿™è¯´æ˜<strong>ä¸¤å±‚ä»¿å°„å˜æ¢åçš„è¡¨è¾¾å¼ç»“æ„è¿˜æ˜¯çº¿æ€§çš„ï¼ï¼</strong>åŒç†nå±‚ä¹‹åè¿˜æ˜¯çº¿æ€§ï¼è¿™ç®€ç›´æ˜¯æ— ç”¨åŠŸï¼è¦è®°ä½ï¼Œç¥ç»ç½‘ç»œé‚£ä¹ˆå¤šå±‚çš„ç›®çš„æ˜¯å°½å¯èƒ½å­¦ä¹ å¦‚ä½•é€¼è¿‘æ•°æ®ï¼Œå¦‚æœæ•°æ®æ˜¯éçº¿æ€§ç»“æ„æ’å¸ƒçš„ï¼Œé‚£å åŠ å†å¤šä¹Ÿæ¯«æ— åµç”¨ï¼<br>æ‰€ä»¥ç°åœ¨å†æ¥çœ‹çœ‹è¿™ä¸ªé—®é¢˜ï¼š<strong>ä¸ºä»€ä¹ˆéœ€è¦æ¿€æ´»å‡½æ•°ï¼Ÿ</strong></p><h2 id="æ€»ç»“ä¸€ä¸‹ï¼š"><a href="#æ€»ç»“ä¸€ä¸‹ï¼š" class="headerlink" title="æ€»ç»“ä¸€ä¸‹ï¼š"></a>æ€»ç»“ä¸€ä¸‹ï¼š</h2><p>å¦‚æœä¸ç”¨æ¿€åŠ±å‡½æ•°ï¼ˆå…¶å®ç›¸å½“äºæ¿€åŠ±å‡½æ•°æ˜¯f(x) = xï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä½ æ¯ä¸€å±‚èŠ‚ç‚¹çš„è¾“å…¥éƒ½æ˜¯ä¸Šå±‚è¾“å‡ºçš„çº¿æ€§å‡½æ•°ï¼Œå¾ˆå®¹æ˜“éªŒè¯ï¼Œ<strong>æ— è®ºä½ ç¥ç»ç½‘ç»œæœ‰å¤šå°‘å±‚ï¼Œè¾“å‡ºéƒ½æ˜¯è¾“å…¥çš„çº¿æ€§ç»„åˆ</strong>ï¼Œä¸æ²¡æœ‰éšè—å±‚æ•ˆæœç›¸å½“ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯æœ€åŸå§‹çš„æ„ŸçŸ¥æœºï¼ˆPerceptronï¼‰äº†ï¼Œé‚£ä¹ˆç½‘ç»œçš„é€¼è¿‘èƒ½åŠ›å°±ç›¸å½“æœ‰é™ã€‚æ­£å› ä¸ºä¸Šé¢çš„åŸå› ï¼Œæˆ‘ä»¬å†³å®šå¼•å…¥éçº¿æ€§å‡½æ•°ä½œä¸ºæ¿€åŠ±å‡½æ•°ï¼Œè¿™æ ·æ·±å±‚ç¥ç»ç½‘ç»œè¡¨è¾¾èƒ½åŠ›å°±æ›´åŠ å¼ºå¤§ï¼ˆä¸å†æ˜¯è¾“å…¥çš„çº¿æ€§ç»„åˆï¼Œè€Œæ˜¯<strong>å‡ ä¹å¯ä»¥é€¼è¿‘ä»»æ„å‡½æ•°</strong>ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¥ç»ç½‘ç»œ </tag>
            
            <tag> æ¿€æ´»å‡½æ•° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å•çš„3å±‚ç¥ç»ç½‘ç»œå®ç°</title>
      <link href="/2018/08/19/%E7%AE%80%E5%8D%95%E7%9A%843%E5%B1%82%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0/"/>
      <url>/2018/08/19/%E7%AE%80%E5%8D%95%E7%9A%843%E5%B1%82%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="ä½¿ç”¨sigmoidä½œä¸ºæ¿€æ´»å‡½æ•°çš„æç®€3å±‚ç¥ç»ç½‘ç»œ-å‰å‘-èŒƒä¾‹"><a href="#ä½¿ç”¨sigmoidä½œä¸ºæ¿€æ´»å‡½æ•°çš„æç®€3å±‚ç¥ç»ç½‘ç»œ-å‰å‘-èŒƒä¾‹" class="headerlink" title="ä½¿ç”¨sigmoidä½œä¸ºæ¿€æ´»å‡½æ•°çš„æç®€3å±‚ç¥ç»ç½‘ç»œ(å‰å‘)èŒƒä¾‹"></a>ä½¿ç”¨sigmoidä½œä¸ºæ¿€æ´»å‡½æ•°çš„æç®€3å±‚ç¥ç»ç½‘ç»œ(å‰å‘)èŒƒä¾‹</h2><h3 id="å¯¼å…¥numpyåº“"><a href="#å¯¼å…¥numpyåº“" class="headerlink" title="å¯¼å…¥numpyåº“"></a>å¯¼å…¥numpyåº“</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰sigmoidå‡½æ•°"><a href="#å®šä¹‰sigmoidå‡½æ•°" class="headerlink" title="å®šä¹‰sigmoidå‡½æ•°"></a>å®šä¹‰sigmoidå‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>/(<span class="number">1</span>+np.exp(-x))</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–ç¥ç»ç½‘ç»œ"><a href="#åˆå§‹åŒ–ç¥ç»ç½‘ç»œ" class="headerlink" title="åˆå§‹åŒ–ç¥ç»ç½‘ç»œ"></a>åˆå§‹åŒ–ç¥ç»ç½‘ç»œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_network</span><span class="params">()</span>:</span></span><br><span class="line">    network=&#123;&#125;</span><br><span class="line">    network[<span class="string">'w1'</span>]=np.array([[<span class="number">0.1</span>,<span class="number">0.3</span>,<span class="number">0.5</span>],[<span class="number">0.2</span>,<span class="number">0.4</span>,<span class="number">0.6</span>]])</span><br><span class="line">    network[<span class="string">'w2'</span>]=np.array([[<span class="number">0.1</span>,<span class="number">0.4</span>],[<span class="number">0.2</span>,<span class="number">0.5</span>],[<span class="number">0.3</span>,<span class="number">0.6</span>]])</span><br><span class="line">    network[<span class="string">'w3'</span>]=np.array([[<span class="number">0.1</span>,<span class="number">0.3</span>],[<span class="number">0.2</span>,<span class="number">0.4</span>]])</span><br><span class="line">    network[<span class="string">'b1'</span>]=np.array([<span class="number">0.1</span>,<span class="number">0.2</span>,<span class="number">0.3</span>])</span><br><span class="line">    network[<span class="string">'b2'</span>]=np.array([<span class="number">0.1</span>,<span class="number">0.2</span>])</span><br><span class="line">    network[<span class="string">'b3'</span>]=np.array([<span class="number">0.1</span>,<span class="number">0.2</span>])</span><br><span class="line">    <span class="keyword">return</span> network</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰ç¥ç»ç½‘ç»œ"><a href="#å®šä¹‰ç¥ç»ç½‘ç»œ" class="headerlink" title="å®šä¹‰ç¥ç»ç½‘ç»œ"></a>å®šä¹‰ç¥ç»ç½‘ç»œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(network,x)</span>:</span></span><br><span class="line">    w1,w2,w3=network[<span class="string">'w1'</span>],network[<span class="string">'w2'</span>],network[<span class="string">'w3'</span>]</span><br><span class="line">    b1,b2,b3=network[<span class="string">'b1'</span>],network[<span class="string">'b2'</span>],network[<span class="string">'b3'</span>]</span><br><span class="line">    </span><br><span class="line">    a1=np.dot(x,w1)+b1</span><br><span class="line">    z1=sigmoid(a1)</span><br><span class="line">    a2=np.dot(z1,w2)+b2</span><br><span class="line">    z2=sigmoid(a2)</span><br><span class="line">    a3=np.dot(z2,w3)+b3</span><br><span class="line">    y=a3</span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure><h3 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">network=init_network()</span><br><span class="line">x=np.array([<span class="number">1.0</span>,<span class="number">0.5</span>])</span><br><span class="line">y=forward(network,x)</span><br><span class="line">print(y)<span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/09/05/vTWyes.jpg" alt="ç¥ç»ç½‘ç»œ" title="ç¥ç»ç½‘ç»œ"></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç¥ç»ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ„ŸçŸ¥æœºåˆè¯†</title>
      <link href="/2018/08/10/%E6%84%9F%E7%9F%A5%E6%9C%BA%E5%88%9D%E8%AF%86/"/>
      <url>/2018/08/10/%E6%84%9F%E7%9F%A5%E6%9C%BA%E5%88%9D%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="æ„ŸçŸ¥æœºï¼ˆperceptron"><a href="#æ„ŸçŸ¥æœºï¼ˆperceptron" class="headerlink" title="æ„ŸçŸ¥æœºï¼ˆperceptron)"></a>æ„ŸçŸ¥æœºï¼ˆperceptron)</h1><p>æ„ŸçŸ¥æœºæ˜¯ç¥ç»ç½‘ç»œï¼ˆæ·±åº¦å­¦ä¹ ï¼‰çš„èµ·æºç®—æ³•ï¼Œå­¦ä¹ æ„ŸçŸ¥æœºçš„æ„é€ æ˜¯é€šå‘ç¥ç»ç½‘ç»œå’Œæ·±åº¦å­¦ä¹ çš„ä¸€ç§é‡è¦æ€æƒ³ã€‚</p><blockquote><p>ä¸¥æ ¼è®²ï¼Œåº”è¯¥ç§°ä¸ºâ€œäººå·¥ç¥ç»å…ƒâ€æˆ–â€œæœ´ç´ æ„ŸçŸ¥æœºâ€ï¼Œä½†æ˜¯å› ä¸ºå¾ˆå¤šåŸºæœ¬çš„å¤„ç†éƒ½æ˜¯å…±é€šçš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç®€å•åœ°ç§°ä¸ºâ€œæ„ŸçŸ¥æœºâ€ã€‚</p></blockquote><h2 id="åŸç†ç®€ä»‹ï¼š"><a href="#åŸç†ç®€ä»‹ï¼š" class="headerlink" title="åŸç†ç®€ä»‹ï¼š"></a>åŸç†ç®€ä»‹ï¼š</h2><p>æ„ŸçŸ¥æœºæ¥æ”¶å¤šä¸ªè¾“å…¥ä¿¡å·ï¼Œè¾“å‡ºä¸€ä¸ªä¿¡å·ã€‚<br>è¿™é‡Œæ‰€è¯´çš„â€œä¿¡å·â€å¯ä»¥æƒ³ è±¡æˆç”µæµæˆ–æ²³æµé‚£æ ·å…·å¤‡â€œ<strong>æµåŠ¨æ€§</strong>â€çš„ä¸œè¥¿ã€‚<br>åƒç”µæµæµè¿‡å¯¼çº¿ï¼Œå‘å‰æ–¹è¾“é€ ç”µå­ä¸€æ ·ï¼Œæ„ŸçŸ¥æœºçš„ä¿¡å·ä¹Ÿä¼šå½¢æˆæµï¼Œå‘å‰æ–¹è¾“é€ä¿¡æ¯ã€‚<br>ä½†æ˜¯ï¼Œå’Œå®é™…çš„ç”µ æµä¸åŒçš„æ˜¯ï¼Œæ„ŸçŸ¥æœºçš„ä¿¡å·åªæœ‰<strong>â€œæµ/ä¸æµâ€ï¼ˆ1/0ï¼‰</strong>ä¸¤ç§å–å€¼ã€‚<br>0 å¯¹åº”â€œä¸ä¼ é€’ä¿¡å·â€ï¼Œ1å¯¹åº”â€œä¼ é€’ä¿¡å·â€ã€‚</p><p><img src="http://r.photo.store.qq.com/psb?/V14eJTFY137vJk/Jb9LnAgcqtwC7udEtAvxtUYaeAQmdphrXHM8w98K9MQ!/r/dIoBAAAAAAAA" alt="net" title="markdown"></p><p><strong>å¦‚å›¾</strong></p><ul><li>x<sub>1</sub> ã€x<sub>2</sub>æ˜¯è¾“å…¥ä¿¡å·ï¼Œ</li><li>y æ˜¯è¾“å‡ºä¿¡å·ï¼Œ</li><li>w<sub>1</sub>ã€w<sub>2</sub>æ˜¯æƒé‡ ï¼ˆw æ˜¯ weight çš„é¦–å­—æ¯ï¼‰ã€‚</li><li>å›¾ä¸­çš„â—‹ç§°ä¸ºâ€œç¥ç»å…ƒâ€æˆ–è€…â€œèŠ‚ç‚¹â€ã€‚</li><li>è¾“å…¥ä¿¡å·è¢«é€å¾€ç¥ç»å…ƒæ—¶ï¼Œä¼šè¢«åˆ†åˆ«ä¹˜ä»¥å›ºå®šçš„æƒé‡ï¼ˆw<sub>1</sub> x<sub>1</sub> , w<sub>2</sub> x<sub>2</sub> ï¼‰ã€‚</li><li>ç¥ç»å…ƒä¼šè®¡ç®—ä¼ é€è¿‡æ¥çš„ä¿¡å·çš„æ€»å’Œï¼Œåªæœ‰å½“è¿™ä¸ªæ€»å’Œè¶…è¿‡ äº†æŸä¸ªç•Œé™å€¼æ—¶ï¼Œæ‰ä¼šè¾“å‡º1ï¼ˆè¿™ä¹Ÿç§°ä¸ºâ€œç¥ç»å…ƒè¢«æ¿€æ´»ï¼‰ã€‚</li><li>è¿™é‡Œå°†è¿™ä¸ªç•Œé™å€¼ç§°ä¸ºé˜ˆå€¼ï¼Œç”¨ç¬¦å·Î¸è¡¨ç¤ºã€‚</li></ul><p>æ„ŸçŸ¥æœºçš„å¤šä¸ªè¾“å…¥ä¿¡å·éƒ½æœ‰å„è‡ªå›ºæœ‰çš„æƒé‡ï¼Œè¿™äº›æƒé‡å‘æŒ¥ç€æ§åˆ¶å„ä¸ª ä¿¡å·çš„é‡è¦æ€§çš„ä½œç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæƒé‡è¶Šå¤§ï¼Œå¯¹åº”è¯¥æƒé‡çš„ä¿¡å·çš„é‡è¦æ€§å°±è¶Šé«˜ã€‚<br>æƒé‡ï¼šç›¸å½“äºç”µæµé‡Œçš„ç”µé˜»ã€‚ç”µé˜»æ˜¯å†³å®šç”µæµæµåŠ¨éš¾åº¦çš„å‚æ•°ï¼Œ ç”µé˜»è¶Šä½ï¼Œé€šè¿‡çš„ç”µæµå°±è¶Šå¤§ã€‚<br>è€Œæ„ŸçŸ¥æœºçš„æƒé‡åˆ™æ˜¯å€¼è¶Šå¤§ï¼Œé€šè¿‡çš„ä¿¡å·å°±è¶Šå¤§ã€‚<br>ä¸ç®¡æ˜¯ç”µé˜»è¿˜æ˜¯æƒé‡ï¼Œåœ¨æ§åˆ¶ä¿¡å·æµåŠ¨éš¾åº¦ï¼ˆæˆ–è€…æµ åŠ¨å®¹æ˜“åº¦ï¼‰è¿™ä¸€ç‚¹ä¸Šçš„ä½œç”¨éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ„ŸçŸ¥æœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2015/01/20/hello-world/"/>
      <url>/2015/01/20/hello-world/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
